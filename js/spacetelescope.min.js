/*!
	SpaceTelescope
	(c) Stuart Lowe and Chris North 2014-5
*/
if(typeof $==="undefined"){$={}}(function(e){var s={};s.log10=function(i){return Math.log(i)/2.302585092994046};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(i){window.setTimeout(i,1000/60)}})();var u={supportsFullScreen:false,isFullScreen:function(){return false},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},a="webkit moz o ms khtml".split(" ");if(typeof document.cancelFullScreen!="undefined"){u.supportsFullScreen=true}else{for(var A=0,r=a.length;A<r;A++){u.prefix=a[A];if(typeof document[u.prefix+"CancelFullScreen"]!="undefined"){u.supportsFullScreen=true;break}}}if(u.supportsFullScreen){u.fullScreenEventName=u.prefix+"fullscreenchange";u.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}};u.requestFullScreen=function(i){return(this.prefix==="")?i.requestFullScreen():i[this.prefix+"RequestFullScreen"]()};u.cancelFullScreen=function(i){return(this.prefix==="")?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}}if(typeof jQuery!="undefined"){jQuery.fn.requestFullScreen=function(){return this.each(function(){if(u.supportsFullScreen){u.requestFullScreen(this)}})}}window.fullScreenApi=u;Raphael.el.animateAlong=function(L,K,J,I,M){var i=this;i.zforward=(!g(M,"boolean"))?false:M;i.atFront=false;i.path=L;i.direction=I;i.pathLen=i.path.getTotalLength();K=(g(K,"undefined"))?5000:K;J=(g(J,"undefined"))?1:J;i.paper.customAttributes.along=function(P){var O=(this.direction&&this.direction<0)?(1-P)*this.pathLen:(P*this.pathLen);var N=this.path.getPointAtLength(O),Q={cx:N.x,cy:N.y};if(this.zforward){if(P>0.5&&!this.atFront){this.toFront();this.atFront=true}if(P>0&&P<0.5&&this.atFront){this.toBack();this.atFront=false}}this.rotateWith&&(Q.transform="r"+N.alpha);return Q};i.attr({along:0});var G=Raphael.animation({along:1},K);i.animate(G.repeat(J))};(function(){var G=0;var I=["ms","moz","webkit","o"];for(var i=0;i<I.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[I[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[I[i]+"CancelAnimationFrame"]||window[I[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(N,K){var J=new Date().getTime();var L=Math.max(0,16-(J-G));var M=window.setTimeout(function(){N(J+L)},L);G=J+L;return M}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(J){clearTimeout(J)}}}());e.query=function(){var i={length:0};var G=location.search;if(G&&G!="#"){G=G.replace(/^\?/,"").replace(/\&$/,"");jQuery.each(G.split("&"),function(){var I=this.split("=")[0];var J=this.split("=")[1];if(/^[0-9\.]+$/.test(J)){J=parseFloat(J)}i[I]=J})}return i};document.write('<style type="text/css">.noscriptmsg { display: none; }</style>');function H(G){if(typeof e!=="function"){this.log("No jQuery! Abort! Abort!");return this}this.q=e.query();this.i=G;this.stage="intro";this.choices={};this.sections=["objectives","satellite","instruments","cooling","vehicle","site","orbit","proposal"];this.keyboard=true;this.errors=[];this.warnings=[];this.launchstep=0;this.langurl="config/%LANG%%MODE%.json";this.dataurl="config/options%MODE%.json";this.scenariourl="config/scenarios_%LANG%%MODE%.json";this.keys=new Array();this.pushstate=!!(window.history&&history.pushState);this.settings={length:"m",currency:"GBP",temperature:"K",mass:"kg",time:"years",usecookies:false,mode:"normal"};this.init(G);var I="transform WebkitTransform MozTransform OTransform msTransform".split(" ");this.hastransform=false;for(var i=0;i<I.length;i++){var J=document.createElement("div");if(J.style[I[i]]!=undefined){this.hastransform=true}}return this}H.prototype.init=function(i){this.lang=(g(this.q.lang,"string"))?this.q.lang:(navigator)?(navigator.userLanguage||navigator.systemLanguage||navigator.language||browser.language):"";this.langshort=(this.lang.indexOf("-")>0?this.lang.substring(0,this.lang.indexOf("-")):this.lang.substring(0,2));this.langs=(i&&i.langs)?i.langs:{en:"English"};this.setVar("currency","string");this.setVar("length","string");this.setVar("mass","string");this.setVar("temperature","string");this.setVar("time","string");this.setVar("mode","string");this.addEvents();this.startup();return this};H.prototype.addEvents=function(){var J=this;window[(this.pushstate)?"onpopstate":"onhashchange"]=function(i){J.navigate(i)};list=e("#language ul li a");for(var I=0;I<list.length;I++){e(list[I]).on("click",{me:this},function(i){i.preventDefault();i.data.me.loadLanguage(e(this).attr("data"),i.data.me.update)})}e("#summary a").on("click",{me:this},function(i){i.data.me.toggleMenus("summaryext",i)});e("a.togglewarning,a.toggleerror").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("messages")});e("a.togglemenu").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("menu")});e("a.togglelang").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("language")});e(document).on("dragenter","#application",function(i){i.preventDefault()});e(document).on("dragover","#application",function(i){i.preventDefault();e(this).css("opacity",0.75)});e(document).on("drop",function(i){i.preventDefault()});function G(K,L){if(K[0].type=="text/plain"||K[0].type==""){var i=new FileReader();i.onload=(function(M){return function(N){L.processFile(N.target.result).toggleMenus()}})(K[0]);i.readAsText(K[0])}}e(document).on("drop","#application",{me:this},function(K){K.preventDefault();e(this).css({opacity:1});var i=K.originalEvent.dataTransfer.files;G(i,K.data.me);return false});if(g(Blob,"function")){e("#menu ul").append('<li class="baritem" data="load"><a href="#"><img src="images/cleardot.gif" class="icon load" alt="" /><span>Load</span></a><input type="file" id="files" name="files[]" multiple /></li>');e(document).on("change","#files",{me:this},function(i){G(i.target.files,i.data.me)});e("#menu ul").append('<li class="baritem" data="save"><a href="#"><img src="images/cleardot.gif" class="icon save" alt="" /><span>Save</span></a></li>')}if(u.supportsFullScreen){e("#menu ul").append('<li class="baritem" data="fullscreen"><a href="#" class="fullscreenbtn"><img src="images/cleardot.gif" class="icon fullscreen" alt="" /> <span></span></li>');e(".baritem .fullscreenbtn").parent().on("click",{me:this},function(i){i.data.me.toggleFullScreen().toggleMenus()})}e(".baritem .load").parent().on("click",{me:this},function(i){e("#files").trigger("click")});e(".baritem .save").parent().on("click",{me:this},function(i){i.data.me.save().toggleMenus()});e(".baritem .help").parent().on("click",{me:this},function(i){i.data.me.toggleGuide(i).toggleMenus()});e(".baritem .restart").parent().on("click",{me:this},function(i){i.data.me.toggleMenus()});e(".baritem .options").parent().on("click",{me:this},function(i){i.data.me.showView("options",i).toggleMenus()});e("body").on("click","a.guidelink",{me:this},function(i){if(e(this).attr("href").indexOf("#")==0){i.data.me.showView(e(this).attr("href").substr(1),i)}i.data.me});e(document).on("keypress",{me:this},function(K){if(!K){K=window.event}var i=K.keyCode||K.charCode||K.which||0;K.data.me.keypress(i,K)});this.registerKey(["?"],function(i){this.toggleGuide(i)});e(document).on("scroll",{me:this},function(i){i.data.me.scrollMenus()});e(".scriptonly").removeClass("scriptonly");e(document).on("focus","input,textarea",{me:this},function(i){i.data.me.keyboard=false}).on("blur","input,textarea",{me:this},function(i){i.data.me.keyboard=true});e(document).on("click","#scenarios .button",{me:this},function(i){i.data.me.chooseScenario(e(this).attr("data"))});e(document).on("click","#messages a",{me:this},function(i){e("#messages").hide()});e(document).on("click",".remove_instrument",{me:this},function(i){i.preventDefault();i.data.me.removeInstrument(e(this).attr("data"))});e(document).on("change","#designer_cooling .options input,#designer_cooling .options select",{me:this},function(i){if(i.data.me.getValue("input[name=hascooling]:checked")=="yes"){e("#designer_cooling li.hascooling").show()}else{e("#designer_cooling li.hascooling").hide()}i.data.me.parseChoices().showDetails("cooling")});e(document).on("click","#designer_vehicle .options .button",{me:this},function(i){i.preventDefault();e("#designer_vehicle .info>li."+e(this).attr("data")).find("input").trigger("click")});e(document).on("change","#designer_vehicle .options .selector input",{me:this},function(i){e("#designer_vehicle .info>li").removeClass("selected");e("#designer_vehicle .info>li."+e(this).attr("data")).addClass("selected").find("input").trigger("click");i.data.me.parseChoices()});e(document).on("click","#designer_vehicle .options .info>li",{me:this},function(i){if(!e(this).hasClass("withinfo")){e(".withinfo").removeClass("withinfo");e(this).addClass("withinfo");e("#designer_vehicle .details").html(e(this).find(".vehicle_details").html()).addClass("padded")}});e(document).on("click","#designer_site .launchsite",{me:this},function(i){i.preventDefault();e("#designer_site #site").val(e(this).attr("data"));e("#designer_site #site").trigger("change")});e(document).on("submit","form",{me:this},function(i){i.preventDefault()});e(document).on("change",".doc input,.doc textarea",{me:this},function(i){i.data.me.updateProposal()});e(document).on("click",".printable a.button",{me:this},function(i){i.preventDefault();i.data.me.printProposal()});e(document).on("click",".relaunch a.button",{me:this},function(i){i.preventDefault();i.data.me.relaunch()});e(document).on("click","#launchnav a.button",{me:this},function(i){i.preventDefault();i.data.me.launch()});e(document).on("click",".toggler",{me:this},function(K){var i=e(this).find("input:checked");if(i.attr("value")=="yes"){e(this).addClass("checked")}else{e(this).removeClass("checked")}if(i.attr("id").indexOf("mode")==0){var L=(i.attr("value")=="yes"?"advanced":"normal");if(K.data.me.settings.mode!=L){K.data.me.setMode(L)}}});e(document).on("change","#designer_satellite select, #designer_satellite input",{me:this},function(i){i.data.me.parseChoices().showDetails("satellite").showDetails("cooling")});e(document).on("change","#designer_instruments select",{me:this},function(M){var L=M.data.me.getValue("#instruments");var K=M.data.me.getValue("#wavelengths");M.data.me.parseChoices().showDetails("instruments",{wavelength:K,type:L});e(".add_instrument.hidden").removeClass("hidden")});e(document).on("click","#designer_instruments .add_instrument",{me:this},function(i){i.preventDefault();i.data.me.addInstrument()});e(document).on("change","#designer_site #site",{me:this},function(K){var i=K.data.me.getValue("#site");e(".launchsite").removeClass("selected");e(".launchsite[data="+i+"]").addClass("selected");K.data.me.parseChoices().showDetails("site",i)});e(document).on("change","#mission_orbit",{me:this},function(K){var i=K.data.me.getValue("#mission_orbit");K.data.me.highlightOrbit(i).parseChoices().showDetails("orbit",i).showDetails("cooling")});e(document).on("change","#mission_duration",{me:this},function(i){i.data.me.parseChoices()});e(document).on("submit","#designer_instruments form",{me:this},function(i){i.preventDefault();e(this).find("a.add_instrument").trigger("click")});e(window).resize({me:this},function(i){i.data.me.resize()});return this};H.prototype.startup=function(i){this.data=null;this.phrases=null;this.choices={};this.scenarios=null;this.buildTable();if(g(i,"function")){i=[this.update,i]}else{i=[this.update]}this.loadConfig();this.loadLanguage(this.lang,i);var G="";var I=0;for(l in this.langs){G+='<li class="baritem"><a href="#" title="'+this.langs[l]+'" data="'+l+'">'+this.langs[l]+" ["+l+"]</a></li>";I++}e("#language ul").html(G);if(I<2){e(".togglelang").closest(".baritem").hide()}return this};H.prototype.setMode=function(i,G){this.settings.mode=i;this.q.mode=i;this.startup(G)};H.prototype.changeMode=function(i){this.changeToggle("togglemode","mode_"+i);return this};H.prototype.changeToggle=function(I,i){var G=this.toggles[I];if(!G){return this}if(i==G.a.id&&e("#"+G.a.id).length>0){e("#"+G.a.id).trigger("click").closest(".toggler").trigger("click")}if(i==G.b.id&&e("#"+G.a.id).length>0){e("#"+G.b.id).trigger("click").closest(".toggler").trigger("click")}return this};H.prototype.buildToggle=function(J,G,i){if(!g(J,"string")&&!g(G,"object")&&!g(i,"object")){return""}if(!this.toggles){this.toggles={}}this.toggles[J]={a:G,b:i};var I='<label class="toggle-label';if(G.checked){html='<div class="toggleinput toggler">'+I+'1" for="'+G.id+'"></label>'}else{html='<div class="toggleinput toggler checked">'+I+'1" for="'+G.id+'"></label>'}html+='<div class="toggle-bg">';html+='	<input id="'+G.id+'" type="radio" '+(G.checked?'checked="checked" ':"")+'name="'+J+'" value="'+G.value+'">';html+='	<input id="'+i.id+'" type="radio" '+(i.checked?'checked="checked" ':"")+'name="'+J+'" value="'+i.value+'">';html+='	<span class="switch"></span>';html+="</div>";html+=""+I+'2" for="'+i.id+'"></label></div>';return html};H.prototype.updateToggle=function(G,i,I){if(!g(G,"object")&&!g(i,"object")||e("#"+G.id).length==0||e("#"+i.id).length==0){return this}if(!I){I=""}if(!G.label){G.label=""}if(!i.label){i.label=""}e("#"+G.id+",#"+i.id).attr("title",I);e("label[for="+G.id+"]").html(G.label);e("label[for="+i.id+"]").html(i.label);return this};H.prototype.buildPage=function(){if(this.built){return this.updatePage()}this.built=true;e("#scenarios").html('<h2></h2><p class="about"></p><ul id="scenariolist"></ul>');e("#messages .warnings").html('<div class="bigpadded"><h3 class="warning"><img src="images/cleardot.gif" class="icon warning" /> <span class="title"></span> <span class="warning value">0</span></h3><ul class="summary"></ul>');e("#messages .errors").html('<div class="bigpadded"><h3 class="error"><img src="images/cleardot.gif" class="icon error" /> <span class="title"></span> <span class="error value">0</span></h3><ul class="summary"></ul>');e("#designer").html('<div class="designer_inner bigpadded"><div id="main"><div id="menubar"></div><div id="output"></div><div id="sidebar"><div class="padded"></div></div></div></div>');for(var G=0;G<this.sections.length;G++){if(e("#designer_"+this.sections[G]).length==0){e("#output").append('<div id="designer_'+this.sections[G]+'" class="designer"><h2 class="designer_title"><a href="#designer_'+this.sections[G]+'" class="toggle'+this.sections[G]+'"></a></h2><div class="designer_content"><div class="intro"></div><div class="options"></div><div class="questions"></div></div></div>')}}e(".barmenu").append('<div class="baritem togglelaunch"><a href="#launch" class="">Launch</a></div>');e("#designer_objectives .intro").after('<div class="summary"></div>');e("#designer_satellite .options").html('<div class="bigpadded"><form><ul><li class="option mirror_diameter"><label for="mirror_size"></label><select id="mirror_size" name="mirror_size"></select></li><li class="option mirror_deployable"><label for="mirror_deployable"></label>'+this.buildToggle("toggledeployable",{value:"no",id:"mirror_deployable_no",label:"",checked:true},{value:"yes",id:"mirror_deployable_yes",label:""})+'</li><li class="option mirror_uv"><label for="mirror_uv"></label>'+this.buildToggle("toggleuv",{value:"no",id:"mirror_uv_no",checked:true},{value:"yes",id:"mirror_uv_yes"})+'</li></ul></form><div class="details"></div></div>');e("#designer_instruments .options").html('<div class="bigpadded"><form><ul><li><label for="instruments"></label><select id="wavelengths" name="wavelengths"></select><select id="instruments" name="instruments"></select> <input type="text" id="instrument_name" name="instrument_name" /></li></ul></form><div class="details"></div><a href="#" class="add_instrument hidden"><img src="images/cleardot.gif" class="icon add" /><span>'+this.phrases.designer.instruments.options.add+'</span></a></div><div class="instrument_list bigpadded"></div>');e("#designer_cooling .options").html('<div class="bigpadded"><form><ul></ul></form><div class="details"></div></div>');e("#designer_site .options").html('<div class="worldmap"><img src="images/worldmap.jpg" /></div><div class="bigpadded"><form><ul><li><label for="site"></label><select id="site" name="site"></select></li></ul></form><div class="details"></div></div>');e("#designer_orbit .options").html('<div id="orbits"></div><div id="orbits2"></div><div class="bigpadded"><form><ul><li><label for="mission_orbit"></label><select id="mission_orbit" name="mission_orbit"></select></li><li><label for="mission_duration"></label><select id="mission_duration" name="mission_duration"></select></li></ul></form><div class="details"></div></div>');e("#designer_proposal .options").html('<div class="padded"><div class="doc"></div></div>');e("#sidebar").html('<div class="sidebar_inner"><div class="satellite panel" id="sidebar_satellite"></div><div class="vehicle padded panel"></div><div class="site worldmap panel"></div><div class="orbit panel"></div></div>');this.buildTable();this.updatePage();return this};H.prototype.updatePage=function(){var J="";for(var I=0;I<this.sections.length;I++){J+='<li><a href="#designer_'+this.sections[I]+'" class="toggle'+this.sections[I]+'"></a></li>'}e("#menubar").html("<ul>"+J+"</ul>");e("#designer_cooling .options form ul li").remove();e("#designer_cooling .options form ul").append('<li><label for="hascooling"></label>'+this.buildToggle("hascooling",{value:"no",id:"cooling_no",checked:true},{value:"yes",id:"cooling_yes"})+"</li>");if(this.data.cooling.temperature){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_temperature"></label><select id="cooling_temperature" name="cooling_temperature"></select></li>')}if(this.data.cooling.passive){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_passive"></label>'+this.buildToggle("cooling_passive",{value:"no",id:"cooling_passive_no"},{value:"yes",id:"cooling_passive_yes",checked:true})+"</li>")}if(this.data.cooling.active){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_active"></label>'+this.buildToggle("cooling_active",{value:"no",id:"cooling_active_no",checked:true},{value:"yes",id:"cooling_active_yes"})+"</li>")}if(this.data.cooling.cryogenic){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_cryogenic"></label><select id="cooling_cryogenic" name="cooling_cryogenic"></select></li>')}J='<div class="bigpadded">';J+='<form><ul class="info">';for(var G in this.data.vehicle){J+='<li class="'+G+'" data="'+G+'">';J+='<div class="image"><img src="" alt="" title="" /></div><div class="operator"><img src="" alt="" title="" /></div>';J+='<div class="vehicle_details">';J+='<div class="rocket"></div>';var K=["operator","height","diameter","currency","massLEO","massGTO",(this.data.vehicle[G].risk?"risk":""),"sites"];for(var I=0;I<K.length;I++){J+=this.buildRow("","",K[I])}J+='<div class="clearall"></div>';J+="</div>";J+='<div class="selector"><input type="radio" name="vehicle_rocket" id="vehicle_rocket_'+G+'" data="'+G+'" /><label for="vehicle_rocket_'+G+'"></label></div>';J+="</li>"}J+='</ul></form><div class="details"></div></div>';e("#designer_vehicle .options").html(J);e(".details").html("").removeClass("padded");e("#sidebar .panel").hide();return this};H.prototype.buildTable=function(){this.table={success:{list:{success_vehicle:{},success_site:{},success_orbit:{},success_deploy:{},success_cooling:{},success_instruments:{},success_mission:{}}},cost_available:{list:{cost_initial:{},cost_dev_total:{list:{cost_dev_satellite:{},cost_dev_mirror:{},cost_dev_cooling:{},cost_dev_instruments:{}}},cost_operations_total:{list:{cost_operations_launch:{},cost_operations_ground:{}}},cost_total:{},cost_available:{}}},mass_total:{list:{mass_satellite:{},mass_mirror:{},mass_cooling_total:(this.settings.mode=="advanced"?{list:{mass_cooling_passive:{},mass_cooling_cryo:{},mass_cooling_active:{}}}:{}),mass_instruments:{}}},time_dev_total:{list:{time_dev_total:{list:{time_dev_satellite:{},time_dev_mirror:{},time_dev_cooling:{},time_dev_instruments:{}}},time_mission:{},time_cooling:{},time_fuel:{},time_observing:{}}},science_total:{},profile_total:{list:{profile_site:{},profile_vehicle:{},profile_instruments:{},profile_mirror:{},profile_temperature:{},profile_orbit:{},profile_launch:{},profile_end:{}}}}};H.prototype.resize=function(){if(this.modal){this.positionModal(this.modal)}if(e("#launchanimation").length>0){e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"})}return this};H.prototype.navigate=function(G,i){if(!i){var i=location.href.split("#")[1]}this.log("navigate",i,G);if(!g(i,"string")){i=""}this.showView(i,G);return this};H.prototype.keypress=function(G,J){if(this.keyboard){if(!J){J={altKey:false}}for(var I=0;I<this.keys.length;I++){if(this.keys[I].charCode==G&&J.altKey==this.keys[I].altKey){this.keys[I].fn.call(this,{event:J});break}}}};H.prototype.registerKey=function(P,N,J){if(!g(N,"function")){return this}if(!g(P,"object")){P=[P]}var O,G,M,I,K,L;for(M=0;M<P.length;M++){K=false;if(typeof P[M]=="string"){if(P[M].indexOf("alt")==0){L=P[M];K=true;P[M]=P[M].substring(4)}else{L=P[M]}G=P[M].charCodeAt(0)}else{G=P[M];if(G==37){L="&larr;"}else{if(G==32){L="space"}else{if(G==38){L="up"}else{if(G==39){L="&rarr;"}else{if(G==40){L="down"}else{L=String.fromCharCode(G)}}}}}}O=true;for(I=0;I<this.keys.length;I++){if(this.keys.charCode==G&&this.keys.altKey==K){O=false}}if(O){this.keys.push({str:L,charCode:G,"char":String.fromCharCode(G),fn:N,txt:J,altKey:K})}}return this};H.prototype.toggleMenus=function(M,K){if(K&&g(K,"object")){K.preventDefault()}var G=e(".dropdown");var I=(K)?e(K.currentTarget).attr("href"):"";for(var J=0;J<G.length;J++){var L=this;if(e(G[J]).attr("id")==M){e(G[J]).toggle(0,function(){if(I&&I.indexOf("#")>=0){L.setScroll("#"+I.split("#")[1])}})}else{e(G[J]).hide()}}if(M=="messages"){this.setScroll("#"+M)}return this};H.prototype.scrollMenus=function(i){e(".dropdown.fullwidth:visible").each(function(){var G=parseInt(e(this).css("top"));var I=e("#bar").outerHeight();var J=window.scrollY;if(G<=I){e(".dropdown").css({top:I})}if(G>J+I){e(".dropdown").css({top:J+I})}});return this};H.prototype.setVar=function(i,I){if(g(i,"string")){if(this.i&&typeof this.i[i]===I){this.settings[i]=this.i[i]}if(typeof this.q[i]===I){this.settings[i]=this.q[i];if(this.settings.usecookies){w("spacetelescope."+i,this.settings[i],1)}}if(this.settings.usecookies){var G=B("spacetelescope."+i);if(G){this.settings[i]=G}}}return this};H.prototype.loadConfig=function(G){var i=this.dataurl.replace("%MODE%",this.getMode());e.ajax({url:i,beforeSend:function(I){if(I.overrideMimeType){I.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+i)},success:function(J){this.data=J;if(g(G,"function")){G.call(this)}if(g(G,"object")&&G.length>0){for(var I=0;I<G.length;I++){G[I].call(this)}}}});return this};H.prototype.getMode=function(){return(this.settings.mode=="advanced")?"_advanced":""};H.prototype.loadLanguage=function(G,J){if(!G){G=this.langshort}var i=this.settings.mode;var I=this.langurl.replace("%LANG%",G).replace("%MODE%",this.getMode());e.ajax({url:I,beforeSend:function(K){if(K.overrideMimeType){K.overrideMimeType("application/json")}},method:"GET",cache:false,dataType:"json",context:this,error:function(){this.log("Error loading "+G+" ("+i+")");if(this.lang.length==2){this.log("Attempting to load default (en) instead");this.loadLanguage("en",J)}else{if(I.indexOf(this.lang)>0){this.log("Attempting to load "+this.langshort+" instead");this.loadLanguage(this.langshort,J)}}},success:function(K){this.langshort=G;this.lang=G;this.phrases=K;this.log("Loaded "+G);this.loadScenarios(J)}});return this};H.prototype.loadScenarios=function(I){var i=this.settings.mode;var G=this.scenariourl.replace("%LANG%",this.langshort).replace("%MODE%",this.getMode());e.ajax({url:G,beforeSend:function(J){if(J.overrideMimeType){J.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+G+" ("+i+")");if(g(I,"function")){I.call(this)}if(g(I,"object")&&I.length>0){for(var J=0;J<I.length;J++){I[J].call(this)}}},success:function(K){this.scenarios=K.scenarios;this.log("Loaded Scenario");if(g(I,"function")){I.call(this)}if(g(I,"object")&&I.length>0){for(var J=0;J<I.length;J++){I[J].call(this)}}}});return this};H.prototype.chooseScenario=function(G){this.log("chooseScenario",G);this.scenario=this.scenarios[G];this.stage="designer";e("#summary").show();this.updateSummary().updateLanguage();return this};H.prototype.update=function(){this.log("update");if(!this.phrases||!this.data){return this}this.buildPage().updateLanguage().makeSpace("orbits").displayOrbits();e("#language.dropdown").hide();if(!this.loaded){this.navigate();this.loaded=true}return this};H.prototype.addInstrument=function(){if(!this.choices.instruments){this.choices.instruments=[]}var I=this.getValue("#instruments");var G=this.getValue("#wavelengths");var J=this.getValue("#instrument_name");if(I&&G){if(!J){J=this.phrases.designer.instruments.defaultname.replace(/%d%/,(this.choices.instruments.length+1))}this.choices.instruments.push({name:J,type:I,wavelength:G,ok:true});this.updateInstruments()}return this};H.prototype.removeInstrument=function(G){G=parseInt(G,10);if(G<this.choices.instruments.length){this.choices.instruments.splice(G,1)}this.updateInstruments();return this};H.prototype.displayInstruments=function(){var I="";var J=this.phrases.designer;this.log("displayInstruments");I+="<h3>"+J.instruments.table.title+'</h3><div class="tablewrapper"><table><tr><th>'+J.instruments.table.name+"</th><th>"+J.instruments.table.type+"</th><th>"+J.instruments.table.cost+"</th><th>"+J.instruments.table.mass+"</th><th>"+J.instruments.table.temperature+"</th><th></th></tr>";if(this.choices.instruments&&this.choices.instruments.length>0){for(var G=0;G<this.choices.instruments.length;G++){v=this.getInstrument({wavelength:this.choices.instruments[G].wavelength,type:this.choices.instruments[G].type});I+="<tr><td>"+this.choices.instruments[G].name+"</td><td>"+v.wavelength+" "+v.type+"</td><td>"+this.formatValueSpan(v.cost)+"</td><td>"+this.formatValueSpan(v.mass)+"</td><td>"+this.formatValueSpan(v.temp)+'</td><td><a class="remove_instrument" href="#" title="'+this.phrases.designer.instruments.options.remove+'" data="'+G+'"><img class="icon minus" src="images/cleardot.gif"></a></td></tr>'}}I+="</table></div>";e("#designer_instruments .instrument_list").html(I);return I};H.prototype.updateInstruments=function(){this.log("updateInstruments");this.displayInstruments();this.parseChoices("designer_instruments");return this};H.prototype.makeSatellite=function(){this.log("makeSatellite");if(!this.satellite){this.satellite=new E({id:"sidebar_satellite",spacetel:this})}this.satellite.resize();return this};H.prototype.makeSpace=function(i){this.log("makeSpace");if(!this.space){this.space=new F({id:i,phrases:this.phrases.designer.orbit,data:this.data.orbit,callback:this.selectOrbit,context:this,interactive:true})}if(!this.space.el.is(":visible")){return this}this.space.data=this.data.orbit;this.space.phrases=this.phrases.designer.orbit;if(!this.space.paper){this.space.resize()}return this};H.prototype.selectOrbit=function(i){if(i){e("#designer_orbit #mission_orbit").val(i);e("#designer_orbit #mission_orbit").trigger("change")}return this};H.prototype.highlightOrbit=function(i){this.log("highlightOrbit",i,this.space);this.space.highlight(i);return this};H.prototype.removeOrbits=function(){this.space.removeOrbits();return this};H.prototype.displayOrbits=function(i,G){this.log("displayOrbits",i,G);this.space.displayOrbits(i,G);return this};H.prototype.updateProposal=function(){this.log("updateProposal");e(".printable").remove();var J={};var L={};var G;if(this.choices.instruments&&this.choices.instruments.length>0){var M="";for(var I=0;I<this.choices.instruments.length;I++){G=this.choices.instruments[I].wavelength;v=this.getInstrument({wavelength:this.choices.instruments[I].wavelength,type:this.choices.instruments[I].type});M+=""+this.choices.instruments[I].name+" - "+v.wavelength+" "+v.type+"\n";if(this.data.wavelengths[G].min){if(!L.value||this.data.wavelengths[G].min.value<L.value){L=this.copyValue(this.data.wavelengths[G].min)}}if(this.data.wavelengths[G].max){if(!J.value||this.data.wavelengths[G].max.value>J.value){J=this.copyValue(this.data.wavelengths[G].max)}}}e("#proposal_instruments").val(M)}if(this.choices.mirror){e("#proposal_mirror").val(this.choices.mirror);if(this.settings.mode!="advanced"){var K=this.data.mirror[this.choices.mirror].diameter;e("#proposal_reslow").val(n(this.formatValue(this.makeValue(1.22*L.value/K.value,"degrees"))));e("#proposal_reshigh").val(n(this.formatValue(this.makeValue(1.22*J.value/K.value,"degrees"))))}}if(this.choices.temperature){e("#proposal_reqtemp").val(this.formatValue(this.choices.instrument.temp));e("#proposal_temp").val(this.formatValue(this.choices.temperature))}if(this.table.mass_total){e("#proposal_mass").val(this.formatValue(this.table.mass_total.value));e("#proposal_mass_satellite").val(this.formatValue(this.table.mass_total.list.mass_satellite.value));e("#proposal_mass_mirror").val(this.formatValue(this.table.mass_total.list.mass_mirror.value));e("#proposal_mass_cooling").val(this.formatValue(this.table.mass_total.list.mass_cooling_total.value));e("#proposal_mass_instruments").val(this.formatValue(this.table.mass_total.list.mass_instruments.value))}if(this.choices.orbit){e("#proposal_orbit").val(this.phrases.designer.orbit.options[this.choices.orbit].label);e("#proposal_distance").val(this.formatValue(this.data.orbit[this.choices.orbit].altitude));if(this.settings.mode!="advanced"){e("#proposal_period").val(this.formatValue(this.data.orbit[this.choices.orbit].period));e("#proposal_fuel").val(this.formatValue(this.data.orbit[this.choices.orbit].fuellife))}}if(this.choices.mission){e("#proposal_duration").val(this.formatValue(this.copyValue(this.data.mission[this.choices.mission].life)))}if(this.choices.vehicle){e("#proposal_vehicle").val(this.phrases.designer.vehicle.options[this.choices.vehicle].label);e("#proposal_operator").val(this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label);e("#proposal_launchmass").val(this.formatValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO)));e("#proposal_launchsize").val(this.formatValue(this.data.vehicle[this.choices.vehicle].diameter))}if(this.choices.site){e("#proposal_site").val(this.phrases.designer.site.options[this.choices.site].label)}if(this.table){e("#proposal_cost").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_total.value))));e("#proposal_cost_satellite").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.value))));e("#proposal_cost_mirror").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.value))));e("#proposal_cost_cooling").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.value))));e("#proposal_cost_instruments").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.value))));e("#proposal_cost_dev").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.value))));e("#proposal_cost_launch").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.value))));e("#proposal_cost_ground").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.value))));e("#proposal_cost_operations").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.value))))}if(this.proposalCompleteness()!=0){e(".doc").after('<div class="printable bigpadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.print+"</a></div>")}return this};H.prototype.proposalCompleteness=function(){this.log("proposalCompleteness");var L=0;var I=e(".doc").find("input");var G=e(".doc").find("textarea");var K=I.length+G.length;for(var J=0;J<I.length;J++){if(e(I[J]).val()!=""){L++}}for(var J=0;J<G.length;J++){if(e(G[J]).val()!=""){L++}}return L/K};H.prototype.printProposal=function(){this.log("printProposal");var G=e(".doc").eq(0).html();G=G.replace(/<label[^\>]*>[^\<]*<\/label>/g,"").replace(/<input [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(J,K){var I=e("#"+K).val();return(I!=""?'<span class="userinput">'+I+"</span>":'<span class="emptyinput">BLANK</span>')}).replace(/<textarea [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(J,K){var I=e("#"+K).val();return(I!=""?'<span class="userinput">'+I+"</span>":'<span class="emptyinput">BLANK</span>')});var i=window.open("","","width="+e(window).width()+",height="+e(window).height()+",resizeable,scrollbars");i.document.write('<!DOCTYPE html><html><head><link type="text/css" href="css/fonts.css" media="all" rel="stylesheet"><link type="text/css" href="css/style.css" media="all" rel="stylesheet"><script>function onload(){ window.print(); }<\/script></head><body onload="onload()"><div id="main" class="bigpadded"><div class="doc">'+G+"</div></div></body></html>");i.document.close();return this};H.prototype.updateSidePanels=function(){if(this.choices.mirror||this.choices.hascooling||this.choices.instruments){this.makeSatellite();e("#sidebar .satellite.panel").show()}else{e("#sidebar .satellite.panel").hide()}if(this.choices.vehicle){e("#sidebar .vehicle.panel").html('<div class="image"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div><div class="info"><div>'+this.phrases.designer.vehicle.options[this.choices.vehicle].label+"</div><div>"+this.phrases.designer.vehicle.diameter+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].diameter)+"</div><div>"+this.phrases.designer.vehicle.massLEO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.LEO)+"</div><div>"+this.phrases.designer.vehicle.massGTO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.GTO)+"</div><div>"+this.phrases.designer.vehicle.operator+" "+this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label+"</div></div>").show()}else{e("#sidebar .vehicle.panel").hide()}if(this.choices.site){html='<img src="images/worldmap.png" />';var i=this.data.site[this.choices.site].latitude;var G=this.data.site[this.choices.site].longitude;if(!i&&!G){i=34;G=-116}html+='<a href="#" class="launchsite '+this.choices.site+'" title="'+this.phrases.designer.site.options[this.choices.site].label+'" style="left:'+Math.round(100*(G+180)/360)+"%;top:"+Math.round(100*(90-i)/180)+'%"></a>';e("#sidebar .site.panel").html(html).show()}else{e("#sidebar .site.panel").hide()}if(this.choices.orbit){e("#sidebar .orbit.panel").html('<img src="'+this.data.orbit[this.choices.orbit].img+'" />').show()}else{e("#sidebar .orbit.panel").hide()}return this};H.prototype.updateDropdown=function(L){var I="";var J,K,G;J=e("#"+L);if(J.length==0){return this}K=J.find("option");this.log("updateDropdown");if(L=="mirror_size"){if(this.phrases.designer.satellite.options.diameter.placeholder){I='<option value="">'+this.phrases.designer.satellite.options.diameter.placeholder+"</option>"}for(var i in this.data.mirror){I+='<option value="'+i+'">'+this.formatValue(this.data.mirror[i].diameter)+"</option>"}J.html(I)}else{if(L=="instruments"){if(this.phrases.designer.instruments.options.instrument.none&&this.settings.mode=="advanced"){I='<option value="">'+this.phrases.designer.instruments.options.instrument.none.label+"</option>"}for(var i in this.data.instrument.options){G=this.phrases.designer.instruments.options.instrument[i].label;I+='<option value="'+i+'">'+G+"</option>"}J.html(I);if(this.settings.mode!="advanced"){e("#instruments option:first-child").attr("selected","selected")}this.displayInstruments()}else{if(L=="wavelengths"){if(this.phrases.wavelengths.none.label){I='<option value="">'+this.phrases.wavelengths.none.label+"</option>"}for(var i in this.data.wavelengths){G=this.phrases.wavelengths[i].label;I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}else{if(L=="mission_duration"){if(this.phrases.designer.orbit.duration.none){I='<option value="">'+this.phrases.designer.orbit.duration.none+"</option>"}for(var i in this.data.mission){G=this.formatValue(this.data.mission[i].life);I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}else{if(L=="mission_orbit"){if(this.phrases.designer.orbit.orbit.none){I='<option value="">'+this.phrases.designer.orbit.orbit.none+"</option>"}for(var i in this.data.orbit){I+='<option value="'+i+'">'+this.phrases.designer.orbit.options[i].label+"</option>"}J.html(I)}else{if(L=="cooling_temperature"){if(this.data.cooling.temperature){for(var i in this.data.cooling.temperature){G=n(this.formatValue(this.data.cooling.temperature[i].temperature));I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}}else{if(L=="site"){if(this.phrases.designer.site.hint){I='<option value="">'+this.phrases.designer.site.hint+"</option>"}for(var i in this.data.site){if(this.phrases.designer.site.options[i]){G=this.phrases.designer.site.options[i].label;I+='<option value="'+i+'">'+G+"</option>"}}J.html(I)}else{if(L=="cooling_cryogenic"){for(var i in this.data.cooling.cryogenic){G=(this.phrases.designer.cooling.options.cryogenic.options[i]?this.phrases.designer.cooling.options.cryogenic.options[i]:this.formatValue(this.data.cooling.cryogenic[i].life));I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}}}}}}}}return this};H.prototype.updateLanguage=function(){this.log("updateLanguage");if(!this.phrases||!this.data){return this}var Y=this.phrases;var L,W,R,M,N;if(Y.title){document.title=n(Y.title)}e("h1").text(Y.title);e("body").attr("dir",(Y.language.alignment=="right"?"rtl":"ltr")).removeClass("ltr rtl").addClass((Y.language.alignment=="right"?"rtl":"ltr"));if(this.scenario){if(e("#designer_objectives .banner").length==0){e("#designer_objectives .intro").before('<div class="banner"></div>')}e("#designer_objectives .banner").html('<div class="title">'+this.scenario.name+"</div>");if(this.scenario.image&&this.scenario.image.banner){e("#designer_objectives .banner").css("background-image","url("+this.scenario.image.banner+")")}if(Y.designer.objectives.intro){e("#designer_objectives .intro").html("<p><strong>"+Y.scenarios.mission+"</strong> &quot;"+this.formatScenario(this.scenario)+"&quot;</p>"+(this.scenario.funder?Y.designer.objectives.intro:Y.designer.objectives.intronofunder).replace(/%TITLE%/,this.scenario.name).replace(/%FUNDER%/,this.scenario.funder)).addClass("bigpadded")}}e("#designer_satellite .options .mirror_diameter label").html(Y.designer.satellite.options.diameter.label);this.updateDropdown("mirror_size");e("#designer_satellite .options .mirror_deployable label").html(Y.designer.satellite.options.deployable.label);e("#designer_satellite .options .mirror_uv label").html(Y.designer.satellite.options.uv.label);if(Y.designer.satellite.intro){e("#designer_satellite .intro").html(Y.designer.satellite.intro).addClass("bigpadded")}this.updateToggle({id:"mirror_deployable_no",label:this.phrases.designer.satellite.options.deployable.no},{id:"mirror_deployable_yes",label:this.phrases.designer.satellite.options.deployable.yes},this.phrases.designer.satellite.options.deployable.label);this.updateToggle({id:"mirror_uv_no",label:this.phrases.designer.satellite.options.uv.no},{id:"mirror_uv_yes",label:this.phrases.designer.satellite.options.uv.yes},this.phrases.designer.satellite.options.uv.label);this.updateDropdown("instruments");this.updateDropdown("wavelengths");e("#designer_instruments .options label").html(Y.designer.instruments.options.label);e("#designer_instruments .options input#instrument_name").attr("placeholder",Y.designer.instruments.options.name);e("#designer_instruments .options a.add_instrument").attr("title",Y.designer.instruments.options.add);e("#designer_instruments .options a.add_instrument span").html(Y.designer.instruments.options.add);if(Y.designer.instruments.intro){e("#designer_instruments .intro").html(Y.designer.instruments.intro.replace(/%MAX%/,this.data.instrument.maxsize.length)).addClass("bigpadded")}if(Y.designer.cooling.intro){e("#designer_cooling .intro").html(Y.designer.cooling.intro).addClass("bigpadded")}e("#designer_cooling .options label[for=hascooling]").html(Y.designer.cooling.enable.label);this.updateToggle({id:"cooling_no",label:Y.designer.cooling.enable.no},{id:"cooling_yes",label:Y.designer.cooling.enable.yes},this.phrases.designer.cooling.enable.label);if(this.data.cooling.temperature){this.updateDropdown("cooling_temperature");e("#designer_cooling .options label[for=cooling_temperature]").html(Y.designer.cooling.options.temperature.label)}if(this.data.cooling.passive){L="";this.updateToggle({id:"cooling_passive_no",label:this.phrases.designer.cooling.options.passive.options.no},{id:"cooling_passive_yes",label:this.phrases.designer.cooling.options.passive.options.yes},this.phrases.designer.cooling.options.passive.label);e("#designer_cooling .options label[for=cooling_passive]").html(Y.designer.cooling.options.passive.label)}if(this.data.cooling.active){L="";this.updateToggle({id:"cooling_active_no",label:this.phrases.designer.cooling.options.active.options.no},{id:"cooling_active_yes",label:this.phrases.designer.cooling.options.active.options.yes},this.phrases.designer.cooling.options.active.label);e("#designer_cooling .options label[for=cooling_active]").html(Y.designer.cooling.options.active.label)}if(this.data.cooling.cryogenic){this.updateDropdown("cooling_cryogenic");e("#designer_cooling .options label[for=cooling_cryogenic]").html(Y.designer.cooling.options.cryogenic.label)}W=0;N=Y.designer.vehicle;var Q="";var S=0;for(var V in this.data.vehicle){S++}var K=100/S;for(var V in this.data.vehicle){M=e("#designer_vehicle .options li").eq(W);M.attr({data:V}).css({width:K+"%"});R=this.data.vehicle[V];M.find(".image img").attr({src:R.img,alt:N.options[V].label,title:N.options[V].label});M.find(".selector label").html(N.options[V].label);M.find(".rocket").html(N.options[V].label);M.find(".operator img").attr({src:this.data.operator[R.operator].img,alt:Y.operator[R.operator].label,title:Y.operator[R.operator].label});M.find(".details .operator strong").html(N.operator);M.find(".details .operator .value").html(Y.operator[R.operator].label);if(R.height){M.find(".height strong").html(N.height);this.updateValue(M.find(".height .value"),R.height)}M.find(".diameter strong").html(N.diameter);this.updateValue(M.find(".diameter .value"),R.diameter);M.find(".currency strong").html(N.cost);this.updateValue(M.find(".currency .value"),R.cost);M.find(".massLEO strong").html(N.massLEO);this.updateValue(M.find(".massLEO .value"),R.mass.LEO);M.find(".massGTO strong").html(N.massGTO);this.updateValue(M.find(".massGTO .value"),R.mass.GTO);if(R.risk){M.find(".risk strong").html(N.risk);this.updateValue(M.find(".risk .value"),(R.risk*100)+"%")}M.find(".sites strong").html(N.sites);L="";for(var P=0;P<R.sites.length;P++){L+=""+Y.designer.site.options[R.sites[P]].label+"<br />"}this.updateValue(M.find(".sites .value"),L);M.find("input").attr("value",V);M.find(".button").html(N.select);W++}if(Y.designer.vehicle.intro){e("#designer_vehicle .intro").html(Y.designer.vehicle.intro).addClass("bigpadded")}var X="";this.updateDropdown("site");var O='<option value="">'+Y.designer.site.hint+"</option>";for(var P in this.data.site){var J=this.data.site[P].latitude;var I=this.data.site[P].longitude;O+='<option value="'+P+'">'+Y.designer.site.options[P].label+"</option>";if(!J&&!I){J=34;I=-116}X+='<a href="#" class="launchsite '+P+'" data="'+P+'" title="'+Y.designer.site.options[P].label+'" style="left:'+Math.round(100*(I+180)/360)+"%;top:"+Math.round(100*(90-J)/180)+'%"></a>'}e("#designer_site .worldmap .launchsite").remove();e("#designer_site .worldmap").append(X);e("#designer_site .options label").html(Y.designer.site.hint);if(Y.designer.site.intro){e("#designer_site .intro").html(Y.designer.site.intro).addClass("bigpadded")}e("#designer_orbit .options label[for=mission_duration]").html(Y.designer.orbit.duration.label);this.updateDropdown("mission_duration");e("#designer_orbit .options label[for=mission_orbit]").html(Y.designer.orbit.orbit.label);this.updateDropdown("mission_orbit");var G=(Y.designer.proposal.labels?Y.designer.proposal.labels:{});String.prototype.formify=function(ab,aa,Z,ad,i){if(!i&&G[ab]){i=G[ab]}if(i){i='<label for="'+Z+'">'+i+"</label>"}else{i=""}if(!ad){ad=""}if(aa=="text"){var ac='<input type="text" name="'+Z+'" id="'+Z+'" value="'+ad+'" >'}else{if(aa=="textarea"){var ac='<textarea name="'+Z+'" id="'+Z+'">'+ad+"</textarea>"}}return this.replace("%"+ab+"%",i+ac,"g")};var T=Y.designer.proposal.doc;e("#designer_proposal .options .doc").html(T.replace(/%FUNDER%/g,"Funder").replace(/%DATE%/,(new Date()).toDateString()).formify("TO","text","proposal_to").formify("NAME","text","proposal_name").formify("AIM","textarea","proposal_aim").formify("PREVIOUS","text","proposal_previous").formify("ADVANCE","textarea","proposal_advance").formify("INSTRUMENTS","textarea","proposal_instruments").formify("GOALS","textarea","proposal_goal").formify("RESLOW","text","proposal_reslow").formify("RESHIGH","text","proposal_reshigh").formify("MIRROR","text","proposal_mirror").formify("REQTEMPERATURE","text","proposal_reqtemp").formify("TEMPERATURE","text","proposal_temp").formify("MASS","text","proposal_mass").formify("MASSSATELLITE","text","proposal_mass_satellite").formify("MASSMIRROR","text","proposal_mass_mirror").formify("MASSCOOLING","text","proposal_mass_cooling").formify("MASSINSTRUMENTS","text","proposal_mass_instruments").formify("ORBIT","text","proposal_orbit").formify("DISTANCE","text","proposal_distance").formify("PERIOD","text","proposal_period").formify("FUEL","text","proposal_fuel").formify("DURATION","text","proposal_duration").formify("VEHICLE","text","proposal_vehicle").formify("OPERATOR","text","proposal_operator").formify("SITE","text","proposal_site").formify("LAUNCHMASS","text","proposal_launchmass").formify("LAUNCHSIZE","text","proposal_launchsize").formify("COST","text","proposal_cost").formify("COSTSATELLITE","text","proposal_cost_satellite").formify("COSTMIRROR","text","proposal_cost_mirror").formify("COSTCOOLING","text","proposal_cost_cooling").formify("COSTINSTRUMENTS","text","proposal_cost_instruments").formify("COSTDEV","text","proposal_cost_dev").formify("COSTLAUNCH","text","proposal_cost_launch").formify("COSTGROUND","text","proposal_cost_ground").formify("COSTOPERATIONS","text","proposal_cost_operations"));for(var W=0;W<this.sections.length;W++){if(Y.designer[this.sections[W]]){e(".toggle"+this.sections[W]).text(Y.designer[this.sections[W]].label).attr("title",(Y.designer[this.sections[W]].hint?Y.designer[this.sections[W]].hint.replace(/<([^>]*)>/g,""):""))}}e(".togglemenu").attr("title",Y.ui.menu.title);e("#menu ul li").each(function(Z){var aa=e(this).attr("data");e(this).find("a").attr("title",Y.ui.menu[aa].title).find("span").html(Y.ui.menu[aa].label)});var U=["warnings","errors","success","time","cost","mass","science"];for(var W=0;W<U.length;W++){if(Y.ui[U[W]]){e(".toggle"+U[W]).attr("title",Y.ui[U[W]].title)}if(Y.ui.summary[U[W]]){e(".toggle"+U[W]).attr("title",Y.ui.summary[U[W]].title)}}e("#introduction").html(Y.intro.about);e("#introduction").append('<div class="centre"><a href="#scenarios" class="button fancybtn">'+Y.intro.button+"</a></div>");e("#introduction").append('<div class="centre toppadded">'+this.buildToggle("togglemode",{value:"no",id:"mode_basic",checked:(this.settings.mode!="advanced"?true:false)},{value:"yes",id:"mode_advanced",checked:(this.settings.mode=="advanced"?true:false)})+"</div>");this.updateToggle({id:"mode_basic",label:this.phrases.modes.basic},{id:"mode_advanced",label:this.phrases.modes.advanced},this.phrases.modes.label);var M="";for(var W=0;W<this.scenarios.length;W++){M+='<li><div class="padded">'+(this.scenarios[W].image&&this.scenarios[W].image.banner?'<img src="'+this.scenarios[W].image.banner+'"'+(this.scenarios[W].image.alt?'alt="'+this.scenarios[W].image.alt+'"':"")+' style="width: 100%;" />':"")+"<h3>"+this.scenarios[W].name+"</h3><p>"+this.formatScenario(this.scenarios[W])+'</p><a href="#designer_objectives" class="button" title="'+this.scenarios[W].name+'" data="'+W+'">Choose this mission<!--LANGUAGE--></a></div></li>'}e("#scenariolist").html(M);e("#scenarios h2").html(Y.scenarios.title);e("#scenarios p.about").html(Y.scenarios.intro);this.updateUnits();e("#messages h3.warning .title").text(this.phrases.ui.warning.title);e("#messages h3.error .title").text(this.phrases.ui.error.title);e(".togglelaunch a").text(this.phrases.launch.label).attr("title",(this.phrases.launch.hint?this.phrases.launch.hint:""));var P=Y.ui.summary;this.table.success.label=P.success.title;this.table.success.list.success_orbit.label=P.success.orbit;this.table.success.list.success_site.label=P.success.site;this.table.success.list.success_vehicle.label=P.success.vehicle;this.table.success.list.success_deploy.label=P.success.deploy;this.table.success.list.success_cooling.label=P.success.cooling;this.table.success.list.success_instruments.label=P.success.instruments;this.table.success.list.success_mission.label=P.success.mission;this.table.cost_available.label=P.cost.title;this.table.cost_available.list.cost_initial.label=P.cost.initial;this.table.cost_available.list.cost_dev_total.label=P.cost.dev.title;this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.label=P.cost.dev.satellite;this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.label=P.cost.dev.mirror;this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.label=P.cost.dev.cooling;this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.label=P.cost.dev.instruments;this.table.cost_available.list.cost_operations_total.label=P.cost.operations.title;this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.label=P.cost.operations.launch;this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.label=P.cost.operations.ground;this.table.cost_available.list.cost_total.label=P.cost.total;this.table.cost_available.list.cost_available.label=P.cost.available;this.table.time_dev_total.label=P.time.title;this.table.time_dev_total.list.time_dev_total.label=P.time.dev.title;this.table.time_dev_total.list.time_dev_total.list.time_dev_satellite.label=P.time.dev.satellite;this.table.time_dev_total.list.time_dev_total.list.time_dev_mirror.label=P.time.dev.mirror;this.table.time_dev_total.list.time_dev_total.list.time_dev_cooling.label=P.time.dev.cooling;this.table.time_dev_total.list.time_dev_total.list.time_dev_instruments.label=P.time.dev.instruments;this.table.time_dev_total.list.time_mission.label=P.time.mission;this.table.time_dev_total.list.time_cooling.label=P.time.cooling;this.table.time_dev_total.list.time_fuel.label=P.time.fuel;this.table.time_dev_total.list.time_observing.label=P.time.observing;this.table.mass_total.label=P.mass.title;this.table.mass_total.list.mass_satellite.label=P.mass.satellite;this.table.mass_total.list.mass_mirror.label=P.mass.mirror;this.table.mass_total.list.mass_cooling_total.label=P.mass.cooling.title;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.label=P.mass.cooling.passive;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.label=P.mass.cooling.cryo;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.label=P.mass.cooling.active}this.table.mass_total.list.mass_instruments.label=P.mass.instruments;this.table.science_total.label=P.science.title;this.table.profile_total.label=P.profile.title;this.table.profile_total.list.profile_site.label=P.profile.site;this.table.profile_total.list.profile_vehicle.label=P.profile.vehicle;this.table.profile_total.list.profile_instruments.label=P.profile.instruments;this.table.profile_total.list.profile_mirror.label=P.profile.mirror;this.table.profile_total.list.profile_temperature.label=P.profile.temperature;this.table.profile_total.list.profile_orbit.label=P.profile.orbit;this.table.profile_total.list.profile_launch.label=P.profile.launch;this.table.profile_total.list.profile_end.label=P.profile.end;this.updateSummaryList();return this};H.prototype.getInstrument=function(L){var I=L;var N=this.makeValue(0,"GBP");var K=this.makeValue(0,"kg");var G=this.makeValue(0,"K");var M=this.makeValue(0,"months");if(L.wavelength&&this.data.wavelengths[L.wavelength]){var i=this.copyValue(this.data.wavelengths[L.wavelength]);if(i.cost){N=i.cost}if(i.mass){K=i.mass}if(i.temperature){G=i.temperature}I.wavelength=this.phrases.wavelengths[L.wavelength].label}if(L.type&&this.data.instrument.options[L.type]){var J=this.copyValue(this.data.instrument.options[L.type]);if(J.multiplier&&J.multiplier.cost){N.value*=J.multiplier.cost}if(J.multiplier&&J.multiplier.mass){K.value*=J.multiplier.mass}if(J.devtime){M=J.devtime}I.type=this.phrases.designer.instruments.options.instrument[L.type].label}I.cost=N;I.mass=K;I.temp=G;I.time=M;return I};H.prototype.buildRow=function(G,I,i){return(!G&&!I&&!i)?"":"<div"+(g(i,"string")?' class="'+i+'"':"")+"><strong>"+G+"</strong> "+this.formatValueSpan(I)+"</div>"};H.prototype.showDetails=function(i,T){this.log("showDetails");var P="";if(!i||i==""){return this}var Q=this.phrases.designer;if(i=="satellite"){if(this.choices.mirror&&this.data.mirror[this.choices.mirror]){var K=this.data.mirror[this.choices.mirror];var I=this.copyValue(K.cost);var R=this.copyValue(K.mass);var J=this.copyValue(K.devtime);var O=this.copyValue(K.bus.cost);var S=this.copyValue(K.bus.mass);var N=this.copyValue(K.bus.devtime);var M=this.copyValue(K.bus.diameter);if(this.choices.deployablemirror){var U=this.data.deployablemirror.multiplier;if(U.cost){I.value*=U.cost}if(U.mass){R.value*=U.mass}if(U.time){J.value*=U.time}if(U.bus.cost){O.value*=U.bus.cost}if(U.bus.mass){S.value*=U.bus.mass}if(U.bus.time){N.value*=U.bus.time}if(U.bus.diameter){M.value*=U.bus.diameter}}if(this.choices.uvmirror){var U=this.data.uvmirror.multiplier;if(U.cost){I.value*=U.cost}if(U.mass){R.value*=U.mass}if(U.time){J.value*=U.time}}P+=this.buildRow(Q.satellite.cost,I);P+=this.buildRow(Q.satellite.mass,R);P+=this.buildRow(Q.satellite.devtime,J);P+=this.buildRow(Q.satellite.bus.cost,O);P+=this.buildRow(Q.satellite.bus.mass,S);P+=this.buildRow(Q.satellite.bus.devtime,N);P+=this.buildRow(Q.satellite.bus.diameter,M);P+=this.buildRow(Q.satellite.bus.slots,K.bus.instrumentslots)}}else{if(i=="instruments"){T=this.getInstrument(T);P+=this.buildRow(Q.instruments.cost,T.cost);P+=this.buildRow(Q.instruments.mass,T.mass);P+=this.buildRow(Q.instruments.temperature,T.temp);P+=this.buildRow(Q.instruments.devtime,T.time)}else{if(i=="cooling"){P+=this.buildRow(Q.cooling.temperature,this.choices.temperature);P+=this.buildRow(Q.cooling.cost,this.choices.cooling.cost);P+=this.buildRow(Q.cooling.mass,this.choices.cooling.mass);if(this.choices.cooling.time.value>0){P+=this.buildRow(Q.cooling.devtime,this.choices.cooling.time)}P+=this.buildRow(Q.cooling.life,this.choices.cooling.life);P+=this.buildRow(Q.cooling.risk,this.makeValue(this.choices.cooling.risk*100,"%"))}else{if(i=="site"){if(g(this.data.site[T].latitude,"number")){P+=this.buildRow(Q.site.location,this.data.site[T].latitude.toFixed(2)+"&deg;, "+this.data.site[T].longitude.toFixed(2)+"&deg;")}if(this.data.site[T].operator){P+=this.buildRow(Q.site.operator,this.phrases.operator[this.data.site[T].operator].label)}P+=this.buildRow(Q.site.trajectories,Q.site.options[T].trajectories);var L="";for(var G in this.data.site[T].orbits){if(this.data.site[T].orbits[G]){L+=""+Q.orbit.options[G].label+"<br />"}}P+=this.buildRow(Q.site.orbits,L);if(g(this.data.site[T].risk,"number")){P+=this.buildRow(Q.site.risk,(this.data.site[T].risk*100).toFixed(0)+"%")}}else{if(i=="orbit"){if(this.data.orbit[T].altitude){P+=this.buildRow(Q.orbit.altitude,this.data.orbit[T].altitude)}if(this.data.orbit[T].period){P+=this.buildRow(Q.orbit.period,this.data.orbit[T].period)}if(this.data.orbit[T].obsfrac){P+=this.buildRow(Q.orbit.obsfrac,{value:this.data.orbit[T].obsfrac*100,units:"%",dimension:"percent"})}if(this.data.orbit[T].fuellife){P+=this.buildRow(Q.orbit.fuellife,this.data.orbit[T].fuellife)}if(this.data.orbit[T].temperature){P+=this.buildRow(Q.orbit.temperature,this.data.orbit[T].temperature)}if(this.data.orbit[T].groundcost){P+=this.buildRow(Q.orbit.groundcost,this.data.orbit[T].groundcost)}if(this.data.orbit[T].risk){P+=this.buildRow(Q.orbit.risk,{value:this.data.orbit[T].risk*100,units:"%",dimension:"percent"})}}}}}}P+='<div class="clearall"></div>';e("#designer_"+i+" .details").html(P).addClass("padded").show();return this};H.prototype.formatScenario=function(i){return""+((g(i.description,"string"))?i.description:"").replace(/%COST%/,this.formatValueSpan(i.budget))+""};H.prototype.updateOptions=function(){e("#options").html("<h3>"+this.phrases.ui.menu.options.label+'</h3><form id="optionform"><ul></ul>');for(var i in this.phrases.ui.options){html='<li><label for="change'+i+'">'+this.phrases.ui.options[i]+'</label> <select id="change'+i+'" name="change'+i+'">';if(i=="currency"){for(var G in this.phrases.ui[i]){html+='<option value="'+G+'"'+(G==this.settings.currency?' selected="selected"':"")+">"+this.phrases.ui.currency[G].label+" "+this.phrases.ui.currency[G].symbol+"</option>"}}else{for(var G in this.phrases.ui.units){if(this.phrases.ui.units[G].dimension==i&&this.phrases.ui.units[G].selectable){html+='<option value="'+G+'"'+(G==this.settings[i]?' selected="selected"':"")+">"+this.phrases.ui.units[G].label+"</option>"}}}html+="</select></li>";e("#options ul").append(html);e("form#optionform #change"+i).on("change",{me:this,o:i},function(I){I.data.me.settings[I.data.o]=e(this).val();I.data.me.updateUnits()})}this.addCloser(e("#options"),{me:this},function(I){I.preventDefault();I.data.me.closeModal(e("#options"))});return this};H.prototype.updateUnits=function(){var K=e(".convertable");var L,N,G,I,M;for(var J=0;J<K.length;J++){L=e(K[J]);G=L.attr("data-value");I=L.attr("data-units");M=L.attr("data-dimension");if(G&&I&&M){L.html(this.formatValue({value:G,units:I,dimension:M}))}}this.updateDropdown("mirror_size");this.updateDropdown("cooling_temperature");return this};H.prototype.updateValue=function(P,O,G){var J;if(g(P,"object")){J=P}else{if(g(P,"string")){J=e("."+P+".value")}}if(J.length>0){if(g(O,"object")){var N={value:parseFloat(J.attr("data-value"),10),units:J.attr("data-units"),dimension:J.attr("data-dimension")};if(G&&N.dimension==O.dimension){var L=this;var M=20;if(!G){G=400}var Q=new Date();var K=0;if(O.units!=N.units){O=this.convertValue(O,N.dimension)}function I(){var i=(new Date())-Q;if(i>G){J.html(L.formatValue(O)).attr({"data-value":O.value,"data-units":O.units,"data-dimension":O.dimension}).addClass("convertable")}else{J.html(L.formatValue({value:(N.value+(O.value-N.value)*(i/G)),units:N.units,dimension:N.dimension}));requestAnimFrame(I)}}I()}else{J.attr({"data-value":O.value,"data-units":O.units,"data-dimension":O.dimension}).html(this.formatValue(O)).addClass("convertable")}}else{J.html(O)}}return this};H.prototype.formatValueSpan=function(G,i){i=(i)?" "+i:"";return(g(G,"object")?'<span class="value'+i+' convertable" data-value="'+G.value+'" data-units="'+G.units+'" data-dimension="'+G.dimension+'">'+this.formatValue(G)+"</span>":'<span class="value'+i+'">'+G+"</span>")};H.prototype.copyValue=function(i){if(g(i,"object")){return JSON.parse(JSON.stringify(i))}return{}};H.prototype.getValue=function(i){var G=e(i);if(G.length>0){if(G.prop("tagName")=="SELECT"){return G.find(":selected").attr("value")}if(G.prop("tagName")=="INPUT"){return G.val()}}return""};H.prototype.getChoice=function(G){if(G=="mirror.cost"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].cost):this.makeValue(0,"GBP"));v.value=-v.value;if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.cost){v.value*=this.data.deployablemirror.multiplier.cost}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.cost){v.value*=this.data.uvmirror.multiplier.cost}}else{if(G=="mirror.mass"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].mass):this.makeValue(0,"kg"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.mass){v.value*=this.data.deployablemirror.multiplier.mass}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.mass){v.value*=this.data.uvmirror.multiplier.mass}}else{if(G=="mirror.time"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].devtime):this.makeValue(0,"months"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.time){v.value*=this.data.deployablemirror.multiplier.time}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.time){v.value*=this.data.uvmirror.multiplier.time}}else{if(G=="mirror.prob"){v=(this.choices.mirror?this.data.mirror[this.choices.mirror].risk:1);if(this.choices.deployablemirror&&this.data.deployablemirror.risk){v*=this.data.deployablemirror.risk}if(this.choices.uvmirror&&this.data.uvmirror.risk){v*=this.data.uvmirror.risk}}else{if(G=="mirror"){v=(this.choices.mirror)?this.data.mirror[this.choices.mirror].diameter:this.makeValue(0,"m")}else{if(G=="cooling.cost"){v=(this.choices.cooling?this.copyValue(this.choices.cooling.cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(G=="cooling.mass"){v=(this.choices.cooling&&this.choices.cooling.mass?this.copyValue(this.choices.cooling.mass):this.makeValue(0,"kg"))}else{if(G=="cooling.passive.mass"){v=(this.choices.cooling&&this.choices.cooling.passive?this.copyValue(this.choices.cooling.passive):this.makeValue(0,"kg"))}else{if(G=="cooling.active.mass"){v=(this.choices.cooling&&this.choices.cooling.active?this.copyValue(this.choices.cooling.active):this.makeValue(0,"kg"))}else{if(G=="cooling.cryogenic.mass"){v=(this.choices.cooling&&this.choices.cooling.cryogenic?this.copyValue(this.choices.cooling.cryogenic):this.makeValue(0,"kg"))}else{if(G=="cooling.time"){v=(this.choices.cooling?this.copyValue(this.choices.cooling.time):this.makeValue(0,"months"))}else{if(G=="cooling.life"){v=(this.choices.cooling&&this.choices.cooling.life?this.copyValue(this.choices.cooling.life):this.makeValue(99,"years"))}else{if(G=="cooling.prob"){v=1;if(this.choices.cooling&&this.choices.cooling.risk){v=this.choices.cooling.risk}}else{if(G=="satellite.cost"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.cost):this.makeValue(0,"GBP"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.cost){v.value*=this.data.deployablemirror.multiplier.bus.cost}v.value=-v.value}else{if(G=="satellite.mass"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.mass):this.makeValue(0,"kg"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.mass){v.value*=this.data.deployablemirror.multiplier.bus.mass}}else{if(G=="satellite.time"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.devtime):this.makeValue(0,"months"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.time){v.value*=this.data.deployablemirror.multiplier.bus.time}}else{if(G=="instruments.time"){v=(this.choices.instrument&&this.choices.instrument.time)?this.choices.instrument.time:this.makeValue(0,"months")}else{if(G=="instruments.cost"){v=(this.choices.instrument&&this.choices.instrument.cost)?this.choices.instrument.cost:this.makeValue(0,"GBP");v.value=-v.value}else{if(G=="instruments.mass"){v=(this.choices.instrument&&this.choices.instrument.mass)?this.choices.instrument.mass:this.makeValue(0,"kg")}else{if(G=="instruments.prob"){v=(this.choices.instrument&&this.choices.instrument.risk)?this.choices.instrument.risk:1}else{if(G=="site"){v=(this.choices.site?this.phrases.designer.site.options[this.choices.site].label:"")}else{if(G=="site.prob"){v=0;if(this.choices.site){v=(this.data.site[this.choices.site].risk?this.data.site[this.choices.site].risk:1)}}else{if(G=="vehicle"){v=(this.choices.vehicle?this.phrases.designer.vehicle.options[this.choices.vehicle].label:"")}else{if(G=="vehicle.cost"){v=(this.choices.vehicle?this.copyValue(this.data.vehicle[this.choices.vehicle].cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(G=="vehicle.prob"){v=0;if(this.choices.vehicle){v=(this.data.vehicle[this.choices.vehicle].risk?this.data.vehicle[this.choices.vehicle].risk:1)}}else{if(G=="ground.cost"){var i=this.choices.mission?this.copyValue(this.data.mission[this.choices.mission].life):this.makeValue(0,"months");if(this.choices.orbit){v=this.copyValue(this.data.orbit[this.choices.orbit].groundcost);v.value*=-this.convertValue(i,"years").value}else{v=this.makeValue(0,"GBP")}}else{if(G=="temperature"){v=(this.choices.temperature)?this.choices.temperature:this.makeValue(400,"K");if(this.choices.orbit){v=this.data.orbit[this.choices.orbit].temperature}}else{if(G=="launch.cost"){v=(this.choices.vehicle?this.copyValue(this.data.vehicle[this.choices.vehicle].cost):this.makeValue(0,"GBP"));v.value*=-(this.choices.orbit?this.data.orbit[this.choices.orbit].multiplier.launchcost:1)}else{if(G=="orbit"){v=(this.choices.orbit)?this.phrases.designer.orbit.options[this.choices.orbit].label:""}else{if(G=="orbit.prob"){v=0;if(this.choices.orbit){v=(this.data.orbit[this.choices.orbit].risk)?this.data.orbit[this.choices.orbit].risk:1}}else{if(G=="mission.time"){v=(this.choices.mission?this.copyValue(this.data.mission[this.choices.mission].life):this.makeValue(0,"months"))}else{if(G=="mission.prob"){v=(this.choices.mission&&this.data.mission[this.choices.mission].risk?this.data.mission[this.choices.mission].risk:1)}else{if(G=="fuel.time"){v=(this.choices.orbit?this.copyValue(this.data.orbit[this.choices.orbit].fuellife):this.makeValue(0,"months"))}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return v};H.prototype.processSummaryList=function(K,J,L){L++;var I='<ul class="summary">';for(var G in K){if(K[G].value||K[G].list){I+="<li>";if(G&&K[G].value){I+='<span class="label '+G+'">'+K[G].label+"</span>"+this.formatValueSpan(K[G].value,J+" "+G)}if(K[G].list){I+=this.processSummaryList(K[G].list,(L==1?J:""))}I+="</li>"}}I+="</ul>";return I};H.prototype.updateSummaryList=function(){for(var I in this.table){var G="";var K=I;if(K.indexOf("_")>0){K=K.substr(0,K.indexOf("_"))}var J=K;if(K!=I){J+=" "+I}var L=0;if(this.table[I].value){this.updateValue("baritem ."+I,this.table[I].value)}var i='<h3><img src="images/cleardot.gif" class="icon '+J+'" /> <span class="label '+J+'">'+this.table[I].label+"</span> "+(this.table[I].value?this.formatValueSpan(this.table[I].value,J):"")+"</h3>";if(this.table[I].list){i+=this.processSummaryList(this.table[I].list,K,L)}e("#summaryext_"+K).addClass("padded").html(i)}return this};H.prototype.updateSummary=function(){this.log("updateSummary");var N="";var S=this.phrases.ui.summary;var L={};var Z={};var U={};var J={};var K={};L.mirror=this.getChoice("mirror.prob");L.site=this.getChoice("site.prob");L.vehicle=this.getChoice("vehicle.prob");L.cooling=this.getChoice("cooling.prob");L.orbit=this.getChoice("orbit.prob");L.instruments=this.getChoice("instruments.prob");L.mission=this.getChoice("mission.prob");L.total=L.orbit*L.site*L.vehicle*L.mirror*L.cooling*L.instruments*L.mission;if(L.total<0.5&&L.total>0){this.warnings.push({text:this.phrases.warnings.risky})}if(L.total==0){this.errors.push({text:this.phrases.errors.impossible})}Z.mirror=this.getChoice("mirror.cost");Z.satellite=this.getChoice("satellite.cost");Z.cooling=this.getChoice("cooling.cost");Z.instruments=this.getChoice("instruments.cost");Z.dev=this.sumValues(Z.mirror,Z.satellite,Z.cooling,Z.instruments);Z.vehicle=this.getChoice("vehicle.cost");Z.ground=this.getChoice("ground.cost");Z.launch=this.getChoice("launch.cost");Z.operations=this.sumValues(Z.launch,Z.ground);Z.total=this.sumValues(Z.dev,Z.operations);Z.free=this.sumValues(this.scenario.budget,Z.total);if(Z.free.value<0){this.errors.push({text:this.phrases.errors.bankrupt})}J.mirror=this.getChoice("mirror.time");J.satellite=this.getChoice("satellite.time");J.instruments=this.getChoice("instruments.time");J.cooling=this.getChoice("cooling.time");J.total=this.sumValues(J.mirror,J.satellite,J.cooling,J.instruments);J.mission=this.getChoice("mission.time");J.lifecooling=this.getChoice("cooling.life");J.fuel=this.getChoice("fuel.time");var O=this.minValue(J.mission,J.lifecooling,J.fuel);O.value*=(this.choices.orbit)?this.data.orbit[this.choices.orbit].obsfrac:0;J.observing=O;var ab=this.convertValue(J.fuel,J.mission.units);if(J.mission.value>ab.value){this.warnings.push({text:this.phrases.warnings.fuellifetime.replace(/%LIFE%/,this.formatValue(ab)).replace(/%DURATION%/,this.formatValue(J.mission)),link:"#designer_orbit"})}var V=this.convertValue(J.lifecooling,J.mission.units);if(J.mission.value>V.value){this.warnings.push({text:this.phrases.warnings.coolinglifetime.replace(/%LIFE%/,this.formatValue(V)).replace(/%DURATION%/,this.formatValue(J.mission)),link:"#designer_orbit"})}if(L.total>0&&J.mission.value==0){this.warnings.push({text:this.phrases.warnings.missionlife,link:"#designer_orbit"})}U.mirror=this.getChoice("mirror.mass");U.satellite=this.getChoice("satellite.mass");U.cooling=this.getChoice("cooling.mass");U.instruments=this.getChoice("instruments.mass");U.total=this.sumValues(U.mirror,U.satellite,U.cooling,U.instruments);if(this.choices.orbit&&this.choices.vehicle){var W=this.convertValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO),U.total.units);if(U.total.value>W.value){this.errors.push({text:this.phrases.errors.heavy})}if(U.total.value<=W.value&&U.total.value>0.8*W.value){this.warnings.push({text:this.phrases.warnings.heavy})}}this.table.success.value=this.formatPercent(L.total);this.table.success.list.success_orbit.value=this.formatPercent(L.orbit);this.table.success.list.success_site.value=this.formatPercent(L.site);this.table.success.list.success_vehicle.value=this.formatPercent(L.vehicle);this.table.success.list.success_deploy.value=this.formatPercent(L.mirror);this.table.success.list.success_cooling.value=this.formatPercent(L.cooling);this.table.success.list.success_instruments.value=this.formatPercent(L.instruments);this.table.success.list.success_mission.value=this.formatPercent(L.mission);this.updateTable("cost_available","value",Z.free);this.updateTable("cost_initial","value",this.scenario.budget);this.updateTable("cost_dev_total","value",Z.dev);this.updateTable("cost_dev_satellite","value",Z.satellite);this.updateTable("cost_dev_mirror","value",Z.mirror);this.updateTable("cost_dev_cooling","value",Z.cooling);this.updateTable("cost_dev_instruments","value",Z.instruments);this.updateTable("cost_operations_total","value",Z.operations);this.updateTable("cost_operations_launch","value",Z.launch);this.updateTable("cost_operations_ground","value",Z.ground);this.updateTable("cost_total","value",Z.total);this.table.cost_available.list.cost_available.value=Z.free;this.updateTable("time_dev_total","value",J.total);this.table.time_dev_total.list.time_dev_total.value=J.total;this.updateTable("time_dev_satellite","value",J.satellite);this.updateTable("time_dev_mirror","value",J.mirror);this.updateTable("time_dev_cooling","value",J.cooling);this.updateTable("time_dev_instruments","value",J.instruments);this.updateTable("time_mission","value",J.mission);this.updateTable("time_cooling","value",J.lifecooling);this.updateTable("time_fuel","value",J.fuel);this.updateTable("time_observing","value",J.observing);this.table.mass_total.value=U.total;this.table.mass_total.list.mass_satellite.value=U.satellite;this.table.mass_total.list.mass_mirror.value=U.mirror;this.table.mass_total.list.mass_cooling_total.value=U.cooling;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.value=this.getChoice("cooling.passive.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.value=this.getChoice("cooling.cryogenic.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.value=this.getChoice("cooling.active.mass")}this.table.mass_total.list.mass_instruments.value=U.instruments;var Q=0;this.table.science_total.list={};if(this.scenario&&this.scenario.requires&&g(this.scenario.requires,"object")){var I=this.scenario.requires;var O,P,G,M;this.table.science_total.list={};for(var T=0;T<I.length;T++){G=0;if(I[T]["instruments"]){P=false;if(this.choices.instruments){for(var Y=0;Y<I[T]["instruments"].length;Y++){P=false;for(var X=0;X<this.choices.instruments.length;X++){if((this.choices.instruments[X].type==I[T]["instruments"][Y].type||this.choices.instruments[X].type=="both")&&this.choices.instruments[X].wavelength==I[T]["instruments"][Y].wavelength){P=true}}if(P){G+=100}}}if(I[T]["instruments"].length>0){G/=I[T]["instruments"].length}if(G!=100){this.errors.push({text:I[T].error})}}if(I[T]["mirror"]){M=this.copyValue(I[T]["mirror"]);O=this.convertValue(this.getChoice("mirror"),M.units);if(O.value<M.value){this.errors.push({text:I[T].error})}else{G=100}}if(I[T]["devtime"]){M=this.copyValue(I[T]["devtime"]);O=this.convertValue(this.table.time_dev_total.value,M.units);if(O.value>M.value){this.errors.push({text:I[T].error.replace(/%DEVTIME%/,this.formatValue(O))})}else{G=100}}if(I[T]["vehicle"]){P=false;if(g(I[T]["vehicle"],"object")){for(var Y=0;Y<I[T]["vehicle"].length;Y++){if(this.choices.vehicle==I[T]["vehicle"][Y]){P=true}}}else{if(this.choices.vehicle==I[T]["vehicle"]){P=true}}if(!P){this.errors.push({text:I[T].error})}else{G=100}}if(I[T]["site"]){M=(this.choices.vehicle)?this.phrases.designer.vehicle.options[this.choices.vehicle].label:"";if(this.choices.vehicle==I[T]["vehicle"]){this.errors.push({text:I[T].error})}else{G=100}}if(I[T]["observingtime"]){M=this.copyValue(I[T]["observingtime"]);O=this.convertValue(this.table.time_dev_total.list.time_observing.value,M.units);if(O.value<M.value){this.errors.push({text:I[T].error.replace(/%OBSERVINGTIME%/,this.formatValue(O))})}else{G=100}}if(!I[T]["label"]){I[T]["label"]="UNKNOWN"}this.table.science_total.list["target"+T]={label:(O?I[T].label.replace(/%VALUE%/,this.formatValue(M)):I[T].label),value:this.makeValue(G,"%")};Q+=G}if(I.length>0){Q/=I.length}else{Q=100}}this.table.science_total.value=this.makeValue(Q,"%");this.table.profile_total.list.profile_site.value=this.getChoice("site");this.table.profile_total.list.profile_vehicle.value=this.getChoice("vehicle");this.table.profile_total.list.profile_instruments.value=(this.choices.instruments)?this.choices.instruments.length:0;this.table.profile_total.list.profile_mirror.value=this.getChoice("mirror");this.table.profile_total.list.profile_temperature.value=this.getChoice("temperature");this.table.profile_total.list.profile_orbit.value=this.getChoice("orbit");var aa=new Date();var R=this.convertValue(J.total,"months");aa.setUTCMonth(aa.getUTCMonth()+R.value);this.launchdate=aa.toDateString();this.table.profile_total.list.profile_launch.value=aa.toDateString();R=this.convertValue(this.minValue(J.mission,J.fuel,J.lifecooling),"months");aa.setUTCMonth(aa.getUTCMonth()+R.value);this.table.profile_total.list.profile_end.value=aa.toDateString();if(this.choices.orbit&&this.choices.site&&this.choices.vehicle&&this.errors.length==0){this.enableLaunch()}else{this.disableLaunch()}this.updateSummaryList();return this};H.prototype.enableLaunch=function(){this.launchable=true;e(".togglelaunch").show();return this};H.prototype.disableLaunch=function(){this.launchable=false;e(".togglelaunch").hide();return this};H.prototype.test=function(){return this.processFile("---\nMODE	advanced\nSCENARIO	Star Birth & Evolution\nMIRROR	1.0m\nINSTRUMENT	submm;both;SPIRE\nINSTRUMENT	farir;spectrometer;HIFI\nINSTRUMENT	farir;both;PACS\nCOOLING	true\nCOOLINGACTIVE	true\nCOOLINGCRYO	2yr\nVEHICLE	ARI5\nSITE	CSG\nDURATION	7\nORBIT	ES2\n---")};H.prototype.processFile=function(N){if(g(N,"string")){N=N.split(/[\n\r]/)}var J=false;var L,G;var M="";var K=[];for(var I=0;I<N.length;I++){L=N[I].indexOf("---");if(J&&L==0){J=false}if(J){G=N[I].split(/\:\t/);if(G[0]=="MODE"){M=G[1]}else{K.push({key:G[0],value:G[1]})}}if(!J&&L==0){J=true}}if(M){this.setMode(M,function(){function i(){var R="";for(var O=0;O<K.length;O++){if(K[O].key=="SCENARIO"){for(var Q=0;Q<this.scenarios.length;Q++){if(this.scenarios[Q].name==K[O].value){R=Q}}}}this.chooseScenario(R);function P(){for(var S=0;S<K.length;S++){if(K[S].key=="MIRROR"){e("#mirror_size").val(K[S].value)}if(K[S].key=="DEPLOYABLE"&&K[S].value=="true"){this.changeToggle("toggledeployable","mirror_deployable_yes")}if(K[S].key=="UVQUALITY"&&K[S].value=="true"){this.changeToggle("toggleuv","mirror_uv_yes")}if(K[S].key=="VEHICLE"){e("#vehicle_rocket_"+K[S].value).trigger("click")}if(K[S].key=="SITE"){e("a."+K[S].value).trigger("click")}if(K[S].key=="COOLING"&&K[S].value=="true"){this.changeToggle("hascooling","cooling_yes")}if(K[S].key=="COOLINGACTIVE"&&K[S].value=="true"){this.changeToggle("cooling_active","cooling_active_yes")}if(K[S].key=="COOLINGCRYO"){e("#cooling_cryogenic").val(K[S].value)}if(K[S].key=="COOLINGTEMP"){e("#cooling_temperature").val(K[S].value)}if(K[S].key=="DURATION"){e("#mission_duration").val(K[S].value)}if(K[S].key=="ORBIT"){e("#mission_orbit").val(K[S].value).trigger("change")}if(K[S].key.indexOf("INSTRUMENT")==0){var T=K[S].value.split(/\;/);e("#wavelengths").val(T[0]);e("#instruments").val(T[1]);e("#instrument_name").val(T[2]);e(".add_instrument").trigger("click")}}}this.showView("designer_objectives","",P)}this.showView("scenarios","",i)})}return this};H.prototype.save=function(){if(!g(Blob,"function")){return this}var I="---\n";if(this.settings.mode){I+="MODE:	"+this.settings.mode+"\n"}if(this.scenario.name){I+="SCENARIO:	"+this.scenario.name+"\n"}if(this.choices.mirror){I+="MIRROR:	"+this.choices.mirror+"\n"}if(this.choices.deployablemirror){I+="DEPLOYABLE:	"+(this.choices.deployablemirror?"true":"false")+"\n"}if(this.choices.uvmirror){I+="UVQUALITY:	"+(this.choices.uvmirror?"true":"false")+"\n"}for(var K=0;K<this.choices.instruments.length;K++){I+="INSTRUMENT-"+(K+1)+":	"+this.choices.instruments[K].wavelength+";"+this.choices.instruments[K].type+";"+this.choices.instruments[K].name+"\n"}if(this.choices.cool.passive){I+="COOLING:	"+(this.choices.cool.passive=="yes"?"true":"false")+"\n"}if(this.choices.cool.active=="yes"){I+="COOLINGACTIVE:	"+(this.choices.cool.active=="yes"?"true":"false")+"\n"}if(this.choices.cool.cryogenic){I+="COOLINGCRYO:	"+this.choices.cool.cryogenic+"\n"}if(this.choices.vehicle){I+="VEHICLE:	"+this.choices.vehicle+"\n"}if(this.choices.site){I+="SITE:	"+this.choices.site+"\n"}if(this.choices.mission){I+="DURATION:	"+this.choices.mission+"\n"}if(this.choices.orbit){I+="ORBIT:	"+this.choices.orbit+"\n"}I+="---\n";var L=new Blob([I],{type:"text/plain"});var M="spacetelescope.txt";function J(i){document.body.removeChild(i.target)}var G=document.createElement("a");G.download=M;G.innerHTML="Download File";if(window.webkitURL!=null){G.href=window.webkitURL.createObjectURL(L)}else{G.href=window.URL.createObjectURL(L);G.onclick=J;G.style.display="none";document.body.appendChild(G)}G.click();return this};H.prototype.goForLaunch=function(){this.log("goForLaunch");if(!this.launchable){this.showView("designer");return this}if(this.stage=="launch"){e(".togglelaunch").hide();e("body").addClass("showlaunch");e("#launch").show();var G=this.phrases.designer.orbit.options[this.choices.orbit].label;var J=this.phrases.designer.vehicle.options[this.choices.vehicle].label;var i=this.phrases.designer.site.options[this.choices.site].label;var I=this.formatValue(this.table.time_dev_total.list.time_dev_total.value);e("#launch").html("<h2>"+this.phrases.launch.title+"</h2><p>"+this.phrases.launch.intro.replace(/%DEVTIME%/,I).replace(/%VEHICLE%/,J).replace(/%SITE%/,i).replace(/%ORBIT%/,G).replace(/%LAUNCHDATE%/,this.launchdate)+'</p><div id="launchanimation">'+('<div id="launchpadbg"><img src="images/launchpad_'+this.choices.site+'.png" /></div><div id="launchpadfg"><img src="images/launchpad_'+this.choices.site+'_fg.png" /></div><div id="launchrocket"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div>')+'<div id="countdown" class="padded">Countdown</div></div><div id="launchnav" class="toppadded"></div><ul id="launchtimeline" class="toppadded"></ul>');e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"});this.launchstep=0;if(this.launchstep==0){this.countdown(10)}}};H.prototype.countdown=function(G){this.launchstep=1;var I=this;if(G>0){e("#countdown").html('<div class="tick">'+this.phrases.launch.countdown[G.toFixed(0)]+"</div>");G--;if(!this.outtatime){clearTimeout(this.outtatime)}this.outtatime=setTimeout(function(){I.countdown(G)},1000)}else{e("#countdown").html(""+this.phrases.launch.countdown.liftoff);this.ok=true;this.okcool=true;this.temperature=this.copyValue(this.data.orbit[this.choices.orbit].temperature);this.launch()}};H.prototype.launch=function(){this.launchstep++;e("#launchnav").html('<a href="#" class="button fancybtn">'+this.phrases.launch.next+"</a>");var P={mirror:this.getChoice("mirror.prob"),site:this.getChoice("site.prob"),vehicle:this.getChoice("vehicle.prob"),cooling:this.getChoice("cooling.prob"),orbit:this.getChoice("orbit.prob"),mission:this.getChoice("mission.prob")};var W=this.phrases.launch.status;var R=true;var I=e("#launchtimeline");var N=e("#launchanimation");function V(i){I.prepend(e(i).hide().fadeIn(1000))}if(this.ok){if(this.launchstep==2){this.ok=this.roll(P.site*P.vehicle);V("<li>"+this.buildRow(this.phrases.launch.launch.label,(this.ok?this.phrases.launch.launch.success:this.phrases.launch.launch.fail),"launch_launch")+"</li>");if(this.ok){N.addClass(this.choices.vehicle).addClass("launched");this.exhaust=new C()}}else{this.exhaust.stop()}if(this.launchstep==3){this.ok=this.roll(P.orbit);V("<li>"+this.buildRow(this.phrases.launch.orbit.label,(this.ok?this.phrases.launch.orbit.success:this.phrases.launch.orbit.fail).replace(/%ORBIT%/,this.getChoice("orbit")),"launch_orbit")+'<div id="launchorbit"></div></li>');if(this.ok){N.html("");this.launchanim=new F({id:"launchanimation",height:"50%",orbits:[this.choices.orbit],phrases:this.phrases.designer.orbit,data:this.data.orbit,interactive:false});this.launchanim.resize()}}if(this.launchstep==4){this.ok=this.roll(P.mirror);V("<li>"+this.buildRow(this.phrases.launch.deploy.label,(this.ok?this.phrases.launch.deploy.success:this.phrases.launch.deploy.fail),"launch_mirror")+"</li>");N.html("");this.launchanim=new E({id:"launchanimation",spacetel:this,height:"50%",state:{mirror:this.ok},colourize:{mirror:true,bus:false,cooling:{passive:false,cryogenic:false,active:false}}});this.launchanim.resize()}if(this.launchstep==5){var M=true;var U=true;var X="";var J=this.convertValue(this.choices.instrument.temp,"K");this.launchtherm=new o({canvas:this.launchanim.paper,required:J.value,phrasebook:{req:this.phrases.designer.instruments.temperature,y:this.phrases.ui.summary.profile.temperature},context:this,x:0,y:0,width:this.launchanim.paper.width*0.3,format:this.formatValue});if(this.choices.hascooling){if(this.choices.cool.temperature){var S=this.data.cooling.temperature[e("#cooling_temperature").val()];if(S.temperature){this.temperature=this.copyValue(S.temperature)}if(!S.risk){S.risk=1}M=this.roll(S.risk);X+="<li>"+this.buildRow(this.phrases.launch.cooling.label.label,(M?this.phrases.launch.cooling.label.success:this.phrases.launch.cooling.label.fail),"launch_temperature")+"</li>";this.launchanim.state.cooling={passive:M,active:M,cryogenic:M};this.launchanim.colourize.cooling={passive:true,active:true,cryogenic:true};this.launchanim.build()}if(this.data.cooling.passive){X+="<li>"+this.buildRow(this.phrases.launch.cooling.label.label,"","launch_cooling")+"</li>";p=this.choices.cool.passive;if(p=="yes"){M=this.roll(this.data.cooling.passive[p].risk);U=M;if(M){this.temperature.value*=this.data.cooling.passive[p].multiplier.temperature}X+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.passive.label,(M?this.phrases.launch.cooling.passive.success:this.phrases.launch.cooling.passive.fail),"launch_passive")+"</li>";this.launchanim.state.cooling.passive=M;this.launchanim.colourize.cooling.passive=true;this.launchanim.build();if(this.data.cooling.active&&U){p=this.choices.cool.active;if(p=="yes"){M=this.roll(this.data.cooling.active[p].risk);if(M){this.temperature.value*=this.data.cooling.active[p].multiplier.temperature}X+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.active.label,(M?this.phrases.launch.cooling.active.success:this.phrases.launch.cooling.active.fail),"launch_active")+"</li>";this.launchanim.state.cooling.active=M;this.launchanim.colourize.cooling.active=true;this.launchanim.build()}}if(this.data.cooling.cryogenic&&U){p=this.choices.cool.cryogenic;if(p&&p!="none"){M=this.roll(this.data.cooling.cryogenic[p].risk);if(M){this.temperature.value*=this.data.cooling.cryogenic[p].multiplier.temperature}X+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.cryogenic.label,(M?this.phrases.launch.cooling.cryogenic.success:this.phrases.launch.cooling.cryogenic.fail),"launch_cryogenic")+"</li>";this.launchanim.state.cooling.cryogenic=M;this.launchanim.colourize.cooling.cryogenic=true;this.launchanim.build()}}}}this.launchtherm.value(this.temperature.value)}X+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.achieved.label,(M?this.phrases.launch.cooling.achieved.success:this.phrases.launch.cooling.achieved.fail).replace(/\%TEMPERATURE%/,this.formatValue(this.temperature)))+"</li>";V(X)}if(this.launchstep==6){var K=0;var X="";if(this.choices.instruments){X+="<li>"+this.buildRow(this.phrases.launch.instruments.label,"")+"</li>";this.beakers=[];var Q=(this.launchanim.paper.height/(this.choices.instruments.length+1));for(var Y=0;Y<this.choices.instruments.length;Y++){this.beakers.push(new D({canvas:this.launchanim.paper,x:this.launchanim.paper.width*0.8,y:(Q*(Y+1)-this.launchanim.paper.width*0.04),width:this.launchanim.paper.width*0.08,height:this.launchanim.paper.width*0.08,label:this.choices.instruments[Y].name}));var O=this.convertValue(this.data.wavelengths[this.choices.instruments[Y].wavelength].temperature,this.temperature.units);R=(O.value>=this.temperature.value)?true:false;this.choices.instruments[Y].ok=R;X+='<li class="indent">'+this.buildRow(this.choices.instruments[Y].name+" ("+this.phrases.wavelengths[this.choices.instruments[Y].wavelength].label+" "+this.phrases.designer.instruments.options.instrument[this.choices.instruments[Y].type].label+")",(R?this.phrases.launch.instruments.success:this.phrases.launch.instruments.fail),"launch_instrument")+"</li>"}this.launchanim.colourize.bus=true;this.launchanim.build()}V(X)}if(this.launchstep==7){var K=0;var X="";if(this.choices.instruments){X+="<li>"+this.buildRow(this.phrases.launch.science.label,"")+"</li>";for(var Y=0;Y<this.choices.instruments.length;Y++){if(this.choices.instruments[Y].ok){var S=this.copyValue(this.data.instrument.options[this.choices.instruments[Y].type]);if(!S.risk){S.risk=1}S.risk*=P.mission;R=this.roll(S.risk);this.log(Y,S.risk,R);var G=100;if(!R){G=Math.random()*100}K+=G;this.beakers[Y].value(G/100);tmp=(R?this.phrases.launch.science.success:this.phrases.launch.science.fail).replace(/%PERCENT%/,this.formatValue(this.makeValue(G,"%")));X+='<li class="indent">'+this.buildRow(this.choices.instruments[Y].name+" ("+this.phrases.wavelengths[this.choices.instruments[Y].wavelength].label+" "+this.phrases.designer.instruments.options.instrument[this.choices.instruments[Y].type].label+")",tmp,"launch_science")+"</li>"}}if(this.choices.instruments.length>0){K/=this.choices.instruments.length}}tmp=(this.ok?this.phrases.launch.overall.success:this.phrases.launch.overall.fail).replace(/\%PERCENT%/,this.formatValue(this.makeValue(K,"%")));V(X);V("<li>"+this.buildRow(this.phrases.launch.overall.label,tmp,"finalresult")+"</li>");e(".printable").remove();I.after('<div class="printable toppadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.reprint+"</a></div>").fadeIn();e("#launchnav").html("");this.launchstep=0}}if(!this.ok){e("#launchnav a.button").remove();if(!this.relaunched){var T=this.table.time_dev_total.list.time_dev_total.value;var L=this.copyValue(T);L.value*=0.5;var Z=this.sumValues(this.getChoice("mirror.cost"),this.getChoice("satellite.cost"),this.getChoice("cooling.cost"),this.getChoice("instruments.cost"));Z.value*=0.5;Z=this.sumValues(Z,this.getChoice("vehicle.cost"));Z.value*=-1;e("#launchnav").html('<div class="relaunch toppadded"><p>'+this.phrases.launch.relaunch.text.replace(/\%DEVTIME\%/,this.formatValue(T)).replace(/%RELAUNCHTIME%/,this.formatValue(L)).replace(/%RELAUNCHCOST%/,this.formatValueSpan(Z))+'</p><a href="#" class="button fancybtn">'+this.phrases.launch.relaunch.label+"</a></div>")}else{e(".relaunch").remove()}}return this};H.prototype.relaunch=function(){this.relaunched=true;this.goForLaunch()};H.prototype.roll=function(i){if(!i){i=1}return(Math.random()>i)?false:true};H.prototype.setKey=function(G,i,I,J){for(A in G){if(A==i){G[A][I]=J;return G}else{if(G[A].list){G[A].list=this.setKey(G[A].list,i,I,J)}}}return G};H.prototype.updateTable=function(i,G,I){this.table=this.setKey(this.table,i,G,I);return this};H.prototype.convertValue=function(i,G){if(!g(i,"object")){return i}if(g(i.value,"string")&&i.value!="inf"){i.value=parseFloat(i.value,10)}i=this.copyValue(i);if(i.dimension=="length"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="ft"){i.value/=3.281}if(i.units=="km"){i.value*=1000}if(i.units=="mile"){i.value*=1609}if(i.units=="cubit"){i.value*=0.4572}if(i.units=="bluewhale"){i.value*=30}if(i.units=="yard"){i.value*=0.9144}if(G=="ft"){i.value*=3.281}if(G=="km"){i.value*=0.001}if(G=="mile"){i.value/=1609}if(G=="cubit"){i.value/=0.4572}if(G=="bluewhale"){i.value/=30}if(G=="yard"){i.value/=0.9144}i.units=G}if(i.units=="m"&&i.value>1000){i.value/=1000;i.units="km"}if(i.units=="ft"&&i.value>5280){i.value/=5280;i.units="mile"}if(i.units=="yard"&&i.value>5280){i.value/=5280;i.units="league"}}}else{if(i.dimension=="mass"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="lb"){i.value/=2.205}if(i.units=="t"){i.value*=1000}if(i.units=="elephant"){i.value*=5400}if(G=="lb"){i.value*=2.205}if(G=="t"){i.value/=1000}if(G=="elephant"){i.value/=5400}i.units=G}}}else{if(i.dimension=="temperature"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="C"){i.value+=273}else{if(i.units=="F"){i.value=(5/9)*(i.value-32)+273}}if(G=="C"){i.value-=273}else{if(G=="F"){i.value=(9/5)*(i.value-273)+32}}i.units=G}}}else{if(i.dimension=="time"){if(G=="years"||G=="months"||G=="days"||G=="hours"){if(i.units!=G){if(i.units=="months"){i.value/=12}else{if(i.units=="days"){i.value/=365.25}else{if(i.units=="hours"){i.value/=365.25*24}else{if(i.units=="minutes"){i.value/=365.25*24*60}}}}if(G=="months"){i.value*=12}else{if(G=="days"){i.value*=365.25}else{if(G=="hours"){i.value*=365.25*24}else{if(G=="minutes"){i.value*=365.25*24*60}}}}i.units=G}}}else{if(i.dimension=="angle"){if(G=="degrees"||G=="arcmin"||G=="arcsec"){if(i.units!=G){if(i.units=="arcmin"){i.value/=60}else{if(i.units=="arcsec"){i.value/=3600}}if(G=="arcmin"){i.value*=60}else{if(G=="arcsec"){i.value*=3600}}i.units=G}}}else{if(i.dimension=="currency"){if(this.data.currency[G]){if(i.units!=G){if(i.value!="inf"){if(this.data.currency[i.units].conv){i.value/=this.data.currency[i.units].conv}if(this.data.currency[G].conv){i.value*=this.data.currency[G].conv}}i.units=G}}}}}}}}return i};H.prototype.sumValues=function(){var J=Array.prototype.slice.call(arguments,0);var G,I,K;if(J.length>0){I=this.convertValue(J[0],J[0].units);for(K=1;K<J.length;K++){if(g(J[K],"object")&&J[K].dimension&&J[K].dimension===I.dimension){G=this.convertValue(J[K],J[0].units);I.value+=G.value}}return I}return{}};H.prototype.negativeValue=function(){var J=Array.prototype.slice.call(arguments,0);var G,I,K;if(J.length>0){I=this.copyValue(J[0]);I.value*=-1;return I}return{}};H.prototype.minValue=function(){var I=Array.prototype.slice.call(arguments,0);var G,K,J;if(I.length>0){J=this.convertValue(I[0],I[0].units);for(K=1;K<I.length;K++){if(g(I[K],"object")&&I[K].dimension&&I[K].dimension===I[0].dimension){G=this.convertValue(I[K],I[0].units);if(G.value<J.value){J=G}}}return J}return{}};function c(i){if(i<1e-9){return 1}if(g(i,"number")&&i<1){return Math.ceil(s.log10(1/i))+1}else{return 1}return 1}H.prototype.formatValue=function(I,L){if(g(I,"string")||g(I,"number")){return I}if(!(g(I,"object")&&I.dimension)){return""}ph=this.phrases;I=this.copyValue(I);if(g(L,"string")){L=parseInt(L,10)}if(I.dimension=="length"){I=this.convertValue(I,(this.settings.length)?this.settings.length:"m");if(!g(L,"number")){L=(I.units=="km"?0:c(I.value))}var K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(I.value>1000000000000000){return b(I.value,K)}return""+f((I.value).toFixed(L)).replace(/\.0+$/,"").replace(/(\.0?[1-9]+)0+$/,"$1")+""+K}else{if(I.dimension=="mass"){I=this.convertValue(I,(this.settings.mass)?this.settings.mass:"kg");var K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(!g(L,"number")){L=(I.value>=1000)?0:c(I.value)}if(I.value>1000000000000000){return b(I.value,K)}else{return""+f((I.value).toFixed(L)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+""+K}}else{if(I.dimension=="currency"){I=this.convertValue(I,(this.settings.currency)?this.settings.currency:"GBP");if(!g(L,"number")){L=0}var i=(ph.ui.million.compact)?ph.ui.million.compact:"";var J=(ph.ui.currency[I.units]&&ph.ui.currency[I.units].symbol)?ph.ui.currency[I.units].symbol:(ph.ui.currency.GBP.symbol?ph.ui.currency.GBP.symbol:"");if(I.value=="inf"||I.value>=1000000000000000){return"&infin;"}var G=(I.value<0)?"-":"";I.value=Math.abs(I.value);if(I.value>=1000){I.value/=1000;i=(ph.ui.billion.compact)?ph.ui.billion.compact:""}if(L==0){if(I.value<100){L=1}if(I.value<10){L=2}}var M=(I.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1").replace(/^ /,"&thinsp;");return G+J+M+i}else{if(I.dimension=="temperature"){I=this.convertValue(I,(this.settings.temperature)?this.settings.temperature:"K");if(g(L,"string")){L=parseInt(L,10)}if(!g(L,"number")){L=(I.value>1000)?0:c(I.value)}var K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(g(I.value,"string")){I.value=parseInt(I.value,10)}return""+f((I.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+K}else{if(I.dimension=="time"){if(I.units=="years"&&I.value<5){I=this.convertValue(I,"months")}if(!g(L,"number")){L=(I.value>=6)?0:c(I.value)}var K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(g(I.value,"string")){I.value=parseInt(I.value,10)}return""+f((I.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+K}else{if(I.dimension=="percent"){I=I.value;if(!g(I,"number")){I=parseInt(I,10)}if(!g(I,"number")){return"0"+K}if(!g(L,"number")){L=1}var K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"%";return""+f(I.toFixed(L)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+K}else{if(I.dimension=="angle"){if(I.units=="degrees"&&I.value<1){I=this.convertValue(I,"arcmin")}if(I.units=="arcmin"&&I.value<1){I=this.convertValue(I,"arcsec")}if(!g(L,"number")){L=(I.value>=10)?0:c(I.value)}var K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(g(I.value,"string")){I.value=parseInt(I.value,10)}return""+f((I.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+K}else{return I.value}}}}}}}};H.prototype.makeValue=function(i,G,I){if(!I){if(this.phrases.ui.units[G]){I=this.phrases.ui.units[G].dimension}else{if(this.phrases.ui.currency[G]){I="currency"}else{I="unknown"}}}return{value:i,units:G,dimension:I}};H.prototype.formatPercent=function(i,G){if(!g(i,"number")){i=0}if(!g(G,"number")){G=1}return""+f((i*100).toFixed(G)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+"%"};H.prototype.toggleFullScreen=function(){this.elem=document.getElementById("application");if(u.isFullScreen()){u.cancelFullScreen(this.elem);this.fullscreen=false;e("#application").removeClass("fullscreen")}else{u.requestFullScreen(this.elem);this.fullscreen=true;e("#application").addClass("fullscreen")}return this};H.prototype.parseChoices=function(O,ab){O=(O&&O.indexOf("designer_")==0)?O.substr(9):"";this.log("parseChoices",O);var Y,W,ad,N,ae,Q,M,R,T;var aa,S,ac,I,ah;this.errors=[];this.warnings=[];Y=e("#mission_duration").val();this.choices.mission=(Y&&this.data.mission[Y])?Y:"";W=e("#mirror_size").val();this.choices.mirror=(W&&this.data.mirror[W])?W:"";ad=e("input[name=toggledeployable]:checked").val();this.choices.deployablemirror=(ad&&ad=="yes")?true:false;N=e("input[name=toggleuv]:checked").val();this.choices.uvmirror=(N&&N=="yes")?true:false;M=e("#designer_vehicle input[name=vehicle_rocket]:checked").val();this.choices.vehicle=(M&&this.data.vehicle[M])?M:"";R=e("#site").val();var P=false;this.choices.site=(R&&this.data.site[R])?R:"";var V=e("#mission_orbit").val();if(V&&this.data.orbit[V]){this.choices.orbit=V}else{this.choices.orbit=""}ae=e("input[name=hascooling]:checked").val();this.choices.hascooling=(ae&&ae=="yes")?true:false;this.choices.cool={};Q=e("#cooling_temperature").val();this.choices.cool.temperature=(Q)?Q:"";this.choices.cool.passive=this.getValue("input[name=cooling_passive]:checked");this.choices.cool.active=this.getValue("input[name=cooling_active]:checked");this.choices.cool.cryogenic=e("#cooling_cryogenic").val();this.choices.temperature=this.makeValue(400,"K");this.choices.instrument={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),temp:this.makeValue(400,"K"),time:this.makeValue(0,"months"),risk:1};if(this.choices.instruments){var G=false;for(var Z=0;Z<this.choices.instruments.length;Z++){var Q=this.copyValue(this.data.instrument.options[this.choices.instruments[Z].type]);if(!Q.multiplier){Q.multiplier={}}if(!Q.multiplier.cost){Q.multiplier.cost=1}if(!Q.multiplier.mass){Q.multiplier.mass=1}var K=this.copyValue(this.data.wavelengths[this.choices.instruments[Z].wavelength]);if(K.cost){K.cost.value*=Q.multiplier.cost}this.choices.instrument.cost=this.sumValues(this.choices.instrument.cost,K.cost);if(K.mass){this.choices.instrument.mass=this.sumValues(this.choices.instrument.mass,K.mass)}this.choices.instrument.mass.value*=Q.multiplier.mass;this.choices.instrument.temp=this.minValue(this.choices.instrument.temp,K.temperature);if(Q.devtime){this.choices.instrument.time=this.sumValues(this.choices.instrument.time,Q.devtime)}if(Q.risk){this.choices.instrument.risk*=Q.risk}if(this.choices.instruments[Z].wavelength=="uv"){G=true}}var L=(this.choices.mirror)?this.data.mirror[this.choices.mirror].bus.instrumentslots:0;if(this.choices.instruments.length>L){this.errors.push({text:this.phrases.errors.slots,link:"#designer_instruments"})}if(!this.choices.uvmirror&&G){this.errors.push({text:this.phrases.errors.uv,link:"#designer_satellite"})}}if(this.choices.site){if(this.choices.vehicle){for(var Z=0;Z<this.data.vehicle[this.choices.vehicle].sites.length;Z++){if(this.data.vehicle[this.choices.vehicle].sites[Z]==R){P=true}}}else{P=true}if(!P){this.errors.push({text:this.phrases.errors.site.replace(/%SITE%/g,this.phrases.designer.site.options[R].label).replace(/%VEHICLE%/,this.phrases.designer.vehicle.options[M].label),link:"#designer_site"})}}if(this.choices.vehicle&&this.choices.mirror){var J=this.copyValue(this.data.vehicle[this.choices.vehicle].diameter);var X=this.copyValue(this.data.mirror[this.choices.mirror].bus.diameter);if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.diameter){X.value*=this.data.deployablemirror.multiplier.bus.diameter}if(X.value>J.value){this.errors.push({text:this.phrases.errors.size,link:"#designer_satellite"})}}if(this.choices.orbit){P=false;if(this.choices.site){P=this.data.site[this.choices.site].orbits[V]}else{P=true}if(!P){this.errors.push({text:this.phrases.errors.orbit.replace(/%SITE%/g,this.phrases.designer.site.options[R].label).replace(/%ORBIT%/,this.phrases.designer.orbit.options[V].label),link:"#designer_orbit"})}this.choices.temperature=this.copyValue(this.data.orbit[this.choices.orbit].temperature)}this.choices.cooling={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),life:this.makeValue(99,"years"),time:this.makeValue(0,"months"),risk:1};if(this.choices.hascooling){if(this.choices.cool.temperature){Q=this.data.cooling.temperature[e("#cooling_temperature").val()];if(Q.temperature){this.choices.temperature=this.copyValue(Q.temperature)}if(Q.mass){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,Q.mass)}if(Q.cost){this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,Q.cost)}if(Q.devtime){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,Q.devtime)}if(Q.life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,Q.life)}if(Q.risk){this.choices.cooling.risk*=Q.risk}if(this.choices.mirror&&this.data.mirror[W]["passive"]){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.mirror[W]["passive"].mass);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.mirror[W]["passive"].cost);this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.mirror[W]["passive"].devtime)}}if(this.data.cooling.passive){T=this.choices.cool.passive;if(T=="yes"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.passive[T].devtime);if(this.choices.mirror&&this.data.mirror[this.choices.mirror].passive){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.mirror[this.choices.mirror].passive.mass);this.choices.cooling.passive=this.data.mirror[this.choices.mirror].passive.mass;this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.mirror[this.choices.mirror].passive.cost)}this.choices.cooling.mass.value*=this.data.cooling.passive[T].multiplier.mass;this.choices.cooling.cost.value*=this.data.cooling.passive[T].multiplier.cost;this.choices.cooling.risk*=this.data.cooling.passive[T].risk;this.choices.temperature.value*=this.data.cooling.passive[T].multiplier.temperature;if(this.data.cooling.passive[T].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.passive[T].life)}if(this.choices.orbit){this.choices.cooling.life.value*=this.data.orbit[this.choices.orbit].multiplier.passive.time;if(this.data.orbit[this.choices.orbit].multiplier.cryo.time==0){this.errors.push({text:this.phrases.errors.hotorbitpassive,link:"#designer_orbit"})}}if(this.data.cooling.active){T=this.choices.cool.active;if(T=="yes"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.active[T].devtime);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.cooling.active[T].cost);this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.cooling.active[T].mass);this.choices.cooling.active=this.data.cooling.active[T].mass;this.choices.cooling.risk*=this.data.cooling.active[T].risk;this.choices.temperature.value*=this.data.cooling.active[T].multiplier.temperature;if(this.data.cooling.active[T].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.active[T].life)}}}this.choices.cooling.cryogeniclife=0;if(this.data.cooling.cryogenic){T=this.choices.cool.cryogenic;if(T&&T!="none"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.cryogenic[T].devtime);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.cooling.cryogenic[T].cost);this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.cooling.cryogenic[T].mass);this.choices.cooling.cryogenic=this.data.cooling.cryogenic[T].mass;this.choices.cooling.risk*=this.data.cooling.cryogenic[T].risk;this.choices.temperature.value*=this.data.cooling.cryogenic[T].multiplier.temperature;if(this.data.cooling.cryogenic[T].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.cryogenic[T].life);this.choices.cooling.cyrogeniclife=this.convertValue(this.data.cooling.cryogenic[T].life,"years");this.choices.cooling.cyrogeniclife=this.choices.cooling.cyrogeniclife.value}if(this.choices.orbit){this.choices.cooling.life.value*=this.data.orbit[this.choices.orbit].multiplier.cryo.time;var U=this.data.orbit[this.choices.orbit].multiplier.cryo.time;if(U==0){this.errors.push({text:this.phrases.errors.hotorbitcryo,link:"#designer_orbit"})}if(U<1&&U>0){this.warnings.push({text:this.phrases.warnings.warmorbitcryo,link:"#designer_orbit"})}}}}}else{if(this.data.cooling.active&&this.getValue("input[name=cooling_active]:checked")=="yes"&&T=="no"){this.warnings.push({text:this.phrases.warnings.activenopassive,link:"#designer_cooling"})}if(this.data.cooling.cryogenic&&this.getValue("#cooling_cryogenic")!="none"&&T=="no"){this.warnings.push({text:this.phrases.warnings.cryonopassive,link:"#designer_cooling"})}}}}var ag=this.convertValue(this.choices.instrument.temp,"K");var af=this.convertValue(this.choices.temperature,"K");if(af.value>ag.value){this.errors.push({text:this.phrases.errors.temperature.replace(/%TEMPERATURE%/,"<strong>"+this.formatValue(af)+"</strong>").replace(/%REQUIREMENT%/,"<strong>"+this.formatValue(ag)+"</strong>"),link:"#designer_cooling"})}if(this.proposalCompleteness()<1){this.warnings.push({text:this.phrases.warnings.proposal,link:"#designer_proposal"})}this.updateSummary().updateSidePanels().updateMessages("error",this.errors).updateMessages("warning",this.warnings);return this};H.prototype.updateMessages=function(K,L){this.log("updateMessages",L);if(K!="error"&&K!="warning"){return this}var G="";var I=0;if(L&&typeof L=="object"&&L.length>0){I=L.length;for(var J=0;J<L.length;J++){G+="<li>"+L[J].text+(L[J].link?' <a href="'+L[J].link+'">'+this.phrases.ui[K].link+"</a>":"")+"</li>"}}e("."+K+".value").html(I);e("#messages h3."+K).next().html(G);if(I==0){e(".toggle"+K+",."+K+"s").hide()}else{e(".toggle"+K+",."+K+"s").show()}return this};H.prototype.toggleView=function(i,G){this.log("toggleView",i);if(!e("#"+i).is(":visible")){this.showView(i,G)}else{this.showView(G)}return this};H.prototype.showView=function(i,J,G){this.log("showView",i,J);if(g(i,"object")){J=i;i=""}if(!g(i,"string")){i=""}if(i=="messages"||i=="menu"||i=="language"||i=="options"||i.indexOf("summaryext")==0){if(J&&g(J,"object")&&g(J.preventDefault,"function")){J.preventDefault()}if(i=="options"){if(J){J.preventDefault()}this.updateOptions();e("#summaryext").hide();this.showModal(e("#options"));e("body").addClass("showoptions")}return this}e(".view").hide();e("body").removeClass("showguide showintro showoptions showmessages");if(i.indexOf("designer")==0&&!this.scenario){i="intro"}if((i.indexOf("guide")==0&&i.length==5)||i.indexOf("guide_")==0){e("#summaryext").hide();this.showGuide(i);e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide")}else{if((i.indexOf("designer")==0&&i.length==8)||i.indexOf("designer_")==0){e("#summaryext").hide();if(i.indexOf("designer_")==0){var I=i.substr(i.indexOf("designer_")+9);e("#menubar li").removeClass("on");e("#menubar a.toggle"+I).parent().addClass("on");e(".designer .designer_content").hide();e("#"+i+" .designer_content").show();e("#designer").show();if(e("#"+i).find("a").is(":visible")){e("#"+i).find("a:visible").eq(0).focus()}else{if(e("#"+i).find("input")){e("#"+i).find("input").eq(0).focus()}else{e("#menubar a.toggle"+I).focus()}}if(I=="orbit"){this.makeSpace("orbits").displayOrbits()}else{this.removeOrbits()}if(I=="proposal"){this.updateProposal()}}else{e("#designer").show().find("a").eq(0).focus()}this.updateBodyClass("showdesigner");this.setScroll("#"+i);this.stage="designer"}else{if(i=="intro"){e("#summaryext").hide();e("#intro").show();this.updateBodyClass("showintro");this.stage="intro";this.startup()}else{if(i=="scenarios"){e("#summaryext").hide();e("#scenarios").show();this.updateBodyClass("showscenarios");this.stage="scenarios"}else{if(i=="launch"){e("#summaryext").hide();this.updateMessages("error",{}).updateMessages("warning",{});this.updateBodyClass("showlaunch");this.goForLaunch();this.stage="launch"}else{e("#"+this.stage).show();this.updateBodyClass("show"+this.stage)}}}}}if(this.pushstate&&!J){history.pushState({},"Guide","#"+i)}if(g(G,"function")){G.call(this)}return this};H.prototype.setScroll=function(I){this.log("setScroll",I);var i=e("#bar");var J=(i.is(":visible"))?i.outerHeight():0;var G=0;if(I&&e(I).length==1){G=Math.floor(e(I).offset().top-J);if(G<0){G=0}}e(window).scrollTop(G);return this};H.prototype.toggleGuide=function(i,G){this.log("toggleGuide",i);if(g(i,"object")){G=i;i=""}if(!e("#guide").is(":visible")){if(!i){i="guide"}this.showView(i)}else{this.showView()}return this};H.prototype.closeGuide=function(){this.log("closeGuide");e("body").removeClass("showguide");e("#guide").hide();e("#intro").show();return this};H.prototype.showGuide=function(Q){this.log("showGuide",Q);var I=Q;if(g(Q,"string")){var P=Q.split("_");if(P.length>1&&this.phrases.guide[P[1]]){Q=P[1]}}var L="";var M=this.phrases.guide;var R,N,S,K,G;if(Q){e("body").addClass("showguide");e("#guide").show();if(e("#guide").length==0){e("#page").append('<div id="guide" class="view"></div>')}if(Q=="guide"){L+="<h2>"+this.phrases.guide.title+"</h2><p>"+this.phrases.guide.about+'</p><ul class="index">';for(k in this.phrases.guide){if(k!="title"&&k!="about"&&g(this.phrases.guide[k].title,"string")){L+='<li><a href="#guide_'+k+'" class="guidelink">'+this.phrases.guide[k].title+"</a><br />"+(g(this.phrases.guide[k].summary,"string")?this.phrases.guide[k].summary:"")+"</li>"}}L+="</ul>"}else{if(M[Q]){L+='<div class="guidetop"><span class="breadcrumb"><a href="#guide" class="guidelink">'+M.title+"</a> &raquo; "+M[Q].title+"</span></div>";K=M[Q].about;if(Q=="mirror"){S="";for(A in this.data.mirror){S+="<tr>";S+="<td>"+this.formatValue(this.data.mirror[A].diameter)+"</td>";S+="<td>"+this.formatValue(this.data.mirror[A].mass)+"</td>";S+="<td>"+this.formatValue(this.data.mirror[A].cost)+"</td>";if(this.settings.mode=="advanced"){S+="<td>"+this.formatValue(this.data.mirror[A].devtime)+"</td>"}S+="</tr>"}K=K.replace(/\%MIRRORTABLE\%/,S)}else{if(Q=="structure"){S="";for(A in this.data.mirror){S+="<tr>";S+="<td>"+this.formatValue(this.data.mirror[A].diameter)+"</td>";S+="<td>"+this.formatValue(this.data.mirror[A].bus.diameter)+"</td>";S+="<td>"+this.formatValue(this.data.mirror[A].bus.cost)+"</td>";S+="<td>"+this.formatValue(this.data.mirror[A].bus.mass)+"</td>";S+="</tr>"}K=K.replace(/\%STRUCTURETABLE\%/,S)}else{if(Q=="cooling"){S="";if(this.settings.mode=="advanced"){for(A in this.data.cooling.cryogenic){if(A!="none"){S+="<tr>";S+="<td>"+this.formatValue(this.data.cooling.cryogenic[A].life)+"</td>";S+="<td>"+this.formatValue(this.data.cooling.cryogenic[A].cost)+"</td>";S+="<td>"+this.formatValue(this.data.cooling.cryogenic[A].mass)+"</td>";S+="</tr>"}}K=K.replace(/\%ACTIVELIFE\%/,this.formatValue(this.data.cooling.active.yes.life));K=K.replace(/\%ACTIVEMASS\%/,this.formatValue(this.data.cooling.active.yes.mass));K=K.replace(/\%ACTIVECOST\%/,this.formatValue(this.data.cooling.active.yes.cost))}else{for(A in this.data.cooling.temperature){S+="<tr>";S+="<td>"+this.formatValue(this.data.cooling.temperature[A].temperature)+"</td>";S+="<td>"+this.formatValue(this.data.cooling.temperature[A].cost)+"</td>";S+="<td>"+this.formatValue(this.data.cooling.temperature[A].mass)+"</td>";S+="</tr>"}}K=K.replace(/\%COOLINGTABLE\%/,S)}else{if(Q=="instruments"){S="";for(A in this.data.wavelengths){if(A!="none"){S+="<tr>";S+="<td>"+this.phrases.wavelengths[A].label+"</td>";S+="<td>"+this.formatValue(this.data.wavelengths[A].temperature)+"</td>";S+="</tr>"}}K=K.replace(/\%WAVELENGTHTABLE\%/,S);if(this.settings.mode=="advanced"){S="";for(A in this.data.instrument.options){if(A!="none"){S+="<tr>";S+="<td>"+this.phrases.designer.instruments.options.instrument[A].label+"</td>";S+="<td>"+this.formatValue(this.data.instrument.options[A].multiplier.mass)+"</td>";S+="<td>"+this.formatValue(this.data.instrument.options[A].multiplier.cost)+"</td>";S+="<td>"+this.formatValue(this.data.instrument.options[A].devtime)+"</td>";S+="</tr>"}}K=K.replace(/\%INSTRUMENTTABLE\%/,S)}}else{if(Q=="orbit"){S="";for(A in this.data.orbit){S+="<tr>";S+="<td>"+this.phrases.designer.orbit.options[A].label+"</td>";S+="<td>"+(this.phrases.designer.orbit.options[A].altitude?this.phrases.designer.orbit.options[A].altitude:"")+this.formatValue(this.data.orbit[A].altitude,0)+"</td>";S+="<td>"+this.formatValue(this.data.orbit[A].period)+"</td>";S+="<td>"+(this.data.orbit[A].obsfrac*100)+"%</td>";S+="<td>"+this.formatValue(this.data.orbit[A].temperature)+"</td>";S+="</tr>"}K=K.replace("%ORBITTABLE%",S);for(A in this.data.orbit){K=K.replace("%"+A+"ANCHOR%","guide_orbit_"+A);K=K.replace("%"+A+"LABEL%",this.phrases.designer.orbit.options[A].label);K=K.replace("%"+A+"GROUNDCOST%",this.formatValue(this.data.orbit[A].groundcost));K=K.replace("%"+A+"FUELLIFE%",this.formatValue(this.data.orbit[A].fuellife));K=K.replace("%"+A+"ALTITUDE%",this.formatValue(this.data.orbit[A].altitude));K=K.replace("%"+A+"PERIOD%",this.formatValue(this.data.orbit[A].period));K=K.replace("%"+A+"CRYOREDUCTION%",(100*(1-this.data.orbit[A].multiplier.cryo)).toFixed(0)+"%")}}else{if(Q=="vehicle"){S="";for(A in this.data.vehicle){S+="<tr>";S+="<td>"+this.phrases.designer.vehicle.options[A].label+"</td>";S+="<td>"+this.formatValue(this.data.vehicle[A].diameter,0)+"</td>";S+="<td>"+this.formatValue(this.data.vehicle[A].mass.LEO,0)+"</td>";S+="<td>"+this.formatValue(this.data.vehicle[A].mass.GTO,0)+"</td>";S+="<td>"+this.formatValue(this.data.vehicle[A].cost,0)+"</td>";S+="<td>"+this.phrases.operator[this.data.vehicle[A].operator].label+"</td>";if(this.settings.mode=="advanced"){S+="<td>"+(this.data.vehicle[A].risk*100)+"%</td>"}S+="</tr>"}K=K.replace(/\%ROCKETTABLE\%/,S)}else{if(Q=="site"){S="";for(A in this.data.site){S+="<tr>";S+="<td>"+this.phrases.designer.site.options[A].label+"</td>";S+="<td>"+this.phrases.designer.site.options[A].trajectories+"</td>";S+="<td>";var J="";for(var i in this.data.vehicle){for(var T=0;T<this.data.vehicle[i].sites.length;T++){if(this.data.vehicle[i].sites[T]==A){if(J.length>0){J+=", "}J+=""+this.phrases.designer.vehicle.options[i].label+""}}}S+=J;S+="</td>";S+="</tr>"}K=K.replace(/\%SITETABLE\%/,S)}}}}}}}if(K.indexOf("<p>")<0){K="<p>"+K+"</p>"}L+='<h2 id="guide_'+Q+'">'+M[Q].title+"</h2>"+K+'<div class="clearall" /></div>';if(Q=="roles"){for(k in M[Q]){if(k!="title"&&k!="about"&&g(M[Q][k].title,"string")){L+="<h3>"+M[Q][k].title+"</h3><p>"+M[Q][k].about+"</p>"}}}else{if(Q=="previous"){for(k in M[Q]["missions"]){if(g(M[Q]["missions"][k].title,"string")){N="<ul>";for(A in M[Q]["missions"][k]){if(A!="title"&&A!="image"){R=this.formatValue(M[Q]["missions"][k][A]);N+='<li><span class="key">'+M[Q][A]+'</span> <span class="value">'+R+"</span></li>"}}N+="</ul>";L+='<h3 id="guide_'+Q+"_"+k+'">'+M[Q]["missions"][k].title+"</h3>";if(M[Q]["missions"][k]["image"]){L+='<figure class="right"><img src="'+M[Q]["missions"][k]["image"].src+'" alt="'+M[Q]["missions"][k]["title"]+'" /><figcaption>'+M[Q]["missions"][k]["title"]+"</figcaption></figure>"}L+="";L+=N}}}}}}if(M[Q]&&M[Q].questions){G='<h3 id="guide_'+Q+'_questions">Questions</h3><ol>';for(A=0;A<M[Q].questions.length;A++){G+="<li>"+M[Q].questions[A].label.replace("%EARTHRADIUS%",this.formatValue({value:6500,units:"km",dimension:"length"})).replace("%EARTHMASS%",this.formatValue({value:6e+24,units:"kg",dimension:"mass"}))+"</li>"}G+="</ol>";L+=G}e("#guide").html(L);if(L.indexOf("script")>=0&&g(MathJax,"object")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"guide"])}this.addCloser(e("#guide"),{me:this},function(U){U.preventDefault();U.data.me.toggleGuide()});var O=this;e("#guide").show(function(){O.setScroll("#"+I)});e("#intro").hide()}else{this.closeGuide()}e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide");return this};H.prototype.updateBodyClass=function(i){e("body").removeClass("showguide showintro showoptions showmessages showlaunch").addClass(i);return this};H.prototype.addCloser=function(I,J,G){var i=location.href.split("#")[1];if(I.find(".close").length==0){I.prepend('<a href="#" class="close" title="Close"><img src="images/cleardot.gif" class="icon close" /></a>')}if(I.attr("id")!="guide"&&I.attr("id").indexOf(i)!=0){I.find("a.close").attr("href","#"+i)}I.find("a img.close").parent().on("click",J,G);return this};H.prototype.showModal=function(J){var G=e(window).width();var K=e(window).height();var i=0;var I=0;J.show().find("a").eq(0).focus();this.positionModal(J);this.modal=J;return this};H.prototype.closeModal=function(i){i.hide();e("#modalbg").hide();e("body").css("overflow-y","auto");this.modal=undefined;return this};H.prototype.positionModal=function(i){x(i);e("#modalbg").hide().css({left:0,top:0,height:e(document).height(),width:e(document).width()}).show().off("click").on("click",{me:this},function(G){G.data.me.closeModal(i)});return this};H.prototype.log=function(){var i=Array.prototype.slice.call(arguments,0);if(console&&g(console.log,"function")){console.log("LOG",i)}return this};function E(I){if(!I){I={}}if(I.spacetel){this.s=I.spacetel}else{return this}this.heightscale="";this.prop={mirror:0,bus:0,slots:0};this.id=(g(I.id,"string"))?I.id:"sidebar_satellite";if(!this.el){this.el=e("#"+this.id)}if(this.el.find("#"+this.id+"_schematic").length==0){this.el.html('<div class="schematic" id="'+this.id+'_schematic"></div>')}if(g(I.height,"string")&&I.height.indexOf("%")>0){this.heightscale=parseFloat(I.height)/100}this.state={cooling:{passive:true,active:true,cryogenic:true},mirror:true,bus:true};if(g(I.state,"object")){for(var G in I.state){this.state[G]=I.state[G]}}this.colourize={cooling:{passive:false,active:false,cryogenic:true},mirror:false,bus:true};if(g(I.colourize,"object")){for(var G in I.colourize){this.colourize[G]=I.colourize[G]}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}E.prototype.getScales=function(Q,O){var L=Math.floor(Q/32);var G=L*(this.prop.bus/this.prop.mirror);var M=8;var I=2;var K=10*G;var R=(this.s.choices.cooling.cryogenic?this.s.choices.cooling.cyrogeniclife:0);if(R==0&&this.s.choices.cool.temperature){var S=this.s.convertValue(this.s.choices.temperature,"K");if(S.value<50){R=Math.log(50/S.value)}}var P=4;var J=((M+P+R)*L);var i=13*L;var N=(this.s.choices.cooling.passive?2*L:0);if(this.s.choices.cool.temperature){var S=this.s.convertValue(this.s.choices.temperature,"K");if(S.value<300){N=2*L}}h=(this.s.choices.mirror)?K+J+i+N+(2*O):0;return{body:J,vgroove:N,bus:K,mirror:i,h:h,fb:G,f:L,top:P,bodyh:M,tank:R,instrument:I}};E.prototype.build=function(){var ag=160;var T=this.el.parent().innerWidth();var ak;var an=Math.cos(Math.PI*30/180);if(this.s.choices.mirror){for(var ab in this.s.data.mirror){ak=this.s.convertValue(this.s.data.mirror[ab].diameter,"m");if(ab==this.s.choices.mirror){this.prop.mirror=ak.value}}for(var ab in this.s.data.mirror){ak=this.s.convertValue(this.s.data.mirror[ab].bus.diameter,"m");if(ab==this.s.choices.mirror){this.prop.bus=ak.value;if(this.s.choices.deployablemirror&&this.s.data.deployablemirror.multiplier.bus.diameter){this.prop.bus*=this.s.data.deployablemirror.multiplier.bus.diameter}this.prop.slots=this.s.data.mirror[ab].bus.instrumentslots}}}var M=16;var ao;if(this.heightscale){ao=this.getScales(200,M);T=(T*this.heightscale)*200/ao.h}ao=this.getScales(T,M);var Y=ao.fb;var ai=ao.f;var N=ao.bodyh;var J=ao.tank;var G=ao.top;var I=ao.instrument;ag=(this.s.choices.mirror)?ao.bus+ao.body+ao.mirror+ao.vgroove+(2*M):0;if(this.heightscale){this.create(T,T*this.heightscale)}else{this.create("auto",ag)}if(this.bus){this.bus.remove();delete this.bus}if(this.body){this.body.remove();delete this.body}if(this.vgroove){this.vgroove.remove();delete this.vgroove}if(this.mirror){this.mirror.remove();delete this.mirror}var aj={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};var ap={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};var O={stroke:"white","stroke-width":1};var U,af;var W=this.paper;if(this.s.choices.mirror){this.bus=W.set();this.bus.push(W.ellipse(0,3.5*Y,10*Y,6*Y).attr(aj));this.bus.push(W.path("m "+(-8.5*Y)+", "+(-2*Y)+" l0,"+(4*Y)+" l"+(5*Y)+","+(3*Y)+" l"+(7*Y)+",0 l"+(5*Y)+","+(-3*Y)+" l0,"+(-4*Y)+" l"+(-5*Y)+","+(-3*Y)+" l"+(-7*Y)+",0 z").attr(aj));this.bus.push(W.path("m "+(-8.5*Y)+", "+(2*Y)+" l0,"+(3.5*Y)+" l"+(5*Y)+","+(3*Y)+" l0,"+(-3.5*Y)+" z").attr(aj));this.bus.push(W.path("m "+(-3.5*Y)+", "+(5*Y)+" l"+(7*Y)+",0 l0,"+(3.5*Y)+" l"+(-7*Y)+",0 z").attr(aj));this.bus.push(W.path("m "+(8.5*Y)+", "+(2*Y)+" l0,"+(3.5*Y)+" l"+(-5*Y)+","+(3*Y)+" l0,"+(-3.5*Y)+" z").attr(aj))}if(ao.vgroove>0){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};if(this.colourize.cooling.passive){af.fill=(this.state.cooling.passive)?e(".mass").css("color"):"black";af["fill-opacity"]=0.5}this.vgroove=W.set();this.vgroove.push(W.ellipse(0,-0.6*Y,8.5*Y,5*Y).attr(af));this.vgroove.push(W.ellipse(0,-1.2*Y,8.25*Y,4.75*Y).attr(af));this.vgroove.push(W.ellipse(0,-1.8*Y,8*Y,4.5*Y).attr(af));this.vgroove.push(W.path("m 0,"+(-0.6*Y)+" l"+(-5.5*Y)+","+(2.5*Y)+" m"+(5.5*Y)+","+(-2.5*Y)+" l"+(1.5*Y)+","+(3.5*Y)+" m"+(-1.5*Y)+","+(-3.5*Y)+" l"+(8*Y)+","+(-Y)+" m"+(-8*Y)+","+(Y)+" l"+(5*Y)+","+(-5*Y)+" m"+(-5*Y)+","+(5*Y)+" l"+(-2*Y)+","+(-5.5*Y)+" m"+(2*Y)+","+(5.5*Y)+" l"+(-7*Y)+","+(-3*Y)).attr({stroke:"white","stroke-width":1,"stroke-opacity":0.4}))}if(this.s.choices.mirror){this.body=W.set();var ah=Math.min(7,8.5*(this.prop.bus/this.prop.mirror));var am=ah*0.4;var K=(ah-am);this.body.push(W.ellipse(0,0,ah*ai,K*ai).attr(O));this.body.push(W.path("m "+(-ah*ai)+",0 a "+(ah*ai)+","+(K*ai)+" 0 0,0 "+(2*ah*ai)+",0 l 0,"+(-(N+J-1)*ai)+" q 0,"+(-2*ai)+" "+(-K*ai)+","+(-G*ai)+" l0,"+(-1*ai)+" a"+(am*ai)+","+(am*0.5*ai)+" 0 0,0 "+(-2*am*ai)+",0 l0,"+(1*ai)+" q"+(-K*ai)+","+(1*ai)+" "+(-K*ai)+","+(K*ai)+" z").attr(aj));if(J>0){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.cooling.cryogenic){af.fill=(this.state.cooling.cryogenic)?e(".mass").css("color"):"black";af["fill-opacity"]=0.8}this.body.push(W.path("m "+(-ah*ai)+",0 a "+(ah*ai)+","+(K*ai)+" 0 0,0 "+(2*ah*ai)+",0 l 0,"+(-J*ai)+" a "+(ah*ai)+","+(K*ai)+" 0 0,0 "+(-2*ah*ai)+",0 z").attr(af));this.body.push(W.ellipse(0,(-J*ai),ah*ai,K*ai).attr(O))}this.body.push(W.ellipse(0,(-(N+J+G)*ai),am*ai,am*0.5*ai).attr(O));var S=Math.ceil(this.prop.slots/2);var Q,P,V,al;var ad=2.2;ad=ah*2/(S+2);var aa=ad/2;var X=ad/4;var Z=0;var L=(this.s.choices.instruments)?this.s.choices.instruments.length:0;e("#"+this.id+"_schematic .label").remove();var R="";T=this.el.innerWidth();ag=this.el.innerHeight();for(var ae=0;ae<S;ae++){Q=(ae-(S-1)/2)*(ad*ai*1.25);for(var ac=0;ac<2;ac++){P=J+1.5+(ac==0?0:I*2);V=0.5+(Q+(ac==0?X*ai:0))/T;al=(M+(ao.bus+ao.vgroove+(P+(ac==0?-I:+I*1.5))*ai))/ag;if(Z<L){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.bus){af["fill-opacity"]=1;if(this.state.bus){af.fill=e(".science").css("color")}if(!this.s.choices.instruments[Z].ok){af.fill="black"}}}else{af={stroke:"white","stroke-width":1,"stroke-dasharray":"- ",fill:"white","fill-opacity":0.2}}this.body.push(W.path("m"+(Q-aa*ai)+","+(-P*ai)+" l"+(aa*ai)+","+(X*ai)+" l"+(aa*ai)+","+(-X*ai)+" l0,"+(-I*ai)+" l"+(-aa*ai)+","+(-X*ai)+" l"+(-aa*ai)+","+(X*ai)+" z m"+(aa*ai)+","+(X*ai)+" l0,"+(-I*ai)+" l"+(-aa*ai)+","+(-X*ai)+"m"+(aa*ai)+","+(X*ai)+"l"+(aa*ai)+","+(-X*ai)).attr(af));if(Z<L&&this.s.choices.instruments[Z]&&this.s.hastransform){R+='<div class="label '+(ac==0?"bottom":"top")+'" style="bottom:'+(100*al)+"%; left:"+(100*V)+'%">'+this.s.choices.instruments[Z].name+"</div>"}Z++}}if(R){e("#"+this.id+"_schematic").prepend(R)}}if(this.s.choices.mirror){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};if(this.colourize.mirror){af.fill=e(".time").css("color");if(!this.state.mirror){af.fill="black";af.stroke="#ff0000"}}this.mirror=W.set();this.mirror.push(W.ellipse(0,-2.5*ai,10*ai,6*ai).attr(af));this.mirror.push(W.ellipse(0,0,1*ai,0.6*ai).attr(aj));this.mirror.push(W.path("m "+(-2*ai)+","+(-11*ai)+" l"+(-3*ai)+","+(6*ai)+" l "+(5*ai)+","+(-7*ai)+" l"+(5*ai)+","+(7*ai)+" l"+(-3*ai)+","+(-6*ai)).attr(O));this.mirror.push(W.path("m "+(-2*ai)+","+(-11*ai)+" l"+(2*ai)+","+(-1*ai)+" l 0,"+(-1*ai)+" l"+(-2*ai)+","+(1*ai)+" z").attr(aj));this.mirror.push(W.path("m "+(2*ai)+","+(-11*ai)+" l"+(-2*ai)+","+(-1*ai)+" l 0,"+(-1*ai)+" l"+(2*ai)+","+(1*ai)+" z").attr(aj));this.mirror.push(W.path("m "+(-2*ai)+","+(-11*ai)+" l"+(-4*ai)+","+(12*ai)+" l "+(6*ai)+","+(-11*ai)+" l"+(6*ai)+","+(11*ai)+" l"+(-4*ai)+","+(-12*ai)).attr(O));this.mirror.push(W.ellipse(0,(-11*ai),2*ai,1*ai).attr(af));this.mirror.push(W.path("m "+(-2*ai)+","+(-12*ai)+" l"+(2*ai)+","+(1*ai)+" l 0,"+(1*ai)+" l"+(-2*ai)+","+(-1*ai)+" z").attr(aj));this.mirror.push(W.path("m "+(2*ai)+","+(-12*ai)+" l"+(-2*ai)+","+(1*ai)+" l 0,"+(1*ai)+" l"+(2*ai)+","+(-1*ai)+" z").attr(aj))}if(this.bus){for(var ae=0;ae<this.bus.length;ae++){z(this.bus[ae],["t",this.width/2,ag-M-ao.bus])}}if(this.vgroove){for(var ae=0;ae<this.vgroove.length;ae++){z(this.vgroove[ae],["t",this.width/2,ag-M-ao.bus])}}if(this.body){for(var ae=0;ae<this.body.length;ae++){z(this.body[ae],["t",this.width/2,ag-M-ao.bus-ao.vgroove])}}if(this.mirror){for(var ae=0;ae<this.mirror.length;ae++){z(this.mirror[ae],["t",this.width/2,ag-M-ao.bus-ao.vgroove-ao.body])}}return this};E.prototype.resize=function(i,G){this.build();return this};E.prototype.create=function(i,I){e("#"+this.id+"_schematic").hide();this.el.css({width:"auto",display:"block"});if(!i||i=="auto"){i=this.el.innerWidth()}var G=this.el.parent();if(i<G.width()/2){i=G.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}if(!I){I=i/2}if(this.heightscale){I=i*this.heightscale}if(i!=this.width||I!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=G.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=I;if(!this.paper){this.paper=Raphael(this.id+"_schematic",this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}}e("#"+this.id+"_schematic").show();return this};function F(I){this.width=0;this.height=300;this.heightscale="";this.zoom=0;this.scale=[1,0.022];this.anim={};this.orbits={};this.labels={};this.svg={orbits:{}};this.phrases={};this.data={};this.callback;this.spacetel={};this.id="orbits";this.interactive=true;if(!I){I={}}if(g(I.id,"string")){this.id=I.id}if(g(I.zoom,"number")){this.zoom=I.zoom}this.el=e("#"+this.id);if(g(I.phrases,"object")){this.phrases=I.phrases}if(g(I.data,"object")){this.data=I.data}if(g(I.callback,"function")){this.callback=I.callback}if(g(I.interactive,"boolean")){this.interactive=I.interactive}if(g(I.height,"string")&&I.height.indexOf("%")>0){this.heightscale=I.height/100}if(g(I.height,"number")){this.height=I.height}if(I.context){this.spacetel=I.context}this.orbits={GEO:{inclination:0,color:"#048b9f",ellipticity:0.3,zoom:0,z:false,ok:false},SNS:{inclination:-90,color:"#7ac36a",ellipticity:0.4,zoom:0,z:true,ok:false},HEO:{inclination:30,color:"#de1f2a",ellipticity:0.4,zoom:0,z:false,ok:false},LEO:{inclination:-30,color:"#cccccc",ellipticity:0.4,zoom:0,z:true,ok:false},EM2:{inclination:0,color:"#cccccc",ellipticity:1,zoom:1,z:false,ok:false},ES2:{inclination:0,color:"#9467bd",ellipticity:1,zoom:1,z:false,ok:false},ETR:{inclination:0,color:"#fac900",ellipticity:1,zoom:1,z:false,ok:false}};if(!I.orbits){I.orbits=["GEO","SNS","HEO","LEO","EM2","ES2","ETR"]}for(var G=0;G<I.orbits.length;G++){if(this.orbits[I.orbits[G]]){this.orbits[I.orbits[G]].ok=true}}if(I.orbits.length==1){this.zoom=this.orbits[I.orbits[0]].zoom}if(!this.spacetel.convertValue||!g(this.spacetel.convertValue,"function")){this.spacetel.convertValue=function(i){return i}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}F.prototype.resize=function(){if(this.el.length>0){this.el.children().hide()}this.el.css({width:"auto",display:"block"});var i=this.el.innerWidth();if(i<this.el.parent().width()/2){i=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}var G=i/2;if(i!=this.width||G!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=(this.heightscale)?this.width*this.heightscale:G;if(!this.paper){this.paper=Raphael(this.id,this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}this.E={x:this.width/2,y:this.height/2,r:this.height/6,radius:6378};this.M={r:5,o:this.E.r*58}}this.displayOrbits();this.el.children().show();return this};F.prototype.removeOrbits=function(){for(var K in this.orbits){if(this.svg.orbits[K]){if(this.svg.orbits[K].dotted){this.svg.orbits[K].dotted.stop().remove()}if(this.svg.orbits[K].solid){this.svg.orbits[K].solid.stop().remove()}if(this.svg.orbits[K].satellite){this.svg.orbits[K].satellite.stop().remove()}delete this.svg.orbits[K]}}var I=["Moon","Moonorbit","Moonlagrangian","Earthorbit"];for(var J=0;J<I.length;J++){if(this[I[J]]){this[I[J]].remove();delete this[I[J]]}}for(var G in this.labels){for(var J in this.labels[G]){if(g(this.labels[G][J].remove,"function")){this.labels[G][J].remove();delete this.labels[G][J]}}delete this.labels[G]}return this};F.prototype.displayOrbits=function(Z,I){if(!this.paper){return this}if(this.orbits.HEO){this.orbits.HEO.r=this.E.r*3.3}if(Z){this.zoom=this.orbits[Z].zoom}if(g(I,"number")){this.zoom=I}function V(ac,ad,aa){if(!aa||!g(aa,"number")){aa=0}var i=ac*Math.sin(aa*Math.PI/180);var ab=ac*Math.cos(aa*Math.PI/180);if(Math.abs(aa)>80){i+=ac;ab+=ac*ad}return" m "+(0-ab)+" "+(0-i)+" a "+(ac)+","+(ad*ac)+" "+aa+" 1,1 0,0.01"}function L(i){if(i){i.hide()}}function X(i){if(i){i.show()}}if(this.rebuild){this.removeOrbits();this.rebuild=false}if(this.interactive){if(e("#"+this.id+" .zoomer").length==0){e("#"+this.id).prepend('<a href="#" class="zoomer button">-</a>');e("#"+this.id+" .zoomer").on("click",{me:this},function(i){i.preventDefault();i.data.me.displayOrbits("",(i.data.me.zoom==0?1:0));e(this).html(i.data.me.zoom==0?"&minus;":"&plus;").attr("title",(i.data.me.zoom==0?i.data.me.phrases.zoomout:i.data.me.phrases.zoomin))})}}if(this.Earth){this.Earth.remove()}if(this.zoom==0){this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m -6.927379,42.861897 c -10.79338,-1.89118 -21.17473,-8.25868 -27.52258,-16.87977 -15.02038,-20.3975403 -9.63593,-48.89125 11.79388,-62.41291 16.94554,-10.68989 39.20392,-8.16663 53.44137,6.06404 5.87268,5.86844 9.54913,12.35889 11.55616,20.4047297 1.16835,4.68267 1.47335,12.35457 0.67442,16.96248 -3.048,17.5816003 -15.4426,30.9321203 -32.72769,35.2509203 -4.33566,1.08222 -12.80575,1.3828 -17.21554,0.61124 z m 11.33951,-4.82289 c 6.979,-0.79891 13.53188,-3.42643 19.13933,-7.67694 1.15933,-0.87801 1.54372,-1.39287 1.55148,-2.07816 0.0111,-1.02039 1.44195,-5.01704 2.21985,-6.20209 0.27849,-0.42427 1.14761,-1.04771 1.93147,-1.3828 1.16726,-0.50337 1.55149,-0.90389 2.12308,-2.23204 0.96595,-2.24427 1.24242,-3.45664 0.78812,-3.45664 -0.20378,0 -0.37027,-0.35953 -0.37027,-0.78883 0,-0.79173 1.79473,-2.69441 4.39774,-4.66182 0.67305,-0.50337 1.30726,-1.14263 1.40925,-1.40725 0.839,-2.1845903 0.99945,-12.8320603 0.19322,-12.8320603 -0.51768,0 -0.70521,2.11843004 -0.37077,4.19083 0.41376,2.56281 0.0979,4.2843 -0.80975,4.4166 -1.268,0.18698 -2.13725,-1.28571 -2.84295,-4.81066 -1.04641,-5.22558 -1.1243,-5.32626 -4.56601,-5.9267 -1.02684,-0.17978 -1.08581,-0.13664 -1.08581,0.81689 0,2.22772 -2.80355,5.66709 -5.01389,6.15248 -1.66562,0.36674 -2.62557,-0.58246 -4.17367,-4.1182 -0.735,-1.67907 -1.59947,-3.31138 -1.92103,-3.62778 -0.55377,-0.5465 -0.58461,-0.53932 -0.58461,0.12942 0,1.72221 2.25458,7.61438 3.13524,8.1954 0.20501,0.13663 1.09432,0.2445 1.97628,0.25168 2.19326,0.006 3.57706,0.7572 3.56758,1.9329 -0.013,1.61147 -1.23802,3.68026 -3.44872,5.8238503 -2.98531,2.89432 -3.55713,3.9449 -3.55867,6.5372 -0.001,2.03428 0.0252,2.10116 0.75047,1.87393 0.41348,-0.12941 1.04826,-0.43864 1.4107,-0.68312 0.98159,-0.67594 2.09973,-0.56808 2.35382,0.2373 0.2447,0.77084 -1.60253,3.96287 -3.39818,5.87203 -0.87967,0.93553 -1.18294,1.07144 -1.83751,0.82552 -0.6725,-0.25169 -0.7809,-0.51776 -0.76252,-1.84374 0.013,-0.95351 -0.11516,-1.50505 -0.33409,-1.43314 -0.34616,0.10794 -0.65537,0.55369 -2.65289,3.74859 -1.17673,1.884 -3.79425,3.67597 -6.07803,4.16206 -1.86971,0.3955 -3.48492,0 -3.48492,-0.7953 0,-0.26607 -0.43326,-1.29723 -0.96281,-2.30323 -1.69574,-3.22007 -1.84288,-3.99595 -1.37585,-7.24909 0.47848,-3.33582 0.19975,-4.72582 -1.21076997,-6.04247 -1.23809,-1.15484 -1.87063003,-2.53763 -1.64033003,-3.58606 0.18366003,-0.8355803 0.0857,-0.9340903 -1.34377,-1.3540303 -1.63056,-0.4818 -5.15549,-0.33078 -7.61198,0.33796 -1.09992,0.30202 -1.50461,0.23729 -2.83756,-0.42426 -2.86801,-1.42451 -4.32003,-4.81858 -3.89918,-9.11581996 0.39299,-4.01250004 0.54491,-4.51441004 1.80953,-5.97273004 0.68343,-0.78955 1.4365,-1.90268 1.67352,-2.47365 0.39117,-0.94344 1.89274,-1.9479897 3.70135,-2.4779597 0.29382,-0.0863 0.93542,-0.95925 0.19912,-1.19654 -2.63115,0.61121 -3.4916,-1.84374 -1.69974,-3.63426 0.98587,-0.98515 1.35751,-1.14982 2.33866,-1.03549 1.08194,0.12941 1.16649,0.0791 1.16649,-0.77733 0,-0.49616 0.15034,-1.00814 0.33409,-1.12032 0.18367,-0.11497 1.44636,-0.95208 1.44636,-1.06713 0,-0.36673 -4.64238,1.86027 -2.8525,-0.67594 -0.26146,0.41707 -0.65956,0.19416 -1.1224,-0.26605 -0.87213,-0.87083 0.29445,-1.80204 1.00761,-1.97534 0.45202,-0.006 0.96756,1.28718 1.31068,0.58247 -0.82013,-1.1455 -0.62158,-2.63904 -0.28282,-2.70519 1.2859,-0.53932 1.49537,0.78523 1.49537,1.81137 0,0.39548 0.2255,0.91683 0.50112,1.14478 0.27563,0.2373 0.50113,0.79099 0.50113,1.25048 0,0.76151 0.0941,0.81689 1.06974,0.62562 1.49278,-0.30203 2.53575,-1.36699 2.47682,-2.53838 2.67534003,-1.78908 -0.15886,-1.06713 -0.29398,-1.20302 -0.63709,-0.63281 -0.13885,-1.83798 1.40482003,-3.38761 2.14169997,-2.15005 3.38975997,-2.7095 6.99786997,-3.13593 2.72694,-0.32359 3.09543,-0.29482 4.55125,0.35235 1.4815,0.64719 1.57109,0.76511 1.3838,1.70136 l -0.20026,0.99953 1.80809,-0.9643 c 0.99444,-0.53212 2.56916,-1.15844 3.49938,-1.39646 0.93019,-0.2373 1.69128,-0.56808 1.69128,-0.72556 0,-0.3811 -4.20122,-2.31041 -6.97024,-3.21358 -5.23627,-1.70998 -13.51182,-2.25217 -18.83832,-1.23323 -4.60384,0.87944 -12.69228,4.14912 -13.13855,5.31187 -0.0896,0.2373 0.0676,0.97293 0.34883,1.64671 0.63899,1.52734 0.65767,3.66589 0.0424,4.84878 -0.61531,1.18145 -5.09802,5.49956 -6.37985,6.14601 -0.55124,0.27325 -2.28017,0.92043 -3.84205,1.42882 -4.30776,1.40509 -4.48483,1.5338 -5.46145,3.96935 -1.64357,4.1023697 -2.26852,7.1311597 -2.45187,11.88357974 l -0.17385,4.50720996 2.56104,2.13282 c 1.40855,1.17211 3.47725,3.15461 4.59709,4.4043803 1.51998,1.6956 2.48972,2.45639 3.82568,2.99714 1.96471,0.79675 3.45111,2.28165 3.45111,3.4473 0,0.40987 -0.24263,1.46045 -0.53917,2.3291 -0.49906,1.46407 -0.49746,1.69129 0.0209,3.04604 0.6264,1.6388 0.35646,2.62899 -0.81789,3.00146 -0.81891,0.26607 -0.85988,1.23396 -0.10053,2.39168 0.31237,0.4746 0.65063,1.48204 0.7517,2.23635 0.17385,1.29723 0.34977,1.48131 3.26152,3.42284 7.40928,4.93795 16.4231,7.13547 25.16577,6.13379 z m 8.48287,-49.9181103 c 0.68449,-0.6759197 0.66479,-1.1239097 -0.0596,-1.3360497 -0.3215,-0.10072 -2.2514,-1.55826 -2.92906,-1.89694 -1.01081,-0.49617 6.7196,-1.01966 1.45075,-3.16972 -5.26885,-2.15079 -2.56176,4.83655 -3.32655,3.88017 -0.65552,-0.8327 -2.0022,-1.01104 -2.5835,-0.48178 -1.15634,-1.28069 -2.98745,-3.84351 -3.70189,-3.89241 -1.03907997,-0.0718 1.16978,2.32983 -0.27577,2.81665 -1.44553997,0.48898 -2.20706997,-2.826 -4.09265,-2.61817 -2.10817,0.2373 -4.38327,-0.72484 -5.18683,3.39191 -0.004,0.52493 3.06135,0.16533 4.50771,0 2.32603003,-0.3092 3.10989003,0 5.24841,1.91132 l 1.88004,1.7013597 3.25884,-0.2373 c 2.19723,-0.1583 3.33099,-0.11497 3.48033,0.1222 0.3297,0.53212 1.72994,0.42425 2.32983,-0.16534 z M 4.909541,-24.277303 c 0.94202,-0.43865 1.16153,-0.7191 1.01819,-1.2505 -0.10053,-0.38112 -0.18477,-0.86794 -0.18732,-1.09733 0.15107,-1.64957 -0.72375,-1.29793 -1.57539,-0.0718 -0.77094,1.13326 -4.82187997,5.26872 -0.61209,2.96477 0.0752,-0.0718 0.69614,-0.25886 1.35664,-0.56807 z m 20.69451,-1.74667 c 0.2363,-0.38111 -1.04497,-1.12824 -1.47795,-0.86075 -0.16792,0.10072 -0.95404,-0.15107 -1.74709,-0.56808 -1.95859,-1.02828 -6.42112,-0.95134 -5.77085,0.10072 0.10572,0.17256 1.42366,0.3164 2.92877,0.3164 2.03716,8.3e-4 3.03539,0.16533 3.90586,0.6328 1.36846,0.73274 1.8913,0.82694 2.16126,0.3883 z")}else{this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m 0 -43.6 c,-19.195,-0.359,-37.44,13.34,-41.865,32.015 c,-4.561096,17.1667748,2.72917,37.246587,17.656538,46.977656 c,13.373687,9.285707,32.0526208,9.996435,45.992018,1.508414 c,5.957424,-3.319826,11.075156,-8.039317,14.543607,-13.935126 c,10.546018,-15.6499112,8.720274,-38.18332,-4.018314,-52.068038 c,-8.07768,-9.096389,-20.115729,-14.609639,-32.30837958,-14.498209 z m,0.09375,5.375 c,12.57022058,-0.128555,24.94591858,6.5994,31.74999958,17.15625 c,-0.94917,5.002919,-6.086293,1.530374,-3.041063,-1.619594 c,-1.457671,-0.526126,-4.932858,2.878261,-6.847657,-0.603915 c,-3.184453,-1.308637,-6.3599,1.691261,-5.15979,4.188482 c,-3.782846,2.664376,-6.163477,-4.184848,-10.1526402,-1.250482 c,0.930713,-0.712397,6.3522672,-6.132291,1.9485113,-5.743768 c,-2.1471153,3.268504,-5.9001547,5.6116,-9.7549386,6.742359 c,-3.0333281,1.666497,3.4871809,3.919715,5.0848899,3.874212 c,4.4525294,2.286084,8.5800896,7.1007845,6.1927696,12.1877615 c,1.90772,3.21337796,3.996962,6.758283,2.957496,10.7455353 c,-1.088944,1.5975017,-1.993627,6.6457482,-3.8098779,5.9629142 c,0.09411,-5.5523502,-5.8551147,1.424572,-5.9032977,3.921686 c,-0.233555,1.607328,-2.089538,4.666463,0.316221,3.452139 c,1.5791784,3.031545,4.0433554,1.23024,2.5706854,-1.432668 c,-0.755832,-2.214988,1.071785,-4.450478,1.431817,-0.910521 c,3.4227102,1.986574,-2.079278,8.026424,-3.441317,4.221977 c,-0.05038,3.190668,-5.9116094,4.835384,-6.2547064,5.746188 c,2.90918203,2.904457,-1.551746,2.079951,-3.228894,2.254064 c,-1.300676,5.220523,5.49423002,3.315504,6.569102,-0.06951 c,2.572843,-3.120142,7.9417807,2.476723,8.2176023,0.158591 c,-5.1570029,-2.906592,4.3679773,1.498193,3.7328613,-0.172704 c,0.355589,-3.393695,5.711734,0.663429,6.832822,-2.635732 c,2.782198,1.056601,-3.254675,4.26505,-4.941003,4.473991 c,-2.714088,0.573027,-2.35272,4.236763,-5.7564619,2.583428 c,-3.9108453,-2.119881,-7.9960437,-0.807618,-12.0653907,-0.15703 c,-4.931145,2.236895,-10.2173174,1.74978,-14.8366384,-1.385684 c,-10.813803,-5.566552,-18.524599,-16.654538,-20.004852,-28.7192222 c,2.732778,2.989211,6.598056,4.7293091,8.998081,8.3559682 c,1.599527,0.730324,3.945675,3.523961,4.82994,3.171984 c,1.833841,-2.480098,4.151057,-5.772095,2.790203,-8.5464922 c,3.363681,-2.474446,-0.289772,-5.5676083,-3.153322,-3.525176 c,-4.391341,0.818177,-0.191169,-4.9463963,1.391046,-6.2324653 c,2.857681,-0.460706,3.513174,2.41500097,3.980956,3.732494 c,3.316523,-0.0353,0.834669,-3.882306,4.374542,-4.092336 c,0.130908,-1.411563,-3.481833,-2.709873,-0.211945,-1.771103 c,4.26026,-1.249006,1.634257,-4.365219,-0.493731,-3.1780419 c,2.763194,-2.1547021,4.181646,-7.6700956,8.5041634,-6.4331296 c,2.24906,-0.416067,2.612667,-2.860803,1.014942,-3.538046 c,2.719085,-1.835258,-1.409228,-1.787455,-0.10076,-4.29649 c,-1.830306,-0.309672,-4.304873,-0.973664,-2.132519,-3.101562 c,-3.3845944,2.57314,-3.5487544,7.860395,-8.9615664,7.398945 c,-4.539774,1.777416,-8.333796,-1.761858,-12.015717,-2.70409 c,-1.477835,0.696073,-6.487149,4.76626,-4.024621,0.665479 c,6.584664,-11.488859,19.533888,-19.038283,32.80405842,-18.874686 z m,-33.65625042,21.59375 c,-0.631472,0.607654,-1.285523,0.774007,0,0 z m,25.0312504,13.8749985 c,-1.378264,1.634778,-4.7210584,3.734578,-0.438841,3.849626 c,2.052676,0.491366,5.022044,2.343429,3.253406,-0.95631404 c,-0.419504,-1.86979296,-2.20923,-1.09186896,-2.814565,-2.89331196 z m,-4.0625014,1.78125 c,-4.153103,-0.46570203,-2.208863,6.0465023,-6.129842,6.4757613 c,-0.605185,2.103009,2.300217,1.325155,3.030352,1.204245 c,1.416321,-2.463228,3.738442,-4.4874303,3.09949,-7.6800063 z m,3.5312514,3.03125 c,0.05302,4.2453083,-2.3776964,7.126859,-5.9261904,8.5371375 c,-2.819523,3.208873,0.326358,5.688926,2.91859,2.404436 c,3.6624634,0.820099,7.4597394,0.468648,8.5987314,-3.8347225 c,3.98761402,-4.1394317,-1.837631,-7.108603,-5.591131,-7.106851 z m,2.65625,13.8750015 c,-4.0821284,2.583778,5.79884807,0.948002,0,0 z m,29.9999996,1 c,-0.310613,2.698258,7.000211,1.533177,2.616976,4.524626 c,-1.843124,0.0678,-6.305665,-2.59259,-2.616976,-4.524626 z m,-25.0937496,4.625 c,-2.608331,0.710104,1.04075402,4.160157,-0.444775,4.552104 c,-1.433649,1.942609,4.729631,-0.163724,1.34758302,-1.892931 c,-0.672,-1.046,-1.062,-1.697,-0.903,-2.659 z m,32.4999996,0.34375 c,-0.01479,2.705677,-5.791353,2.714607,-1.548038,0.956689 l,0.803335,-0.425532 z m,-12.78125,0.375 c,0.523617,1.617196,4.358842,0.626771,1.387,2.500788 c,-1.249506,2.929193,-6.666484,3.760447,-3.932662,-0.407517 c,1.533416,0.532153,2.258563,-0.753125,2.545662,-2.093271 z m,-21.9374996,1.15625 c,-3.15159,1.823608,0.365256,3.975785,0.815462,0.936364 c,-0.0466,-0.434703,-0.359015,-0.867276,-0.815462,-0.936364 z m,26.4374996,6.90625 c,-1.920358,1.510414,-1.942756,0.166742,0,0 z")}this.Earth.attr({stroke:0,fill:"#69DFFF",opacity:0.8});var M,K,O,W,T,U;var Q=this;function G(aa){if(!aa){return null}if(!aa.cx){aa.cx=0}if(!aa.cy){aa.cy=0}if(!aa.e){aa.e=1}if(!aa.i){aa.i=0}if(!aa.r){aa.r=1}if(!aa.z){aa.z=false}if(!aa.color){aa.color="#999999"}if(!aa.stroke){aa.stroke={}}if(!aa.stroke.on){aa.stroke.on=2.5}if(!aa.stroke.off){aa.stroke.off=1.5}if(!aa.stroke.selected){aa.stroke.selected=2.5}var ac={inp:aa};if(aa.key=="ES2"){ac.dotted=Q.paper.path("M "+(aa.cx-aa.r)+",0 q "+(aa.r*2)+","+(Q.height/2)+" 0,"+(Q.height));ac.solid=Q.paper.path("M "+(aa.cx-aa.r)+",0 q "+(aa.r*2)+","+(Q.height/2)+" 0,"+(Q.height))}else{if(aa.e==1){ac.dotted=Q.paper.circle(aa.cx,aa.cy,aa.r);ac.solid=Q.paper.circle(aa.cx,aa.cy,aa.r)}else{var ab="m "+aa.cx+","+aa.cy+" "+V(aa.r,aa.e,aa.i);ac.dotted=Q.paper.path(ab);ac.solid=Q.paper.path(ab)}}if(aa.period){ac.satellite=Q.paper.circle(aa.cx,aa.cy,4).attr({fill:aa.color,stroke:0});if(aa.key!="ES2"){ac.anim=ac.satellite.animateAlong((aa.orbit?aa.orbit:ac.dotted),aa.period,Infinity,aa.orbitdir,aa.z)}}ac.dotted.attr({stroke:aa.color,"stroke-dasharray":"-","stroke-width":aa.stroke.off});ac.solid.attr({stroke:aa.color,opacity:0.1,"stroke-width":8});if(g(Q.callback,"function")){var i=function(){e("#"+this.id).css("cursor","pointer");this.dotted.attr({"stroke-width":(this.selected?aa.stroke.selected:aa.stroke.on)})};var ad=function(){e("#"+this.id).css("cursor","default");this.dotted.attr({"stroke-width":(this.selected?aa.stroke.selected:aa.stroke.off)})};ac.solid.hover(i,ad,ac,ac);ac.satellite.hover(i,ad,ac,ac);ac.solid.click(function(){Q.callback.call((Q.spacetel?Q.spacetel:this),aa.key)},ac,ac);ac.satellite.click(function(){Q.callback.call((Q.spacetel?Q.spacetel:this),aa.key)},ac,ac)}ac.zoom=Q.zoom+0;ac.hide=function(){L(ac.dotted);L(ac.solid);L(ac.satellite)};ac.show=function(){X(ac.dotted);X(ac.solid);X(ac.satellite)};return ac}if(!this.E||!this.M||!this.scale){return this}if(this.zoom==0){for(var P in this.data){if(this.orbits[P]&&this.orbits[P].ok&&this.orbits[P].zoom==this.zoom&&!this.svg.orbits[P]){if(P=="HEO"){M=-this.E.r*1.2;K=-this.E.r*0.35}else{M=0;K=0}if(!this.orbits[P].r){this.orbits[P].r=this.E.r*(1+this.data[P].altitude.value/this.E.radius)}U=this.spacetel.convertValue(this.data[P].period,"hours");this.svg.orbits[P]=G({key:P,period:U.value*3*1000,r:this.orbits[P].r,cx:(this.E.x+M),cy:(this.E.y+K),color:this.orbits[P].color,e:this.orbits[P].ellipticity,i:this.orbits[P].inclination,z:this.orbits[P].z})}}}else{if(this.zoom==1){if(!this.Moonorbit){this.Moonorbit=this.paper.path("M "+this.E.x+","+this.E.y+" "+V(this.M.o*this.scale[1],1)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.Moon=this.paper.circle(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6),this.E.y-this.M.o*this.scale[1]*Math.sin(Math.PI/6),this.M.r).attr({fill:"#606060",stroke:0});var O=9;if(!this.svg.orbits.ETR&&this.data.ETR&&this.orbits.ETR.ok){U=this.spacetel.convertValue(this.data.ETR.period,"days");this.Earthorbit=this.paper.path("M "+(this.E.x-O)+",0 q "+(O*2)+","+(this.height/2)+" 0,"+(this.height)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.svg.orbits.ETR=G({key:"ETR",period:U.value*1000,r:1,cx:(this.E.x-O*0.78),cy:(this.E.y+2.1*this.M.o*this.scale[1]),color:this.orbits.ETR.color})}if(!this.svg.orbits.EM2&&this.data.EM2&&this.orbits.EM2.ok){this.Moonlagrangian=this.paper.path("M "+this.E.x+","+this.E.y+" "+V(this.M.o*this.scale[1]*440000/380000,1)).attr({stroke:"#000000","stroke-dasharray":"-","stroke-width":0.5,opacity:0.01});U=this.spacetel.convertValue(this.data.EM2.period,"days");this.Moon.animateAlong(this.Moonorbit,U.value*1000,Infinity,-1);this.svg.orbits.EM2=G({key:"EM2",period:U.value*1000,orbit:this.Moonlagrangian,orbitdir:-1,r:this.M.o*((440000/380000)-1)*this.scale[1],cx:(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6)),cy:(this.M.o*this.scale[1]*Math.sin(Math.PI/6)),color:this.orbits.EM2.color,e:1,i:0});this.svg.orbits.EM2.dotted.animateAlong(this.Moonorbit,U.value*1000,Infinity,-1);this.svg.orbits.EM2.solid.animateAlong(this.Moonorbit,U.value*1000,Infinity,-1)}if(!this.svg.orbits.ES2&&this.data.ES2&&this.orbits.ES2.ok){U=this.spacetel.convertValue(this.data.ES2.period,"days");this.svg.orbits.ES2=G({key:"ES2",period:U.value*1000,r:9,cx:(this.E.x+4*this.M.o*this.scale[1]),cy:this.E.y,color:this.orbits.ES2.color})}var R=this.M.o*this.scale[1];var N=0.3;var J=parseInt(this.el.css("font-size"));if(!this.labels){this.labels={}}if(!this.labels.sun){this.labels.sun={zoom:1,arrow:this.paper.path("M "+(this.E.x-4*R)+","+this.E.y+" l "+(N*R)+",-"+(N*0.3*R)+" q "+(-N*0.3*R)+","+(N*0.3*R)+" 0,"+(N*0.6*R)+" z M "+(this.E.x-4*R+N*0.85*R)+","+(this.E.y-N*0.05*R)+" l "+(N*R*1.5)+","+(-N*0.05*R)+" l 0,"+(N*0.2*R)+" l "+(-N*R*1.5)+","+(-N*0.05*R)+" z").attr({fill:"#fac900",stroke:0}),label:this.paper.text((this.E.x-4*R+2.5*N*R),(this.E.y),this.phrases.diagram.sun).attr({fill:"#fac900",stroke:0,"text-anchor":"start","font-size":J})}}if(!this.labels.earthorbit&&this.data.ETR&&this.orbits.ETR.ok){this.labels.earthorbit={zoom:1,arrow:this.paper.path("M "+(this.E.x)+","+(this.E.y-2.1*R)+" l -"+(N*0.3*R)+","+(N*R)+" q "+(N*0.3*R)+","+(-N*0.3*R)+" "+(N*0.6*R)+",0 z M "+(this.E.x-N*0.05*R)+","+(this.E.y-2.1*R+N*0.85*R)+" l "+(-N*0.05*R)+","+(N*R*1.5)+" l "+(N*0.2*R)+",0 l "+(-N*0.05*R)+","+(-N*R*1.5)+" z").attr({fill:"#999999",stroke:0}),label:this.paper.text((this.E.x+N*0.3*R),(this.E.y-2*R+N*R),this.phrases.diagram.earthorbit).attr({fill:"#999999",stroke:0,"text-anchor":"start","font-size":J})}}}}}for(var P in this.svg.orbits){if(this.svg.orbits[P].zoom!=this.zoom){L(this.svg.orbits[P])}else{X(this.svg.orbits[P])}if(this.zoom==0){L(this.Moonorbit);L(this.Moon)}else{X(this.Moonorbit);X(this.Moon)}if(this.svg.orbits.EM2){if(this.zoom==0){L(this.Moonlagrangian);L(this.Earthorbit)}else{X(this.Moonlagrangian);X(this.Earthorbit)}}}for(var S in this.labels){if(this.labels[S].zoom!=this.zoom){L(this.labels[S].arrow);L(this.labels[S].label)}else{X(this.labels[S].arrow);X(this.labels[S].label)}}var Y=this.E.r/48;if(this.scale[this.zoom]<1){Y*=this.scale[this.zoom]*10}if(this.Earth){z(this.Earth,["S",Y,Y,this.E.x,this.E.y])}return this};F.prototype.highlight=function(i){if(!i){return this}this.displayOrbits(i);for(var G in this.svg.orbits){if(G==i){this.svg.orbits[G].selected=true}else{this.svg.orbits[G].selected=false}this.svg.orbits[G].dotted.attr({"stroke-width":(this.svg.orbits[G].selected?this.svg.orbits[G].inp.stroke.selected:this.svg.orbits[G].inp.stroke.off)});this.svg.orbits[G].satellite.attr({r:(this.svg.orbits[G].selected?8:4),"stroke-width":(this.svg.orbits[G].selected?8:0),stroke:"white","stroke-opacity":0.5})}return this};function o(J){if(!J){J={}}this.id=(typeof J.id==="string")?J.id:"thermometer";this.pb=(J.phrasebook)?J.phrasebook:{y:""};this.txt=(J.txt)?J.txt:{font:"12px",fill:"#ffffff","text-anchor":"start"};this.labeltxt=(J.labeltxt)?J.labeltxt:{font:"10px","text-anchor":"start",fill:"#ffffff"};this.format=(typeof J.format==="function")?J.format:function(i){return f(i.value)+" K"};this.ctx=(typeof J.context==="object")?J.context:this;this.colour=(typeof J.color==="string")?J.color:"#df0000";this.wide=(typeof J.width==="number")?J.width:(typeof J.canvas==="object")?J.canvas.width:200;this.tall=(typeof J.height==="number")?J.height:(typeof J.canvas==="object")?J.canvas.height:200;this.req=(typeof J.required==="number")?J.required:300;this.xoff=(typeof J.x==="number")?J.x:0;this.yoff=(typeof J.y==="number")?J.y:0;this.p=7;this.tickmarks=[0.1,0.3,1,3,10,30,100,300];this.bulb=4*this.p;this.bottom=this.tall-this.p*9.5;this.top=this.p*6;this.thermo=(typeof J.canvas==="object")?J.canvas:Raphael(this.id,this.wide,this.tall);this.mercurybase=this.thermo.rect((this.xoff+this.wide/2-this.p*2.5),this.yoff+this.bottom+this.p,this.p*5,this.bulb).attr({fill:this.colour,stroke:0});this.mercuryzero=this.thermo.rect((this.xoff+this.wide/2-this.p*1.5),this.yoff+this.bottom-0.5,this.p*3,Math.abs(this.p+1)).attr({fill:this.colour,stroke:0});this.mercury=this.thermo.rect(this.xoff+(this.wide/2-this.p*1.5),this.yoff+this.top,this.p*3,Math.abs(this.top-this.bottom)).attr({fill:this.colour,stroke:0});this.thermometer=this.thermo.path("M "+(this.xoff+this.wide/2-this.p)+","+(this.yoff+this.bottom+this.p)+" l 0,"+(this.top-this.bottom-this.p)+" c 0,-"+(this.p)+" "+(this.p*2)+",-"+(this.p)+" "+(this.p*2)+",0 l 0,"+(this.bottom-this.top+this.p)+" c "+(this.p*2)+","+(this.p*0.5)+" "+(this.p*2)+","+this.bulb+" "+(-this.p)+","+this.bulb+" c -"+(this.p*3)+",0 -"+(this.p*3)+",-"+(this.bulb-this.p*0.5)+" "+(-this.p)+",-"+this.bulb+" m -"+(this.p)+",-"+(this.p)+" c -"+(this.p*2.5)+","+(this.p)+" "+(-this.p*3)+","+(this.p*2+this.bulb)+" "+(this.p*2)+","+(this.p*2+this.bulb)+" c "+(this.p*5)+",0 "+(this.p*4.5)+",-"+(this.p+this.bulb)+" "+(this.p*2)+",-"+(this.p*2+this.bulb)+" l 0,-"+(this.bottom-this.top)+" c 0,-"+(this.p*2.5)+" -"+(this.p*4)+", -"+(this.p*2.5)+" -"+(this.p*4)+",0 l0,"+(this.bottom-this.top)).attr({fill:"#e4f6fe","fill-opacity":1,stroke:"#000000","stroke-width":1,"stroke-opacity":0.3});this.highlight=this.thermo.path("M "+(this.xoff+this.wide/2-this.p*0.35)+","+(this.yoff+this.bottom+this.p)+" l 0,-"+(this.bottom-this.top+this.p)+" l -"+(this.p*0.3)+",0 l 0,"+(this.bottom-this.top+this.p)+" l 0,"+(this.p*0.25)+" c -"+(this.p*0.5)+","+(this.p*0.25)+" -"+(this.p*1.75)+","+(this.p*0.75)+" -"+(this.p*0.75)+","+(this.p*2)+" c 0,-"+(this.p*0.5)+" "+(this.p*0.1)+",-"+(this.p*1.5)+" "+(this.p)+",-"+(this.p*2)+" z").attr({opacity:0.5,fill:"#f7fcfe","fill-opacity":1,stroke:0});this.shade=this.thermo.path("M "+(this.xoff+this.wide/2+this.p*0.5)+","+(this.yoff+this.bottom+this.p)+" l 0,-"+(this.bottom-this.top+this.p)+" l "+(this.p*0.9)+",0 l 0,"+(this.bottom-this.top+this.p)+" c "+this.p+","+this.p+" "+(this.p*1.25)+","+(this.bulb)+" -"+(this.p*2.5)+","+(this.bulb-this.p*0.75)+" q "+(this.p*3.25)+",-"+(this.bulb*0.1)+" "+(this.p*1.75)+",-"+(this.bulb-this.p)+" z").attr({opacity:0.2,fill:"#000000","fill-opacity":1,stroke:"#000000","stroke-width":1});this.labels=this.thermo.set();this.ticks=this.thermo.set();var G,K;for(var I=0;I<this.tickmarks.length;I++){K=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.tickmarks[I]))-0.5;this.ticks.push(this.thermo.path("M "+(this.xoff+this.wide/2+2)+","+(this.yoff+K)+" l "+(this.p*3)+",0").attr({stroke:"white","stroke-width":1}))}K=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.req))-0.5;this.ticks.push(this.thermo.path("M "+(this.xoff+this.wide/2-this.p*5)+","+(this.yoff+K)+" l "+(this.p*6)+",0").attr({stroke:"#ffffff","stroke-width":1,"stroke-dasharray":["-"]}));this.updateLanguage(this.pb);return this}o.prototype.updateLanguage=function(I){this.pb=I;if(this.rl){this.rl.remove()}y=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.req))-0.5;this.rl=this.thermo.text(this.xoff+this.wide/2-this.p*6,this.yoff+y,this.pb.req).attr(this.txt);this.rl.attr({"text-anchor":"middle"}).transform("r-90");if(this.labels){this.labels.remove()}for(var G=0;G<this.tickmarks.length;G++){y=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.tickmarks[G]))-0.5;this.labels.push(this.thermo.text((this.xoff+this.wide/2+this.p*3.5),(this.yoff+y),n(this.format.call(this.ctx,{value:this.tickmarks[G],units:"K",dimension:"temperature"}))).attr(this.labeltxt))}return this};o.prototype.getYFrac=function(i){return(Math.log10(i)-Math.log10(this.tickmarks[0]))/(Math.log10(this.tickmarks[this.tickmarks.length-1])-Math.log10(this.tickmarks[0]))};o.prototype.value=function(i){var I=this.getYFrac(i);if((I-1)*(this.bottom-this.top)>this.p){I=1+(this.p/(this.bottom-this.top))}if(i<this.tickmarks[0]){I=0}this.mercury.transform("s1,"+I+",0,"+this.bottom);var G={value:i,units:"K",dimension:"temperature"};if(i<=this.tickmarks[this.tickmarks.length-1]){G.value=this.tickmarks[this.tickmarks.length-1]}this.labels[this.labels.length-1].attr("text",n(this.format.call(this.ctx,G)));return this};function D(i){if(!i){i={}}this.label=(typeof i.label==="string")?i.label:"";this.colour=(typeof i.color==="string")?i.color:e(".science").css("color");this.wide=(typeof i.width==="number")?i.width:50;this.tall=(typeof i.height==="number")?i.height:75;this.xoff=(typeof i.x==="number")?i.x:0;this.yoff=(typeof i.y==="number")?i.y:0;this.p=0.1;if(typeof i.canvas==="object"){this.canvas=i.canvas}else{return this}p=this.wide*this.p;q=this.tall*this.p;console.log(this);this.liquid=this.canvas.rect(this.xoff+p,this.yoff+this.p*this.tall,this.wide-2*p,(1-2*this.p)*this.tall).attr({fill:this.colour,stroke:0});this.flask=this.canvas.path("M"+(this.xoff+p*3.75)+","+(this.yoff+q)+" l "+(p*0.25)+","+(q*0.25)+" l 0,"+(q*3)+" l -"+(p*2.5)+","+(q*3.75)+" q -"+(p*0.5)+","+(q*0.75)+" 0,"+(q)+" l "+(p*7)+",0 q "+(p*0.5)+",-"+(q*0.25)+" 0,-"+q+" l -"+(p*2.5)+",-"+(q*3.75)+" l 0,"+(-q*3)+" l "+(p*0.25)+",-"+(q*0.25)+" l -"+(p*2.5)+",0 m 0,-"+q+" l "+(p*6.25)+",0 l 0,"+(q*10)+" l-"+(p*10)+",0 l 0,-"+(q*10)+" z").attr({fill:"black",stroke:0});this.outline=this.canvas.path("M"+(this.xoff+p*3.75)+","+(this.yoff+q)+" l "+(p*0.25)+","+(q*0.25)+" l 0,"+(q*3)+" l -"+(p*2.5)+","+(q*3.75)+" q -"+(p*0.5)+","+(q*0.75)+" 0,"+(q)+" l "+(p*7)+",0 q "+(p*0.5)+",-"+(q*0.25)+" 0,-"+q+" l -"+(p*2.5)+",-"+(q*3.75)+" l 0,"+(-q*3)+" l "+(p*0.25)+",-"+(q*0.25)+"").attr({stroke:"white","stroke-width":2});this.label=this.canvas.text(this.xoff,this.yoff+this.tall/2,this.label).attr({font:"10px","text-anchor":"end",fill:"#ffffff"});this.value(0);return this}D.prototype.value=function(i){if(i>1){i=1}if(i<0){i=0}this.liquid.transform("s1,"+i+",0,"+(this.yoff+this.tall-this.p*this.tall));return this};function C(){var N=e("#launchrocket img");var J=e("#launchpadbg img");if(e("#launchexhaust").length==0){N.before('<canvas id="launchexhaust"></canvas>')}var G=document.getElementById("launchexhaust");var T=G.getContext("2d");this.active=true;var R=J.innerWidth(),L=J.innerHeight();G.width=R;G.height=L;var S=[];var O={};var I=80;for(var K=0;K<I;K++){S.push(new M())}function M(){this.speed={x:-0.5+Math.random()*1,y:-5+Math.random()*3};this.loc={x:N.offset().left+(N.width()/2)-J.offset().left,y:N.offset().top+N.height()-J.offset().top};this.radius=5+Math.random()*2;this.life=20+Math.random()*10;this.remaining_life=this.life;this.r=Math.round(Math.random()*55+200);this.g=this.r;this.b=this.r}var P=this;function Q(){T.globalCompositeOperation="source-over";T.fillStyle="transparent";T.fillRect(0,0,R,L);for(var U=0;U<S.length;U++){var V=S[U];T.beginPath();V.opacity=Math.round(V.remaining_life/V.life*100)/100;var W=T.createRadialGradient(V.loc.x,V.loc.y,0,V.loc.x,V.loc.y,V.radius);W.addColorStop(0,"rgba("+V.r+", "+V.g+", "+V.b+", "+V.opacity+")");W.addColorStop(0.5,"rgba("+V.r+", "+V.g+", "+V.b+", "+V.opacity+")");W.addColorStop(1,"rgba("+Math.round(V.r*0.9)+", "+Math.round(V.g*0.9)+", "+Math.round(V.b*0.9)+", 0)");T.fillStyle=W;T.arc(V.loc.x,V.loc.y,V.radius,Math.PI*2,false);T.fill();V.remaining_life-=0.5;V.radius+=0.5;V.loc.x+=V.speed.x;V.loc.y-=V.speed.y;if(V.remaining_life<0||V.radius<0){S[U]=new M()}}if(P.active){requestAnimationFrame(Q)}}Q();return this}C.prototype.stop=function(){this.active=false};function f(K){K+="";var i=K.split(".");var J=i[0];var G=i.length>1?"."+i[1]:"";var I=/(\d+)(\d{3})/;while(I.test(J)){J=J.replace(I,"$1,$2")}return J+G}function g(i,G){return(typeof i===G)}function b(G,I){var J=Math.floor(s.log10(G));var i=Math.round(G/Math.pow(10,J));return""+i+"&times;10<sup>"+J+"</sup>"+I}function n(i){return e("<div />").html(i).text()}function x(J){var G=e(window).width();var K=e(window).height();var i=0;var I=0;i=((G-J.outerWidth())/2);J.css({left:((G-J.outerWidth())/2)+"px"});if(e(window).height()>J.height()){I=((K-J.outerHeight())/2+e(window).scrollTop());e("body").css("overflow-y","hidden")}J.css({left:i+"px",top:I+"px",position:"absolute"})}function z(G,i){t=G.data("transform");if(g(t,"undefined")){t=G.attr("transform")}if(!g(t,"object")){t=[]}m=false;for(A=0;A<t.length;A++){for(j=0;j<i.length;j++){if(t[A][0]==i[j][0]){t[A]=i[j][0];m=true}}}if(!m){t.push(i)}G.transform(t).data("transform",t)}function w(I,J,K){if(K){var G=new Date();G.setTime(G.getTime()+(K*24*60*60*1000));var i="; expires="+G.toGMTString()}else{var i=""}document.cookie=I+"="+J+i+"; path=/"}function B(I){var K=I+"=";var G=document.cookie.split(";");for(var J=0;J<G.length;J++){var L=G[J];while(L.charAt(0)==" "){L=L.substring(1,L.length)}if(L.indexOf(K)==0){return L.substring(K.length,L.length)}}return null}function d(i){w(i,"",-1)}e.spacetelescope=function(G,i){if(typeof i=="object"){i.container=G}else{if(G){if(typeof G=="string"){i={container:G}}else{i=G}}else{i={}}}i.plugins=e.spacetelescope.plugins;return new H(i)};e.spacetelescope.plugins=[]})($);