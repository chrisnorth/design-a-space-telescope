/*!
	SpaceTelescope
	(c) Stuart Lowe and Chris North 2014-5
*/
if(typeof $==="undefined"){$={}}(function(e){if(!g(Math.log10,"function")){Math.log10=function(i){return Math.log(i)/2.302585092994046}}window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(i){window.setTimeout(i,1000/60)}})();var s={supportsFullScreen:false,isFullScreen:function(){return false},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},a="webkit moz o ms khtml".split(" ");if(typeof document.cancelFullScreen!="undefined"){s.supportsFullScreen=true}else{for(var z=0,r=a.length;z<r;z++){s.prefix=a[z];if(typeof document[s.prefix+"CancelFullScreen"]!="undefined"){s.supportsFullScreen=true;break}}}if(s.supportsFullScreen){s.fullScreenEventName=s.prefix+"fullscreenchange";s.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}};s.requestFullScreen=function(i){return(this.prefix==="")?i.requestFullScreen():i[this.prefix+"RequestFullScreen"]()};s.cancelFullScreen=function(i){return(this.prefix==="")?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}}if(typeof jQuery!="undefined"){jQuery.fn.requestFullScreen=function(){return this.each(function(){if(s.supportsFullScreen){s.requestFullScreen(this)}})}}window.fullScreenApi=s;Raphael.el.animateAlong=function(K,J,I,H,L){var i=this;i.zforward=(!g(L,"boolean"))?false:L;i.atFront=false;i.path=K;i.direction=H;i.pathLen=i.path.getTotalLength();J=(g(J,"undefined"))?5000:J;I=(g(I,"undefined"))?1:I;i.paper.customAttributes.along=function(O){var N=(this.direction&&this.direction<0)?(1-O)*this.pathLen:(O*this.pathLen);var M=this.path.getPointAtLength(N),P={cx:M.x,cy:M.y};if(this.zforward){if(O>0.5&&!this.atFront){this.toFront();this.atFront=true}if(O>0&&O<0.5&&this.atFront){this.toBack();this.atFront=false}}this.rotateWith&&(P.transform="r"+M.alpha);return P};i.attr({along:0});var G=Raphael.animation({along:1},J);i.animate(G.repeat(I))};(function(){var G=0;var H=["ms","moz","webkit","o"];for(var i=0;i<H.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[H[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[H[i]+"CancelAnimationFrame"]||window[H[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(M,J){var I=new Date().getTime();var K=Math.max(0,16-(I-G));var L=window.setTimeout(function(){M(I+K)},K);G=I+K;return L}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(I){clearTimeout(I)}}}());e.query=function(){var i={length:0};var G=location.search;if(G&&G!="#"){G=G.replace(/^\?/,"").replace(/\&$/,"");jQuery.each(G.split("&"),function(){var H=this.split("=")[0];var I=this.split("=")[1];if(/^[0-9\.]+$/.test(I)){I=parseFloat(I)}i[H]=I})}return i};document.write('<style type="text/css">.noscriptmsg { display: none; }</style>');function F(G){if(typeof e!=="function"){this.log("No jQuery! Abort! Abort!");return this}this.q=e.query();this.i=G;this.stage="intro";this.choices={};this.sections=["objectives","satellite","instruments","cooling","vehicle","site","orbit","proposal"];this.keyboard=true;this.errors=[];this.warnings=[];this.launchstep=0;this.languages={en:"en"};this.langurl="config/%LANG%%MODE%.json";this.dataurl="config/options%MODE%.json";this.scenariourl="config/scenarios_%LANG%%MODE%.json";this.keys=new Array();this.pushstate=!!(window.history&&history.pushState);this.settings={length:"m",currency:"GBP",temperature:"K",mass:"kg",time:"years",usecookies:false,mode:"normal"};this.init(G);var H="transform WebkitTransform MozTransform OTransform msTransform".split(" ");this.hastransform=false;for(var i=0;i<H.length;i++){var I=document.createElement("div");if(I.style[H[i]]!=undefined){this.hastransform=true}}return this}F.prototype.init=function(i){this.lang=(g(this.q.lang,"string"))?this.q.lang:(navigator)?(navigator.userLanguage||navigator.systemLanguage||navigator.language||browser.language):"";this.langshort=(this.lang.indexOf("-")>0?this.lang.substring(0,this.lang.indexOf("-")):this.lang.substring(0,2));this.langs=(i&&i.langs)?i.langs:{en:"English"};this.setVar("currency","string");this.setVar("length","string");this.setVar("mass","string");this.setVar("temperature","string");this.setVar("time","string");this.setVar("mode","string");this.addEvents();this.startup();return this};F.prototype.addEvents=function(){var I=this;window[(this.pushstate)?"onpopstate":"onhashchange"]=function(i){I.navigate(i)};list=e("#language ul li a");for(var H=0;H<list.length;H++){e(list[H]).on("click",{me:this},function(i){i.preventDefault();i.data.me.loadLanguage(e(this).attr("data"),i.data.me.update)})}e("#summary a").on("click",{me:this},function(i){i.data.me.toggleMenus("summaryext",i)});e("a.togglewarning,a.toggleerror").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("messages")});e("a.togglemenu").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("menu")});e("a.togglelang").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("language")});e(document).on("dragenter","#application",function(i){i.preventDefault()});e(document).on("dragover","#application",function(i){i.preventDefault();e(this).css("opacity",0.75)});e(document).on("drop",function(i){i.preventDefault()});function G(J,K){if(J[0].type=="text/plain"||J[0].type==""){var i=new FileReader();i.onload=(function(L){return function(M){K.processFile(M.target.result).toggleMenus()}})(J[0]);i.readAsText(J[0])}}e(document).on("drop","#application",{me:this},function(J){J.preventDefault();e(this).css({opacity:1});var i=J.originalEvent.dataTransfer.files;G(i,J.data.me);return false});if(g(Blob,"function")){e("#menu ul").append('<li class="baritem" data="load"><a href="#"><img src="images/cleardot.gif" class="icon load" alt="" /><span>Load</span></a><input type="file" id="files" name="files[]" multiple /></li>');e(document).on("change","#files",{me:this},function(i){G(i.target.files,i.data.me)});e("#menu ul").append('<li class="baritem" data="save"><a href="#"><img src="images/cleardot.gif" class="icon save" alt="" /><span>Save</span></a></li>')}if(s.supportsFullScreen){e("#menu ul").append('<li class="baritem" data="fullscreen"><a href="#" class="fullscreenbtn"><img src="images/cleardot.gif" class="icon fullscreen" alt="" /> <span></span></li>');e(".baritem .fullscreenbtn").parent().on("click",{me:this},function(i){i.data.me.toggleFullScreen().toggleMenus()})}e(".baritem .load").parent().on("click",{me:this},function(i){e("#files").trigger("click")});e(".baritem .save").parent().on("click",{me:this},function(i){i.data.me.save().toggleMenus()});e(".baritem .help").parent().on("click",{me:this},function(i){i.data.me.toggleGuide(i).toggleMenus()});e(".baritem .restart").parent().on("click",{me:this},function(i){i.data.me.toggleMenus()});e(".baritem .options").parent().on("click",{me:this},function(i){i.data.me.showView("options",i).toggleMenus()});e("body").on("click","a.guidelink",{me:this},function(i){if(e(this).attr("href").indexOf("#")==0){i.data.me.showView(e(this).attr("href").substr(1),i)}i.data.me});e(document).on("keypress",{me:this},function(J){if(!J){J=window.event}var i=J.keyCode||J.charCode||J.which||0;J.data.me.keypress(i,J)});this.registerKey(["?"],function(i){this.toggleGuide(i)});e(document).on("scroll",{me:this},function(i){i.data.me.scrollMenus()});e(".scriptonly").removeClass("scriptonly");e(document).on("focus","input,textarea",{me:this},function(i){i.data.me.keyboard=false}).on("blur","input,textarea",{me:this},function(i){i.data.me.keyboard=true});e(document).on("click","#scenarios .button",{me:this},function(i){i.data.me.chooseScenario(e(this).attr("data"))});e(document).on("click","#messages a",{me:this},function(i){e("#messages").hide()});e(document).on("click",".remove_instrument",{me:this},function(i){i.preventDefault();i.data.me.removeInstrument(e(this).attr("data"))});e(document).on("change","#designer_cooling .options input,#designer_cooling .options select",{me:this},function(i){if(i.data.me.getValue("input[name=hascooling]:checked")=="yes"){e("#designer_cooling li.hascooling").show()}else{e("#designer_cooling li.hascooling").hide()}i.data.me.parseChoices().showDetails("cooling")});e(document).on("click","#designer_vehicle .options .button",{me:this},function(i){i.preventDefault();e("#designer_vehicle .info>li."+e(this).attr("data")).find("input").trigger("click")});e(document).on("change","#designer_vehicle .options .selector input",{me:this},function(i){e("#designer_vehicle .info>li").removeClass("selected");e("#designer_vehicle .info>li."+e(this).attr("data")).addClass("selected").find("input").trigger("click");i.data.me.parseChoices()});e(document).on("click","#designer_vehicle .options .info>li",{me:this},function(i){if(!e(this).hasClass("withinfo")){e(".withinfo").removeClass("withinfo");e(this).addClass("withinfo");e("#designer_vehicle .details").html(e(this).find(".vehicle_details").html()).addClass("padded")}});e(document).on("click","#designer_site .launchsite",{me:this},function(i){i.preventDefault();e("#designer_site #site").val(e(this).attr("data"));e("#designer_site #site").trigger("change")});e(document).on("submit","form",{me:this},function(i){i.preventDefault()});e(document).on("change",".doc input,.doc textarea",{me:this},function(i){i.data.me.updateProposal()});e(document).on("click",".printable a.button",{me:this},function(i){i.preventDefault();i.data.me.printProposal()});e(document).on("click",".relaunch a.button",{me:this},function(i){i.preventDefault();i.data.me.relaunch()});e(document).on("click","#launchnav a.button",{me:this},function(i){i.preventDefault();i.data.me.launch()});e(document).on("click",".toggler",{me:this},function(J){var i=e(this).find("input:checked");if(i.attr("value")=="yes"){e(this).addClass("checked")}else{e(this).removeClass("checked")}if(i.attr("id").indexOf("mode")==0){var K=(i.attr("value")=="yes"?"advanced":"normal");if(J.data.me.settings.mode!=K){J.data.me.setMode(K)}}});e(document).on("change","#designer_satellite select, #designer_satellite input",{me:this},function(i){i.data.me.parseChoices().showDetails("satellite").showDetails("cooling")});e(document).on("change","#designer_instruments select",{me:this},function(L){var K=L.data.me.getValue("#instruments");var J=L.data.me.getValue("#wavelengths");L.data.me.parseChoices().showDetails("instruments",{wavelength:J,type:K});e(".add_instrument.hidden").removeClass("hidden")});e(document).on("click","#designer_instruments .add_instrument",{me:this},function(i){i.preventDefault();i.data.me.addInstrument()});e(document).on("change","#designer_site #site",{me:this},function(J){var i=J.data.me.getValue("#site");e(".launchsite").removeClass("selected");e(".launchsite[data="+i+"]").addClass("selected");J.data.me.parseChoices().showDetails("site",i)});e(document).on("change","#mission_orbit",{me:this},function(J){var i=J.data.me.getValue("#mission_orbit");J.data.me.highlightOrbit(i).parseChoices().showDetails("orbit",i).showDetails("cooling")});e(document).on("change","#mission_duration",{me:this},function(i){i.data.me.parseChoices()});e(document).on("submit","#designer_instruments form",{me:this},function(i){i.preventDefault();e(this).find("a.add_instrument").trigger("click")});e(window).resize({me:this},function(i){i.data.me.resize()});return this};F.prototype.startup=function(i){this.data=null;this.phrases=null;this.choices={};this.scenarios=null;this.buildTable();if(g(i,"function")){i=[this.update,i]}else{i=[this.update]}this.loadConfig();this.loadLanguage(this.lang,i);var G="";var H=0;for(l in this.langs){G+='<li class="baritem"><a href="#" title="'+this.langs[l]+'" data="'+l+'">'+this.langs[l]+" ["+l+"]</a></li>";H++}e("#language ul").html(G);if(H<2){e(".togglelang").closest(".baritem").hide()}return this};F.prototype.setMode=function(i,G){this.settings.mode=i;this.q.mode=i;this.startup(G)};F.prototype.changeMode=function(i){this.changeToggle("togglemode","mode_"+i);return this};F.prototype.changeToggle=function(H,i){var G=this.toggles[H];if(!G){return this}if(i==G.a.id&&e("#"+G.a.id).length>0){e("#"+G.a.id).trigger("click").closest(".toggler").trigger("click")}if(i==G.b.id&&e("#"+G.a.id).length>0){e("#"+G.b.id).trigger("click").closest(".toggler").trigger("click")}return this};F.prototype.buildToggle=function(I,G,i){if(!g(I,"string")&&!g(G,"object")&&!g(i,"object")){return""}if(!this.toggles){this.toggles={}}this.toggles[I]={a:G,b:i};var H='<label class="toggle-label';if(G.checked){html='<div class="toggleinput toggler">'+H+'1" for="'+G.id+'"></label>'}else{html='<div class="toggleinput toggler checked">'+H+'1" for="'+G.id+'"></label>'}html+='<div class="toggle-bg">';html+='	<input id="'+G.id+'" type="radio" '+(G.checked?'checked="checked" ':"")+'name="'+I+'" value="'+G.value+'">';html+='	<input id="'+i.id+'" type="radio" '+(i.checked?'checked="checked" ':"")+'name="'+I+'" value="'+i.value+'">';html+='	<span class="switch"></span>';html+="</div>";html+=""+H+'2" for="'+i.id+'"></label></div>';return html};F.prototype.updateToggle=function(G,i,H){if(!g(G,"object")&&!g(i,"object")||e("#"+G.id).length==0||e("#"+i.id).length==0){return this}if(!H){H=""}if(!G.label){G.label=""}if(!i.label){i.label=""}e("#"+G.id+",#"+i.id).attr("title",H);e("label[for="+G.id+"]").html(G.label);e("label[for="+i.id+"]").html(i.label);return this};F.prototype.buildPage=function(){if(this.built){return this.updatePage()}this.built=true;e("#scenarios").html('<h2></h2><p class="about"></p><ul id="scenariolist"></ul>');e("#messages .warnings").html('<div class="bigpadded"><h3 class="warning"><img src="images/cleardot.gif" class="icon warning" /> <span class="title"></span> <span class="warning value">0</span></h3><ul class="summary"></ul>');e("#messages .errors").html('<div class="bigpadded"><h3 class="error"><img src="images/cleardot.gif" class="icon error" /> <span class="title"></span> <span class="error value">0</span></h3><ul class="summary"></ul>');e("#designer").html('<div class="designer_inner bigpadded"><div id="main"><div id="menubar"></div><div id="output"></div><div id="sidebar"><div class="padded"></div></div></div></div>');for(var G=0;G<this.sections.length;G++){if(e("#designer_"+this.sections[G]).length==0){e("#output").append('<div id="designer_'+this.sections[G]+'" class="designer"><h2 class="designer_title"><a href="#designer_'+this.sections[G]+'" class="toggle'+this.sections[G]+'"></a></h2><div class="designer_content"><div class="intro"></div><div class="options"></div><div class="questions"></div></div></div>')}}e(".barmenu").append('<div class="baritem togglelaunch"><a href="#launch" class="">Launch</a></div>');e("#designer_objectives .intro").after('<div class="summary"></div>');e("#designer_satellite .options").html('<div class="bigpadded"><form><ul><li class="option mirror_diameter"><label for="mirror_size"></label><select id="mirror_size" name="mirror_size"></select></li><li class="option mirror_deployable"><label for="mirror_deployable"></label>'+this.buildToggle("toggledeployable",{value:"no",id:"mirror_deployable_no",label:"",checked:true},{value:"yes",id:"mirror_deployable_yes",label:""})+'</li><li class="option mirror_uv"><label for="mirror_uv"></label>'+this.buildToggle("toggleuv",{value:"no",id:"mirror_uv_no",checked:true},{value:"yes",id:"mirror_uv_yes"})+'</li></ul></form><div class="details"></div></div>');e("#designer_instruments .options").html('<div class="bigpadded"><form><ul><li><label for="instruments"></label><select id="wavelengths" name="wavelengths"></select><select id="instruments" name="instruments"></select> <input type="text" id="instrument_name" name="instrument_name" /></li></ul></form><div class="details"></div><a href="#" class="add_instrument hidden"><img src="images/cleardot.gif" class="icon add" /><span>'+this.phrases.designer.instruments.options.add+'</span></a></div><div class="instrument_list bigpadded"></div>');e("#designer_cooling .options").html('<div class="bigpadded"><form><ul></ul></form><div class="details"></div></div>');e("#designer_site .options").html('<div class="worldmap"><img src="images/worldmap.jpg" /></div><div class="bigpadded"><form><ul><li><label for="site"></label><select id="site" name="site"></select></li></ul></form><div class="details"></div></div>');e("#designer_orbit .options").html('<div id="orbits"></div><div id="orbits2"></div><div class="bigpadded"><form><ul><li><label for="mission_orbit"></label><select id="mission_orbit" name="mission_orbit"></select></li><li><label for="mission_duration"></label><select id="mission_duration" name="mission_duration"></select></li></ul></form><div class="details"></div></div>');e("#designer_proposal .options").html('<div class="padded"><div class="doc"></div></div>');e("#sidebar").html('<div class="sidebar_inner"><div class="satellite panel" id="sidebar_satellite"></div><div class="vehicle padded panel"></div><div class="site worldmap panel"></div><div class="orbit panel"></div></div>');this.buildTable();this.updatePage();return this};F.prototype.updatePage=function(){var I="";for(var H=0;H<this.sections.length;H++){I+='<li><a href="#designer_'+this.sections[H]+'" class="toggle'+this.sections[H]+'"></a></li>'}e("#menubar").html("<ul>"+I+"</ul>");e("#designer_cooling .options form ul li").remove();e("#designer_cooling .options form ul").append('<li><label for="hascooling"></label>'+this.buildToggle("hascooling",{value:"no",id:"cooling_no",checked:true},{value:"yes",id:"cooling_yes"})+"</li>");if(this.data.cooling.temperature){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_temperature"></label><select id="cooling_temperature" name="cooling_temperature"></select></li>')}if(this.data.cooling.passive){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_passive"></label>'+this.buildToggle("cooling_passive",{value:"no",id:"cooling_passive_no"},{value:"yes",id:"cooling_passive_yes",checked:true})+"</li>")}if(this.data.cooling.active){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_active"></label>'+this.buildToggle("cooling_active",{value:"no",id:"cooling_active_no",checked:true},{value:"yes",id:"cooling_active_yes"})+"</li>")}if(this.data.cooling.cryogenic){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_cryogenic"></label><select id="cooling_cryogenic" name="cooling_cryogenic"></select></li>')}I='<div class="bigpadded">';I+='<form><ul class="info">';for(var G in this.data.vehicle){I+='<li class="'+G+'" data="'+G+'">';I+='<div class="image"><img src="" alt="" title="" /></div><div class="operator"><img src="" alt="" title="" /></div>';I+='<div class="vehicle_details">';I+='<div class="rocket"></div>';var J=["operator","height","diameter","currency","massLEO","massGTO",(this.data.vehicle[G].risk?"risk":""),"sites"];for(var H=0;H<J.length;H++){I+=this.buildRow("","",J[H])}I+='<div class="clearall"></div>';I+="</div>";I+='<div class="selector"><input type="radio" name="vehicle_rocket" id="vehicle_rocket_'+G+'" data="'+G+'" /><label for="vehicle_rocket_'+G+'"></label></div>';I+="</li>"}I+='</ul></form><div class="details"></div></div>';e("#designer_vehicle .options").html(I);e(".details").html("").removeClass("padded");e("#sidebar .panel").hide();return this};F.prototype.buildTable=function(){this.table={success:{list:{success_vehicle:{},success_site:{},success_orbit:{},success_deploy:{},success_cooling:{},success_instruments:{},success_mission:{}}},cost_available:{list:{cost_initial:{},cost_dev_total:{list:{cost_dev_satellite:{},cost_dev_mirror:{},cost_dev_cooling:{},cost_dev_instruments:{}}},cost_operations_total:{list:{cost_operations_launch:{},cost_operations_ground:{}}},cost_total:{},cost_available:{}}},mass_total:{list:{mass_satellite:{},mass_mirror:{},mass_cooling_total:(this.settings.mode=="advanced"?{list:{mass_cooling_passive:{},mass_cooling_cryo:{},mass_cooling_active:{}}}:{}),mass_instruments:{}}},time_dev_total:{list:{time_dev_total:{list:{time_dev_satellite:{},time_dev_mirror:{},time_dev_cooling:{},time_dev_instruments:{}}},time_mission:{},time_cooling:{},time_fuel:{},time_observing:{}}},science_total:{},profile_total:{list:{profile_site:{},profile_vehicle:{},profile_instruments:{},profile_mirror:{},profile_temperature:{},profile_orbit:{},profile_launch:{},profile_end:{}}}}};F.prototype.resize=function(){if(this.modal){this.positionModal(this.modal)}if(e("#launchanimation").length>0){e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"})}return this};F.prototype.navigate=function(G,i){if(!i){var i=location.href.split("#")[1]}this.log("navigate",i,G);if(!g(i,"string")){i=""}this.showView(i,G);return this};F.prototype.keypress=function(G,I){if(this.keyboard){if(!I){I={altKey:false}}for(var H=0;H<this.keys.length;H++){if(this.keys[H].charCode==G&&I.altKey==this.keys[H].altKey){this.keys[H].fn.call(this,{event:I});break}}}};F.prototype.registerKey=function(O,M,I){if(!g(M,"function")){return this}if(!g(O,"object")){O=[O]}var N,G,L,H,J,K;for(L=0;L<O.length;L++){J=false;if(g(O[L],"string")){if(O[L].indexOf("alt")==0){K=O[L];J=true;O[L]=O[L].substring(4)}else{K=O[L]}G=O[L].charCodeAt(0)}else{G=O[L];if(G==37){K="&larr;"}else{if(G==32){K="space"}else{if(G==38){K="up"}else{if(G==39){K="&rarr;"}else{if(G==40){K="down"}else{K=String.fromCharCode(G)}}}}}}N=true;for(H=0;H<this.keys.length;H++){if(this.keys.charCode==G&&this.keys.altKey==J){N=false}}if(N){this.keys.push({str:K,charCode:G,"char":String.fromCharCode(G),fn:M,txt:I,altKey:J})}}return this};F.prototype.toggleMenus=function(L,J){if(J&&g(J,"object")){J.preventDefault()}var G=e(".dropdown");var H=(J)?e(J.currentTarget).attr("href"):"";for(var I=0;I<G.length;I++){var K=this;if(e(G[I]).attr("id")==L){e(G[I]).toggle(0,function(){if(H&&H.indexOf("#")>=0){K.setScroll("#"+H.split("#")[1])}})}else{e(G[I]).hide()}}if(L=="messages"){this.setScroll("#"+L)}return this};F.prototype.scrollMenus=function(i){e(".dropdown.fullwidth:visible").each(function(){var G=parseInt(e(this).css("top"));var H=e("#bar").outerHeight();var I=window.scrollY;if(G<=H){e(".dropdown").css({top:H})}if(G>I+H){e(".dropdown").css({top:I+H})}});return this};F.prototype.setVar=function(i,H){if(g(i,"string")){if(this.i&&typeof this.i[i]===H){this.settings[i]=this.i[i]}if(typeof this.q[i]===H){this.settings[i]=this.q[i];if(this.settings.usecookies){u("spacetelescope."+i,this.settings[i],1)}}if(this.settings.usecookies){var G=A("spacetelescope."+i);if(G){this.settings[i]=G}}}return this};F.prototype.loadConfig=function(G){var i=this.dataurl.replace("%MODE%",this.getMode());e.ajax({url:i,beforeSend:function(H){if(H.overrideMimeType){H.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+i)},success:function(I){this.data=I;if(g(G,"function")){G.call(this)}if(g(G,"object")&&G.length>0){for(var H=0;H<G.length;H++){G[H].call(this)}}}});return this};F.prototype.getMode=function(){return(this.settings.mode=="advanced")?"_advanced":""};F.prototype.loadLanguage=function(G,I){if(!G){G=this.langshort}var i=this.settings.mode;if(!this.languages[G]){G=this.langshort;if(this.languages[this.langshort]){G="en"}}var H=this.langurl.replace("%LANG%",G).replace("%MODE%",this.getMode());e.ajax({url:H,beforeSend:function(J){if(J.overrideMimeType){J.overrideMimeType("application/json")}},method:"GET",cache:false,dataType:"json",context:this,error:function(){this.log("Error loading "+G+" ("+i+")")},success:function(J){this.langshort=G;this.lang=G;this.phrases=J;this.log("Loaded "+G);this.loadScenarios(I)}});return this};F.prototype.loadScenarios=function(H){var i=this.settings.mode;var G=this.scenariourl.replace("%LANG%",this.langshort).replace("%MODE%",this.getMode());e.ajax({url:G,beforeSend:function(I){if(I.overrideMimeType){I.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+G+" ("+i+")");if(g(H,"function")){H.call(this)}if(g(H,"object")&&H.length>0){for(var I=0;I<H.length;I++){H[I].call(this)}}},success:function(J){this.scenarios=J.scenarios;this.log("Loaded Scenario");if(g(H,"function")){H.call(this)}if(g(H,"object")&&H.length>0){for(var I=0;I<H.length;I++){H[I].call(this)}}}});return this};F.prototype.chooseScenario=function(G){this.log("chooseScenario",G);this.scenario=this.scenarios[G];this.stage="designer";e("#summary").show();this.updateSummary().updateLanguage();return this};F.prototype.update=function(){this.log("update");if(!this.phrases||!this.data){return this}this.buildPage().updateLanguage().makeSpace("orbits").displayOrbits();e("#language.dropdown").hide();if(!this.loaded){this.navigate();this.loaded=true}return this};F.prototype.addInstrument=function(){if(!this.choices.instruments){this.choices.instruments=[]}var H=this.getValue("#instruments");var G=this.getValue("#wavelengths");var I=this.getValue("#instrument_name");if(H&&G){if(!I){I=this.phrases.designer.instruments.defaultname.replace(/%d%/,(this.choices.instruments.length+1))}this.choices.instruments.push({name:I,type:H,wavelength:G,ok:true});this.updateInstruments()}return this};F.prototype.removeInstrument=function(G){G=parseInt(G,10);if(G<this.choices.instruments.length){this.choices.instruments.splice(G,1)}this.updateInstruments();return this};F.prototype.displayInstruments=function(){var H="";var I=this.phrases.designer;this.log("displayInstruments");H+="<h3>"+I.instruments.table.title+'</h3><div class="tablewrapper"><table><tr><th>'+I.instruments.table.name+"</th><th>"+I.instruments.table.type+"</th><th>"+I.instruments.table.cost+"</th><th>"+I.instruments.table.mass+"</th><th>"+I.instruments.table.temperature+"</th><th></th></tr>";if(this.choices.instruments&&this.choices.instruments.length>0){for(var G=0;G<this.choices.instruments.length;G++){v=this.getInstrument({wavelength:this.choices.instruments[G].wavelength,type:this.choices.instruments[G].type});H+="<tr><td>"+this.choices.instruments[G].name+"</td><td>"+v.wavelength+" "+v.type+"</td><td>"+this.formatValueSpan(v.cost)+"</td><td>"+this.formatValueSpan(v.mass)+"</td><td>"+this.formatValueSpan(v.temp)+'</td><td><a class="remove_instrument" href="#" title="'+this.phrases.designer.instruments.options.remove+'" data="'+G+'"><img class="icon minus" src="images/cleardot.gif"></a></td></tr>'}}H+="</table></div>";e("#designer_instruments .instrument_list").html(H);return H};F.prototype.updateInstruments=function(){this.log("updateInstruments");this.displayInstruments();this.parseChoices("designer_instruments");return this};F.prototype.makeSatellite=function(){this.log("makeSatellite");if(!this.satellite){this.satellite=new D({id:"sidebar_satellite",spacetel:this})}this.satellite.resize();return this};F.prototype.makeSpace=function(i){this.log("makeSpace");if(!this.space){this.space=new E({id:i,phrases:this.phrases.designer.orbit,data:this.data.orbit,callback:this.selectOrbit,context:this,interactive:true})}if(!this.space.el.is(":visible")){return this}this.space.data=this.data.orbit;this.space.phrases=this.phrases.designer.orbit;if(!this.space.paper){this.space.resize()}return this};F.prototype.selectOrbit=function(i){if(i){e("#designer_orbit #mission_orbit").val(i);e("#designer_orbit #mission_orbit").trigger("change")}return this};F.prototype.highlightOrbit=function(i){this.log("highlightOrbit",i,this.space);this.space.highlight(i);return this};F.prototype.removeOrbits=function(){this.space.removeOrbits();return this};F.prototype.displayOrbits=function(i,G){this.log("displayOrbits",i,G);this.space.displayOrbits(i,G);return this};F.prototype.updateProposal=function(){this.log("updateProposal");e(".printable").remove();var I={};var K={};var G;if(this.choices.instruments&&this.choices.instruments.length>0){var L="";for(var H=0;H<this.choices.instruments.length;H++){G=this.choices.instruments[H].wavelength;v=this.getInstrument({wavelength:this.choices.instruments[H].wavelength,type:this.choices.instruments[H].type});L+=""+this.choices.instruments[H].name+" - "+v.wavelength+" "+v.type+"\n";if(this.data.wavelengths[G].min){if(!K.value||this.data.wavelengths[G].min.value<K.value){K=this.copyValue(this.data.wavelengths[G].min)}}if(this.data.wavelengths[G].max){if(!I.value||this.data.wavelengths[G].max.value>I.value){I=this.copyValue(this.data.wavelengths[G].max)}}}e("#proposal_instruments").val(L)}if(this.choices.mirror){e("#proposal_mirror").val(this.choices.mirror);if(this.settings.mode!="advanced"){var J=this.data.mirror[this.choices.mirror].diameter;e("#proposal_reslow").val(n(this.formatValue(this.makeValue(1.22*K.value/J.value,"degrees"))));e("#proposal_reshigh").val(n(this.formatValue(this.makeValue(1.22*I.value/J.value,"degrees"))))}}if(this.choices.temperature){e("#proposal_reqtemp").val(this.formatValue(this.choices.instrument.temp));e("#proposal_temp").val(this.formatValue(this.choices.temperature))}if(this.table.mass_total){e("#proposal_mass").val(this.formatValue(this.table.mass_total.value));e("#proposal_mass_satellite").val(this.formatValue(this.table.mass_total.list.mass_satellite.value));e("#proposal_mass_mirror").val(this.formatValue(this.table.mass_total.list.mass_mirror.value));e("#proposal_mass_cooling").val(this.formatValue(this.table.mass_total.list.mass_cooling_total.value));e("#proposal_mass_instruments").val(this.formatValue(this.table.mass_total.list.mass_instruments.value))}if(this.choices.orbit){e("#proposal_orbit").val(this.phrases.designer.orbit.options[this.choices.orbit].label);e("#proposal_distance").val(this.formatValue(this.data.orbit[this.choices.orbit].altitude));if(this.settings.mode!="advanced"){e("#proposal_period").val(this.formatValue(this.data.orbit[this.choices.orbit].period));e("#proposal_fuel").val(this.formatValue(this.data.orbit[this.choices.orbit].fuellife))}}if(this.choices.mission){e("#proposal_duration").val(this.formatValue(this.copyValue(this.data.mission[this.choices.mission].life)))}if(this.choices.vehicle){e("#proposal_vehicle").val(this.phrases.designer.vehicle.options[this.choices.vehicle].label);e("#proposal_operator").val(this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label);e("#proposal_launchmass").val(this.formatValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO)));e("#proposal_launchsize").val(this.formatValue(this.data.vehicle[this.choices.vehicle].diameter))}if(this.choices.site){e("#proposal_site").val(this.phrases.designer.site.options[this.choices.site].label)}if(this.table){e("#proposal_cost").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_total.value))));e("#proposal_cost_satellite").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.value))));e("#proposal_cost_mirror").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.value))));e("#proposal_cost_cooling").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.value))));e("#proposal_cost_instruments").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.value))));e("#proposal_cost_dev").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.value))));e("#proposal_cost_launch").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.value))));e("#proposal_cost_ground").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.value))));e("#proposal_cost_operations").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.value))))}if(this.proposalCompleteness()!=0){e(".doc").after('<div class="printable bigpadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.print+"</a></div>")}return this};F.prototype.proposalCompleteness=function(){this.log("proposalCompleteness");var K=0;var H=e(".doc").find("input");var G=e(".doc").find("textarea");var J=H.length+G.length;for(var I=0;I<H.length;I++){if(e(H[I]).val()!=""){K++}}for(var I=0;I<G.length;I++){if(e(G[I]).val()!=""){K++}}return K/J};F.prototype.printProposal=function(){this.log("printProposal");var G=e(".doc").eq(0).html();G=G.replace(/<label[^\>]*>[^\<]*<\/label>/g,"").replace(/<input [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(I,J){var H=e("#"+J).val();return(H!=""?'<span class="userinput">'+H+"</span>":'<span class="emptyinput">BLANK</span>')}).replace(/<textarea [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(I,J){var H=e("#"+J).val();return(H!=""?'<span class="userinput">'+H+"</span>":'<span class="emptyinput">BLANK</span>')});var i=window.open("","","width="+e(window).width()+",height="+e(window).height()+",resizeable,scrollbars");i.document.write('<!DOCTYPE html><html><head><link type="text/css" href="css/fonts.css" media="all" rel="stylesheet"><link type="text/css" href="css/style.css" media="all" rel="stylesheet"><script>function onload(){ window.print(); }<\/script></head><body onload="onload()"><div id="main" class="bigpadded"><div class="doc">'+G+"</div></div></body></html>");i.document.close();return this};F.prototype.updateSidePanels=function(){if(this.choices.mirror||this.choices.hascooling||this.choices.instruments){this.makeSatellite();e("#sidebar .satellite.panel").show()}else{e("#sidebar .satellite.panel").hide()}if(this.choices.vehicle){e("#sidebar .vehicle.panel").html('<div class="image"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div><div class="info"><div>'+this.phrases.designer.vehicle.options[this.choices.vehicle].label+"</div><div>"+this.phrases.designer.vehicle.diameter+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].diameter)+"</div><div>"+this.phrases.designer.vehicle.massLEO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.LEO)+"</div><div>"+this.phrases.designer.vehicle.massGTO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.GTO)+"</div><div>"+this.phrases.designer.vehicle.operator+" "+this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label+"</div></div>").show()}else{e("#sidebar .vehicle.panel").hide()}if(this.choices.site){html='<img src="images/worldmap.png" />';var i=this.data.site[this.choices.site].latitude;var G=this.data.site[this.choices.site].longitude;if(!i&&!G){i=34;G=-116}html+='<a href="#" class="launchsite '+this.choices.site+'" title="'+this.phrases.designer.site.options[this.choices.site].label+'" style="left:'+Math.round(100*(G+180)/360)+"%;top:"+Math.round(100*(90-i)/180)+'%"></a>';e("#sidebar .site.panel").html(html).show()}else{e("#sidebar .site.panel").hide()}if(this.choices.orbit){e("#sidebar .orbit.panel").html('<img src="'+this.data.orbit[this.choices.orbit].img+'" />').show()}else{e("#sidebar .orbit.panel").hide()}return this};F.prototype.updateDropdown=function(K){var H="";var I,J,G;I=e("#"+K);if(I.length==0){return this}J=I.find("option");this.log("updateDropdown");if(K=="mirror_size"){if(this.phrases.designer.satellite.options.diameter.placeholder){H='<option value="">'+this.phrases.designer.satellite.options.diameter.placeholder+"</option>"}for(var i in this.data.mirror){H+='<option value="'+i+'">'+this.formatValue(this.data.mirror[i].diameter)+"</option>"}I.html(H)}else{if(K=="instruments"){if(this.phrases.designer.instruments.options.instrument.none&&this.settings.mode=="advanced"){H='<option value="">'+this.phrases.designer.instruments.options.instrument.none.label+"</option>"}for(var i in this.data.instrument.options){G=this.phrases.designer.instruments.options.instrument[i].label;H+='<option value="'+i+'">'+G+"</option>"}I.html(H);if(this.settings.mode!="advanced"){e("#instruments option:first-child").attr("selected","selected")}this.displayInstruments()}else{if(K=="wavelengths"){if(this.phrases.wavelengths.none.label){H='<option value="">'+this.phrases.wavelengths.none.label+"</option>"}for(var i in this.data.wavelengths){G=this.phrases.wavelengths[i].label;H+='<option value="'+i+'">'+G+"</option>"}I.html(H)}else{if(K=="mission_duration"){if(this.phrases.designer.orbit.duration.none){H='<option value="">'+this.phrases.designer.orbit.duration.none+"</option>"}for(var i in this.data.mission){G=this.formatValue(this.data.mission[i].life);H+='<option value="'+i+'">'+G+"</option>"}I.html(H)}else{if(K=="mission_orbit"){if(this.phrases.designer.orbit.orbit.none){H='<option value="">'+this.phrases.designer.orbit.orbit.none+"</option>"}for(var i in this.data.orbit){H+='<option value="'+i+'">'+this.phrases.designer.orbit.options[i].label+"</option>"}I.html(H)}else{if(K=="cooling_temperature"){if(this.data.cooling.temperature){for(var i in this.data.cooling.temperature){G=n(this.formatValue(this.data.cooling.temperature[i].temperature));H+='<option value="'+i+'">'+G+"</option>"}I.html(H)}}else{if(K=="site"){if(this.phrases.designer.site.hint){H='<option value="">'+this.phrases.designer.site.hint+"</option>"}for(var i in this.data.site){if(this.phrases.designer.site.options[i]){G=this.phrases.designer.site.options[i].label;H+='<option value="'+i+'">'+G+"</option>"}}I.html(H)}else{if(K=="cooling_cryogenic"){for(var i in this.data.cooling.cryogenic){G=(this.phrases.designer.cooling.options.cryogenic.options[i]?this.phrases.designer.cooling.options.cryogenic.options[i]:this.formatValue(this.data.cooling.cryogenic[i].life));H+='<option value="'+i+'">'+G+"</option>"}I.html(H)}}}}}}}}return this};F.prototype.updateLanguage=function(){this.log("updateLanguage");if(!this.phrases||!this.data){return this}var X=this.phrases;var K,V,Q,L,M;if(X.title){document.title=n(X.title)}e("h1").text(X.title);e("body").attr("dir",(X.language.alignment=="right"?"rtl":"ltr")).removeClass("ltr rtl").addClass((X.language.alignment=="right"?"rtl":"ltr"));if(this.scenario){if(e("#designer_objectives .banner").length==0){e("#designer_objectives .intro").before('<div class="banner"></div>')}e("#designer_objectives .banner").html('<div class="title">'+this.scenario.name+"</div>");if(this.scenario.image&&this.scenario.image.banner){e("#designer_objectives .banner").css("background-image","url("+this.scenario.image.banner+")")}if(X.designer.objectives.intro){e("#designer_objectives .intro").html("<p><strong>"+X.scenarios.mission+"</strong> &quot;"+this.formatScenario(this.scenario)+"&quot;</p>"+(this.scenario.funder?X.designer.objectives.intro:X.designer.objectives.intronofunder).replace(/%TITLE%/,this.scenario.name).replace(/%FUNDER%/,this.scenario.funder)).addClass("bigpadded")}}e("#designer_satellite .options .mirror_diameter label").html(X.designer.satellite.options.diameter.label);this.updateDropdown("mirror_size");e("#designer_satellite .options .mirror_deployable label").html(X.designer.satellite.options.deployable.label);e("#designer_satellite .options .mirror_uv label").html(X.designer.satellite.options.uv.label);if(X.designer.satellite.intro){e("#designer_satellite .intro").html(X.designer.satellite.intro).addClass("bigpadded")}this.updateToggle({id:"mirror_deployable_no",label:this.phrases.designer.satellite.options.deployable.no},{id:"mirror_deployable_yes",label:this.phrases.designer.satellite.options.deployable.yes},this.phrases.designer.satellite.options.deployable.label);this.updateToggle({id:"mirror_uv_no",label:this.phrases.designer.satellite.options.uv.no},{id:"mirror_uv_yes",label:this.phrases.designer.satellite.options.uv.yes},this.phrases.designer.satellite.options.uv.label);this.updateDropdown("instruments");this.updateDropdown("wavelengths");e("#designer_instruments .options label").html(X.designer.instruments.options.label);e("#designer_instruments .options input#instrument_name").attr("placeholder",X.designer.instruments.options.name);e("#designer_instruments .options a.add_instrument").attr("title",X.designer.instruments.options.add);e("#designer_instruments .options a.add_instrument span").html(X.designer.instruments.options.add);if(X.designer.instruments.intro){e("#designer_instruments .intro").html(X.designer.instruments.intro.replace(/%MAX%/,this.data.instrument.maxsize.length)).addClass("bigpadded")}if(X.designer.cooling.intro){e("#designer_cooling .intro").html(X.designer.cooling.intro).addClass("bigpadded")}e("#designer_cooling .options label[for=hascooling]").html(X.designer.cooling.enable.label);this.updateToggle({id:"cooling_no",label:X.designer.cooling.enable.no},{id:"cooling_yes",label:X.designer.cooling.enable.yes},this.phrases.designer.cooling.enable.label);if(this.data.cooling.temperature){this.updateDropdown("cooling_temperature");e("#designer_cooling .options label[for=cooling_temperature]").html(X.designer.cooling.options.temperature.label)}if(this.data.cooling.passive){K="";this.updateToggle({id:"cooling_passive_no",label:this.phrases.designer.cooling.options.passive.options.no},{id:"cooling_passive_yes",label:this.phrases.designer.cooling.options.passive.options.yes},this.phrases.designer.cooling.options.passive.label);e("#designer_cooling .options label[for=cooling_passive]").html(X.designer.cooling.options.passive.label)}if(this.data.cooling.active){K="";this.updateToggle({id:"cooling_active_no",label:this.phrases.designer.cooling.options.active.options.no},{id:"cooling_active_yes",label:this.phrases.designer.cooling.options.active.options.yes},this.phrases.designer.cooling.options.active.label);e("#designer_cooling .options label[for=cooling_active]").html(X.designer.cooling.options.active.label)}if(this.data.cooling.cryogenic){this.updateDropdown("cooling_cryogenic");e("#designer_cooling .options label[for=cooling_cryogenic]").html(X.designer.cooling.options.cryogenic.label)}V=0;M=X.designer.vehicle;var P="";var R=0;for(var U in this.data.vehicle){R++}var J=100/R;for(var U in this.data.vehicle){L=e("#designer_vehicle .options li").eq(V);L.attr({data:U}).css({width:J+"%"});Q=this.data.vehicle[U];L.find(".image img").attr({src:Q.img,alt:M.options[U].label,title:M.options[U].label});L.find(".selector label").html(M.options[U].label);L.find(".rocket").html(M.options[U].label);L.find(".operator img").attr({src:this.data.operator[Q.operator].img,alt:X.operator[Q.operator].label,title:X.operator[Q.operator].label});L.find(".details .operator strong").html(M.operator);L.find(".details .operator .value").html(X.operator[Q.operator].label);if(Q.height){L.find(".height strong").html(M.height);this.updateValue(L.find(".height .value"),Q.height)}L.find(".diameter strong").html(M.diameter);this.updateValue(L.find(".diameter .value"),Q.diameter);L.find(".currency strong").html(M.cost);this.updateValue(L.find(".currency .value"),Q.cost);L.find(".massLEO strong").html(M.massLEO);this.updateValue(L.find(".massLEO .value"),Q.mass.LEO);L.find(".massGTO strong").html(M.massGTO);this.updateValue(L.find(".massGTO .value"),Q.mass.GTO);if(Q.risk){L.find(".risk strong").html(M.risk);this.updateValue(L.find(".risk .value"),(Q.risk*100)+"%")}L.find(".sites strong").html(M.sites);K="";for(var O=0;O<Q.sites.length;O++){K+=""+X.designer.site.options[Q.sites[O]].label+"<br />"}this.updateValue(L.find(".sites .value"),K);L.find("input").attr("value",U);L.find(".button").html(M.select);V++}if(X.designer.vehicle.intro){e("#designer_vehicle .intro").html(X.designer.vehicle.intro).addClass("bigpadded")}var W="";this.updateDropdown("site");var N='<option value="">'+X.designer.site.hint+"</option>";for(var O in this.data.site){var I=this.data.site[O].latitude;var H=this.data.site[O].longitude;N+='<option value="'+O+'">'+X.designer.site.options[O].label+"</option>";if(!I&&!H){I=34;H=-116}W+='<a href="#" class="launchsite '+O+'" data="'+O+'" title="'+X.designer.site.options[O].label+'" style="left:'+Math.round(100*(H+180)/360)+"%;top:"+Math.round(100*(90-I)/180)+'%"></a>'}e("#designer_site .worldmap .launchsite").remove();e("#designer_site .worldmap").append(W);e("#designer_site .options label").html(X.designer.site.hint);if(X.designer.site.intro){e("#designer_site .intro").html(X.designer.site.intro).addClass("bigpadded")}e("#designer_orbit .options label[for=mission_duration]").html(X.designer.orbit.duration.label);this.updateDropdown("mission_duration");e("#designer_orbit .options label[for=mission_orbit]").html(X.designer.orbit.orbit.label);this.updateDropdown("mission_orbit");var G=(X.designer.proposal.labels?X.designer.proposal.labels:{});String.prototype.formify=function(aa,Z,Y,ac,i){if(!i&&G[aa]){i=G[aa]}if(i){i='<label for="'+Y+'">'+i+"</label>"}else{i=""}if(!ac){ac=""}if(Z=="text"){var ab='<input type="text" name="'+Y+'" id="'+Y+'" value="'+ac+'" >'}else{if(Z=="textarea"){var ab='<textarea name="'+Y+'" id="'+Y+'">'+ac+"</textarea>"}}return this.replace("%"+aa+"%",i+ab,"g")};var S=X.designer.proposal.doc;e("#designer_proposal .options .doc").html(S.replace(/%FUNDER%/g,"Funder").replace(/%DATE%/,(new Date()).toDateString()).formify("TO","text","proposal_to").formify("NAME","text","proposal_name").formify("AIM","textarea","proposal_aim").formify("PREVIOUS","text","proposal_previous").formify("ADVANCE","textarea","proposal_advance").formify("INSTRUMENTS","textarea","proposal_instruments").formify("GOALS","textarea","proposal_goal").formify("RESLOW","text","proposal_reslow").formify("RESHIGH","text","proposal_reshigh").formify("MIRROR","text","proposal_mirror").formify("REQTEMPERATURE","text","proposal_reqtemp").formify("TEMPERATURE","text","proposal_temp").formify("MASS","text","proposal_mass").formify("MASSSATELLITE","text","proposal_mass_satellite").formify("MASSMIRROR","text","proposal_mass_mirror").formify("MASSCOOLING","text","proposal_mass_cooling").formify("MASSINSTRUMENTS","text","proposal_mass_instruments").formify("ORBIT","text","proposal_orbit").formify("DISTANCE","text","proposal_distance").formify("PERIOD","text","proposal_period").formify("FUEL","text","proposal_fuel").formify("DURATION","text","proposal_duration").formify("VEHICLE","text","proposal_vehicle").formify("OPERATOR","text","proposal_operator").formify("SITE","text","proposal_site").formify("LAUNCHMASS","text","proposal_launchmass").formify("LAUNCHSIZE","text","proposal_launchsize").formify("COST","text","proposal_cost").formify("COSTSATELLITE","text","proposal_cost_satellite").formify("COSTMIRROR","text","proposal_cost_mirror").formify("COSTCOOLING","text","proposal_cost_cooling").formify("COSTINSTRUMENTS","text","proposal_cost_instruments").formify("COSTDEV","text","proposal_cost_dev").formify("COSTLAUNCH","text","proposal_cost_launch").formify("COSTGROUND","text","proposal_cost_ground").formify("COSTOPERATIONS","text","proposal_cost_operations"));for(var V=0;V<this.sections.length;V++){if(X.designer[this.sections[V]]){e(".toggle"+this.sections[V]).text(X.designer[this.sections[V]].label).attr("title",(X.designer[this.sections[V]].hint?X.designer[this.sections[V]].hint.replace(/<([^>]*)>/g,""):""))}}e(".togglemenu").attr("title",X.ui.menu.title);e("#menu ul li").each(function(Y){var Z=e(this).attr("data");e(this).find("a").attr("title",X.ui.menu[Z].title).find("span").html(X.ui.menu[Z].label)});var T=["warnings","errors","success","time","cost","mass","science"];for(var V=0;V<T.length;V++){if(X.ui[T[V]]){e(".toggle"+T[V]).attr("title",X.ui[T[V]].title)}if(X.ui.summary[T[V]]){e(".toggle"+T[V]).attr("title",X.ui.summary[T[V]].title)}}e("#introduction").html(X.intro.about);e("#introduction").append('<div class="centre"><a href="#scenarios" class="button fancybtn">'+X.intro.button+"</a></div>");e("#introduction").append('<div class="centre toppadded">'+this.buildToggle("togglemode",{value:"no",id:"mode_basic",checked:(this.settings.mode!="advanced"?true:false)},{value:"yes",id:"mode_advanced",checked:(this.settings.mode=="advanced"?true:false)})+"</div>");this.updateToggle({id:"mode_basic",label:this.phrases.modes.basic},{id:"mode_advanced",label:this.phrases.modes.advanced},this.phrases.modes.label);var L="";for(var V=0;V<this.scenarios.length;V++){L+='<li><div class="padded">'+(this.scenarios[V].image&&this.scenarios[V].image.banner?'<img src="'+this.scenarios[V].image.banner+'"'+(this.scenarios[V].image.alt?'alt="'+this.scenarios[V].image.alt+'"':"")+' style="width: 100%;" />':"")+"<h3>"+this.scenarios[V].name+"</h3><p>"+this.formatScenario(this.scenarios[V])+'</p><a href="#designer_objectives" class="button" title="'+this.scenarios[V].name+'" data="'+V+'">Choose this mission<!--LANGUAGE--></a></div></li>'}e("#scenariolist").html(L);e("#scenarios h2").html(X.scenarios.title);e("#scenarios p.about").html(X.scenarios.intro);this.updateUnits();e("#messages h3.warning .title").text(this.phrases.ui.warning.title);e("#messages h3.error .title").text(this.phrases.ui.error.title);e(".togglelaunch a").text(this.phrases.launch.label).attr("title",(this.phrases.launch.hint?this.phrases.launch.hint:""));var O=X.ui.summary;this.table.success.label=O.success.title;this.table.success.list.success_orbit.label=O.success.orbit;this.table.success.list.success_site.label=O.success.site;this.table.success.list.success_vehicle.label=O.success.vehicle;this.table.success.list.success_deploy.label=O.success.deploy;this.table.success.list.success_cooling.label=O.success.cooling;this.table.success.list.success_instruments.label=O.success.instruments;this.table.success.list.success_mission.label=O.success.mission;this.table.cost_available.label=O.cost.title;this.table.cost_available.list.cost_initial.label=O.cost.initial;this.table.cost_available.list.cost_dev_total.label=O.cost.dev.title;this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.label=O.cost.dev.satellite;this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.label=O.cost.dev.mirror;this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.label=O.cost.dev.cooling;this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.label=O.cost.dev.instruments;this.table.cost_available.list.cost_operations_total.label=O.cost.operations.title;this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.label=O.cost.operations.launch;this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.label=O.cost.operations.ground;this.table.cost_available.list.cost_total.label=O.cost.total;this.table.cost_available.list.cost_available.label=O.cost.available;this.table.time_dev_total.label=O.time.title;this.table.time_dev_total.list.time_dev_total.label=O.time.dev.title;this.table.time_dev_total.list.time_dev_total.list.time_dev_satellite.label=O.time.dev.satellite;this.table.time_dev_total.list.time_dev_total.list.time_dev_mirror.label=O.time.dev.mirror;this.table.time_dev_total.list.time_dev_total.list.time_dev_cooling.label=O.time.dev.cooling;this.table.time_dev_total.list.time_dev_total.list.time_dev_instruments.label=O.time.dev.instruments;this.table.time_dev_total.list.time_mission.label=O.time.mission;this.table.time_dev_total.list.time_cooling.label=O.time.cooling;this.table.time_dev_total.list.time_fuel.label=O.time.fuel;this.table.time_dev_total.list.time_observing.label=O.time.observing;this.table.mass_total.label=O.mass.title;this.table.mass_total.list.mass_satellite.label=O.mass.satellite;this.table.mass_total.list.mass_mirror.label=O.mass.mirror;this.table.mass_total.list.mass_cooling_total.label=O.mass.cooling.title;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.label=O.mass.cooling.passive;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.label=O.mass.cooling.cryo;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.label=O.mass.cooling.active}this.table.mass_total.list.mass_instruments.label=O.mass.instruments;this.table.science_total.label=O.science.title;this.table.profile_total.label=O.profile.title;this.table.profile_total.list.profile_site.label=O.profile.site;this.table.profile_total.list.profile_vehicle.label=O.profile.vehicle;this.table.profile_total.list.profile_instruments.label=O.profile.instruments;this.table.profile_total.list.profile_mirror.label=O.profile.mirror;this.table.profile_total.list.profile_temperature.label=O.profile.temperature;this.table.profile_total.list.profile_orbit.label=O.profile.orbit;this.table.profile_total.list.profile_launch.label=O.profile.launch;this.table.profile_total.list.profile_end.label=O.profile.end;this.updateSummaryList();return this};F.prototype.getInstrument=function(K){var H=K;var M=this.makeValue(0,"GBP");var J=this.makeValue(0,"kg");var G=this.makeValue(0,"K");var L=this.makeValue(0,"months");if(K.wavelength&&this.data.wavelengths[K.wavelength]){var i=this.copyValue(this.data.wavelengths[K.wavelength]);if(i.cost){M=i.cost}if(i.mass){J=i.mass}if(i.temperature){G=i.temperature}H.wavelength=this.phrases.wavelengths[K.wavelength].label}if(K.type&&this.data.instrument.options[K.type]){var I=this.copyValue(this.data.instrument.options[K.type]);if(I.multiplier&&I.multiplier.cost){M.value*=I.multiplier.cost}if(I.multiplier&&I.multiplier.mass){J.value*=I.multiplier.mass}if(I.devtime){L=I.devtime}H.type=this.phrases.designer.instruments.options.instrument[K.type].label}H.cost=M;H.mass=J;H.temp=G;H.time=L;return H};F.prototype.buildRow=function(G,H,i){return(!G&&!H&&!i)?"":"<div"+(g(i,"string")?' class="'+i+'"':"")+"><strong>"+G+"</strong> "+this.formatValueSpan(H)+"</div>"};F.prototype.showDetails=function(X,S){this.log("showDetails");var L="";if(!X||X==""){return this}var Y,O,T,Q,N,U,Z,M,R;Y=this.phrases.designer;O=this.data;M=this.choices;if(X=="satellite"){if(M.mirror&&O.mirror[M.mirror]){T=O.mirror[M.mirror];var W=this.copyValue(T.cost);var P=this.copyValue(T.mass);var K=this.copyValue(T.devtime);var J=this.copyValue(T.bus.cost);var G=this.copyValue(T.bus.mass);var V=this.copyValue(T.bus.devtime);var I=this.copyValue(T.bus.diameter);if(M.deployablemirror){Q=O.deployablemirror.multiplier;if(Q.cost){W.value*=Q.cost}if(Q.mass){P.value*=Q.mass}if(Q.time){K.value*=Q.time}if(Q.bus.cost){J.value*=Q.bus.cost}if(Q.bus.mass){G.value*=Q.bus.mass}if(Q.bus.time){V.value*=Q.bus.time}if(Q.bus.diameter){I.value*=Q.bus.diameter}}if(M.uvmirror){Q=O.uvmirror.multiplier;if(Q.cost){W.value*=Q.cost}if(Q.mass){P.value*=Q.mass}if(Q.time){K.value*=Q.time}}N=Y.satellite;L+=this.buildRow(N.cost,W);L+=this.buildRow(N.mass,P);L+=this.buildRow(N.devtime,K);L+=this.buildRow(N.bus.cost,J);L+=this.buildRow(N.bus.mass,G);L+=this.buildRow(N.bus.devtime,V);L+=this.buildRow(N.bus.diameter,I);L+=this.buildRow(N.bus.slots,T.bus.instrumentslots)}}else{if(X=="instruments"){S=this.getInstrument(S);U=Y.instruments;L+=this.buildRow(U.cost,S.cost);L+=this.buildRow(U.mass,S.mass);L+=this.buildRow(U.temperature,S.temp);L+=this.buildRow(U.devtime,S.time)}else{if(X=="cooling"){var Z=Y.cooling;L+=this.buildRow(Z.temperature,M.temperature);L+=this.buildRow(Z.cost,M.cooling.cost);L+=this.buildRow(Z.mass,M.cooling.mass);if(M.cooling.time.value>0){L+=this.buildRow(Y.cooling.devtime,M.cooling.time)}L+=this.buildRow(Z.life,M.cooling.life);L+=this.buildRow(Z.risk,this.makeValue(M.cooling.risk*100,"%"))}else{if(X=="site"){if(g(O.site[S].latitude,"number")){L+=this.buildRow(Y.site.location,O.site[S].latitude.toFixed(2)+"&deg;, "+O.site[S].longitude.toFixed(2)+"&deg;")}if(O.site[S].operator){L+=this.buildRow(Y.site.operator,this.phrases.operator[O.site[S].operator].label)}L+=this.buildRow(Y.site.trajectories,Y.site.options[S].trajectories);var H="";for(var R in O.site[S].orbits){if(O.site[S].orbits[R]){H+=""+Y.orbit.options[R].label+"<br />"}}L+=this.buildRow(Y.site.orbits,H);if(g(O.site[S].risk,"number")){L+=this.buildRow(Y.site.risk,(O.site[S].risk*100).toFixed(0)+"%")}}else{if(X=="orbit"){R=O.orbit[S];if(R.altitude){L+=this.buildRow(Y.orbit.altitude,R.altitude)}if(R.period){L+=this.buildRow(Y.orbit.period,R.period)}if(R.obsfrac){L+=this.buildRow(Y.orbit.obsfrac,{value:R.obsfrac*100,units:"%",dimension:"percent"})}if(R.fuellife){L+=this.buildRow(Y.orbit.fuellife,R.fuellife)}if(R.temperature){L+=this.buildRow(Y.orbit.temperature,R.temperature)}if(R.groundcost){L+=this.buildRow(Y.orbit.groundcost,R.groundcost)}if(R.risk){L+=this.buildRow(Y.orbit.risk,{value:R.risk*100,units:"%",dimension:"percent"})}}}}}}L+='<div class="clearall"></div>';e("#designer_"+X+" .details").html(L).addClass("padded").show();return this};F.prototype.formatScenario=function(i){return""+((g(i.description,"string"))?i.description:"").replace(/%COST%/,this.formatValueSpan(i.budget))+""};F.prototype.updateOptions=function(){var G=this.phrases;e("#options").html("<h3>"+G.ui.menu.options.label+'</h3><form id="optionform"><ul></ul>');for(var i in G.ui.options){html='<li><label for="change'+i+'">'+G.ui.options[i]+'</label> <select id="change'+i+'" name="change'+i+'">';if(i=="currency"){for(var H in G.ui[i]){html+='<option value="'+H+'"'+(H==this.settings.currency?' selected="selected"':"")+">"+G.ui.currency[H].label+" "+G.ui.currency[H].symbol+"</option>"}}else{for(var H in G.ui.units){if(G.ui.units[H].dimension==i&&G.ui.units[H].selectable){html+='<option value="'+H+'"'+(H==this.settings[i]?' selected="selected"':"")+">"+G.ui.units[H].label+"</option>"}}}html+="</select></li>";e("#options ul").append(html);e("form#optionform #change"+i).on("change",{me:this,o:i},function(I){I.data.me.settings[I.data.o]=e(this).val();I.data.me.updateUnits()})}this.addCloser(e("#options"),{me:this},function(I){I.preventDefault();I.data.me.closeModal(e("#options"))});return this};F.prototype.updateUnits=function(){var J=e(".convertable");var K,M,G,H,L;for(var I=0;I<J.length;I++){K=e(J[I]);G=K.attr("data-value");H=K.attr("data-units");L=K.attr("data-dimension");if(G&&H&&L){K.html(this.formatValue({value:G,units:H,dimension:L}))}}this.updateDropdown("mirror_size");this.updateDropdown("cooling_temperature");return this};F.prototype.updateValue=function(O,N,G){var I;if(g(O,"object")){I=O}else{if(g(O,"string")){I=e("."+O+".value")}}if(I.length>0){if(g(N,"object")){var M={value:parseFloat(I.attr("data-value"),10),units:I.attr("data-units"),dimension:I.attr("data-dimension")};if(G&&M.dimension==N.dimension){var K=this;var L=20;if(!G){G=400}var P=new Date();var J=0;if(N.units!=M.units){N=this.convertValue(N,M.dimension)}function H(){var i=(new Date())-P;if(i>G){I.html(K.formatValue(N)).attr({"data-value":N.value,"data-units":N.units,"data-dimension":N.dimension}).addClass("convertable")}else{I.html(K.formatValue({value:(M.value+(N.value-M.value)*(i/G)),units:M.units,dimension:M.dimension}));requestAnimFrame(H)}}H()}else{I.attr({"data-value":N.value,"data-units":N.units,"data-dimension":N.dimension}).html(this.formatValue(N)).addClass("convertable")}}else{I.html(N)}}return this};F.prototype.formatValueSpan=function(G,i){i=(i)?" "+i:"";return(g(G,"object")?'<span class="value'+i+' convertable" data-value="'+G.value+'" data-units="'+G.units+'" data-dimension="'+G.dimension+'">'+this.formatValue(G)+"</span>":'<span class="value'+i+'">'+G+"</span>")};F.prototype.copyValue=function(i){if(g(i,"object")){return JSON.parse(JSON.stringify(i))}return{}};F.prototype.getValue=function(i){var G=e(i);if(G.length>0){if(G.prop("tagName")=="SELECT"){return G.find(":selected").attr("value")}if(G.prop("tagName")=="INPUT"){return G.val()}}return""};F.prototype.getChoice=function(G){var H=this.choices;if(G=="mirror.cost"){v=(H.mirror?this.copyValue(this.data.mirror[H.mirror].cost):this.makeValue(0,"GBP"));v.value=-v.value;if(H.deployablemirror&&this.data.deployablemirror.multiplier.cost){v.value*=this.data.deployablemirror.multiplier.cost}if(H.uvmirror&&this.data.uvmirror.multiplier.cost){v.value*=this.data.uvmirror.multiplier.cost}}else{if(G=="mirror.mass"){v=(H.mirror?this.copyValue(this.data.mirror[H.mirror].mass):this.makeValue(0,"kg"));if(H.deployablemirror&&this.data.deployablemirror.multiplier.mass){v.value*=this.data.deployablemirror.multiplier.mass}if(H.uvmirror&&this.data.uvmirror.multiplier.mass){v.value*=this.data.uvmirror.multiplier.mass}}else{if(G=="mirror.time"){v=(H.mirror?this.copyValue(this.data.mirror[H.mirror].devtime):this.makeValue(0,"months"));if(H.deployablemirror&&this.data.deployablemirror.multiplier.time){v.value*=this.data.deployablemirror.multiplier.time}if(H.uvmirror&&this.data.uvmirror.multiplier.time){v.value*=this.data.uvmirror.multiplier.time}}else{if(G=="mirror.prob"){v=(H.mirror?this.data.mirror[H.mirror].risk:1);if(H.deployablemirror&&this.data.deployablemirror.risk){v*=this.data.deployablemirror.risk}if(H.uvmirror&&this.data.uvmirror.risk){v*=this.data.uvmirror.risk}}else{if(G=="mirror"){v=(H.mirror)?this.data.mirror[H.mirror].diameter:this.makeValue(0,"m")}else{if(G=="cooling.cost"){v=(H.cooling?this.copyValue(H.cooling.cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(G=="cooling.mass"){v=(H.cooling&&H.cooling.mass?this.copyValue(H.cooling.mass):this.makeValue(0,"kg"))}else{if(G=="cooling.passive.mass"){v=(H.cooling&&H.cooling.passive?this.copyValue(H.cooling.passive):this.makeValue(0,"kg"))}else{if(G=="cooling.active.mass"){v=(H.cooling&&H.cooling.active?this.copyValue(H.cooling.active):this.makeValue(0,"kg"))}else{if(G=="cooling.cryogenic.mass"){v=(H.cooling&&H.cooling.cryogenic?this.copyValue(H.cooling.cryogenic):this.makeValue(0,"kg"))}else{if(G=="cooling.time"){v=(H.cooling?this.copyValue(H.cooling.time):this.makeValue(0,"months"))}else{if(G=="cooling.life"){v=(H.cooling&&H.cooling.life?this.copyValue(H.cooling.life):this.makeValue(99,"years"))}else{if(G=="cooling.prob"){v=1;if(H.cooling&&H.cooling.risk){v=H.cooling.risk}}else{if(G=="satellite.cost"){v=(H.mirror?this.copyValue(this.data.mirror[H.mirror].bus.cost):this.makeValue(0,"GBP"));if(H.deployablemirror&&this.data.deployablemirror.multiplier.bus.cost){v.value*=this.data.deployablemirror.multiplier.bus.cost}v.value=-v.value}else{if(G=="satellite.mass"){v=(H.mirror?this.copyValue(this.data.mirror[H.mirror].bus.mass):this.makeValue(0,"kg"));if(H.deployablemirror&&this.data.deployablemirror.multiplier.bus.mass){v.value*=this.data.deployablemirror.multiplier.bus.mass}}else{if(G=="satellite.time"){v=(H.mirror?this.copyValue(this.data.mirror[H.mirror].bus.devtime):this.makeValue(0,"months"));if(H.deployablemirror&&this.data.deployablemirror.multiplier.bus.time){v.value*=this.data.deployablemirror.multiplier.bus.time}}else{if(G=="instruments.time"){v=(H.instrument&&H.instrument.time)?H.instrument.time:this.makeValue(0,"months")}else{if(G=="instruments.cost"){v=(H.instrument&&H.instrument.cost)?H.instrument.cost:this.makeValue(0,"GBP");v.value=-v.value}else{if(G=="instruments.mass"){v=(H.instrument&&H.instrument.mass)?H.instrument.mass:this.makeValue(0,"kg")}else{if(G=="instruments.prob"){v=(H.instrument&&H.instrument.risk)?H.instrument.risk:1}else{if(G=="site"){v=(H.site?this.phrases.designer.site.options[H.site].label:"")}else{if(G=="site.prob"){v=0;if(H.site){v=(this.data.site[H.site].risk?this.data.site[H.site].risk:1)}}else{if(G=="vehicle"){v=(H.vehicle?this.phrases.designer.vehicle.options[H.vehicle].label:"")}else{if(G=="vehicle.cost"){v=(H.vehicle?this.copyValue(this.data.vehicle[H.vehicle].cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(G=="vehicle.prob"){v=0;if(H.vehicle){v=(this.data.vehicle[H.vehicle].risk?this.data.vehicle[H.vehicle].risk:1)}}else{if(G=="ground.cost"){var i=H.mission?this.copyValue(this.data.mission[H.mission].life):this.makeValue(0,"months");if(H.orbit){v=this.copyValue(this.data.orbit[H.orbit].groundcost);v.value*=-this.convertValue(i,"years").value}else{v=this.makeValue(0,"GBP")}}else{if(G=="temperature"){v=(H.temperature)?H.temperature:this.makeValue(400,"K");if(H.orbit){v=this.data.orbit[H.orbit].temperature}}else{if(G=="launch.cost"){v=(H.vehicle?this.copyValue(this.data.vehicle[H.vehicle].cost):this.makeValue(0,"GBP"));v.value*=-(H.orbit?this.data.orbit[H.orbit].multiplier.launchcost:1)}else{if(G=="orbit"){v=(H.orbit)?this.phrases.designer.orbit.options[H.orbit].label:""}else{if(G=="orbit.prob"){v=0;if(H.orbit){v=(this.data.orbit[H.orbit].risk)?this.data.orbit[H.orbit].risk:1}}else{if(G=="mission.time"){v=(H.mission?this.copyValue(this.data.mission[H.mission].life):this.makeValue(0,"months"))}else{if(G=="mission.prob"){v=(H.mission&&this.data.mission[H.mission].risk?this.data.mission[H.mission].risk:1)}else{if(G=="fuel.time"){v=(H.orbit?this.copyValue(this.data.orbit[H.orbit].fuellife):this.makeValue(0,"months"))}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return v};F.prototype.processSummaryList=function(K,J,L){L++;var I='<ul class="summary">';for(var H in K){var G=K[H];if(G.value||G.list){I+="<li>";if(H&&G.value){I+='<span class="label '+H+'">'+G.label+"</span>"+this.formatValueSpan(G.value,J+" "+H)}if(G.list){I+=this.processSummaryList(G.list,(L==1?J:""))}I+="</li>"}}I+="</ul>";return I};F.prototype.updateSummaryList=function(){for(var H in this.table){var I="";var i=H;if(i.indexOf("_")>0){i=i.substr(0,i.indexOf("_"))}var J=i;if(i!=H){J+=" "+H}var K=0;if(this.table[H].value){this.updateValue("baritem ."+H,this.table[H].value)}var G='<h3><img src="images/cleardot.gif" class="icon '+J+'" /> <span class="label '+J+'">'+this.table[H].label+"</span> "+(this.table[H].value?this.formatValueSpan(this.table[H].value,J):"")+"</h3>";if(this.table[H].list){G+=this.processSummaryList(this.table[H].list,i,K)}e("#summaryext_"+i).addClass("padded").html(G)}return this};F.prototype.updateSummary=function(){this.log("updateSummary");var N,ab,U,V,P,O,G,L,S,X,W,Z,Q,R,aa;var M="";aa=this.phrases;R=aa.ui.summary;var K={};var Y={};var T={};var I={};var J={};K.mirror=this.getChoice("mirror.prob");K.site=this.getChoice("site.prob");K.vehicle=this.getChoice("vehicle.prob");K.cooling=this.getChoice("cooling.prob");K.orbit=this.getChoice("orbit.prob");K.instruments=this.getChoice("instruments.prob");K.mission=this.getChoice("mission.prob");K.total=K.orbit*K.site*K.vehicle*K.mirror*K.cooling*K.instruments*K.mission;if(K.total<0.5&&K.total>0){this.warnings.push({text:aa.warnings.risky})}if(K.total==0){this.errors.push({text:aa.errors.impossible})}Y.mirror=this.getChoice("mirror.cost");Y.satellite=this.getChoice("satellite.cost");Y.cooling=this.getChoice("cooling.cost");Y.instruments=this.getChoice("instruments.cost");Y.dev=this.sumValues(Y.mirror,Y.satellite,Y.cooling,Y.instruments);Y.vehicle=this.getChoice("vehicle.cost");Y.ground=this.getChoice("ground.cost");Y.launch=this.getChoice("launch.cost");Y.operations=this.sumValues(Y.launch,Y.ground);Y.total=this.sumValues(Y.dev,Y.operations);Y.free=this.sumValues(this.scenario.budget,Y.total);if(Y.free.value<0){this.errors.push({text:aa.errors.bankrupt})}I.mirror=this.getChoice("mirror.time");I.satellite=this.getChoice("satellite.time");I.instruments=this.getChoice("instruments.time");I.cooling=this.getChoice("cooling.time");I.total=this.sumValues(I.mirror,I.satellite,I.cooling,I.instruments);I.mission=this.getChoice("mission.time");I.lifecooling=this.getChoice("cooling.life");I.fuel=this.getChoice("fuel.time");N=this.minValue(I.mission,I.lifecooling,I.fuel);N.value*=(this.choices.orbit)?this.data.orbit[this.choices.orbit].obsfrac:0;I.observing=N;ab=this.convertValue(I.fuel,I.mission.units);if(I.mission.value>ab.value){this.warnings.push({text:aa.warnings.fuellifetime.replace(/%LIFE%/,this.formatValue(ab)).replace(/%DURATION%/,this.formatValue(I.mission)),link:"#designer_orbit"})}U=this.convertValue(I.lifecooling,I.mission.units);if(I.mission.value>U.value){this.warnings.push({text:aa.warnings.coolinglifetime.replace(/%LIFE%/,this.formatValue(U)).replace(/%DURATION%/,this.formatValue(I.mission)),link:"#designer_orbit"})}if(K.total>0&&I.mission.value==0){this.warnings.push({text:aa.warnings.missionlife,link:"#designer_orbit"})}T.mirror=this.getChoice("mirror.mass");T.satellite=this.getChoice("satellite.mass");T.cooling=this.getChoice("cooling.mass");T.instruments=this.getChoice("instruments.mass");T.total=this.sumValues(T.mirror,T.satellite,T.cooling,T.instruments);if(this.choices.orbit&&this.choices.vehicle){V=this.convertValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO),T.total.units);if(T.total.value>V.value){this.errors.push({text:aa.errors.heavy})}if(T.total.value<=V.value&&T.total.value>0.8*V.value){this.warnings.push({text:aa.warnings.heavy})}}this.table.success.value=this.formatPercent(K.total);this.table.success.list.success_orbit.value=this.formatPercent(K.orbit);this.table.success.list.success_site.value=this.formatPercent(K.site);this.table.success.list.success_vehicle.value=this.formatPercent(K.vehicle);this.table.success.list.success_deploy.value=this.formatPercent(K.mirror);this.table.success.list.success_cooling.value=this.formatPercent(K.cooling);this.table.success.list.success_instruments.value=this.formatPercent(K.instruments);this.table.success.list.success_mission.value=this.formatPercent(K.mission);this.updateTable("cost_available","value",Y.free);this.updateTable("cost_initial","value",this.scenario.budget);this.updateTable("cost_dev_total","value",Y.dev);this.updateTable("cost_dev_satellite","value",Y.satellite);this.updateTable("cost_dev_mirror","value",Y.mirror);this.updateTable("cost_dev_cooling","value",Y.cooling);this.updateTable("cost_dev_instruments","value",Y.instruments);this.updateTable("cost_operations_total","value",Y.operations);this.updateTable("cost_operations_launch","value",Y.launch);this.updateTable("cost_operations_ground","value",Y.ground);this.updateTable("cost_total","value",Y.total);this.table.cost_available.list.cost_available.value=Y.free;this.updateTable("time_dev_total","value",I.total);this.table.time_dev_total.list.time_dev_total.value=I.total;this.updateTable("time_dev_satellite","value",I.satellite);this.updateTable("time_dev_mirror","value",I.mirror);this.updateTable("time_dev_cooling","value",I.cooling);this.updateTable("time_dev_instruments","value",I.instruments);this.updateTable("time_mission","value",I.mission);this.updateTable("time_cooling","value",I.lifecooling);this.updateTable("time_fuel","value",I.fuel);this.updateTable("time_observing","value",I.observing);this.table.mass_total.value=T.total;this.table.mass_total.list.mass_satellite.value=T.satellite;this.table.mass_total.list.mass_mirror.value=T.mirror;this.table.mass_total.list.mass_cooling_total.value=T.cooling;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.value=this.getChoice("cooling.passive.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.value=this.getChoice("cooling.cryogenic.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.value=this.getChoice("cooling.active.mass")}this.table.mass_total.list.mass_instruments.value=T.instruments;P=0;this.table.science_total.list={};if(this.scenario&&this.scenario.requires&&g(this.scenario.requires,"object")){var H=this.scenario.requires;this.table.science_total.list={};for(S=0;S<H.length;S++){G=0;if(H[S]["instruments"]){O=false;if(this.choices.instruments){for(X=0;X<H[S]["instruments"].length;X++){O=false;for(W=0;W<this.choices.instruments.length;W++){if((this.choices.instruments[W].type==H[S]["instruments"][X].type||this.choices.instruments[W].type=="both")&&this.choices.instruments[W].wavelength==H[S]["instruments"][X].wavelength){O=true}}if(O){G+=100}}}if(H[S]["instruments"].length>0){G/=H[S]["instruments"].length}if(G!=100){this.errors.push({text:H[S].error})}}if(H[S]["mirror"]){L=this.copyValue(H[S]["mirror"]);N=this.convertValue(this.getChoice("mirror"),L.units);if(N.value<L.value){this.errors.push({text:H[S].error})}else{G=100}}if(H[S]["devtime"]){L=this.copyValue(H[S]["devtime"]);N=this.convertValue(this.table.time_dev_total.value,L.units);if(N.value>L.value){this.errors.push({text:H[S].error.replace(/%DEVTIME%/,this.formatValue(N))})}else{G=100}}if(H[S]["vehicle"]){O=false;if(g(H[S]["vehicle"],"object")){for(X=0;X<H[S]["vehicle"].length;X++){if(this.choices.vehicle==H[S]["vehicle"][X]){O=true}}}else{if(this.choices.vehicle==H[S]["vehicle"]){O=true}}if(!O){this.errors.push({text:H[S].error})}else{G=100}}if(H[S]["site"]){L=(this.choices.vehicle)?aa.designer.vehicle.options[this.choices.vehicle].label:"";if(this.choices.vehicle==H[S]["vehicle"]){this.errors.push({text:H[S].error})}else{G=100}}if(H[S]["observingtime"]){L=this.copyValue(H[S]["observingtime"]);N=this.convertValue(this.table.time_dev_total.list.time_observing.value,L.units);if(N.value<L.value){this.errors.push({text:H[S].error.replace(/%OBSERVINGTIME%/,this.formatValue(N))})}else{G=100}}if(!H[S]["label"]){H[S]["label"]="UNKNOWN"}this.table.science_total.list["target"+S]={label:(N?H[S].label.replace(/%VALUE%/,this.formatValue(L)):H[S].label),value:this.makeValue(G,"%")};P+=G}if(H.length>0){P/=H.length}else{P=100}}this.table.science_total.value=this.makeValue(P,"%");this.table.profile_total.list.profile_site.value=this.getChoice("site");this.table.profile_total.list.profile_vehicle.value=this.getChoice("vehicle");this.table.profile_total.list.profile_instruments.value=(this.choices.instruments)?this.choices.instruments.length:0;this.table.profile_total.list.profile_mirror.value=this.getChoice("mirror");this.table.profile_total.list.profile_temperature.value=this.getChoice("temperature");this.table.profile_total.list.profile_orbit.value=this.getChoice("orbit");Z=new Date();Q=this.convertValue(I.total,"months");Z.setUTCMonth(Z.getUTCMonth()+Q.value);this.launchdate=Z.toDateString();this.table.profile_total.list.profile_launch.value=Z.toDateString();Q=this.convertValue(this.minValue(I.mission,I.fuel,I.lifecooling),"months");Z.setUTCMonth(Z.getUTCMonth()+Q.value);this.table.profile_total.list.profile_end.value=Z.toDateString();if(this.choices.orbit&&this.choices.site&&this.choices.vehicle&&this.errors.length==0){this.enableLaunch()}else{this.disableLaunch()}this.updateSummaryList();return this};F.prototype.enableLaunch=function(){this.launchable=true;e(".togglelaunch").show();return this};F.prototype.disableLaunch=function(){this.launchable=false;e(".togglelaunch").hide();return this};F.prototype.processFile=function(L){this.log("processFile",L);if(g(L,"string")){L=L.split(/[\n\r]/)}var O,G,H,K,M,J,P,I,N;O=false;K="";M=[];for(var J=0;J<L.length;J++){G=L[J].indexOf("---");if(O&&G==0){O=false}if(O){H=L[J].split(/\:\t/);if(H[0]=="MODE"){K=H[1]}else{M.push({key:H[0],value:H[1]})}}if(!O&&G==0){O=true}}if(K){this.setMode(K,function(){function i(){var R="";for(J=0;J<M.length;J++){if(M[J].key=="SCENARIO"){for(P=0;P<this.scenarios.length;P++){if(this.scenarios[P].name==M[J].value){R=P}}}}this.chooseScenario(R);function Q(){for(J=0;J<M.length;J++){I=M[J].key;N=M[J].value;if(I=="MIRROR"){e("#mirror_size").val(N)}if(I=="DEPLOYABLE"&&N=="true"){this.changeToggle("toggledeployable","mirror_deployable_yes")}if(I=="UVQUALITY"&&N=="true"){this.changeToggle("toggleuv","mirror_uv_yes")}if(I=="VEHICLE"){e("#vehicle_rocket_"+N).trigger("click")}if(I=="SITE"){e("a."+N).trigger("click")}if(I=="COOLING"&&N=="true"){this.changeToggle("hascooling","cooling_yes")}if(I=="COOLINGACTIVE"&&N=="true"){this.changeToggle("cooling_active","cooling_active_yes")}if(I=="COOLINGCRYO"){e("#cooling_cryogenic").val(N)}if(I=="COOLINGTEMP"){e("#cooling_temperature").val(N)}if(I=="DURATION"){e("#mission_duration").val(N)}if(I=="ORBIT"){e("#mission_orbit").val(N).trigger("change")}if(I.indexOf("INSTRUMENT")==0){var S=N.split(/\;/);e("#wavelengths").val(S[0]);e("#instruments").val(S[1]);e("#instrument_name").val(S[2]);e(".add_instrument").trigger("click")}}}this.showView("designer_objectives","",Q)}this.showView("scenarios","",i)})}return this};F.prototype.save=function(){if(!g(Blob,"function")){return this}var J,G,P,L;G=this.choices;P="true";L="false";function O(Q,i){return Q+":	"+i+"\n"}J="---\n";if(this.settings.mode){J+=O("MODE",this.settings.mode)}if(this.scenario.name){J+=O("SCENARIO",this.scenario.name)}if(G.mirror){J+=O("MIRROR",G.mirror)}if(G.deployablemirror){J+=O("DEPLOYABLE",(G.deployablemirror?P:L))}if(G.uvmirror){J+=O("UVQUALITY",(G.uvmirror?P:L))}for(var I=0;I<G.instruments.length;I++){J+=O("INSTRUMENT-"+(I+1),G.instruments[I].wavelength+";"+G.instruments[I].type+";"+G.instruments[I].name)}if(G.cool.passive){J+=O("COOLING",(G.cool.passive=="yes"?P:L))}if(G.cool.active=="yes"){J+=O("COOLINGACTIVE",(G.cool.active=="yes"?P:L))}if(G.cool.cryogenic){J+=O("COOLINGCRYO",G.cool.cryogenic)}if(G.vehicle){J+=O("VEHICLE",G.vehicle)}if(G.site){J+=O("SITE",G.site)}if(G.mission){J+=O("DURATION",G.mission)}if(G.orbit){J+=O("ORBIT",G.orbit)}J+="---\n";var H=new Blob([J],{type:"text/plain"});var N="spacetelescope.txt";function M(i){document.body.removeChild(i.target)}var K=document.createElement("a");K.download=N;K.innerHTML="Download File";if(window.webkitURL!=null){K.href=window.webkitURL.createObjectURL(H)}else{K.href=window.URL.createObjectURL(H);K.onclick=M;K.style.display="none";document.body.appendChild(K)}K.click();return this};F.prototype.goForLaunch=function(){this.log("goForLaunch");if(!this.launchable){this.showView("designer");return this}if(this.stage=="launch"){e(".togglelaunch").hide();e("body").addClass("showlaunch");e("#launch").show();var G=this.phrases.designer.orbit.options[this.choices.orbit].label;var I=this.phrases.designer.vehicle.options[this.choices.vehicle].label;var i=this.phrases.designer.site.options[this.choices.site].label;var H=this.formatValue(this.table.time_dev_total.list.time_dev_total.value);e("#launch").html("<h2>"+this.phrases.launch.title+"</h2><p>"+this.phrases.launch.intro.replace(/%DEVTIME%/,H).replace(/%VEHICLE%/,I).replace(/%SITE%/,i).replace(/%ORBIT%/,G).replace(/%LAUNCHDATE%/,this.launchdate)+'</p><div id="launchanimation">'+('<div id="launchpadbg"><img src="images/launchpad_'+this.choices.site+'.png" /></div><div id="launchpadfg"><img src="images/launchpad_'+this.choices.site+'_fg.png" /></div><div id="launchrocket"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div>')+'<div id="countdown" class="padded">Countdown</div></div><div id="launchnav" class="toppadded"></div><ul id="launchtimeline" class="toppadded"></ul>');e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"});this.launchstep=0;if(this.launchstep==0){this.countdown(10)}}};F.prototype.countdown=function(G){this.launchstep=1;var H=this;if(G>0){e("#countdown").html('<div class="tick">'+this.phrases.launch.countdown[G.toFixed(0)]+"</div>");G--;if(!this.outtatime){clearTimeout(this.outtatime)}this.outtatime=setTimeout(function(){H.countdown(G)},1000)}else{e("#countdown").html(""+this.phrases.launch.countdown.liftoff);this.ok=true;this.okcool=true;this.temperature=this.copyValue(this.data.orbit[this.choices.orbit].temperature);this.launch()}};F.prototype.launch=function(){this.launchstep++;e("#launchnav").html('<a href="#" class="button fancybtn">'+this.phrases.launch.next+"</a>");var O={mirror:this.getChoice("mirror.prob"),site:this.getChoice("site.prob"),vehicle:this.getChoice("vehicle.prob"),cooling:this.getChoice("cooling.prob"),orbit:this.getChoice("orbit.prob"),mission:this.getChoice("mission.prob")};var W=this.phrases.launch.status;var R=true;var H=e("#launchtimeline");var M=e("#launchanimation");var ab=this.phrases;var aa=this.data;var Q=this.choices;function V(i){H.prepend(e(i).hide().fadeIn(1000))}if(this.ok){if(this.launchstep==2){this.ok=this.roll(O.site*O.vehicle);V("<li>"+this.buildRow(ab.launch.launch.label,(this.ok?ab.launch.launch.success:ab.launch.launch.fail),"launch_launch")+"</li>");if(this.ok){M.addClass(Q.vehicle).addClass("launched");this.exhaust=new B()}}else{this.exhaust.stop()}if(this.launchstep==3){this.ok=this.roll(O.orbit);V("<li>"+this.buildRow(ab.launch.orbit.label,(this.ok?ab.launch.orbit.success:ab.launch.orbit.fail).replace(/%ORBIT%/,this.getChoice("orbit")),"launch_orbit")+'<div id="launchorbit"></div></li>');if(this.ok){M.html("");this.launchanim=new E({id:"launchanimation",height:"50%",orbits:[Q.orbit],phrases:ab.designer.orbit,data:this.data.orbit,interactive:false});this.launchanim.resize()}}if(this.launchstep==4){this.ok=this.roll(O.mirror);V("<li>"+this.buildRow(ab.launch.deploy.label,(this.ok?ab.launch.deploy.success:ab.launch.deploy.fail),"launch_mirror")+"</li>");M.html("");this.launchanim=new D({id:"launchanimation",spacetel:this,height:"50%",state:{mirror:this.ok},colourize:{mirror:true,bus:false,cooling:{passive:false,cryogenic:false,active:false}}});this.launchanim.resize()}if(this.launchstep==5){var L=true;var U=true;var X="";var I=this.convertValue(Q.instrument.temp,"K");this.launchtherm=new o({canvas:this.launchanim.paper,required:I.value,phrasebook:{req:ab.designer.instruments.temperature,y:ab.ui.summary.profile.temperature},context:this,x:0,y:0,width:this.launchanim.paper.width*0.3,format:this.formatValue});if(Q.hascooling){if(Q.cool.temperature){var T=this.data.cooling.temperature[e("#cooling_temperature").val()];if(T.temperature){this.temperature=this.copyValue(T.temperature)}if(!T.risk){T.risk=1}L=this.roll(T.risk);X+="<li>"+this.buildRow(ab.launch.cooling.label.label,(L?ab.launch.cooling.label.success:ab.launch.cooling.label.fail),"launch_temperature")+"</li>";this.launchanim.state.cooling={passive:L,active:L,cryogenic:L};this.launchanim.colourize.cooling={passive:true,active:true,cryogenic:true};this.launchanim.build()}if(this.data.cooling.passive){X+="<li>"+this.buildRow(ab.launch.cooling.label.label,"","launch_cooling")+"</li>";p=Q.cool.passive;if(p=="yes"){L=this.roll(this.data.cooling.passive[p].risk);U=L;if(L){this.temperature.value*=this.data.cooling.passive[p].multiplier.temperature}X+='<li class="indent">'+this.buildRow(ab.launch.cooling.passive.label,(L?ab.launch.cooling.passive.success:ab.launch.cooling.passive.fail),"launch_passive")+"</li>";this.launchanim.state.cooling.passive=L;this.launchanim.colourize.cooling.passive=true;this.launchanim.build();if(this.data.cooling.active&&U){p=Q.cool.active;if(p=="yes"){L=this.roll(this.data.cooling.active[p].risk);if(L){this.temperature.value*=this.data.cooling.active[p].multiplier.temperature}X+='<li class="indent">'+this.buildRow(ab.launch.cooling.active.label,(L?ab.launch.cooling.active.success:ab.launch.cooling.active.fail),"launch_active")+"</li>";this.launchanim.state.cooling.active=L;this.launchanim.colourize.cooling.active=true;this.launchanim.build()}}if(this.data.cooling.cryogenic&&U){p=Q.cool.cryogenic;if(p&&p!="none"){L=this.roll(this.data.cooling.cryogenic[p].risk);if(L){this.temperature.value*=this.data.cooling.cryogenic[p].multiplier.temperature}X+='<li class="indent">'+this.buildRow(ab.launch.cooling.cryogenic.label,(L?ab.launch.cooling.cryogenic.success:ab.launch.cooling.cryogenic.fail),"launch_cryogenic")+"</li>";this.launchanim.state.cooling.cryogenic=L;this.launchanim.colourize.cooling.cryogenic=true;this.launchanim.build()}}}}this.launchtherm.value(this.temperature.value)}X+='<li class="indent">'+this.buildRow(ab.launch.cooling.achieved.label,(L?ab.launch.cooling.achieved.success:ab.launch.cooling.achieved.fail).replace(/\%TEMPERATURE%/,this.formatValue(this.temperature)))+"</li>";V(X)}if(this.launchstep==6){var J=0;var X="";if(Q.instruments){X+="<li>"+this.buildRow(ab.launch.instruments.label,"")+"</li>";this.beakers=[];var P=(this.launchanim.paper.height/(Q.instruments.length+1));for(var Y=0;Y<Q.instruments.length;Y++){this.beakers.push(new C({canvas:this.launchanim.paper,x:this.launchanim.paper.width*0.8,y:(P*(Y+1)-this.launchanim.paper.width*0.04),width:this.launchanim.paper.width*0.06,height:this.launchanim.paper.width*0.06,label:Q.instruments[Y].name}));var N=this.convertValue(this.data.wavelengths[Q.instruments[Y].wavelength].temperature,this.temperature.units);R=(N.value>=this.temperature.value)?true:false;Q.instruments[Y].ok=R;X+='<li class="indent">'+this.buildRow(Q.instruments[Y].name+" ("+ab.wavelengths[Q.instruments[Y].wavelength].label+" "+ab.designer.instruments.options.instrument[Q.instruments[Y].type].label+")",(R?ab.launch.instruments.success:ab.launch.instruments.fail),"launch_instrument")+"</li>"}this.launchanim.colourize.bus=true;this.launchanim.build()}V(X)}if(this.launchstep==7){var J=0;var X="";if(Q.instruments){X+="<li>"+this.buildRow(ab.launch.science.label,"")+"</li>";for(var Y=0;Y<Q.instruments.length;Y++){if(Q.instruments[Y].ok){var T=this.copyValue(this.data.instrument.options[Q.instruments[Y].type]);if(!T.risk){T.risk=1}T.risk*=O.mission;R=this.roll(T.risk);var G=100;if(!R){G=Math.random()*100}J+=G;this.beakers[Y].value(G/100);tmp=(R?ab.launch.science.success:ab.launch.science.fail).replace(/%PERCENT%/,this.formatValue(this.makeValue(G,"%")));X+='<li class="indent">'+this.buildRow(Q.instruments[Y].name+" ("+ab.wavelengths[Q.instruments[Y].wavelength].label+" "+ab.designer.instruments.options.instrument[Q.instruments[Y].type].label+")",tmp,"launch_science")+"</li>"}}if(Q.instruments.length>0){J/=Q.instruments.length}}tmp=(this.ok?ab.launch.overall.success:ab.launch.overall.fail).replace(/\%PERCENT%/,this.formatValue(this.makeValue(J,"%")));V(X);V("<li>"+this.buildRow(ab.launch.overall.label,tmp,"finalresult")+"</li>");e(".printable").remove();H.after('<div class="printable toppadded"><a href="#" class="button fancybtn">'+ab.designer.proposal.reprint+"</a></div>").fadeIn();e("#launchnav").html("");this.launchstep=0}}if(!this.ok){e("#launchnav a.button").remove();if(!this.relaunched){var S=this.table.time_dev_total.list.time_dev_total.value;var K=this.copyValue(S);K.value*=0.5;var Z=this.sumValues(this.getChoice("mirror.cost"),this.getChoice("satellite.cost"),this.getChoice("cooling.cost"),this.getChoice("instruments.cost"));Z.value*=0.5;Z=this.sumValues(Z,this.getChoice("vehicle.cost"));Z.value*=-1;e("#launchnav").html('<div class="relaunch toppadded"><p>'+ab.launch.relaunch.text.replace(/\%DEVTIME\%/,this.formatValue(S)).replace(/%RELAUNCHTIME%/,this.formatValue(K)).replace(/%RELAUNCHCOST%/,this.formatValueSpan(Z))+'</p><a href="#" class="button fancybtn">'+ab.launch.relaunch.label+"</a></div>")}else{e(".relaunch").remove()}}return this};F.prototype.relaunch=function(){this.relaunched=true;this.goForLaunch()};F.prototype.roll=function(i){if(!i){i=1}return(Math.random()>i)?false:true};F.prototype.setKey=function(G,i,H,I){for(z in G){if(z==i){G[z][H]=I;return G}else{if(G[z].list){G[z].list=this.setKey(G[z].list,i,H,I)}}}return G};F.prototype.updateTable=function(i,G,H){this.table=this.setKey(this.table,i,G,H);return this};F.prototype.convertValue=function(i,G){if(!g(i,"object")){return i}if(g(i.value,"string")&&i.value!="inf"){i.value=parseFloat(i.value,10)}i=this.copyValue(i);if(i.dimension=="length"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="ft"){i.value/=3.281}if(i.units=="km"){i.value*=1000}if(i.units=="mile"){i.value*=1609}if(i.units=="cubit"){i.value*=0.4572}if(i.units=="bluewhale"){i.value*=30}if(i.units=="yard"){i.value*=0.9144}if(G=="ft"){i.value*=3.281}if(G=="km"){i.value*=0.001}if(G=="mile"){i.value/=1609}if(G=="cubit"){i.value/=0.4572}if(G=="bluewhale"){i.value/=30}if(G=="yard"){i.value/=0.9144}i.units=G}if(i.units=="m"&&i.value>1000){i.value/=1000;i.units="km"}if(i.units=="ft"&&i.value>5280){i.value/=5280;i.units="mile"}if(i.units=="yard"&&i.value>5280){i.value/=5280;i.units="league"}}}else{if(i.dimension=="mass"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="lb"){i.value/=2.205}if(i.units=="t"){i.value*=1000}if(i.units=="elephant"){i.value*=5400}if(G=="lb"){i.value*=2.205}if(G=="t"){i.value/=1000}if(G=="elephant"){i.value/=5400}i.units=G}}}else{if(i.dimension=="temperature"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="C"){i.value+=273}else{if(i.units=="F"){i.value=(5/9)*(i.value-32)+273}}if(G=="C"){i.value-=273}else{if(G=="F"){i.value=(9/5)*(i.value-273)+32}}i.units=G}}}else{if(i.dimension=="time"){if(G=="years"||G=="months"||G=="days"||G=="hours"){if(i.units!=G){if(i.units=="months"){i.value/=12}else{if(i.units=="days"){i.value/=365.25}else{if(i.units=="hours"){i.value/=365.25*24}else{if(i.units=="minutes"){i.value/=365.25*24*60}}}}if(G=="months"){i.value*=12}else{if(G=="days"){i.value*=365.25}else{if(G=="hours"){i.value*=365.25*24}else{if(G=="minutes"){i.value*=365.25*24*60}}}}i.units=G}}}else{if(i.dimension=="angle"){if(G=="degrees"||G=="arcmin"||G=="arcsec"){if(i.units!=G){if(i.units=="arcmin"){i.value/=60}else{if(i.units=="arcsec"){i.value/=3600}}if(G=="arcmin"){i.value*=60}else{if(G=="arcsec"){i.value*=3600}}i.units=G}}}else{if(i.dimension=="currency"){if(this.data.currency[G]){if(i.units!=G){if(i.value!="inf"){if(this.data.currency[i.units].conv){i.value/=this.data.currency[i.units].conv}if(this.data.currency[G].conv){i.value*=this.data.currency[G].conv}}i.units=G}}}}}}}}return i};F.prototype.sumValues=function(){var I=Array.prototype.slice.call(arguments,0);var G,H,J;if(I.length>0){H=this.convertValue(I[0],I[0].units);for(J=1;J<I.length;J++){if(g(I[J],"object")&&I[J].dimension&&I[J].dimension===H.dimension){G=this.convertValue(I[J],I[0].units);H.value+=G.value}}return H}return{}};F.prototype.negativeValue=function(){var I=Array.prototype.slice.call(arguments,0);var G,H,J;if(I.length>0){H=this.copyValue(I[0]);H.value*=-1;return H}return{}};F.prototype.minValue=function(){var H=Array.prototype.slice.call(arguments,0);var G,J,I;if(H.length>0){I=this.convertValue(H[0],H[0].units);for(J=1;J<H.length;J++){if(g(H[J],"object")&&H[J].dimension&&H[J].dimension===H[0].dimension){G=this.convertValue(H[J],H[0].units);if(G.value<I.value){I=G}}}return I}return{}};function c(i){if(i<1e-9){return 1}if(g(i,"number")&&i<1){return Math.ceil(Math.log10(1/i))+1}else{return 1}return 1}F.prototype.formatValue=function(H,L){if(g(H,"string")||g(H,"number")){return H}if(!(g(H,"object")&&H.dimension)){return""}ph=this.phrases;H=this.copyValue(H);if(g(L,"string")){L=parseInt(L,10)}var J;var K=H.dimension;if(K=="length"){H=this.convertValue(H,(this.settings.length)?this.settings.length:"m");if(!g(L,"number")){L=(H.units=="km"?0:c(H.value))}J=(ph.ui.units[H.units])?ph.ui.units[H.units].unit:"";if(H.value>1000000000000000){return b(H.value,J)}return""+f((H.value).toFixed(L)).replace(/\.0+$/,"").replace(/(\.0?[1-9]+)0+$/,"$1")+""+J}else{if(K=="mass"){H=this.convertValue(H,(this.settings.mass)?this.settings.mass:"kg");J=(ph.ui.units[H.units])?ph.ui.units[H.units].unit:"";if(!g(L,"number")){L=(H.value>=1000)?0:c(H.value)}if(H.value>1000000000000000){return b(H.value,J)}else{return""+f((H.value).toFixed(L)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+""+J}}else{if(K=="currency"){H=this.convertValue(H,(this.settings.currency)?this.settings.currency:"GBP");if(!g(L,"number")){L=0}var i=(ph.ui.million.compact)?ph.ui.million.compact:"";var I=(ph.ui.currency[H.units]&&ph.ui.currency[H.units].symbol)?ph.ui.currency[H.units].symbol:(ph.ui.currency.GBP.symbol?ph.ui.currency.GBP.symbol:"");if(H.value=="inf"||H.value>=1000000000000000){return"&infin;"}var G=(H.value<0)?"-":"";H.value=Math.abs(H.value);if(H.value>=1000){H.value/=1000;i=(ph.ui.billion.compact)?ph.ui.billion.compact:""}if(L==0){if(H.value<100){L=1}if(H.value<10){L=2}}var M=(H.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1").replace(/^ /,"&thinsp;");return G+I+M+i}else{if(K=="temperature"){H=this.convertValue(H,(this.settings.temperature)?this.settings.temperature:"K");if(g(L,"string")){L=parseInt(L,10)}if(!g(L,"number")){L=(H.value>1000)?0:c(H.value)}J=(ph.ui.units[H.units])?ph.ui.units[H.units].unit:"";if(g(H.value,"string")){H.value=parseInt(H.value,10)}return""+f((H.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+J}else{if(K=="time"){if(H.units=="years"&&H.value<5){H=this.convertValue(H,"months")}if(!g(L,"number")){L=(H.value>=6)?0:c(H.value)}J=(ph.ui.units[H.units])?ph.ui.units[H.units].unit:"";if(g(H.value,"string")){H.value=parseInt(H.value,10)}return""+f((H.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+J}else{if(K=="percent"){H=H.value;if(!g(H,"number")){H=parseInt(H,10)}if(!g(H,"number")){return"0"+J}if(!g(L,"number")){L=1}J=(ph.ui.units[H.units])?ph.ui.units[H.units].unit:"%";return""+f(H.toFixed(L)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+J}else{if(K=="angle"){if(H.units=="degrees"&&H.value<1){H=this.convertValue(H,"arcmin")}if(H.units=="arcmin"&&H.value<1){H=this.convertValue(H,"arcsec")}if(!g(L,"number")){L=(H.value>=10)?0:c(H.value)}J=(ph.ui.units[H.units])?ph.ui.units[H.units].unit:"";if(g(H.value,"string")){H.value=parseInt(H.value,10)}return""+f((H.value).toFixed(L).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+J}else{return H.value}}}}}}}};F.prototype.makeValue=function(i,G,H){if(!H){if(this.phrases.ui.units[G]){H=this.phrases.ui.units[G].dimension}else{if(this.phrases.ui.currency[G]){H="currency"}else{H="unknown"}}}return{value:i,units:G,dimension:H}};F.prototype.formatPercent=function(i,G){if(!g(i,"number")){i=0}if(!g(G,"number")){G=1}return""+f((i*100).toFixed(G)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+"%"};F.prototype.toggleFullScreen=function(){this.elem=document.getElementById("application");if(s.isFullScreen()){s.cancelFullScreen(this.elem);this.fullscreen=false;e("#application").removeClass("fullscreen")}else{s.requestFullScreen(this.elem);this.fullscreen=true;e("#application").addClass("fullscreen")}return this};F.prototype.parseChoices=function(P,ac){P=(P&&P.indexOf("designer_")==0)?P.substr(9):"";this.log("parseChoices",P);var Z,X,O,af,R,N,S,U,W,Q,ab,T,ae,I,ai,G;this.errors=[];this.warnings=[];var M=this.choices;var ad=this.data;Z=e("#mission_duration").val();M.mission=(Z&&ad.mission[Z])?Z:"";X=e("#mirror_size").val();M.mirror=(X&&ad.mirror[X])?X:"";G=e("input[name=toggledeployable]:checked").val();M.deployablemirror=(G&&G=="yes")?true:false;O=e("input[name=toggleuv]:checked").val();M.uvmirror=(O&&O=="yes")?true:false;N=e("#designer_vehicle input[name=vehicle_rocket]:checked").val();M.vehicle=(N&&ad.vehicle[N])?N:"";S=e("#site").val();Q=false;M.site=(S&&ad.site[S])?S:"";W=e("#mission_orbit").val();if(W&&ad.orbit[W]){M.orbit=W}else{M.orbit=""}af=e("input[name=hascooling]:checked").val();M.hascooling=(af&&af=="yes")?true:false;M.cool={};R=e("#cooling_temperature").val();M.cool.temperature=(R)?R:"";M.cool.passive=this.getValue("input[name=cooling_passive]:checked");M.cool.active=this.getValue("input[name=cooling_active]:checked");M.cool.cryogenic=e("#cooling_cryogenic").val();M.temperature=this.makeValue(400,"K");M.instrument={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),temp:this.makeValue(400,"K"),time:this.makeValue(0,"months"),risk:1};if(M.instruments){var H=false;for(var aa=0;aa<M.instruments.length;aa++){var R=this.copyValue(ad.instrument.options[M.instruments[aa].type]);if(!R.multiplier){R.multiplier={}}if(!R.multiplier.cost){R.multiplier.cost=1}if(!R.multiplier.mass){R.multiplier.mass=1}var K=this.copyValue(ad.wavelengths[M.instruments[aa].wavelength]);if(K.cost){K.cost.value*=R.multiplier.cost}M.instrument.cost=this.sumValues(M.instrument.cost,K.cost);if(K.mass){M.instrument.mass=this.sumValues(M.instrument.mass,K.mass)}M.instrument.mass.value*=R.multiplier.mass;M.instrument.temp=this.minValue(M.instrument.temp,K.temperature);if(R.devtime){M.instrument.time=this.sumValues(M.instrument.time,R.devtime)}if(R.risk){M.instrument.risk*=R.risk}if(M.instruments[aa].wavelength=="uv"){H=true}}var L=(M.mirror)?ad.mirror[M.mirror].bus.instrumentslots:0;if(M.instruments.length>L){this.errors.push({text:this.phrases.errors.slots,link:"#designer_instruments"})}if(!M.uvmirror&&H){this.errors.push({text:this.phrases.errors.uv,link:"#designer_satellite"})}}if(M.site){if(M.vehicle){for(var aa=0;aa<ad.vehicle[M.vehicle].sites.length;aa++){if(ad.vehicle[M.vehicle].sites[aa]==S){Q=true}}}else{Q=true}if(!Q){this.errors.push({text:this.phrases.errors.site.replace(/%SITE%/g,this.phrases.designer.site.options[S].label).replace(/%VEHICLE%/,this.phrases.designer.vehicle.options[N].label),link:"#designer_site"})}}if(M.vehicle&&M.mirror){var J=this.copyValue(ad.vehicle[M.vehicle].diameter);var Y=this.copyValue(ad.mirror[M.mirror].bus.diameter);if(M.deployablemirror&&ad.deployablemirror.multiplier.bus.diameter){Y.value*=ad.deployablemirror.multiplier.bus.diameter}if(Y.value>J.value){this.errors.push({text:this.phrases.errors.size,link:"#designer_satellite"})}}if(M.orbit){Q=false;if(M.site){Q=ad.site[M.site].orbits[W]}else{Q=true}if(!Q){this.errors.push({text:this.phrases.errors.orbit.replace(/%SITE%/g,this.phrases.designer.site.options[S].label).replace(/%ORBIT%/,this.phrases.designer.orbit.options[W].label),link:"#designer_orbit"})}M.temperature=this.copyValue(ad.orbit[M.orbit].temperature)}M.cooling={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),life:this.makeValue(99,"years"),time:this.makeValue(0,"months"),risk:1};if(M.hascooling){if(M.cool.temperature){R=ad.cooling.temperature[e("#cooling_temperature").val()];if(R.temperature){M.temperature=this.copyValue(R.temperature)}if(R.mass){M.cooling.mass=this.sumValues(M.cooling.mass,R.mass)}if(R.cost){M.cooling.cost=this.sumValues(M.cooling.cost,R.cost)}if(R.devtime){M.cooling.time=this.sumValues(M.cooling.time,R.devtime)}if(R.life){M.cooling.life=this.minValue(M.cooling.life,R.life)}if(R.risk){M.cooling.risk*=R.risk}if(M.mirror&&ad.mirror[X]["passive"]){M.cooling.mass=this.sumValues(M.cooling.mass,ad.mirror[X]["passive"].mass);M.cooling.cost=this.sumValues(M.cooling.cost,ad.mirror[X]["passive"].cost);M.cooling.time=this.sumValues(M.cooling.time,ad.mirror[X]["passive"].devtime)}}if(ad.cooling.passive){U=M.cool.passive;if(U=="yes"){M.cooling.time=this.sumValues(M.cooling.time,ad.cooling.passive[U].devtime);if(M.mirror&&ad.mirror[M.mirror].passive){M.cooling.mass=this.sumValues(M.cooling.mass,ad.mirror[M.mirror].passive.mass);M.cooling.passive=ad.mirror[M.mirror].passive.mass;M.cooling.cost=this.sumValues(M.cooling.cost,ad.mirror[M.mirror].passive.cost)}M.cooling.mass.value*=ad.cooling.passive[U].multiplier.mass;M.cooling.cost.value*=ad.cooling.passive[U].multiplier.cost;M.cooling.risk*=ad.cooling.passive[U].risk;M.temperature.value*=ad.cooling.passive[U].multiplier.temperature;if(ad.cooling.passive[U].life){M.cooling.life=this.minValue(M.cooling.life,ad.cooling.passive[U].life)}if(M.orbit){M.cooling.life.value*=ad.orbit[M.orbit].multiplier.passive.time;if(ad.orbit[M.orbit].multiplier.cryo.time==0){this.errors.push({text:this.phrases.errors.hotorbitpassive,link:"#designer_orbit"})}}if(ad.cooling.active){U=M.cool.active;if(U=="yes"){M.cooling.time=this.sumValues(M.cooling.time,ad.cooling.active[U].devtime);M.cooling.cost=this.sumValues(M.cooling.cost,ad.cooling.active[U].cost);M.cooling.mass=this.sumValues(M.cooling.mass,ad.cooling.active[U].mass);M.cooling.active=ad.cooling.active[U].mass;M.cooling.risk*=ad.cooling.active[U].risk;M.temperature.value*=ad.cooling.active[U].multiplier.temperature;if(ad.cooling.active[U].life){M.cooling.life=this.minValue(M.cooling.life,ad.cooling.active[U].life)}}}M.cooling.cryogeniclife=0;if(ad.cooling.cryogenic){U=M.cool.cryogenic;if(U&&U!="none"){M.cooling.time=this.sumValues(M.cooling.time,ad.cooling.cryogenic[U].devtime);M.cooling.cost=this.sumValues(M.cooling.cost,ad.cooling.cryogenic[U].cost);M.cooling.mass=this.sumValues(M.cooling.mass,ad.cooling.cryogenic[U].mass);M.cooling.cryogenic=ad.cooling.cryogenic[U].mass;M.cooling.risk*=ad.cooling.cryogenic[U].risk;M.temperature.value*=ad.cooling.cryogenic[U].multiplier.temperature;if(ad.cooling.cryogenic[U].life){M.cooling.life=this.minValue(M.cooling.life,ad.cooling.cryogenic[U].life);M.cooling.cyrogeniclife=this.convertValue(ad.cooling.cryogenic[U].life,"years");M.cooling.cyrogeniclife=M.cooling.cyrogeniclife.value}if(M.orbit){M.cooling.life.value*=ad.orbit[M.orbit].multiplier.cryo.time;var V=ad.orbit[M.orbit].multiplier.cryo.time;if(V==0){this.errors.push({text:this.phrases.errors.hotorbitcryo,link:"#designer_orbit"})}if(V<1&&V>0){this.warnings.push({text:this.phrases.warnings.warmorbitcryo,link:"#designer_orbit"})}}}}}else{if(ad.cooling.active&&this.getValue("input[name=cooling_active]:checked")=="yes"&&U=="no"){this.warnings.push({text:this.phrases.warnings.activenopassive,link:"#designer_cooling"})}if(ad.cooling.cryogenic&&this.getValue("#cooling_cryogenic")!="none"&&U=="no"){this.warnings.push({text:this.phrases.warnings.cryonopassive,link:"#designer_cooling"})}}}}var ah=this.convertValue(M.instrument.temp,"K");var ag=this.convertValue(M.temperature,"K");if(ag.value>ah.value){this.errors.push({text:this.phrases.errors.temperature.replace(/%TEMPERATURE%/,"<strong>"+this.formatValue(ag)+"</strong>").replace(/%REQUIREMENT%/,"<strong>"+this.formatValue(ah)+"</strong>"),link:"#designer_cooling"})}if(this.proposalCompleteness()<1){this.warnings.push({text:this.phrases.warnings.proposal,link:"#designer_proposal"})}this.choices=M;this.updateSummary().updateSidePanels().updateMessages("error",this.errors).updateMessages("warning",this.warnings);return this};F.prototype.updateMessages=function(J,K){this.log("updateMessages",K);if(J!="error"&&J!="warning"){return this}var G="";var H=0;if(K&&typeof K=="object"&&K.length>0){H=K.length;for(var I=0;I<K.length;I++){G+="<li>"+K[I].text+(K[I].link?' <a href="'+K[I].link+'">'+this.phrases.ui[J].link+"</a>":"")+"</li>"}}e("."+J+".value").html(H);e("#messages h3."+J).next().html(G);if(H==0){e(".toggle"+J+",."+J+"s").hide()}else{e(".toggle"+J+",."+J+"s").show()}return this};F.prototype.toggleView=function(i,G){this.log("toggleView",i);if(!e("#"+i).is(":visible")){this.showView(i,G)}else{this.showView(G)}return this};F.prototype.showView=function(i,I,G){this.log("showView",i,I);if(g(i,"object")){I=i;i=""}if(!g(i,"string")){i=""}if(i=="messages"||i=="menu"||i=="language"||i=="options"||i.indexOf("summaryext")==0){if(I&&g(I,"object")&&g(I.preventDefault,"function")){I.preventDefault()}if(i=="options"){if(I){I.preventDefault()}this.updateOptions();e("#summaryext").hide();this.showModal(e("#options"));e("body").addClass("showoptions")}return this}e(".view").hide();e("body").removeClass("showguide showintro showoptions showmessages");if(i.indexOf("designer")==0&&!this.scenario){i="intro"}if((i.indexOf("guide")==0&&i.length==5)||i.indexOf("guide_")==0){e("#summaryext").hide();this.showGuide(i);e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide")}else{if((i.indexOf("designer")==0&&i.length==8)||i.indexOf("designer_")==0){e("#summaryext").hide();if(i.indexOf("designer_")==0){var H=i.substr(i.indexOf("designer_")+9);e("#menubar li").removeClass("on");e("#menubar a.toggle"+H).parent().addClass("on");e(".designer .designer_content").hide();e("#"+i+" .designer_content").show();e("#designer").show();if(e("#"+i).find("a").is(":visible")){e("#"+i).find("a:visible").eq(0).focus()}else{if(e("#"+i).find("input")){e("#"+i).find("input").eq(0).focus()}else{e("#menubar a.toggle"+H).focus()}}if(H=="orbit"){this.makeSpace("orbits").displayOrbits()}else{this.removeOrbits()}if(H=="proposal"){this.updateProposal()}}else{e("#designer").show().find("a").eq(0).focus()}this.updateBodyClass("showdesigner");this.setScroll("#"+i);this.stage="designer"}else{if(i=="intro"){e("#summaryext").hide();e("#intro").show();this.updateBodyClass("showintro");this.stage="intro";this.startup()}else{if(i=="scenarios"){e("#summaryext").hide();e("#scenarios").show();this.updateBodyClass("showscenarios");this.stage="scenarios"}else{if(i=="launch"){e("#summaryext").hide();this.updateMessages("error",{}).updateMessages("warning",{});this.updateBodyClass("showlaunch");this.goForLaunch();this.stage="launch"}else{e("#"+this.stage).show();this.updateBodyClass("show"+this.stage)}}}}}if(this.pushstate&&!I){history.pushState({},"Guide","#"+i)}if(g(G,"function")){G.call(this)}return this};F.prototype.setScroll=function(H){this.log("setScroll",H);var i=e("#bar");var I=(i.is(":visible"))?i.outerHeight():0;var G=0;if(H&&e(H).length==1){G=Math.floor(e(H).offset().top-I);if(G<0){G=0}}e(window).scrollTop(G);return this};F.prototype.toggleGuide=function(i,G){this.log("toggleGuide",i);if(g(i,"object")){G=i;i=""}if(!e("#guide").is(":visible")){if(!i){i="guide"}this.showView(i)}else{this.showView()}return this};F.prototype.closeGuide=function(){this.log("closeGuide");e("body").removeClass("showguide");e("#guide").hide();e("#intro").show();return this};F.prototype.showGuide=function(R){this.log("showGuide",R);var H=R;if(g(R,"string")){var Q=R.split("_");if(Q.length>1&&this.phrases.guide[Q[1]]){R=Q[1]}}var L="";var M=this.phrases.guide;var S,N,T,K,G;if(R){e("body").addClass("showguide");e("#guide").show();if(e("#guide").length==0){e("#page").append('<div id="guide" class="view"></div>')}if(R=="guide"){L+="<h2>"+this.phrases.guide.title+"</h2><p>"+this.phrases.guide.about+'</p><ul class="index">';for(k in this.phrases.guide){if(k!="title"&&k!="about"&&g(this.phrases.guide[k].title,"string")){L+='<li><a href="#guide_'+k+'" class="guidelink">'+this.phrases.guide[k].title+"</a><br />"+(g(this.phrases.guide[k].summary,"string")?this.phrases.guide[k].summary:"")+"</li>"}}L+="</ul>"}else{if(M[R]){L+='<div class="guidetop"><span class="breadcrumb"><a href="#guide" class="guidelink">'+M.title+"</a> &raquo; "+M[R].title+"</span></div>";K=M[R].about;var I=this.data.mirror;if(R=="mirror"){T="";for(z in I){T+="<tr>";T+="<td>"+this.formatValue(I[z].diameter)+"</td>";T+="<td>"+this.formatValue(I[z].mass)+"</td>";T+="<td>"+this.formatValue(I[z].cost)+"</td>";if(this.settings.mode=="advanced"){T+="<td>"+this.formatValue(I[z].devtime)+"</td>"}T+="</tr>"}K=K.replace(/\%MIRRORTABLE\%/,T)}else{if(R=="structure"){T="";for(z in I){T+="<tr>";T+="<td>"+this.formatValue(I[z].diameter)+"</td>";T+="<td>"+this.formatValue(I[z].bus.diameter)+"</td>";T+="<td>"+this.formatValue(I[z].bus.cost)+"</td>";T+="<td>"+this.formatValue(I[z].bus.mass)+"</td>";T+="</tr>"}K=K.replace(/\%STRUCTURETABLE\%/,T)}else{if(R=="cooling"){T="";var P=this.data.cooling;if(this.settings.mode=="advanced"){for(z in P.cryogenic){if(z!="none"){T+="<tr>";T+="<td>"+this.formatValue(P.cryogenic[z].life)+"</td>";T+="<td>"+this.formatValue(P.cryogenic[z].cost)+"</td>";T+="<td>"+this.formatValue(P.cryogenic[z].mass)+"</td>";T+="</tr>"}}K=K.replace(/\%ACTIVELIFE\%/,this.formatValue(P.active.yes.life));K=K.replace(/\%ACTIVEMASS\%/,this.formatValue(P.active.yes.mass));K=K.replace(/\%ACTIVECOST\%/,this.formatValue(P.active.yes.cost))}else{for(z in P.temperature){T+="<tr>";T+="<td>"+this.formatValue(P.temperature[z].temperature)+"</td>";T+="<td>"+this.formatValue(P.temperature[z].cost)+"</td>";T+="<td>"+this.formatValue(P.temperature[z].mass)+"</td>";T+="</tr>"}}K=K.replace(/\%COOLINGTABLE\%/,T)}else{if(R=="instruments"){T="";for(z in this.data.wavelengths){if(z!="none"){T+="<tr>";T+="<td>"+this.phrases.wavelengths[z].label+"</td>";T+="<td>"+this.formatValue(this.data.wavelengths[z].temperature)+"</td>";T+="</tr>"}}K=K.replace(/\%WAVELENGTHTABLE\%/,T);if(this.settings.mode=="advanced"){T="";for(z in this.data.instrument.options){if(z!="none"){T+="<tr>";T+="<td>"+this.phrases.designer.instruments.options.instrument[z].label+"</td>";T+="<td>"+this.formatValue(this.data.instrument.options[z].multiplier.mass)+"</td>";T+="<td>"+this.formatValue(this.data.instrument.options[z].multiplier.cost)+"</td>";T+="<td>"+this.formatValue(this.data.instrument.options[z].devtime)+"</td>";T+="</tr>"}}K=K.replace(/\%INSTRUMENTTABLE\%/,T)}}else{if(R=="orbit"){T="";for(z in this.data.orbit){T+="<tr>";T+="<td>"+this.phrases.designer.orbit.options[z].label+"</td>";T+="<td>"+(this.phrases.designer.orbit.options[z].altitude?this.phrases.designer.orbit.options[z].altitude:"")+this.formatValue(this.data.orbit[z].altitude,0)+"</td>";T+="<td>"+this.formatValue(this.data.orbit[z].period)+"</td>";T+="<td>"+(this.data.orbit[z].obsfrac*100)+"%</td>";T+="<td>"+this.formatValue(this.data.orbit[z].temperature)+"</td>";T+="</tr>"}K=K.replace("%ORBITTABLE%",T);for(z in this.data.orbit){K=K.replace("%"+z+"ANCHOR%","guide_orbit_"+z);K=K.replace("%"+z+"LABEL%",this.phrases.designer.orbit.options[z].label);K=K.replace("%"+z+"GROUNDCOST%",this.formatValue(this.data.orbit[z].groundcost));K=K.replace("%"+z+"FUELLIFE%",this.formatValue(this.data.orbit[z].fuellife));K=K.replace("%"+z+"ALTITUDE%",this.formatValue(this.data.orbit[z].altitude));K=K.replace("%"+z+"PERIOD%",this.formatValue(this.data.orbit[z].period));K=K.replace("%"+z+"CRYOREDUCTION%",(100*(1-this.data.orbit[z].multiplier.cryo)).toFixed(0)+"%")}}else{if(R=="vehicle"){T="";for(z in this.data.vehicle){T+="<tr>";T+="<td>"+this.phrases.designer.vehicle.options[z].label+"</td>";T+="<td>"+this.formatValue(this.data.vehicle[z].diameter,0)+"</td>";T+="<td>"+this.formatValue(this.data.vehicle[z].mass.LEO,0)+"</td>";T+="<td>"+this.formatValue(this.data.vehicle[z].mass.GTO,0)+"</td>";T+="<td>"+this.formatValue(this.data.vehicle[z].cost,0)+"</td>";T+="<td>"+this.phrases.operator[this.data.vehicle[z].operator].label+"</td>";if(this.settings.mode=="advanced"){T+="<td>"+(this.data.vehicle[z].risk*100)+"%</td>"}T+="</tr>"}K=K.replace(/\%ROCKETTABLE\%/,T)}else{if(R=="site"){T="";for(z in this.data.site){T+="<tr>";T+="<td>"+this.phrases.designer.site.options[z].label+"</td>";T+="<td>"+this.phrases.designer.site.options[z].trajectories+"</td>";T+="<td>";var J="";for(var i in this.data.vehicle){for(var U=0;U<this.data.vehicle[i].sites.length;U++){if(this.data.vehicle[i].sites[U]==z){if(J.length>0){J+=", "}J+=""+this.phrases.designer.vehicle.options[i].label+""}}}T+=J;T+="</td>";T+="</tr>"}K=K.replace(/\%SITETABLE\%/,T)}}}}}}}if(K.indexOf("<p>")<0){K="<p>"+K+"</p>"}L+='<h2 id="guide_'+R+'">'+M[R].title+"</h2>"+K+'<div class="clearall" /></div>';if(R=="roles"){for(k in M[R]){if(k!="title"&&k!="about"&&g(M[R][k].title,"string")){L+="<h3>"+M[R][k].title+"</h3><p>"+M[R][k].about+"</p>"}}}else{if(R=="previous"){for(k in M[R]["missions"]){if(g(M[R]["missions"][k].title,"string")){N="<ul>";for(z in M[R]["missions"][k]){if(z!="title"&&z!="image"){S=this.formatValue(M[R]["missions"][k][z]);N+='<li><span class="key">'+M[R][z]+'</span> <span class="value">'+S+"</span></li>"}}N+="</ul>";L+='<h3 id="guide_'+R+"_"+k+'">'+M[R]["missions"][k].title+"</h3>";if(M[R]["missions"][k]["image"]){L+='<figure class="right"><img src="'+M[R]["missions"][k]["image"].src+'" alt="'+M[R]["missions"][k]["title"]+'" /><figcaption>'+M[R]["missions"][k]["title"]+"</figcaption></figure>"}L+="";L+=N}}}}}}if(M[R]&&M[R].questions){G='<h3 id="guide_'+R+'_questions">Questions</h3><ol>';for(z=0;z<M[R].questions.length;z++){G+="<li>"+M[R].questions[z].label.replace("%EARTHRADIUS%",this.formatValue({value:6500,units:"km",dimension:"length"})).replace("%EARTHMASS%",this.formatValue({value:6e+24,units:"kg",dimension:"mass"}))+"</li>"}G+="</ol>";L+=G}e("#guide").html(L);if(L.indexOf("script")>=0&&g(MathJax,"object")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"guide"])}this.addCloser(e("#guide"),{me:this},function(V){V.preventDefault();V.data.me.toggleGuide()});var O=this;e("#guide").show(function(){O.setScroll("#"+H)});e("#intro").hide()}else{this.closeGuide()}e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide");return this};F.prototype.updateBodyClass=function(i){e("body").removeClass("showguide showintro showoptions showmessages showlaunch").addClass(i);return this};F.prototype.addCloser=function(H,I,G){var i=location.href.split("#")[1];if(H.find(".close").length==0){H.prepend('<a href="#" class="close" title="Close"><img src="images/cleardot.gif" class="icon close" /></a>')}if(H.attr("id")!="guide"&&H.attr("id").indexOf(i)!=0){H.find("a.close").attr("href","#"+i)}H.find("a img.close").parent().on("click",I,G);return this};F.prototype.showModal=function(I){var G=e(window).width();var J=e(window).height();var i=0;var H=0;I.show().find("a").eq(0).focus();this.positionModal(I);this.modal=I;return this};F.prototype.closeModal=function(i){i.hide();e("#modalbg").hide();e("body").css("overflow-y","auto");this.modal=undefined;return this};F.prototype.positionModal=function(i){w(i);e("#modalbg").hide().css({left:0,top:0,height:e(document).height(),width:e(document).width()}).show().off("click").on("click",{me:this},function(G){G.data.me.closeModal(i)});return this};F.prototype.log=function(){var i=Array.prototype.slice.call(arguments,0);if(console&&g(console.log,"function")){console.log("LOG",i)}return this};function D(H){if(!H){H={}}if(H.spacetel){this.s=H.spacetel}else{return this}this.heightscale="";this.prop={mirror:0,bus:0,slots:0};this.id=(g(H.id,"string"))?H.id:"sidebar_satellite";if(!this.el){this.el=e("#"+this.id)}if(this.el.find("#"+this.id+"_schematic").length==0){this.el.html('<div class="schematic" id="'+this.id+'_schematic"></div>')}if(g(H.height,"string")&&H.height.indexOf("%")>0){this.heightscale=parseFloat(H.height)/100}this.state={cooling:{passive:true,active:true,cryogenic:true},mirror:true,bus:true};if(g(H.state,"object")){for(var G in H.state){this.state[G]=H.state[G]}}this.colourize={cooling:{passive:false,active:false,cryogenic:true},mirror:false,bus:true};if(g(H.colourize,"object")){for(var G in H.colourize){this.colourize[G]=H.colourize[G]}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}D.prototype.getScales=function(P,N){var K=Math.floor(P/32);var G=K*(this.prop.bus/this.prop.mirror);var L=8;var H=2;var J=10*G;var Q=(this.s.choices.cooling.cryogenic?this.s.choices.cooling.cyrogeniclife:0);if(Q==0&&this.s.choices.cool.temperature){var R=this.s.convertValue(this.s.choices.temperature,"K");if(R.value<50){Q=Math.log(50/R.value)}}var O=4;var I=((L+O+Q)*K);var i=13*K;var M=(this.s.choices.cooling.passive?2*K:0);if(this.s.choices.cool.temperature){var R=this.s.convertValue(this.s.choices.temperature,"K");if(R.value<300){M=2*K}}h=(this.s.choices.mirror)?J+I+i+M+(2*N):0;return{body:I,vgroove:M,bus:J,mirror:i,h:h,fb:G,f:K,top:O,bodyh:L,tank:Q,instrument:H}};D.prototype.build=function(){var af=160;var S=this.el.parent().innerWidth();var aj;var am=Math.cos(Math.PI*30/180);if(this.s.choices.mirror){for(var aa in this.s.data.mirror){aj=this.s.convertValue(this.s.data.mirror[aa].diameter,"m");if(aa==this.s.choices.mirror){this.prop.mirror=aj.value}}for(var aa in this.s.data.mirror){aj=this.s.convertValue(this.s.data.mirror[aa].bus.diameter,"m");if(aa==this.s.choices.mirror){this.prop.bus=aj.value;if(this.s.choices.deployablemirror&&this.s.data.deployablemirror.multiplier.bus.diameter){this.prop.bus*=this.s.data.deployablemirror.multiplier.bus.diameter}this.prop.slots=this.s.data.mirror[aa].bus.instrumentslots}}}var L=16;var an;if(this.heightscale){an=this.getScales(200,L);S=(S*this.heightscale)*200/an.h}an=this.getScales(S,L);var X=an.fb;var ah=an.f;var M=an.bodyh;var I=an.tank;var G=an.top;var H=an.instrument;af=(this.s.choices.mirror)?an.bus+an.body+an.mirror+an.vgroove+(2*L):0;if(this.heightscale){this.create(S,S*this.heightscale)}else{this.create("auto",af)}if(this.bus){this.bus.remove();delete this.bus}if(this.body){this.body.remove();delete this.body}if(this.vgroove){this.vgroove.remove();delete this.vgroove}if(this.mirror){this.mirror.remove();delete this.mirror}var ai={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};var ao={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};var N={stroke:"white","stroke-width":1};var T,ae;var V=this.paper;if(this.s.choices.mirror){this.bus=V.set();this.bus.push(V.ellipse(0,3.5*X,10*X,6*X).attr(ai));this.bus.push(V.path("m "+(-8.5*X)+", "+(-2*X)+" l0,"+(4*X)+" l"+(5*X)+","+(3*X)+" l"+(7*X)+",0 l"+(5*X)+","+(-3*X)+" l0,"+(-4*X)+" l"+(-5*X)+","+(-3*X)+" l"+(-7*X)+",0 z").attr(ai));this.bus.push(V.path("m "+(-8.5*X)+", "+(2*X)+" l0,"+(3.5*X)+" l"+(5*X)+","+(3*X)+" l0,"+(-3.5*X)+" z").attr(ai));this.bus.push(V.path("m "+(-3.5*X)+", "+(5*X)+" l"+(7*X)+",0 l0,"+(3.5*X)+" l"+(-7*X)+",0 z").attr(ai));this.bus.push(V.path("m "+(8.5*X)+", "+(2*X)+" l0,"+(3.5*X)+" l"+(-5*X)+","+(3*X)+" l0,"+(-3.5*X)+" z").attr(ai))}if(an.vgroove>0){ae={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};if(this.colourize.cooling.passive){ae.fill=(this.state.cooling.passive)?e(".mass").css("color"):"black";ae["fill-opacity"]=0.5}this.vgroove=V.set();this.vgroove.push(V.ellipse(0,-0.6*X,8.5*X,5*X).attr(ae));this.vgroove.push(V.ellipse(0,-1.2*X,8.25*X,4.75*X).attr(ae));this.vgroove.push(V.ellipse(0,-1.8*X,8*X,4.5*X).attr(ae));this.vgroove.push(V.path("m 0,"+(-0.6*X)+" l"+(-5.5*X)+","+(2.5*X)+" m"+(5.5*X)+","+(-2.5*X)+" l"+(1.5*X)+","+(3.5*X)+" m"+(-1.5*X)+","+(-3.5*X)+" l"+(8*X)+","+(-X)+" m"+(-8*X)+","+(X)+" l"+(5*X)+","+(-5*X)+" m"+(-5*X)+","+(5*X)+" l"+(-2*X)+","+(-5.5*X)+" m"+(2*X)+","+(5.5*X)+" l"+(-7*X)+","+(-3*X)).attr({stroke:"white","stroke-width":1,"stroke-opacity":0.4}))}if(this.s.choices.mirror){this.body=V.set();var ag=Math.min(7,8.5*(this.prop.bus/this.prop.mirror));var al=ag*0.4;var J=(ag-al);this.body.push(V.ellipse(0,0,ag*ah,J*ah).attr(N));this.body.push(V.path("m "+(-ag*ah)+",0 a "+(ag*ah)+","+(J*ah)+" 0 0,0 "+(2*ag*ah)+",0 l 0,"+(-(M+I-1)*ah)+" q 0,"+(-2*ah)+" "+(-J*ah)+","+(-G*ah)+" l0,"+(-1*ah)+" a"+(al*ah)+","+(al*0.5*ah)+" 0 0,0 "+(-2*al*ah)+",0 l0,"+(1*ah)+" q"+(-J*ah)+","+(1*ah)+" "+(-J*ah)+","+(J*ah)+" z").attr(ai));if(I>0){ae={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.cooling.cryogenic){ae.fill=(this.state.cooling.cryogenic)?e(".mass").css("color"):"black";ae["fill-opacity"]=0.8}this.body.push(V.path("m "+(-ag*ah)+",0 a "+(ag*ah)+","+(J*ah)+" 0 0,0 "+(2*ag*ah)+",0 l 0,"+(-I*ah)+" a "+(ag*ah)+","+(J*ah)+" 0 0,0 "+(-2*ag*ah)+",0 z").attr(ae));this.body.push(V.ellipse(0,(-I*ah),ag*ah,J*ah).attr(N))}this.body.push(V.ellipse(0,(-(M+I+G)*ah),al*ah,al*0.5*ah).attr(N));var R=Math.ceil(this.prop.slots/2);var P,O,U,ak;var ac=2.2;ac=ag*2/(R+2);var Z=ac/2;var W=ac/4;var Y=0;var K=(this.s.choices.instruments)?this.s.choices.instruments.length:0;e("#"+this.id+"_schematic .label").remove();var Q="";S=this.el.innerWidth();af=this.el.innerHeight();for(var ad=0;ad<R;ad++){P=(ad-(R-1)/2)*(ac*ah*1.25);for(var ab=0;ab<2;ab++){O=I+1.5+(ab==0?0:H*2);U=0.5+(P+(ab==0?W*ah:0))/S;ak=(L+(an.bus+an.vgroove+(O+(ab==0?-H:+H*1.5))*ah))/af;if(Y<K){ae={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.bus){ae["fill-opacity"]=1;if(this.state.bus){ae.fill=e(".science").css("color")}if(!this.s.choices.instruments[Y].ok){ae.fill="black"}}}else{ae={stroke:"white","stroke-width":1,"stroke-dasharray":"- ",fill:"white","fill-opacity":0.2}}this.body.push(V.path("m"+(P-Z*ah)+","+(-O*ah)+" l"+(Z*ah)+","+(W*ah)+" l"+(Z*ah)+","+(-W*ah)+" l0,"+(-H*ah)+" l"+(-Z*ah)+","+(-W*ah)+" l"+(-Z*ah)+","+(W*ah)+" z m"+(Z*ah)+","+(W*ah)+" l0,"+(-H*ah)+" l"+(-Z*ah)+","+(-W*ah)+"m"+(Z*ah)+","+(W*ah)+"l"+(Z*ah)+","+(-W*ah)).attr(ae));if(Y<K&&this.s.choices.instruments[Y]&&this.s.hastransform){Q+='<div class="label '+(ab==0?"bottom":"top")+'" style="bottom:'+(100*ak)+"%; left:"+(100*U)+'%">'+this.s.choices.instruments[Y].name+"</div>"}Y++}}if(Q){e("#"+this.id+"_schematic").prepend(Q)}}if(this.s.choices.mirror){ae={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};if(this.colourize.mirror){ae.fill=e(".time").css("color");if(!this.state.mirror){ae.fill="black";ae.stroke="#ff0000"}}this.mirror=V.set();this.mirror.push(V.ellipse(0,-2.5*ah,10*ah,6*ah).attr(ae));this.mirror.push(V.ellipse(0,0,1*ah,0.6*ah).attr(ai));this.mirror.push(V.path("m "+(-2*ah)+","+(-11*ah)+" l"+(-3*ah)+","+(6*ah)+" l "+(5*ah)+","+(-7*ah)+" l"+(5*ah)+","+(7*ah)+" l"+(-3*ah)+","+(-6*ah)).attr(N));this.mirror.push(V.path("m "+(-2*ah)+","+(-11*ah)+" l"+(2*ah)+","+(-1*ah)+" l 0,"+(-1*ah)+" l"+(-2*ah)+","+(1*ah)+" z").attr(ai));this.mirror.push(V.path("m "+(2*ah)+","+(-11*ah)+" l"+(-2*ah)+","+(-1*ah)+" l 0,"+(-1*ah)+" l"+(2*ah)+","+(1*ah)+" z").attr(ai));this.mirror.push(V.path("m "+(-2*ah)+","+(-11*ah)+" l"+(-4*ah)+","+(12*ah)+" l "+(6*ah)+","+(-11*ah)+" l"+(6*ah)+","+(11*ah)+" l"+(-4*ah)+","+(-12*ah)).attr(N));this.mirror.push(V.ellipse(0,(-11*ah),2*ah,1*ah).attr(ae));this.mirror.push(V.path("m "+(-2*ah)+","+(-12*ah)+" l"+(2*ah)+","+(1*ah)+" l 0,"+(1*ah)+" l"+(-2*ah)+","+(-1*ah)+" z").attr(ai));this.mirror.push(V.path("m "+(2*ah)+","+(-12*ah)+" l"+(-2*ah)+","+(1*ah)+" l 0,"+(1*ah)+" l"+(2*ah)+","+(-1*ah)+" z").attr(ai))}if(this.bus){for(var ad=0;ad<this.bus.length;ad++){x(this.bus[ad],["t",this.width/2,af-L-an.bus])}}if(this.vgroove){for(var ad=0;ad<this.vgroove.length;ad++){x(this.vgroove[ad],["t",this.width/2,af-L-an.bus])}}if(this.body){for(var ad=0;ad<this.body.length;ad++){x(this.body[ad],["t",this.width/2,af-L-an.bus-an.vgroove])}}if(this.mirror){for(var ad=0;ad<this.mirror.length;ad++){x(this.mirror[ad],["t",this.width/2,af-L-an.bus-an.vgroove-an.body])}}return this};D.prototype.resize=function(i,G){this.build();return this};D.prototype.create=function(i,H){e("#"+this.id+"_schematic").hide();this.el.css({width:"auto",display:"block"});if(!i||i=="auto"){i=this.el.innerWidth()}var G=this.el.parent();if(i<G.width()/2){i=G.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}if(!H){H=i/2}if(this.heightscale){H=i*this.heightscale}if(i!=this.width||H!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=G.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=H;if(!this.paper){this.paper=Raphael(this.id+"_schematic",this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}}e("#"+this.id+"_schematic").show();return this};function E(H){this.width=0;this.height=300;this.heightscale="";this.zoom=0;this.scale=[1,0.022];this.anim={};this.orbits={};this.labels={};this.svg={orbits:{}};this.phrases={};this.data={};this.callback;this.spacetel={};this.id="orbits";this.interactive=true;if(!H){H={}}if(g(H.id,"string")){this.id=H.id}if(g(H.zoom,"number")){this.zoom=H.zoom}this.el=e("#"+this.id);if(g(H.phrases,"object")){this.phrases=H.phrases}if(g(H.data,"object")){this.data=H.data}if(g(H.callback,"function")){this.callback=H.callback}if(g(H.interactive,"boolean")){this.interactive=H.interactive}if(g(H.height,"string")&&H.height.indexOf("%")>0){this.heightscale=H.height/100}if(g(H.height,"number")){this.height=H.height}if(H.context){this.spacetel=H.context}this.orbits={GEO:{i:0,color:"#048b9f",e:0.3,zoom:0,z:false,ok:false},SNS:{i:-90,color:"#7ac36a",e:0.4,zoom:0,z:true,ok:false},HEO:{i:30,color:"#de1f2a",e:0.4,zoom:0,z:false,ok:false},LEO:{i:-30,color:"#cccccc",e:0.4,zoom:0,z:true,ok:false},EM2:{i:0,color:"#cccccc",e:1,zoom:1,z:false,ok:false},ES2:{i:0,color:"#9467bd",e:1,zoom:1,z:false,ok:false},ETR:{i:0,color:"#fac900",e:1,zoom:1,z:false,ok:false}};if(!H.orbits){H.orbits=["GEO","SNS","HEO","LEO","EM2","ES2","ETR"]}for(var G=0;G<H.orbits.length;G++){if(this.orbits[H.orbits[G]]){this.orbits[H.orbits[G]].ok=true}}if(H.orbits.length==1){this.zoom=this.orbits[H.orbits[0]].zoom}if(!this.spacetel.convertValue||!g(this.spacetel.convertValue,"function")){this.spacetel.convertValue=function(i){return i}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}E.prototype.resize=function(){if(this.el.length>0){this.el.children().hide()}this.el.css({width:"auto",display:"block"});var i=this.el.innerWidth();if(i<this.el.parent().width()/2){i=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}var G=i/2;if(i!=this.width||G!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=(this.heightscale)?this.width*this.heightscale:G;if(!this.paper){this.paper=Raphael(this.id,this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}this.E={x:this.width/2,y:this.height/2,r:this.height/6,radius:6378};this.M={r:5,o:this.E.r*58}}this.displayOrbits();this.el.children().show();return this};E.prototype.removeOrbits=function(){for(var L in this.orbits){var G=this.svg.orbits[L];if(G){if(G.dotted){G.dotted.stop().remove()}if(G.solid){G.solid.stop().remove()}if(G.satellite){G.satellite.stop().remove()}delete this.svg.orbits[L]}}var I=["Moon","Moonorbit","Moonlagrangian","Earthorbit"];for(var J=0;J<I.length;J++){if(this[I[J]]){this[I[J]].remove();delete this[I[J]]}}for(var H in this.labels){var K=this.labels[H];for(var J in K){if(g(K[J].remove,"function")){K[J].remove();delete K[J]}}delete this.labels[H]}return this};E.prototype.displayOrbits=function(Z,H){if(!this.paper){return this}if(this.orbits.HEO){this.orbits.HEO.r=this.E.r*3.3}if(Z){this.zoom=this.orbits[Z].zoom}if(g(H,"number")){this.zoom=H}function V(ac,ad,aa){if(!aa||!g(aa,"number")){aa=0}var i=ac*Math.sin(aa*Math.PI/180);var ab=ac*Math.cos(aa*Math.PI/180);if(Math.abs(aa)>80){i+=ac;ab+=ac*ad}return" m "+(0-ab)+" "+(0-i)+" a "+(ac)+","+(ad*ac)+" "+aa+" 1,1 0,0.01"}function L(i){if(i){i.hide()}}function X(i){if(i){i.show()}}if(this.rebuild){this.removeOrbits();this.rebuild=false}if(this.interactive){if(e("#"+this.id+" .zoomer").length==0){e("#"+this.id).prepend('<a href="#" class="zoomer button">-</a>');e("#"+this.id+" .zoomer").on("click",{me:this},function(i){i.preventDefault();i.data.me.displayOrbits("",(i.data.me.zoom==0?1:0));e(this).html(i.data.me.zoom==0?"&minus;":"&plus;").attr("title",(i.data.me.zoom==0?i.data.me.phrases.zoomout:i.data.me.phrases.zoomin))})}}if(this.Earth){this.Earth.remove()}if(this.zoom==0){this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m -6.92,42.86 c -10.79,-1.89 -21.17,-8.25 -27.52,-16.87 -15.02,-20.39 -9.63,-48.89 11.79,-62.41 16.94,-10.68 39.20,-8.16 53.44,6.06 5.87,5.86 9.54,12.35 11.55,20.40 1.16,4.68 1.47,12.35 0.67,16.96 -3.04,17.58 -15.44,30.93 -32.72,35.25 -4.33,1.08 -12.80,1.38 -17.21,0.61 z m 11.33,-4.82 c 6.97,-0.79 13.53,-3.42 19.13,-7.67 1.15,-0.87 1.54,-1.39 1.55,-2.07 0.01,-1.02 1.44,-5.01 2.21,-6.20 0.27,-0.42 1.14,-1.04 1.93,-1.38 1.16,-0.50 1.55,-0.90 2.12,-2.23 0.96,-2.24 1.24,-3.45 0.78,-3.45 -0.20,0 -0.37,-0.35 -0.37,-0.78 0,-0.79 1.79,-2.69 4.39,-4.66 0.67,-0.50 1.30,-1.14 1.40,-1.40 0.83,-2.18 0.99,-12.83 0.19,-12.83 -0.51,0 -0.70,2.11 -0.37,4.19 0.41,2.56 0.09,4.28 -0.80,4.41 -1.26,0.18 -2.13,-1.28 -2.84,-4.81 -1.04,-5.22 -1.12,-5.32 -4.56,-5.92 -1.02,-0.17 -1.08,-0.13 -1.08,0.81 0,2.22 -2.80,5.66 -5.01,6.15 -1.66,0.36 -2.62,-0.58 -4.17,-4.11 -0.73,-1.67 -1.59,-3.31 -1.92,-3.62 -0.55,-0.54 -0.58,-0.53 -0.58,0.12 0,1.72 2.25,7.61 3.13,8.19 0.20,0.13 1.09,0.24 1.97,0.25 2.19,0.00 3.57,0.75 3.56,1.93 -0.01,1.61 -1.23,3.68 -3.44,5.82 -2.98,2.89 -3.55,3.94 -3.55,6.53 -0.00,2.03 0.02,2.10 0.75,1.87 0.41,-0.12 1.04,-0.43 1.41,-0.68 0.98,-0.67 2.09,-0.56 2.35,0.23 0.24,0.77 -1.60,3.96 -3.39,5.87 -0.87,0.93 -1.18,1.07 -1.83,0.82 -0.67,-0.25 -0.78,-0.51 -0.76,-1.84 0.01,-0.95 -0.11,-1.50 -0.33,-1.43 -0.34,0.10 -0.65,0.55 -2.65,3.74 -1.17,1.88 -3.79,3.67 -6.07,4.16 -1.86,0.39 -3.48,0 -3.48,-0.79 0,-0.26 -0.43,-1.29 -0.96,-2.30 -1.69,-3.22 -1.84,-3.99 -1.37,-7.24 0.47,-3.33 0.19,-4.72 -1.21,-6.04 -1.23,-1.15 -1.87,-2.53 -1.64,-3.58 0.18,-0.83 0.08,-0.93 -1.34,-1.35 -1.63,-0.48 -5.15,-0.33 -7.61,0.33 -1.09,0.30 -1.50,0.23 -2.83,-0.42 -2.86,-1.42 -4.32,-4.81 -3.89,-9.11 0.39,-4.01 0.54,-4.51 1.80,-5.97 0.68,-0.78 1.43,-1.90 1.67,-2.47 0.39,-0.94 1.89,-1.94 3.70,-2.47 0.29,-0.08 0.93,-0.95 0.19,-1.19 -2.63,0.61 -3.49,-1.84 -1.69,-3.63 0.98,-0.98 1.35,-1.14 2.33,-1.03 1.08,0.12 1.16,0.07 1.16,-0.77 0,-0.49 0.15,-1.00 0.33,-1.12 0.18,-0.11 1.44,-0.95 1.44,-1.06 0,-0.36 -4.64,1.86 -2.85,-0.67 -0.26,0.41 -0.65,0.19 -1.12,-0.26 -0.87,-0.87 0.29,-1.80 1.00,-1.97 0.45,-0.00 0.96,1.28 1.31,0.58 -0.82,-1.14 -0.62,-2.63 -0.28,-2.70 1.28,-0.53 1.49,0.78 1.49,1.81 0,0.39 0.22,0.91 0.50,1.14 0.27,0.23 0.50,0.79 0.50,1.25 0,0.76 0.09,0.81 1.06,0.62 1.49,-0.30 2.53,-1.36 2.47,-2.53 2.67,-1.78 -0.15,-1.06 -0.29,-1.20 -0.63,-0.63 -0.13,-1.83 1.40,-3.38 2.14,-2.15 3.38,-2.70 6.99,-3.13 2.72,-0.32 3.09,-0.29 4.55,0.35 1.48,0.64 1.57,0.76 1.38,1.70 l -0.20,0.99 1.80,-0.96 c 0.99,-0.53 2.56,-1.15 3.49,-1.39 0.93,-0.23 1.69,-0.56 1.69,-0.72 0,-0.38 -4.20,-2.31 -6.97,-3.21 -5.23,-1.70 -13.51,-2.25 -18.83,-1.23 -4.60,0.87 -12.69,4.14 -13.13,5.31 -0.08,0.23 0.06,0.97 0.34,1.64 0.63,1.52 0.65,3.66 0.04,4.84 -0.61,1.18 -5.09,5.49 -6.37,6.14 -0.55,0.27 -2.28,0.92 -3.84,1.42 -4.30,1.40 -4.48,1.53 -5.46,3.96 -1.64,4.10 -2.26,7.13 -2.45,11.88 l -0.17,4.50 2.56,2.13 c 1.40,1.17 3.47,3.15 4.59,4.40 1.51,1.69 2.48,2.45 3.82,2.99 1.96,0.79 3.45,2.28 3.45,3.44 0,0.40 -0.24,1.46 -0.53,2.32 -0.49,1.46 -0.49,1.69 0.02,3.04 0.62,1.63 0.35,2.62 -0.81,3.00 -0.81,0.26 -0.85,1.23 -0.10,2.39 0.31,0.47 0.65,1.48 0.75,2.23 0.17,1.29 0.34,1.48 3.26,3.42 7.40,4.93 16.42,7.13 25.16,6.13 z m 8.48,-49.91 c 0.68,-0.67 0.66,-1.12 -0.05,-1.33 -0.32,-0.10 -2.25,-1.55 -2.92,-1.89 -1.01,-0.49 6.71,-1.01 1.45,-3.16 -5.26,-2.15 -2.56,4.83 -3.32,3.88 -0.65,-0.83 -2.00,-1.01 -2.58,-0.48 -1.15,-1.28 -2.98,-3.84 -3.70,-3.89 -1.03,-0.07 1.16,2.32 -0.27,2.81 -1.44,0.48 -2.20,-2.82 -4.09,-2.61 -2.10,0.23 -4.38,-0.72 -5.18,3.39 -0.00,0.52 3.06,0.16 4.50,0 2.32,-0.30 3.10,0 5.24,1.91 l 1.88,1.70 3.25,-0.23 c 2.19,-0.15 3.33,-0.11 3.48,0.12 0.32,0.53 1.72,0.42 2.32,-0.16 z M 4.90,-24.27 c 0.94,-0.43 1.16,-0.71 1.01,-1.25 -0.10,-0.38 -0.18,-0.86 -0.18,-1.09 0.15,-1.64 -0.72,-1.29 -1.57,-0.07 -0.77,1.13 -4.82,5.26 -0.61,2.96 0.07,-0.07 0.69,-0.25 1.35,-0.56 z m 20.69,-1.74 c 0.23,-0.38 -1.04,-1.12 -1.47,-0.86 -0.16,0.10 -0.95,-0.15 -1.74,-0.56 -1.95,-1.02 -6.42,-0.95 -5.77,0.10 0.10,0.17 1.42,0.31 2.92,0.31 2.03,8.3e-4 3.03,0.16 3.90,0.63 1.36,0.73 1.89,0.82 2.16,0.38 z")}else{this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m 0 -43.6 c,-19.19,-0.35,-37.44,13.34,-41.86,32.01 c,-4.56,17.16,2.72,37.24,17.65,46.97 c,13.37,9.28,32.05,9.99,45.99,1.50 c,5.95,-3.31,11.07,-8.03,14.54,-13.93 c,10.54,-15.64,8.72,-38.18,-4.01,-52.06 c,-8.07,-9.09,-20.11,-14.60,-32.30,-14.49 z m,0.09,5.37 c,12.57,-0.12,24.94,6.59,31.74,17.15 c,-0.94,5.00,-6.08,1.53,-3.04,-1.61 c,-1.45,-0.52,-4.93,2.87,-6.84,-0.60 c,-3.18,-1.30,-6.35,1.69,-5.15,4.18 c,-3.78,2.66,-6.16,-4.18,-10.15,-1.25 c,0.93,-0.71,6.35,-6.13,1.94,-5.74 c,-2.14,3.26,-5.90,5.61,-9.75,6.74 c,-3.03,1.66,3.48,3.91,5.08,3.87 c,4.45,2.28,8.58,7.10,6.19,12.18 c,1.90,3.21,3.99,6.75,2.95,10.74 c,-1.08,1.59,-1.99,6.64,-3.80,5.96 c,0.09,-5.55,-5.85,1.42,-5.90,3.92 c,-0.23,1.60,-2.08,4.66,0.31,3.45 c,1.57,3.03,4.04,1.23,2.57,-1.43 c,-0.75,-2.21,1.07,-4.45,1.43,-0.91 c,3.42,1.98,-2.07,8.02,-3.44,4.22 c,-0.05,3.19,-5.91,4.83,-6.25,5.74 c,2.90,2.90,-1.55,2.07,-3.22,2.25 c,-1.30,5.22,5.49,3.31,6.56,-0.06 c,2.57,-3.12,7.94,2.47,8.21,0.15 c,-5.15,-2.90,4.36,1.49,3.73,-0.17 c,0.35,-3.39,5.71,0.66,6.83,-2.63 c,2.78,1.05,-3.25,4.26,-4.94,4.47 c,-2.71,0.57,-2.35,4.23,-5.75,2.58 c,-3.91,-2.11,-7.99,-0.80,-12.06,-0.15 c,-4.93,2.23,-10.21,1.74,-14.83,-1.38 c,-10.81,-5.56,-18.52,-16.65,-20.00,-28.71 c,2.73,2.98,6.59,4.72,8.99,8.35 c,1.59,0.73,3.94,3.52,4.82,3.17 c,1.83,-2.48,4.15,-5.77,2.79,-8.54 c,3.36,-2.47,-0.28,-5.56,-3.15,-3.52 c,-4.39,0.81,-0.19,-4.94,1.39,-6.23 c,2.85,-0.46,3.51,2.41,3.98,3.73 c,3.31,-0.03,0.83,-3.88,4.37,-4.09 c,0.13,-1.41,-3.48,-2.70,-0.21,-1.77 c,4.26,-1.24,1.63,-4.36,-0.49,-3.17 c,2.76,-2.15,4.18,-7.67,8.50,-6.43 c,2.24,-0.41,2.61,-2.86,1.01,-3.53 c,2.71,-1.83,-1.40,-1.78,-0.10,-4.29 c,-1.83,-0.30,-4.30,-0.97,-2.13,-3.10 c,-3.38,2.57,-3.54,7.86,-8.96,7.39 c,-4.53,1.77,-8.33,-1.76,-12.01,-2.70 c,-1.47,0.69,-6.48,4.76,-4.02,0.66 c,6.58,-11.48,19.53,-19.03,32.80,-18.87 z m,-33.65,21.59 c,-0.63,0.60,-1.28,0.77,0,0 z m,25.03,13.87 c,-1.37,1.63,-4.72,3.73,-0.43,3.84 c,2.05,0.49,5.02,2.34,3.25,-0.95 c,-0.41,-1.86,-2.20,-1.09,-2.81,-2.89 z m,-4.06,1.78 c,-4.15,-0.46,-2.20,6.04,-6.12,6.47 c,-0.60,2.10,2.30,1.32,3.03,1.20 c,1.41,-2.46,3.73,-4.48,3.09,-7.68 z m,3.53,3.03 c,0.05,4.24,-2.37,7.12,-5.92,8.53 c,-2.81,3.20,0.32,5.68,2.91,2.40 c,3.66,0.82,7.45,0.46,8.59,-3.83 c,3.98,-4.13,-1.83,-7.10,-5.59,-7.10 z m,2.65,13.87 c,-4.08,2.58,5.79,0.94,0,0 z m,29.99,1 c,-0.31,2.69,7.00,1.53,2.61,4.52 c,-1.84,0.06,-6.30,-2.59,-2.61,-4.52 z m,-25.09,4.62 c,-2.60,0.71,1.04,4.16,-0.44,4.55 c,-1.43,1.94,4.72,-0.16,1.34,-1.89 c,-0.67,-1.04,-1.06,-1.69,-0.90,-2.65 z m,32.49,0.34 c,-0.01,2.70,-5.79,2.71,-1.54,0.95 l,0.80,-0.42 z m,-12.78,0.37 c,0.52,1.61,4.35,0.62,1.38,2.50 c,-1.24,2.92,-6.66,3.76,-3.93,-0.40 c,1.53,0.53,2.25,-0.75,2.54,-2.09 z m,-21.93,1.15 c,-3.15,1.82,0.36,3.97,0.81,0.93 c,-0.04,-0.43,-0.35,-0.86,-0.81,-0.93 z m,26.43,6.90 c,-1.92,1.51,-1.94,0.16,0,0 z")}this.Earth.attr({stroke:0,fill:"#69DFFF",opacity:0.8});var M,K,O,W,T,U;var Q=this;function G(aa){if(!aa){return null}if(!aa.cx){aa.cx=0}if(!aa.cy){aa.cy=0}if(!aa.e){aa.e=1}if(!aa.i){aa.i=0}if(!aa.r){aa.r=1}if(!aa.z){aa.z=false}if(!aa.color){aa.color="#999999"}if(!aa.stroke){aa.stroke={}}if(!aa.stroke.on){aa.stroke.on=2.5}if(!aa.stroke.off){aa.stroke.off=1.5}if(!aa.stroke.selected){aa.stroke.selected=2.5}var ac={inp:aa};if(aa.key=="ES2"){ac.dotted=Q.paper.path("M "+(aa.cx-aa.r)+",0 q "+(aa.r*2)+","+(Q.height/2)+" 0,"+(Q.height));ac.solid=Q.paper.path("M "+(aa.cx-aa.r)+",0 q "+(aa.r*2)+","+(Q.height/2)+" 0,"+(Q.height))}else{if(aa.e==1){ac.dotted=Q.paper.circle(aa.cx,aa.cy,aa.r);ac.solid=Q.paper.circle(aa.cx,aa.cy,aa.r)}else{var ab="m "+aa.cx+","+aa.cy+" "+V(aa.r,aa.e,aa.i);ac.dotted=Q.paper.path(ab);ac.solid=Q.paper.path(ab)}}if(aa.period){ac.satellite=Q.paper.circle(aa.cx,aa.cy,4).attr({fill:aa.color,stroke:0});if(aa.key!="ES2"){ac.anim=ac.satellite.animateAlong((aa.orbit?aa.orbit:ac.dotted),aa.period,Infinity,aa.orbitdir,aa.z)}}ac.dotted.attr({stroke:aa.color,"stroke-dasharray":"-","stroke-width":aa.stroke.off});ac.solid.attr({stroke:aa.color,opacity:0.1,"stroke-width":8});if(g(Q.callback,"function")){var i=function(){e("#"+this.id).css("cursor","pointer");this.dotted.attr({"stroke-width":(this.selected?aa.stroke.selected:aa.stroke.on)})};var ad=function(){e("#"+this.id).css("cursor","default");this.dotted.attr({"stroke-width":(this.selected?aa.stroke.selected:aa.stroke.off)})};ac.solid.hover(i,ad,ac,ac);ac.satellite.hover(i,ad,ac,ac);ac.solid.click(function(){Q.callback.call((Q.spacetel?Q.spacetel:this),aa.key)},ac,ac);ac.satellite.click(function(){Q.callback.call((Q.spacetel?Q.spacetel:this),aa.key)},ac,ac)}ac.zoom=Q.zoom+0;ac.hide=function(){L(ac.dotted);L(ac.solid);L(ac.satellite)};ac.show=function(){X(ac.dotted);X(ac.solid);X(ac.satellite)};return ac}if(!this.E||!this.M||!this.scale){return this}if(this.zoom==0){for(var P in this.data){if(this.orbits[P]&&this.orbits[P].ok&&this.orbits[P].zoom==this.zoom&&!this.svg.orbits[P]){if(P=="HEO"){M=-this.E.r*1.2;K=-this.E.r*0.35}else{M=0;K=0}if(!this.orbits[P].r){this.orbits[P].r=this.E.r*(1+this.data[P].altitude.value/this.E.radius)}U=this.spacetel.convertValue(this.data[P].period,"hours");this.svg.orbits[P]=G({key:P,period:U.value*3*1000,r:this.orbits[P].r,cx:(this.E.x+M),cy:(this.E.y+K),color:this.orbits[P].color,e:this.orbits[P].e,i:this.orbits[P].i,z:this.orbits[P].z})}}}else{if(this.zoom==1){if(!this.Moonorbit){var P=this.svg.orbits;this.Moonorbit=this.paper.path("M "+this.E.x+","+this.E.y+" "+V(this.M.o*this.scale[1],1)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.Moon=this.paper.circle(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6),this.E.y-this.M.o*this.scale[1]*Math.sin(Math.PI/6),this.M.r).attr({fill:"#606060",stroke:0});var O=9;if(!P.ETR&&this.data.ETR&&this.orbits.ETR.ok){U=this.spacetel.convertValue(this.data.ETR.period,"days");this.Earthorbit=this.paper.path("M "+(this.E.x-O)+",0 q "+(O*2)+","+(this.height/2)+" 0,"+(this.height)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});P.ETR=G({key:"ETR",period:U.value*1000,r:1,cx:(this.E.x-O*0.78),cy:(this.E.y+2.1*this.M.o*this.scale[1]),color:this.orbits.ETR.color})}if(!P.EM2&&this.data.EM2&&this.orbits.EM2.ok){this.Moonlagrangian=this.paper.path("M "+this.E.x+","+this.E.y+" "+V(this.M.o*this.scale[1]*440000/380000,1)).attr({stroke:"#000000","stroke-dasharray":"-","stroke-width":0.5,opacity:0.01});U=this.spacetel.convertValue(this.data.EM2.period,"days");this.Moon.animateAlong(this.Moonorbit,U.value*1000,Infinity,-1);P.EM2=G({key:"EM2",period:U.value*1000,orbit:this.Moonlagrangian,orbitdir:-1,r:this.M.o*((440000/380000)-1)*this.scale[1],cx:(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6)),cy:(this.M.o*this.scale[1]*Math.sin(Math.PI/6)),color:this.orbits.EM2.color,e:1,i:0});P.EM2.dotted.animateAlong(this.Moonorbit,U.value*1000,Infinity,-1);P.EM2.solid.animateAlong(this.Moonorbit,U.value*1000,Infinity,-1)}if(!P.ES2&&this.data.ES2&&this.orbits.ES2.ok){U=this.spacetel.convertValue(this.data.ES2.period,"days");P.ES2=G({key:"ES2",period:U.value*1000,r:9,cx:(this.E.x+4*this.M.o*this.scale[1]),cy:this.E.y,color:this.orbits.ES2.color})}var R=this.M.o*this.scale[1];var N=0.3;var I=parseInt(this.el.css("font-size"));if(!this.labels){this.labels={}}if(!this.labels.sun){this.labels.sun={zoom:1,arrow:this.paper.path("M "+(this.E.x-4*R)+","+this.E.y+" l "+(N*R)+",-"+(N*0.3*R)+" q "+(-N*0.3*R)+","+(N*0.3*R)+" 0,"+(N*0.6*R)+" z M "+(this.E.x-4*R+N*0.85*R)+","+(this.E.y-N*0.05*R)+" l "+(N*R*1.5)+","+(-N*0.05*R)+" l 0,"+(N*0.2*R)+" l "+(-N*R*1.5)+","+(-N*0.05*R)+" z").attr({fill:"#fac900",stroke:0}),label:this.paper.text((this.E.x-4*R+2.5*N*R),(this.E.y),this.phrases.diagram.sun).attr({fill:"#fac900",stroke:0,"text-anchor":"start","font-size":I})}}if(!this.labels.earthorbit&&this.data.ETR&&this.orbits.ETR.ok){this.labels.earthorbit={zoom:1,arrow:this.paper.path("M "+(this.E.x)+","+(this.E.y-2.1*R)+" l -"+(N*0.3*R)+","+(N*R)+" q "+(N*0.3*R)+","+(-N*0.3*R)+" "+(N*0.6*R)+",0 z M "+(this.E.x-N*0.05*R)+","+(this.E.y-2.1*R+N*0.85*R)+" l "+(-N*0.05*R)+","+(N*R*1.5)+" l "+(N*0.2*R)+",0 l "+(-N*0.05*R)+","+(-N*R*1.5)+" z").attr({fill:"#999999",stroke:0}),label:this.paper.text((this.E.x+N*0.3*R),(this.E.y-2*R+N*R),this.phrases.diagram.earthorbit).attr({fill:"#999999",stroke:0,"text-anchor":"start","font-size":I})}}}}}for(var P in this.svg.orbits){if(this.svg.orbits[P].zoom!=this.zoom){L(this.svg.orbits[P])}else{X(this.svg.orbits[P])}if(this.zoom==0){L(this.Moonorbit);L(this.Moon)}else{X(this.Moonorbit);X(this.Moon)}if(this.svg.orbits.EM2){if(this.zoom==0){L(this.Moonlagrangian);L(this.Earthorbit)}else{X(this.Moonlagrangian);X(this.Earthorbit)}}}for(var S in this.labels){var J=this.labels[S];if(J.zoom!=this.zoom){L(J.arrow);L(J.label)}else{X(J.arrow);X(J.label)}}var Y=this.E.r/48;if(this.scale[this.zoom]<1){Y*=this.scale[this.zoom]*10}if(this.Earth){x(this.Earth,["S",Y,Y,this.E.x,this.E.y])}return this};E.prototype.highlight=function(i){if(!i){return this}this.displayOrbits(i);for(var G in this.svg.orbits){if(G==i){this.svg.orbits[G].selected=true}else{this.svg.orbits[G].selected=false}this.svg.orbits[G].dotted.attr({"stroke-width":(this.svg.orbits[G].selected?this.svg.orbits[G].inp.stroke.selected:this.svg.orbits[G].inp.stroke.off)});this.svg.orbits[G].satellite.attr({r:(this.svg.orbits[G].selected?8:4),"stroke-width":(this.svg.orbits[G].selected?8:0),stroke:"white","stroke-opacity":0.5})}return this};function o(I){if(!I){I={}}this.id=(g(I.id,"string"))?I.id:"thermometer";this.pb=(I.phrasebook)?I.phrasebook:{y:""};this.txt=(I.txt)?I.txt:{font:"12px",fill:"#ffffff","text-anchor":"start"};this.labeltxt=(I.labeltxt)?I.labeltxt:{font:"10px","text-anchor":"start",fill:"#ffffff"};this.format=(g(I.format,"function"))?I.format:function(i){return f(i.value)+" K"};this.ctx=(g(I.context,"object"))?I.context:this;this.colour=(g(I.color,"string"))?I.color:"#df0000";this.wide=(g(I.width,"number"))?I.width:(g(I.canvas,"object"))?I.canvas.width:200;this.tall=(g(I.height,"number"))?I.height:(g(I.canvas,"object"))?I.canvas.height:200;this.req=(g(I.required,"number"))?I.required:300;this.xoff=(g(I.x,"number"))?I.x:0;this.yoff=(g(I.y,"number"))?I.y:0;this.p=7;this.tm=[0.1,0.3,1,3,10,30,100,300];this.bulb=4*this.p;this.bottom=this.tall-this.p*9.5;this.top=this.p*6;this.thermo=(g(I.canvas,"object"))?I.canvas:Raphael(this.id,this.wide,this.tall);this.mercurybase=this.thermo.rect((this.xoff+this.wide/2-this.p*2.5),this.yoff+this.bottom+this.p,this.p*5,this.bulb).attr({fill:this.colour,stroke:0});this.mercuryzero=this.thermo.rect((this.xoff+this.wide/2-this.p*1.5),this.yoff+this.bottom-0.5,this.p*3,Math.abs(this.p+1)).attr({fill:this.colour,stroke:0});this.mercury=this.thermo.rect(this.xoff+(this.wide/2-this.p*1.5),this.yoff+this.top,this.p*3,Math.abs(this.top-this.bottom)).attr({fill:this.colour,stroke:0});this.thermometer=this.thermo.path("M "+(this.xoff+this.wide/2-this.p)+","+(this.yoff+this.bottom+this.p)+" l 0,"+(this.top-this.bottom-this.p)+" c 0,-"+(this.p)+" "+(this.p*2)+",-"+(this.p)+" "+(this.p*2)+",0 l 0,"+(this.bottom-this.top+this.p)+" c "+(this.p*2)+","+(this.p*0.5)+" "+(this.p*2)+","+this.bulb+" "+(-this.p)+","+this.bulb+" c -"+(this.p*3)+",0 -"+(this.p*3)+",-"+(this.bulb-this.p*0.5)+" "+(-this.p)+",-"+this.bulb+" m -"+(this.p)+",-"+(this.p)+" c -"+(this.p*2.5)+","+(this.p)+" "+(-this.p*3)+","+(this.p*2+this.bulb)+" "+(this.p*2)+","+(this.p*2+this.bulb)+" c "+(this.p*5)+",0 "+(this.p*4.5)+",-"+(this.p+this.bulb)+" "+(this.p*2)+",-"+(this.p*2+this.bulb)+" l 0,-"+(this.bottom-this.top)+" c 0,-"+(this.p*2.5)+" -"+(this.p*4)+", -"+(this.p*2.5)+" -"+(this.p*4)+",0 l0,"+(this.bottom-this.top)).attr({fill:"#e4f6fe","fill-opacity":1,stroke:"#000000","stroke-width":1,"stroke-opacity":0.3});this.highlight=this.thermo.path("M "+(this.xoff+this.wide/2-this.p*0.35)+","+(this.yoff+this.bottom+this.p)+" l 0,-"+(this.bottom-this.top+this.p)+" l -"+(this.p*0.3)+",0 l 0,"+(this.bottom-this.top+this.p)+" l 0,"+(this.p*0.25)+" c -"+(this.p*0.5)+","+(this.p*0.25)+" -"+(this.p*1.75)+","+(this.p*0.75)+" -"+(this.p*0.75)+","+(this.p*2)+" c 0,-"+(this.p*0.5)+" "+(this.p*0.1)+",-"+(this.p*1.5)+" "+(this.p)+",-"+(this.p*2)+" z").attr({opacity:0.5,fill:"#f7fcfe","fill-opacity":1,stroke:0});this.shade=this.thermo.path("M "+(this.xoff+this.wide/2+this.p*0.5)+","+(this.yoff+this.bottom+this.p)+" l 0,-"+(this.bottom-this.top+this.p)+" l "+(this.p*0.9)+",0 l 0,"+(this.bottom-this.top+this.p)+" c "+this.p+","+this.p+" "+(this.p*1.25)+","+(this.bulb)+" -"+(this.p*2.5)+","+(this.bulb-this.p*0.75)+" q "+(this.p*3.25)+",-"+(this.bulb*0.1)+" "+(this.p*1.75)+",-"+(this.bulb-this.p)+" z").attr({opacity:0.2,fill:"#000000","fill-opacity":1,stroke:"#000000","stroke-width":1});this.labels=this.thermo.set();this.ticks=this.thermo.set();var G,J;for(var H=0;H<this.tm.length;H++){J=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.tm[H]))-0.5;this.ticks.push(this.thermo.path("M "+(this.xoff+this.wide/2+2)+","+(this.yoff+J)+" l "+(this.p*3)+",0").attr({stroke:"white","stroke-width":1}))}J=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.req))-0.5;this.ticks.push(this.thermo.path("M "+(this.xoff+this.wide/2-this.p*5)+","+(this.yoff+J)+" l "+(this.p*6)+",0").attr({stroke:"#ffffff","stroke-width":1,"stroke-dasharray":["-"]}));this.updateLanguage(this.pb);return this}o.prototype.updateLanguage=function(H){this.pb=H;if(this.rl){this.rl.remove()}y=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.req))-0.5;this.rl=this.thermo.text(this.xoff+this.wide/2-this.p*6,this.yoff+y,this.pb.req).attr(this.txt);this.rl.attr({"text-anchor":"middle"}).transform("r-90");if(this.labels){this.labels.remove()}for(var G=0;G<this.tm.length;G++){y=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.tm[G]))-0.5;this.labels.push(this.thermo.text((this.xoff+this.wide/2+this.p*3.5),(this.yoff+y),n(this.format.call(this.ctx,{value:this.tm[G],units:"K",dimension:"temperature"}))).attr(this.labeltxt))}return this};o.prototype.getYFrac=function(i){return(Math.log10(i)-Math.log10(this.tm[0]))/(Math.log10(this.tm[this.tm.length-1])-Math.log10(this.tm[0]))};o.prototype.value=function(i){var H=this.getYFrac(i);if((H-1)*(this.bottom-this.top)>this.p){H=1+(this.p/(this.bottom-this.top))}if(i<this.tm[0]){H=0}this.mercury.transform("s1,"+H+",0,"+this.bottom);var G={value:i,units:"K",dimension:"temperature"};if(i<=this.tm[this.tm.length-1]){G.value=this.tm[this.tm.length-1]}this.labels[this.labels.length-1].attr("text",n(this.format.call(this.ctx,G)));return this};function C(i){if(!i){i={}}this.label=(g(i.label,"string"))?i.label:"";this.colour=(g(i.color,"string"))?i.color:e(".science").css("color");this.wide=(g(i.width,"number"))?i.width:50;this.tall=(g(i.height,"number"))?i.height:75;this.xoff=(g(i.x,"number"))?i.x:0;this.yoff=(g(i.y,"number"))?i.y:0;this.p=0.1;if(g(i.canvas,"object")){this.canvas=i.canvas}else{return this}p=this.wide*this.p;q=this.tall*this.p;this.liquid=this.canvas.rect(this.xoff+p,this.yoff+this.p*this.tall,this.wide-2*p,(1-2*this.p)*this.tall).attr({fill:this.colour,stroke:0});this.flask=this.canvas.path("M"+(this.xoff+p*3.75)+","+(this.yoff+q)+" l "+(p*0.25)+","+(q*0.25)+" l 0,"+(q*3)+" l -"+(p*2.5)+","+(q*3.75)+" q -"+(p*0.5)+","+(q*0.75)+" 0,"+(q)+" l "+(p*7)+",0 q "+(p*0.5)+",-"+(q*0.25)+" 0,-"+q+" l -"+(p*2.5)+",-"+(q*3.75)+" l 0,"+(-q*3)+" l "+(p*0.25)+",-"+(q*0.25)+" l -"+(p*2.5)+",0 m 0,-"+q+" l "+(p*6.25)+",0 l 0,"+(q*10)+" l-"+(p*10)+",0 l 0,-"+(q*10)+" z").attr({fill:"black",stroke:0});this.outline=this.canvas.path("M"+(this.xoff+p*3.75)+","+(this.yoff+q)+" l "+(p*0.25)+","+(q*0.25)+" l 0,"+(q*3)+" l -"+(p*2.5)+","+(q*3.75)+" q -"+(p*0.5)+","+(q*0.75)+" 0,"+(q)+" l "+(p*7)+",0 q "+(p*0.5)+",-"+(q*0.25)+" 0,-"+q+" l -"+(p*2.5)+",-"+(q*3.75)+" l 0,"+(-q*3)+" l "+(p*0.25)+",-"+(q*0.25)+"").attr({stroke:"white","stroke-width":2});this.label=this.canvas.text(this.xoff,this.yoff+this.tall/2,this.label).attr({font:"10px","text-anchor":"end",fill:"#ffffff"});this.value(0);return this}C.prototype.value=function(i){if(i>1){i=1}if(i<0){i=0}this.liquid.transform("s1,"+i+",0,"+(this.yoff+this.tall-this.p*this.tall));return this};function B(){var M=e("#launchrocket img");var I=e("#launchpadbg img");if(e("#launchexhaust").length==0){M.before('<canvas id="launchexhaust"></canvas>')}var G=document.getElementById("launchexhaust");var T=G.getContext("2d");this.active=true;var P;var R=I.innerWidth(),K=I.innerHeight();G.width=R;G.height=K;var S=[];var N={};var H=80;for(var J=0;J<H;J++){S.push(new L())}function L(){this.speed={x:-0.5+Math.random()*1,y:-5+Math.random()*3};this.loc={x:M.offset().left+(M.width()/2)-I.offset().left,y:M.offset().top+M.height()-I.offset().top};this.radius=5+Math.random()*2;this.life=20+Math.random()*10;this.remaining_life=this.life;this.r=Math.round(Math.random()*55+200);this.g=this.r;this.b=this.r}var O=this;function Q(){T.globalCompositeOperation="source-over";T.fillStyle="transparent";T.fillRect(0,0,R,K);for(var U=0;U<S.length;U++){var V=S[U];T.beginPath();V.opacity=Math.round(V.remaining_life/V.life*100)/100;var W=T.createRadialGradient(V.loc.x,V.loc.y,0,V.loc.x,V.loc.y,V.radius);P="rgba("+V.r+", "+V.g+", "+V.b+", "+V.opacity+")";W.addColorStop(0,P);W.addColorStop(0.5,P);W.addColorStop(1,"rgba("+Math.round(V.r*0.9)+", "+Math.round(V.g*0.9)+", "+Math.round(V.b*0.9)+", 0)");T.fillStyle=W;T.arc(V.loc.x,V.loc.y,V.radius,Math.PI*2,false);T.fill();V.remaining_life-=0.5;V.radius+=0.5;V.loc.x+=V.speed.x;V.loc.y-=V.speed.y;if(V.remaining_life<0||V.radius<0){S[U]=new L()}}if(O.active){requestAnimationFrame(Q)}}Q();return this}B.prototype.stop=function(){this.active=false};function f(J){J+="";var i=J.split(".");var I=i[0];var G=i.length>1?"."+i[1]:"";var H=/(\d+)(\d{3})/;while(H.test(I)){I=I.replace(H,"$1,$2")}return I+G}function g(i,G){return(typeof i===G)}function b(G,H){var I=Math.floor(Math.log10(G));var i=Math.round(G/Math.pow(10,I));return""+i+"&times;10<sup>"+I+"</sup>"+H}function n(i){return e("<div />").html(i).text()}function w(I){var G=e(window).width();var J=e(window).height();var i=0;var H=0;i=((G-I.outerWidth())/2);I.css({left:((G-I.outerWidth())/2)+"px"});if(e(window).height()>I.height()){H=((J-I.outerHeight())/2+e(window).scrollTop());e("body").css("overflow-y","hidden")}I.css({left:i+"px",top:H+"px",position:"absolute"})}function x(G,i){t=G.data("transform");if(g(t,"undefined")){t=G.attr("transform")}if(!g(t,"object")){t=[]}m=false;for(z=0;z<t.length;z++){for(j=0;j<i.length;j++){if(t[z][0]==i[j][0]){t[z]=i[j][0];m=true}}}if(!m){t.push(i)}G.transform(t).data("transform",t)}function u(H,I,J){if(J){var G=new Date();G.setTime(G.getTime()+(J*24*60*60*1000));var i="; expires="+G.toGMTString()}else{var i=""}document.cookie=H+"="+I+i+"; path=/"}function A(H){var J=H+"=";var G=document.cookie.split(";");for(var I=0;I<G.length;I++){var K=G[I];while(K.charAt(0)==" "){K=K.substring(1,K.length)}if(K.indexOf(J)==0){return K.substring(J.length,K.length)}}return null}function d(i){u(i,"",-1)}e.spacetelescope=function(G,i){if(typeof i=="object"){i.container=G}else{if(G){if(typeof G=="string"){i={container:G}}else{i=G}}else{i={}}}i.plugins=e.spacetelescope.plugins;return new F(i)};e.spacetelescope.plugins=[]})($);