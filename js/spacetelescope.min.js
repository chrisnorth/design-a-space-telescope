/*!
	SpaceTelescope
	(c) Stuart Lowe and Chris North 2014-5
*/
if(typeof $==="undefined"){$={}}(function(e){var s={};s.log10=function(i){return Math.log(i)/2.302585092994046};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(i){window.setTimeout(i,1000/60)}})();var u={supportsFullScreen:false,isFullScreen:function(){return false},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},a="webkit moz o ms khtml".split(" ");if(typeof document.cancelFullScreen!="undefined"){u.supportsFullScreen=true}else{for(var A=0,r=a.length;A<r;A++){u.prefix=a[A];if(typeof document[u.prefix+"CancelFullScreen"]!="undefined"){u.supportsFullScreen=true;break}}}if(u.supportsFullScreen){u.fullScreenEventName=u.prefix+"fullscreenchange";u.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}};u.requestFullScreen=function(i){return(this.prefix==="")?i.requestFullScreen():i[this.prefix+"RequestFullScreen"]()};u.cancelFullScreen=function(i){return(this.prefix==="")?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}}if(typeof jQuery!="undefined"){jQuery.fn.requestFullScreen=function(){return this.each(function(){if(u.supportsFullScreen){u.requestFullScreen(this)}})}}window.fullScreenApi=u;Raphael.el.animateAlong=function(L,K,J,I,M){var i=this;i.zforward=(!g(M,"boolean"))?false:M;i.atFront=false;i.path=L;i.direction=I;i.pathLen=i.path.getTotalLength();K=(g(K,"undefined"))?5000:K;J=(g(J,"undefined"))?1:J;i.paper.customAttributes.along=function(P){var O=(this.direction&&this.direction<0)?(1-P)*this.pathLen:(P*this.pathLen);var N=this.path.getPointAtLength(O),Q={cx:N.x,cy:N.y};if(this.zforward){if(P>0.5&&!this.atFront){this.toFront();this.atFront=true}if(P>0&&P<0.5&&this.atFront){this.toBack();this.atFront=false}}this.rotateWith&&(Q.transform="r"+N.alpha);return Q};i.attr({along:0});var G=Raphael.animation({along:1},K);i.animate(G.repeat(J))};(function(){var G=0;var I=["ms","moz","webkit","o"];for(var i=0;i<I.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[I[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[I[i]+"CancelAnimationFrame"]||window[I[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(N,K){var J=new Date().getTime();var L=Math.max(0,16-(J-G));var M=window.setTimeout(function(){N(J+L)},L);G=J+L;return M}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(J){clearTimeout(J)}}}());e.query=function(){var i={length:0};var G=location.search;if(G&&G!="#"){G=G.replace(/^\?/,"").replace(/\&$/,"");jQuery.each(G.split("&"),function(){var I=this.split("=")[0];var J=this.split("=")[1];if(/^[0-9\.]+$/.test(J)){J=parseFloat(J)}i[I]=J})}return i};document.write('<style type="text/css">.noscriptmsg { display: none; }</style>');function H(G){if(typeof e!=="function"){this.log("No jQuery! Abort! Abort!");return this}this.q=e.query();this.i=G;this.stage="intro";this.choices={};this.sections=["objectives","satellite","instruments","cooling","vehicle","site","orbit","proposal"];this.keyboard=true;this.errors=[];this.warnings=[];this.launchstep=0;this.languages={en:"en"};this.langurl="config/%LANG%%MODE%.json";this.dataurl="config/options%MODE%.json";this.scenariourl="config/scenarios_%LANG%%MODE%.json";this.keys=new Array();this.pushstate=!!(window.history&&history.pushState);this.settings={length:"m",currency:"GBP",temperature:"K",mass:"kg",time:"years",usecookies:false,mode:"normal"};this.init(G);var I="transform WebkitTransform MozTransform OTransform msTransform".split(" ");this.hastransform=false;for(var i=0;i<I.length;i++){var J=document.createElement("div");if(J.style[I[i]]!=undefined){this.hastransform=true}}return this}H.prototype.init=function(i){this.lang=(g(this.q.lang,"string"))?this.q.lang:(navigator)?(navigator.userLanguage||navigator.systemLanguage||navigator.language||browser.language):"";this.langshort=(this.lang.indexOf("-")>0?this.lang.substring(0,this.lang.indexOf("-")):this.lang.substring(0,2));this.langs=(i&&i.langs)?i.langs:{en:"English"};this.setVar("currency","string");this.setVar("length","string");this.setVar("mass","string");this.setVar("temperature","string");this.setVar("time","string");this.setVar("mode","string");this.addEvents();this.startup();return this};H.prototype.addEvents=function(){var J=this;window[(this.pushstate)?"onpopstate":"onhashchange"]=function(i){J.navigate(i)};list=e("#language ul li a");for(var I=0;I<list.length;I++){e(list[I]).on("click",{me:this},function(i){i.preventDefault();i.data.me.loadLanguage(e(this).attr("data"),i.data.me.update)})}e("#summary a").on("click",{me:this},function(i){i.data.me.toggleMenus("summaryext",i)});e("a.togglewarning,a.toggleerror").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("messages")});e("a.togglemenu").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("menu")});e("a.togglelang").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("language")});e(document).on("dragenter","#application",function(i){i.preventDefault()});e(document).on("dragover","#application",function(i){i.preventDefault();e(this).css("opacity",0.75)});e(document).on("drop",function(i){i.preventDefault()});function G(K,L){if(K[0].type=="text/plain"||K[0].type==""){var i=new FileReader();i.onload=(function(M){return function(N){L.processFile(N.target.result).toggleMenus()}})(K[0]);i.readAsText(K[0])}}e(document).on("drop","#application",{me:this},function(K){K.preventDefault();e(this).css({opacity:1});var i=K.originalEvent.dataTransfer.files;G(i,K.data.me);return false});if(g(Blob,"function")){e("#menu ul").append('<li class="baritem" data="load"><a href="#"><img src="images/cleardot.gif" class="icon load" alt="" /><span>Load</span></a><input type="file" id="files" name="files[]" multiple /></li>');e(document).on("change","#files",{me:this},function(i){G(i.target.files,i.data.me)});e("#menu ul").append('<li class="baritem" data="save"><a href="#"><img src="images/cleardot.gif" class="icon save" alt="" /><span>Save</span></a></li>')}if(u.supportsFullScreen){e("#menu ul").append('<li class="baritem" data="fullscreen"><a href="#" class="fullscreenbtn"><img src="images/cleardot.gif" class="icon fullscreen" alt="" /> <span></span></li>');e(".baritem .fullscreenbtn").parent().on("click",{me:this},function(i){i.data.me.toggleFullScreen().toggleMenus()})}e(".baritem .load").parent().on("click",{me:this},function(i){e("#files").trigger("click")});e(".baritem .save").parent().on("click",{me:this},function(i){i.data.me.save().toggleMenus()});e(".baritem .help").parent().on("click",{me:this},function(i){i.data.me.toggleGuide(i).toggleMenus()});e(".baritem .restart").parent().on("click",{me:this},function(i){i.data.me.toggleMenus()});e(".baritem .options").parent().on("click",{me:this},function(i){i.data.me.showView("options",i).toggleMenus()});e("body").on("click","a.guidelink",{me:this},function(i){if(e(this).attr("href").indexOf("#")==0){i.data.me.showView(e(this).attr("href").substr(1),i)}i.data.me});e(document).on("keypress",{me:this},function(K){if(!K){K=window.event}var i=K.keyCode||K.charCode||K.which||0;K.data.me.keypress(i,K)});this.registerKey(["?"],function(i){this.toggleGuide(i)});e(document).on("scroll",{me:this},function(i){i.data.me.scrollMenus()});e(".scriptonly").removeClass("scriptonly");e(document).on("focus","input,textarea",{me:this},function(i){i.data.me.keyboard=false}).on("blur","input,textarea",{me:this},function(i){i.data.me.keyboard=true});e(document).on("click","#scenarios .button",{me:this},function(i){i.data.me.chooseScenario(e(this).attr("data"))});e(document).on("click","#messages a",{me:this},function(i){e("#messages").hide()});e(document).on("click",".remove_instrument",{me:this},function(i){i.preventDefault();i.data.me.removeInstrument(e(this).attr("data"))});e(document).on("change","#designer_cooling .options input,#designer_cooling .options select",{me:this},function(i){if(i.data.me.getValue("input[name=hascooling]:checked")=="yes"){e("#designer_cooling li.hascooling").show()}else{e("#designer_cooling li.hascooling").hide()}i.data.me.parseChoices().showDetails("cooling")});e(document).on("click","#designer_vehicle .options .button",{me:this},function(i){i.preventDefault();e("#designer_vehicle .info>li."+e(this).attr("data")).find("input").trigger("click")});e(document).on("change","#designer_vehicle .options .selector input",{me:this},function(i){e("#designer_vehicle .info>li").removeClass("selected");e("#designer_vehicle .info>li."+e(this).attr("data")).addClass("selected").find("input").trigger("click");i.data.me.parseChoices()});e(document).on("click","#designer_vehicle .options .info>li",{me:this},function(i){if(!e(this).hasClass("withinfo")){e(".withinfo").removeClass("withinfo");e(this).addClass("withinfo");e("#designer_vehicle .details").html(e(this).find(".vehicle_details").html()).addClass("padded")}});e(document).on("click","#designer_site .launchsite",{me:this},function(i){i.preventDefault();e("#designer_site #site").val(e(this).attr("data"));e("#designer_site #site").trigger("change")});e(document).on("submit","form",{me:this},function(i){i.preventDefault()});e(document).on("change",".doc input,.doc textarea",{me:this},function(i){i.data.me.updateProposal()});e(document).on("click",".printable a.button",{me:this},function(i){i.preventDefault();i.data.me.printProposal()});e(document).on("click",".relaunch a.button",{me:this},function(i){i.preventDefault();i.data.me.relaunch()});e(document).on("click","#launchnav a.button",{me:this},function(i){i.preventDefault();i.data.me.launch()});e(document).on("click",".toggler",{me:this},function(K){var i=e(this).find("input:checked");if(i.attr("value")=="yes"){e(this).addClass("checked")}else{e(this).removeClass("checked")}if(i.attr("id").indexOf("mode")==0){var L=(i.attr("value")=="yes"?"advanced":"normal");if(K.data.me.settings.mode!=L){K.data.me.setMode(L)}}});e(document).on("change","#designer_satellite select, #designer_satellite input",{me:this},function(i){i.data.me.parseChoices().showDetails("satellite").showDetails("cooling")});e(document).on("change","#designer_instruments select",{me:this},function(M){var L=M.data.me.getValue("#instruments");var K=M.data.me.getValue("#wavelengths");M.data.me.parseChoices().showDetails("instruments",{wavelength:K,type:L});e(".add_instrument.hidden").removeClass("hidden")});e(document).on("click","#designer_instruments .add_instrument",{me:this},function(i){i.preventDefault();i.data.me.addInstrument()});e(document).on("change","#designer_site #site",{me:this},function(K){var i=K.data.me.getValue("#site");e(".launchsite").removeClass("selected");e(".launchsite[data="+i+"]").addClass("selected");K.data.me.parseChoices().showDetails("site",i)});e(document).on("change","#mission_orbit",{me:this},function(K){var i=K.data.me.getValue("#mission_orbit");K.data.me.highlightOrbit(i).parseChoices().showDetails("orbit",i).showDetails("cooling")});e(document).on("change","#mission_duration",{me:this},function(i){i.data.me.parseChoices()});e(document).on("submit","#designer_instruments form",{me:this},function(i){i.preventDefault();e(this).find("a.add_instrument").trigger("click")});e(window).resize({me:this},function(i){i.data.me.resize()});return this};H.prototype.startup=function(i){this.data=null;this.phrases=null;this.choices={};this.scenarios=null;this.buildTable();if(g(i,"function")){i=[this.update,i]}else{i=[this.update]}this.loadConfig();this.loadLanguage(this.lang,i);var G="";var I=0;for(l in this.langs){G+='<li class="baritem"><a href="#" title="'+this.langs[l]+'" data="'+l+'">'+this.langs[l]+" ["+l+"]</a></li>";I++}e("#language ul").html(G);if(I<2){e(".togglelang").closest(".baritem").hide()}return this};H.prototype.setMode=function(i,G){this.settings.mode=i;this.q.mode=i;this.startup(G)};H.prototype.changeMode=function(i){this.changeToggle("togglemode","mode_"+i);return this};H.prototype.changeToggle=function(I,i){var G=this.toggles[I];if(!G){return this}if(i==G.a.id&&e("#"+G.a.id).length>0){e("#"+G.a.id).trigger("click").closest(".toggler").trigger("click")}if(i==G.b.id&&e("#"+G.a.id).length>0){e("#"+G.b.id).trigger("click").closest(".toggler").trigger("click")}return this};H.prototype.buildToggle=function(J,G,i){if(!g(J,"string")&&!g(G,"object")&&!g(i,"object")){return""}if(!this.toggles){this.toggles={}}this.toggles[J]={a:G,b:i};var I='<label class="toggle-label';if(G.checked){html='<div class="toggleinput toggler">'+I+'1" for="'+G.id+'"></label>'}else{html='<div class="toggleinput toggler checked">'+I+'1" for="'+G.id+'"></label>'}html+='<div class="toggle-bg">';html+='	<input id="'+G.id+'" type="radio" '+(G.checked?'checked="checked" ':"")+'name="'+J+'" value="'+G.value+'">';html+='	<input id="'+i.id+'" type="radio" '+(i.checked?'checked="checked" ':"")+'name="'+J+'" value="'+i.value+'">';html+='	<span class="switch"></span>';html+="</div>";html+=""+I+'2" for="'+i.id+'"></label></div>';return html};H.prototype.updateToggle=function(G,i,I){if(!g(G,"object")&&!g(i,"object")||e("#"+G.id).length==0||e("#"+i.id).length==0){return this}if(!I){I=""}if(!G.label){G.label=""}if(!i.label){i.label=""}e("#"+G.id+",#"+i.id).attr("title",I);e("label[for="+G.id+"]").html(G.label);e("label[for="+i.id+"]").html(i.label);return this};H.prototype.buildPage=function(){if(this.built){return this.updatePage()}this.built=true;e("#scenarios").html('<h2></h2><p class="about"></p><ul id="scenariolist"></ul>');e("#messages .warnings").html('<div class="bigpadded"><h3 class="warning"><img src="images/cleardot.gif" class="icon warning" /> <span class="title"></span> <span class="warning value">0</span></h3><ul class="summary"></ul>');e("#messages .errors").html('<div class="bigpadded"><h3 class="error"><img src="images/cleardot.gif" class="icon error" /> <span class="title"></span> <span class="error value">0</span></h3><ul class="summary"></ul>');e("#designer").html('<div class="designer_inner bigpadded"><div id="main"><div id="menubar"></div><div id="output"></div><div id="sidebar"><div class="padded"></div></div></div></div>');for(var G=0;G<this.sections.length;G++){if(e("#designer_"+this.sections[G]).length==0){e("#output").append('<div id="designer_'+this.sections[G]+'" class="designer"><h2 class="designer_title"><a href="#designer_'+this.sections[G]+'" class="toggle'+this.sections[G]+'"></a></h2><div class="designer_content"><div class="intro"></div><div class="options"></div><div class="questions"></div></div></div>')}}e(".barmenu").append('<div class="baritem togglelaunch"><a href="#launch" class="">Launch</a></div>');e("#designer_objectives .intro").after('<div class="summary"></div>');e("#designer_satellite .options").html('<div class="bigpadded"><form><ul><li class="option mirror_diameter"><label for="mirror_size"></label><select id="mirror_size" name="mirror_size"></select></li><li class="option mirror_deployable"><label for="mirror_deployable"></label>'+this.buildToggle("toggledeployable",{value:"no",id:"mirror_deployable_no",label:"",checked:true},{value:"yes",id:"mirror_deployable_yes",label:""})+'</li><li class="option mirror_uv"><label for="mirror_uv"></label>'+this.buildToggle("toggleuv",{value:"no",id:"mirror_uv_no",checked:true},{value:"yes",id:"mirror_uv_yes"})+'</li></ul></form><div class="details"></div></div>');e("#designer_instruments .options").html('<div class="bigpadded"><form><ul><li><label for="instruments"></label><select id="wavelengths" name="wavelengths"></select><select id="instruments" name="instruments"></select> <input type="text" id="instrument_name" name="instrument_name" /></li></ul></form><div class="details"></div><a href="#" class="add_instrument hidden"><img src="images/cleardot.gif" class="icon add" /><span>'+this.phrases.designer.instruments.options.add+'</span></a></div><div class="instrument_list bigpadded"></div>');e("#designer_cooling .options").html('<div class="bigpadded"><form><ul></ul></form><div class="details"></div></div>');e("#designer_site .options").html('<div class="worldmap"><img src="images/worldmap.jpg" /></div><div class="bigpadded"><form><ul><li><label for="site"></label><select id="site" name="site"></select></li></ul></form><div class="details"></div></div>');e("#designer_orbit .options").html('<div id="orbits"></div><div id="orbits2"></div><div class="bigpadded"><form><ul><li><label for="mission_orbit"></label><select id="mission_orbit" name="mission_orbit"></select></li><li><label for="mission_duration"></label><select id="mission_duration" name="mission_duration"></select></li></ul></form><div class="details"></div></div>');e("#designer_proposal .options").html('<div class="padded"><div class="doc"></div></div>');e("#sidebar").html('<div class="sidebar_inner"><div class="satellite panel" id="sidebar_satellite"></div><div class="vehicle padded panel"></div><div class="site worldmap panel"></div><div class="orbit panel"></div></div>');this.buildTable();this.updatePage();return this};H.prototype.updatePage=function(){var J="";for(var I=0;I<this.sections.length;I++){J+='<li><a href="#designer_'+this.sections[I]+'" class="toggle'+this.sections[I]+'"></a></li>'}e("#menubar").html("<ul>"+J+"</ul>");e("#designer_cooling .options form ul li").remove();e("#designer_cooling .options form ul").append('<li><label for="hascooling"></label>'+this.buildToggle("hascooling",{value:"no",id:"cooling_no",checked:true},{value:"yes",id:"cooling_yes"})+"</li>");if(this.data.cooling.temperature){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_temperature"></label><select id="cooling_temperature" name="cooling_temperature"></select></li>')}if(this.data.cooling.passive){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_passive"></label>'+this.buildToggle("cooling_passive",{value:"no",id:"cooling_passive_no"},{value:"yes",id:"cooling_passive_yes",checked:true})+"</li>")}if(this.data.cooling.active){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_active"></label>'+this.buildToggle("cooling_active",{value:"no",id:"cooling_active_no",checked:true},{value:"yes",id:"cooling_active_yes"})+"</li>")}if(this.data.cooling.cryogenic){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_cryogenic"></label><select id="cooling_cryogenic" name="cooling_cryogenic"></select></li>')}J='<div class="bigpadded">';J+='<form><ul class="info">';for(var G in this.data.vehicle){J+='<li class="'+G+'" data="'+G+'">';J+='<div class="image"><img src="" alt="" title="" /></div><div class="operator"><img src="" alt="" title="" /></div>';J+='<div class="vehicle_details">';J+='<div class="rocket"></div>';var K=["operator","height","diameter","currency","massLEO","massGTO",(this.data.vehicle[G].risk?"risk":""),"sites"];for(var I=0;I<K.length;I++){J+=this.buildRow("","",K[I])}J+='<div class="clearall"></div>';J+="</div>";J+='<div class="selector"><input type="radio" name="vehicle_rocket" id="vehicle_rocket_'+G+'" data="'+G+'" /><label for="vehicle_rocket_'+G+'"></label></div>';J+="</li>"}J+='</ul></form><div class="details"></div></div>';e("#designer_vehicle .options").html(J);e(".details").html("").removeClass("padded");e("#sidebar .panel").hide();return this};H.prototype.buildTable=function(){this.table={success:{list:{success_vehicle:{},success_site:{},success_orbit:{},success_deploy:{},success_cooling:{},success_instruments:{},success_mission:{}}},cost_available:{list:{cost_initial:{},cost_dev_total:{list:{cost_dev_satellite:{},cost_dev_mirror:{},cost_dev_cooling:{},cost_dev_instruments:{}}},cost_operations_total:{list:{cost_operations_launch:{},cost_operations_ground:{}}},cost_total:{},cost_available:{}}},mass_total:{list:{mass_satellite:{},mass_mirror:{},mass_cooling_total:(this.settings.mode=="advanced"?{list:{mass_cooling_passive:{},mass_cooling_cryo:{},mass_cooling_active:{}}}:{}),mass_instruments:{}}},time_dev_total:{list:{time_dev_total:{list:{time_dev_satellite:{},time_dev_mirror:{},time_dev_cooling:{},time_dev_instruments:{}}},time_mission:{},time_cooling:{},time_fuel:{},time_observing:{}}},science_total:{},profile_total:{list:{profile_site:{},profile_vehicle:{},profile_instruments:{},profile_mirror:{},profile_temperature:{},profile_orbit:{},profile_launch:{},profile_end:{}}}}};H.prototype.resize=function(){if(this.modal){this.positionModal(this.modal)}if(e("#launchanimation").length>0){e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"})}return this};H.prototype.navigate=function(G,i){if(!i){var i=location.href.split("#")[1]}this.log("navigate",i,G);if(!g(i,"string")){i=""}this.showView(i,G);return this};H.prototype.keypress=function(G,J){if(this.keyboard){if(!J){J={altKey:false}}for(var I=0;I<this.keys.length;I++){if(this.keys[I].charCode==G&&J.altKey==this.keys[I].altKey){this.keys[I].fn.call(this,{event:J});break}}}};H.prototype.registerKey=function(P,N,J){if(!g(N,"function")){return this}if(!g(P,"object")){P=[P]}var O,G,M,I,K,L;for(M=0;M<P.length;M++){K=false;if(g(P[M],"string")){if(P[M].indexOf("alt")==0){L=P[M];K=true;P[M]=P[M].substring(4)}else{L=P[M]}G=P[M].charCodeAt(0)}else{G=P[M];if(G==37){L="&larr;"}else{if(G==32){L="space"}else{if(G==38){L="up"}else{if(G==39){L="&rarr;"}else{if(G==40){L="down"}else{L=String.fromCharCode(G)}}}}}}O=true;for(I=0;I<this.keys.length;I++){if(this.keys.charCode==G&&this.keys.altKey==K){O=false}}if(O){this.keys.push({str:L,charCode:G,"char":String.fromCharCode(G),fn:N,txt:J,altKey:K})}}return this};H.prototype.toggleMenus=function(M,K){if(K&&g(K,"object")){K.preventDefault()}var G=e(".dropdown");var I=(K)?e(K.currentTarget).attr("href"):"";for(var J=0;J<G.length;J++){var L=this;if(e(G[J]).attr("id")==M){e(G[J]).toggle(0,function(){if(I&&I.indexOf("#")>=0){L.setScroll("#"+I.split("#")[1])}})}else{e(G[J]).hide()}}if(M=="messages"){this.setScroll("#"+M)}return this};H.prototype.scrollMenus=function(i){e(".dropdown.fullwidth:visible").each(function(){var G=parseInt(e(this).css("top"));var I=e("#bar").outerHeight();var J=window.scrollY;if(G<=I){e(".dropdown").css({top:I})}if(G>J+I){e(".dropdown").css({top:J+I})}});return this};H.prototype.setVar=function(i,I){if(g(i,"string")){if(this.i&&typeof this.i[i]===I){this.settings[i]=this.i[i]}if(typeof this.q[i]===I){this.settings[i]=this.q[i];if(this.settings.usecookies){w("spacetelescope."+i,this.settings[i],1)}}if(this.settings.usecookies){var G=B("spacetelescope."+i);if(G){this.settings[i]=G}}}return this};H.prototype.loadConfig=function(G){var i=this.dataurl.replace("%MODE%",this.getMode());e.ajax({url:i,beforeSend:function(I){if(I.overrideMimeType){I.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+i)},success:function(J){this.data=J;if(g(G,"function")){G.call(this)}if(g(G,"object")&&G.length>0){for(var I=0;I<G.length;I++){G[I].call(this)}}}});return this};H.prototype.getMode=function(){return(this.settings.mode=="advanced")?"_advanced":""};H.prototype.loadLanguage=function(G,J){if(!G){G=this.langshort}var i=this.settings.mode;if(!this.languages[G]){G=this.langshort;if(this.languages[this.langshort]){G="en"}}var I=this.langurl.replace("%LANG%",G).replace("%MODE%",this.getMode());e.ajax({url:I,beforeSend:function(K){if(K.overrideMimeType){K.overrideMimeType("application/json")}},method:"GET",cache:false,dataType:"json",context:this,error:function(){this.log("Error loading "+G+" ("+i+")")},success:function(K){this.langshort=G;this.lang=G;this.phrases=K;this.log("Loaded "+G);this.loadScenarios(J)}});return this};H.prototype.loadScenarios=function(I){var i=this.settings.mode;var G=this.scenariourl.replace("%LANG%",this.langshort).replace("%MODE%",this.getMode());e.ajax({url:G,beforeSend:function(J){if(J.overrideMimeType){J.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+G+" ("+i+")");if(g(I,"function")){I.call(this)}if(g(I,"object")&&I.length>0){for(var J=0;J<I.length;J++){I[J].call(this)}}},success:function(K){this.scenarios=K.scenarios;this.log("Loaded Scenario");if(g(I,"function")){I.call(this)}if(g(I,"object")&&I.length>0){for(var J=0;J<I.length;J++){I[J].call(this)}}}});return this};H.prototype.chooseScenario=function(G){this.log("chooseScenario",G);this.scenario=this.scenarios[G];this.stage="designer";e("#summary").show();this.updateSummary().updateLanguage();return this};H.prototype.update=function(){this.log("update");if(!this.phrases||!this.data){return this}this.buildPage().updateLanguage().makeSpace("orbits").displayOrbits();e("#language.dropdown").hide();if(!this.loaded){this.navigate();this.loaded=true}return this};H.prototype.addInstrument=function(){if(!this.choices.instruments){this.choices.instruments=[]}var I=this.getValue("#instruments");var G=this.getValue("#wavelengths");var J=this.getValue("#instrument_name");if(I&&G){if(!J){J=this.phrases.designer.instruments.defaultname.replace(/%d%/,(this.choices.instruments.length+1))}this.choices.instruments.push({name:J,type:I,wavelength:G,ok:true});this.updateInstruments()}return this};H.prototype.removeInstrument=function(G){G=parseInt(G,10);if(G<this.choices.instruments.length){this.choices.instruments.splice(G,1)}this.updateInstruments();return this};H.prototype.displayInstruments=function(){var I="";var J=this.phrases.designer;this.log("displayInstruments");I+="<h3>"+J.instruments.table.title+'</h3><div class="tablewrapper"><table><tr><th>'+J.instruments.table.name+"</th><th>"+J.instruments.table.type+"</th><th>"+J.instruments.table.cost+"</th><th>"+J.instruments.table.mass+"</th><th>"+J.instruments.table.temperature+"</th><th></th></tr>";if(this.choices.instruments&&this.choices.instruments.length>0){for(var G=0;G<this.choices.instruments.length;G++){v=this.getInstrument({wavelength:this.choices.instruments[G].wavelength,type:this.choices.instruments[G].type});I+="<tr><td>"+this.choices.instruments[G].name+"</td><td>"+v.wavelength+" "+v.type+"</td><td>"+this.formatValueSpan(v.cost)+"</td><td>"+this.formatValueSpan(v.mass)+"</td><td>"+this.formatValueSpan(v.temp)+'</td><td><a class="remove_instrument" href="#" title="'+this.phrases.designer.instruments.options.remove+'" data="'+G+'"><img class="icon minus" src="images/cleardot.gif"></a></td></tr>'}}I+="</table></div>";e("#designer_instruments .instrument_list").html(I);return I};H.prototype.updateInstruments=function(){this.log("updateInstruments");this.displayInstruments();this.parseChoices("designer_instruments");return this};H.prototype.makeSatellite=function(){this.log("makeSatellite");if(!this.satellite){this.satellite=new E({id:"sidebar_satellite",spacetel:this})}this.satellite.resize();return this};H.prototype.makeSpace=function(i){this.log("makeSpace");if(!this.space){this.space=new F({id:i,phrases:this.phrases.designer.orbit,data:this.data.orbit,callback:this.selectOrbit,context:this,interactive:true})}if(!this.space.el.is(":visible")){return this}this.space.data=this.data.orbit;this.space.phrases=this.phrases.designer.orbit;if(!this.space.paper){this.space.resize()}return this};H.prototype.selectOrbit=function(i){if(i){e("#designer_orbit #mission_orbit").val(i);e("#designer_orbit #mission_orbit").trigger("change")}return this};H.prototype.highlightOrbit=function(i){this.log("highlightOrbit",i,this.space);this.space.highlight(i);return this};H.prototype.removeOrbits=function(){this.space.removeOrbits();return this};H.prototype.displayOrbits=function(i,G){this.log("displayOrbits",i,G);this.space.displayOrbits(i,G);return this};H.prototype.updateProposal=function(){this.log("updateProposal");e(".printable").remove();var J={};var L={};var G;if(this.choices.instruments&&this.choices.instruments.length>0){var M="";for(var I=0;I<this.choices.instruments.length;I++){G=this.choices.instruments[I].wavelength;v=this.getInstrument({wavelength:this.choices.instruments[I].wavelength,type:this.choices.instruments[I].type});M+=""+this.choices.instruments[I].name+" - "+v.wavelength+" "+v.type+"\n";if(this.data.wavelengths[G].min){if(!L.value||this.data.wavelengths[G].min.value<L.value){L=this.copyValue(this.data.wavelengths[G].min)}}if(this.data.wavelengths[G].max){if(!J.value||this.data.wavelengths[G].max.value>J.value){J=this.copyValue(this.data.wavelengths[G].max)}}}e("#proposal_instruments").val(M)}if(this.choices.mirror){e("#proposal_mirror").val(this.choices.mirror);if(this.settings.mode!="advanced"){var K=this.data.mirror[this.choices.mirror].diameter;e("#proposal_reslow").val(n(this.formatValue(this.makeValue(1.22*L.value/K.value,"degrees"))));e("#proposal_reshigh").val(n(this.formatValue(this.makeValue(1.22*J.value/K.value,"degrees"))))}}if(this.choices.temperature){e("#proposal_reqtemp").val(this.formatValue(this.choices.instrument.temp));e("#proposal_temp").val(this.formatValue(this.choices.temperature))}if(this.table.mass_total){e("#proposal_mass").val(this.formatValue(this.table.mass_total.value));e("#proposal_mass_satellite").val(this.formatValue(this.table.mass_total.list.mass_satellite.value));e("#proposal_mass_mirror").val(this.formatValue(this.table.mass_total.list.mass_mirror.value));e("#proposal_mass_cooling").val(this.formatValue(this.table.mass_total.list.mass_cooling_total.value));e("#proposal_mass_instruments").val(this.formatValue(this.table.mass_total.list.mass_instruments.value))}if(this.choices.orbit){e("#proposal_orbit").val(this.phrases.designer.orbit.options[this.choices.orbit].label);e("#proposal_distance").val(this.formatValue(this.data.orbit[this.choices.orbit].altitude));if(this.settings.mode!="advanced"){e("#proposal_period").val(this.formatValue(this.data.orbit[this.choices.orbit].period));e("#proposal_fuel").val(this.formatValue(this.data.orbit[this.choices.orbit].fuellife))}}if(this.choices.mission){e("#proposal_duration").val(this.formatValue(this.copyValue(this.data.mission[this.choices.mission].life)))}if(this.choices.vehicle){e("#proposal_vehicle").val(this.phrases.designer.vehicle.options[this.choices.vehicle].label);e("#proposal_operator").val(this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label);e("#proposal_launchmass").val(this.formatValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO)));e("#proposal_launchsize").val(this.formatValue(this.data.vehicle[this.choices.vehicle].diameter))}if(this.choices.site){e("#proposal_site").val(this.phrases.designer.site.options[this.choices.site].label)}if(this.table){e("#proposal_cost").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_total.value))));e("#proposal_cost_satellite").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.value))));e("#proposal_cost_mirror").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.value))));e("#proposal_cost_cooling").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.value))));e("#proposal_cost_instruments").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.value))));e("#proposal_cost_dev").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.value))));e("#proposal_cost_launch").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.value))));e("#proposal_cost_ground").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.value))));e("#proposal_cost_operations").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.value))))}if(this.proposalCompleteness()!=0){e(".doc").after('<div class="printable bigpadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.print+"</a></div>")}return this};H.prototype.proposalCompleteness=function(){this.log("proposalCompleteness");var L=0;var I=e(".doc").find("input");var G=e(".doc").find("textarea");var K=I.length+G.length;for(var J=0;J<I.length;J++){if(e(I[J]).val()!=""){L++}}for(var J=0;J<G.length;J++){if(e(G[J]).val()!=""){L++}}return L/K};H.prototype.printProposal=function(){this.log("printProposal");var G=e(".doc").eq(0).html();G=G.replace(/<label[^\>]*>[^\<]*<\/label>/g,"").replace(/<input [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(J,K){var I=e("#"+K).val();return(I!=""?'<span class="userinput">'+I+"</span>":'<span class="emptyinput">BLANK</span>')}).replace(/<textarea [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(J,K){var I=e("#"+K).val();return(I!=""?'<span class="userinput">'+I+"</span>":'<span class="emptyinput">BLANK</span>')});var i=window.open("","","width="+e(window).width()+",height="+e(window).height()+",resizeable,scrollbars");i.document.write('<!DOCTYPE html><html><head><link type="text/css" href="css/fonts.css" media="all" rel="stylesheet"><link type="text/css" href="css/style.css" media="all" rel="stylesheet"><script>function onload(){ window.print(); }<\/script></head><body onload="onload()"><div id="main" class="bigpadded"><div class="doc">'+G+"</div></div></body></html>");i.document.close();return this};H.prototype.updateSidePanels=function(){if(this.choices.mirror||this.choices.hascooling||this.choices.instruments){this.makeSatellite();e("#sidebar .satellite.panel").show()}else{e("#sidebar .satellite.panel").hide()}if(this.choices.vehicle){e("#sidebar .vehicle.panel").html('<div class="image"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div><div class="info"><div>'+this.phrases.designer.vehicle.options[this.choices.vehicle].label+"</div><div>"+this.phrases.designer.vehicle.diameter+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].diameter)+"</div><div>"+this.phrases.designer.vehicle.massLEO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.LEO)+"</div><div>"+this.phrases.designer.vehicle.massGTO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.GTO)+"</div><div>"+this.phrases.designer.vehicle.operator+" "+this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label+"</div></div>").show()}else{e("#sidebar .vehicle.panel").hide()}if(this.choices.site){html='<img src="images/worldmap.png" />';var i=this.data.site[this.choices.site].latitude;var G=this.data.site[this.choices.site].longitude;if(!i&&!G){i=34;G=-116}html+='<a href="#" class="launchsite '+this.choices.site+'" title="'+this.phrases.designer.site.options[this.choices.site].label+'" style="left:'+Math.round(100*(G+180)/360)+"%;top:"+Math.round(100*(90-i)/180)+'%"></a>';e("#sidebar .site.panel").html(html).show()}else{e("#sidebar .site.panel").hide()}if(this.choices.orbit){e("#sidebar .orbit.panel").html('<img src="'+this.data.orbit[this.choices.orbit].img+'" />').show()}else{e("#sidebar .orbit.panel").hide()}return this};H.prototype.updateDropdown=function(L){var I="";var J,K,G;J=e("#"+L);if(J.length==0){return this}K=J.find("option");this.log("updateDropdown");if(L=="mirror_size"){if(this.phrases.designer.satellite.options.diameter.placeholder){I='<option value="">'+this.phrases.designer.satellite.options.diameter.placeholder+"</option>"}for(var i in this.data.mirror){I+='<option value="'+i+'">'+this.formatValue(this.data.mirror[i].diameter)+"</option>"}J.html(I)}else{if(L=="instruments"){if(this.phrases.designer.instruments.options.instrument.none&&this.settings.mode=="advanced"){I='<option value="">'+this.phrases.designer.instruments.options.instrument.none.label+"</option>"}for(var i in this.data.instrument.options){G=this.phrases.designer.instruments.options.instrument[i].label;I+='<option value="'+i+'">'+G+"</option>"}J.html(I);if(this.settings.mode!="advanced"){e("#instruments option:first-child").attr("selected","selected")}this.displayInstruments()}else{if(L=="wavelengths"){if(this.phrases.wavelengths.none.label){I='<option value="">'+this.phrases.wavelengths.none.label+"</option>"}for(var i in this.data.wavelengths){G=this.phrases.wavelengths[i].label;I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}else{if(L=="mission_duration"){if(this.phrases.designer.orbit.duration.none){I='<option value="">'+this.phrases.designer.orbit.duration.none+"</option>"}for(var i in this.data.mission){G=this.formatValue(this.data.mission[i].life);I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}else{if(L=="mission_orbit"){if(this.phrases.designer.orbit.orbit.none){I='<option value="">'+this.phrases.designer.orbit.orbit.none+"</option>"}for(var i in this.data.orbit){I+='<option value="'+i+'">'+this.phrases.designer.orbit.options[i].label+"</option>"}J.html(I)}else{if(L=="cooling_temperature"){if(this.data.cooling.temperature){for(var i in this.data.cooling.temperature){G=n(this.formatValue(this.data.cooling.temperature[i].temperature));I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}}else{if(L=="site"){if(this.phrases.designer.site.hint){I='<option value="">'+this.phrases.designer.site.hint+"</option>"}for(var i in this.data.site){if(this.phrases.designer.site.options[i]){G=this.phrases.designer.site.options[i].label;I+='<option value="'+i+'">'+G+"</option>"}}J.html(I)}else{if(L=="cooling_cryogenic"){for(var i in this.data.cooling.cryogenic){G=(this.phrases.designer.cooling.options.cryogenic.options[i]?this.phrases.designer.cooling.options.cryogenic.options[i]:this.formatValue(this.data.cooling.cryogenic[i].life));I+='<option value="'+i+'">'+G+"</option>"}J.html(I)}}}}}}}}return this};H.prototype.updateLanguage=function(){this.log("updateLanguage");if(!this.phrases||!this.data){return this}var Y=this.phrases;var L,W,R,M,N;if(Y.title){document.title=n(Y.title)}e("h1").text(Y.title);e("body").attr("dir",(Y.language.alignment=="right"?"rtl":"ltr")).removeClass("ltr rtl").addClass((Y.language.alignment=="right"?"rtl":"ltr"));if(this.scenario){if(e("#designer_objectives .banner").length==0){e("#designer_objectives .intro").before('<div class="banner"></div>')}e("#designer_objectives .banner").html('<div class="title">'+this.scenario.name+"</div>");if(this.scenario.image&&this.scenario.image.banner){e("#designer_objectives .banner").css("background-image","url("+this.scenario.image.banner+")")}if(Y.designer.objectives.intro){e("#designer_objectives .intro").html("<p><strong>"+Y.scenarios.mission+"</strong> &quot;"+this.formatScenario(this.scenario)+"&quot;</p>"+(this.scenario.funder?Y.designer.objectives.intro:Y.designer.objectives.intronofunder).replace(/%TITLE%/,this.scenario.name).replace(/%FUNDER%/,this.scenario.funder)).addClass("bigpadded")}}e("#designer_satellite .options .mirror_diameter label").html(Y.designer.satellite.options.diameter.label);this.updateDropdown("mirror_size");e("#designer_satellite .options .mirror_deployable label").html(Y.designer.satellite.options.deployable.label);e("#designer_satellite .options .mirror_uv label").html(Y.designer.satellite.options.uv.label);if(Y.designer.satellite.intro){e("#designer_satellite .intro").html(Y.designer.satellite.intro).addClass("bigpadded")}this.updateToggle({id:"mirror_deployable_no",label:this.phrases.designer.satellite.options.deployable.no},{id:"mirror_deployable_yes",label:this.phrases.designer.satellite.options.deployable.yes},this.phrases.designer.satellite.options.deployable.label);this.updateToggle({id:"mirror_uv_no",label:this.phrases.designer.satellite.options.uv.no},{id:"mirror_uv_yes",label:this.phrases.designer.satellite.options.uv.yes},this.phrases.designer.satellite.options.uv.label);this.updateDropdown("instruments");this.updateDropdown("wavelengths");e("#designer_instruments .options label").html(Y.designer.instruments.options.label);e("#designer_instruments .options input#instrument_name").attr("placeholder",Y.designer.instruments.options.name);e("#designer_instruments .options a.add_instrument").attr("title",Y.designer.instruments.options.add);e("#designer_instruments .options a.add_instrument span").html(Y.designer.instruments.options.add);if(Y.designer.instruments.intro){e("#designer_instruments .intro").html(Y.designer.instruments.intro.replace(/%MAX%/,this.data.instrument.maxsize.length)).addClass("bigpadded")}if(Y.designer.cooling.intro){e("#designer_cooling .intro").html(Y.designer.cooling.intro).addClass("bigpadded")}e("#designer_cooling .options label[for=hascooling]").html(Y.designer.cooling.enable.label);this.updateToggle({id:"cooling_no",label:Y.designer.cooling.enable.no},{id:"cooling_yes",label:Y.designer.cooling.enable.yes},this.phrases.designer.cooling.enable.label);if(this.data.cooling.temperature){this.updateDropdown("cooling_temperature");e("#designer_cooling .options label[for=cooling_temperature]").html(Y.designer.cooling.options.temperature.label)}if(this.data.cooling.passive){L="";this.updateToggle({id:"cooling_passive_no",label:this.phrases.designer.cooling.options.passive.options.no},{id:"cooling_passive_yes",label:this.phrases.designer.cooling.options.passive.options.yes},this.phrases.designer.cooling.options.passive.label);e("#designer_cooling .options label[for=cooling_passive]").html(Y.designer.cooling.options.passive.label)}if(this.data.cooling.active){L="";this.updateToggle({id:"cooling_active_no",label:this.phrases.designer.cooling.options.active.options.no},{id:"cooling_active_yes",label:this.phrases.designer.cooling.options.active.options.yes},this.phrases.designer.cooling.options.active.label);e("#designer_cooling .options label[for=cooling_active]").html(Y.designer.cooling.options.active.label)}if(this.data.cooling.cryogenic){this.updateDropdown("cooling_cryogenic");e("#designer_cooling .options label[for=cooling_cryogenic]").html(Y.designer.cooling.options.cryogenic.label)}W=0;N=Y.designer.vehicle;var Q="";var S=0;for(var V in this.data.vehicle){S++}var K=100/S;for(var V in this.data.vehicle){M=e("#designer_vehicle .options li").eq(W);M.attr({data:V}).css({width:K+"%"});R=this.data.vehicle[V];M.find(".image img").attr({src:R.img,alt:N.options[V].label,title:N.options[V].label});M.find(".selector label").html(N.options[V].label);M.find(".rocket").html(N.options[V].label);M.find(".operator img").attr({src:this.data.operator[R.operator].img,alt:Y.operator[R.operator].label,title:Y.operator[R.operator].label});M.find(".details .operator strong").html(N.operator);M.find(".details .operator .value").html(Y.operator[R.operator].label);if(R.height){M.find(".height strong").html(N.height);this.updateValue(M.find(".height .value"),R.height)}M.find(".diameter strong").html(N.diameter);this.updateValue(M.find(".diameter .value"),R.diameter);M.find(".currency strong").html(N.cost);this.updateValue(M.find(".currency .value"),R.cost);M.find(".massLEO strong").html(N.massLEO);this.updateValue(M.find(".massLEO .value"),R.mass.LEO);M.find(".massGTO strong").html(N.massGTO);this.updateValue(M.find(".massGTO .value"),R.mass.GTO);if(R.risk){M.find(".risk strong").html(N.risk);this.updateValue(M.find(".risk .value"),(R.risk*100)+"%")}M.find(".sites strong").html(N.sites);L="";for(var P=0;P<R.sites.length;P++){L+=""+Y.designer.site.options[R.sites[P]].label+"<br />"}this.updateValue(M.find(".sites .value"),L);M.find("input").attr("value",V);M.find(".button").html(N.select);W++}if(Y.designer.vehicle.intro){e("#designer_vehicle .intro").html(Y.designer.vehicle.intro).addClass("bigpadded")}var X="";this.updateDropdown("site");var O='<option value="">'+Y.designer.site.hint+"</option>";for(var P in this.data.site){var J=this.data.site[P].latitude;var I=this.data.site[P].longitude;O+='<option value="'+P+'">'+Y.designer.site.options[P].label+"</option>";if(!J&&!I){J=34;I=-116}X+='<a href="#" class="launchsite '+P+'" data="'+P+'" title="'+Y.designer.site.options[P].label+'" style="left:'+Math.round(100*(I+180)/360)+"%;top:"+Math.round(100*(90-J)/180)+'%"></a>'}e("#designer_site .worldmap .launchsite").remove();e("#designer_site .worldmap").append(X);e("#designer_site .options label").html(Y.designer.site.hint);if(Y.designer.site.intro){e("#designer_site .intro").html(Y.designer.site.intro).addClass("bigpadded")}e("#designer_orbit .options label[for=mission_duration]").html(Y.designer.orbit.duration.label);this.updateDropdown("mission_duration");e("#designer_orbit .options label[for=mission_orbit]").html(Y.designer.orbit.orbit.label);this.updateDropdown("mission_orbit");var G=(Y.designer.proposal.labels?Y.designer.proposal.labels:{});String.prototype.formify=function(ab,aa,Z,ad,i){if(!i&&G[ab]){i=G[ab]}if(i){i='<label for="'+Z+'">'+i+"</label>"}else{i=""}if(!ad){ad=""}if(aa=="text"){var ac='<input type="text" name="'+Z+'" id="'+Z+'" value="'+ad+'" >'}else{if(aa=="textarea"){var ac='<textarea name="'+Z+'" id="'+Z+'">'+ad+"</textarea>"}}return this.replace("%"+ab+"%",i+ac,"g")};var T=Y.designer.proposal.doc;e("#designer_proposal .options .doc").html(T.replace(/%FUNDER%/g,"Funder").replace(/%DATE%/,(new Date()).toDateString()).formify("TO","text","proposal_to").formify("NAME","text","proposal_name").formify("AIM","textarea","proposal_aim").formify("PREVIOUS","text","proposal_previous").formify("ADVANCE","textarea","proposal_advance").formify("INSTRUMENTS","textarea","proposal_instruments").formify("GOALS","textarea","proposal_goal").formify("RESLOW","text","proposal_reslow").formify("RESHIGH","text","proposal_reshigh").formify("MIRROR","text","proposal_mirror").formify("REQTEMPERATURE","text","proposal_reqtemp").formify("TEMPERATURE","text","proposal_temp").formify("MASS","text","proposal_mass").formify("MASSSATELLITE","text","proposal_mass_satellite").formify("MASSMIRROR","text","proposal_mass_mirror").formify("MASSCOOLING","text","proposal_mass_cooling").formify("MASSINSTRUMENTS","text","proposal_mass_instruments").formify("ORBIT","text","proposal_orbit").formify("DISTANCE","text","proposal_distance").formify("PERIOD","text","proposal_period").formify("FUEL","text","proposal_fuel").formify("DURATION","text","proposal_duration").formify("VEHICLE","text","proposal_vehicle").formify("OPERATOR","text","proposal_operator").formify("SITE","text","proposal_site").formify("LAUNCHMASS","text","proposal_launchmass").formify("LAUNCHSIZE","text","proposal_launchsize").formify("COST","text","proposal_cost").formify("COSTSATELLITE","text","proposal_cost_satellite").formify("COSTMIRROR","text","proposal_cost_mirror").formify("COSTCOOLING","text","proposal_cost_cooling").formify("COSTINSTRUMENTS","text","proposal_cost_instruments").formify("COSTDEV","text","proposal_cost_dev").formify("COSTLAUNCH","text","proposal_cost_launch").formify("COSTGROUND","text","proposal_cost_ground").formify("COSTOPERATIONS","text","proposal_cost_operations"));for(var W=0;W<this.sections.length;W++){if(Y.designer[this.sections[W]]){e(".toggle"+this.sections[W]).text(Y.designer[this.sections[W]].label).attr("title",(Y.designer[this.sections[W]].hint?Y.designer[this.sections[W]].hint.replace(/<([^>]*)>/g,""):""))}}e(".togglemenu").attr("title",Y.ui.menu.title);e("#menu ul li").each(function(Z){var aa=e(this).attr("data");e(this).find("a").attr("title",Y.ui.menu[aa].title).find("span").html(Y.ui.menu[aa].label)});var U=["warnings","errors","success","time","cost","mass","science"];for(var W=0;W<U.length;W++){if(Y.ui[U[W]]){e(".toggle"+U[W]).attr("title",Y.ui[U[W]].title)}if(Y.ui.summary[U[W]]){e(".toggle"+U[W]).attr("title",Y.ui.summary[U[W]].title)}}e("#introduction").html(Y.intro.about);e("#introduction").append('<div class="centre"><a href="#scenarios" class="button fancybtn">'+Y.intro.button+"</a></div>");e("#introduction").append('<div class="centre toppadded">'+this.buildToggle("togglemode",{value:"no",id:"mode_basic",checked:(this.settings.mode!="advanced"?true:false)},{value:"yes",id:"mode_advanced",checked:(this.settings.mode=="advanced"?true:false)})+"</div>");this.updateToggle({id:"mode_basic",label:this.phrases.modes.basic},{id:"mode_advanced",label:this.phrases.modes.advanced},this.phrases.modes.label);var M="";for(var W=0;W<this.scenarios.length;W++){M+='<li><div class="padded">'+(this.scenarios[W].image&&this.scenarios[W].image.banner?'<img src="'+this.scenarios[W].image.banner+'"'+(this.scenarios[W].image.alt?'alt="'+this.scenarios[W].image.alt+'"':"")+' style="width: 100%;" />':"")+"<h3>"+this.scenarios[W].name+"</h3><p>"+this.formatScenario(this.scenarios[W])+'</p><a href="#designer_objectives" class="button" title="'+this.scenarios[W].name+'" data="'+W+'">Choose this mission<!--LANGUAGE--></a></div></li>'}e("#scenariolist").html(M);e("#scenarios h2").html(Y.scenarios.title);e("#scenarios p.about").html(Y.scenarios.intro);this.updateUnits();e("#messages h3.warning .title").text(this.phrases.ui.warning.title);e("#messages h3.error .title").text(this.phrases.ui.error.title);e(".togglelaunch a").text(this.phrases.launch.label).attr("title",(this.phrases.launch.hint?this.phrases.launch.hint:""));var P=Y.ui.summary;this.table.success.label=P.success.title;this.table.success.list.success_orbit.label=P.success.orbit;this.table.success.list.success_site.label=P.success.site;this.table.success.list.success_vehicle.label=P.success.vehicle;this.table.success.list.success_deploy.label=P.success.deploy;this.table.success.list.success_cooling.label=P.success.cooling;this.table.success.list.success_instruments.label=P.success.instruments;this.table.success.list.success_mission.label=P.success.mission;this.table.cost_available.label=P.cost.title;this.table.cost_available.list.cost_initial.label=P.cost.initial;this.table.cost_available.list.cost_dev_total.label=P.cost.dev.title;this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.label=P.cost.dev.satellite;this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.label=P.cost.dev.mirror;this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.label=P.cost.dev.cooling;this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.label=P.cost.dev.instruments;this.table.cost_available.list.cost_operations_total.label=P.cost.operations.title;this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.label=P.cost.operations.launch;this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.label=P.cost.operations.ground;this.table.cost_available.list.cost_total.label=P.cost.total;this.table.cost_available.list.cost_available.label=P.cost.available;this.table.time_dev_total.label=P.time.title;this.table.time_dev_total.list.time_dev_total.label=P.time.dev.title;this.table.time_dev_total.list.time_dev_total.list.time_dev_satellite.label=P.time.dev.satellite;this.table.time_dev_total.list.time_dev_total.list.time_dev_mirror.label=P.time.dev.mirror;this.table.time_dev_total.list.time_dev_total.list.time_dev_cooling.label=P.time.dev.cooling;this.table.time_dev_total.list.time_dev_total.list.time_dev_instruments.label=P.time.dev.instruments;this.table.time_dev_total.list.time_mission.label=P.time.mission;this.table.time_dev_total.list.time_cooling.label=P.time.cooling;this.table.time_dev_total.list.time_fuel.label=P.time.fuel;this.table.time_dev_total.list.time_observing.label=P.time.observing;this.table.mass_total.label=P.mass.title;this.table.mass_total.list.mass_satellite.label=P.mass.satellite;this.table.mass_total.list.mass_mirror.label=P.mass.mirror;this.table.mass_total.list.mass_cooling_total.label=P.mass.cooling.title;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.label=P.mass.cooling.passive;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.label=P.mass.cooling.cryo;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.label=P.mass.cooling.active}this.table.mass_total.list.mass_instruments.label=P.mass.instruments;this.table.science_total.label=P.science.title;this.table.profile_total.label=P.profile.title;this.table.profile_total.list.profile_site.label=P.profile.site;this.table.profile_total.list.profile_vehicle.label=P.profile.vehicle;this.table.profile_total.list.profile_instruments.label=P.profile.instruments;this.table.profile_total.list.profile_mirror.label=P.profile.mirror;this.table.profile_total.list.profile_temperature.label=P.profile.temperature;this.table.profile_total.list.profile_orbit.label=P.profile.orbit;this.table.profile_total.list.profile_launch.label=P.profile.launch;this.table.profile_total.list.profile_end.label=P.profile.end;this.updateSummaryList();return this};H.prototype.getInstrument=function(L){var I=L;var N=this.makeValue(0,"GBP");var K=this.makeValue(0,"kg");var G=this.makeValue(0,"K");var M=this.makeValue(0,"months");if(L.wavelength&&this.data.wavelengths[L.wavelength]){var i=this.copyValue(this.data.wavelengths[L.wavelength]);if(i.cost){N=i.cost}if(i.mass){K=i.mass}if(i.temperature){G=i.temperature}I.wavelength=this.phrases.wavelengths[L.wavelength].label}if(L.type&&this.data.instrument.options[L.type]){var J=this.copyValue(this.data.instrument.options[L.type]);if(J.multiplier&&J.multiplier.cost){N.value*=J.multiplier.cost}if(J.multiplier&&J.multiplier.mass){K.value*=J.multiplier.mass}if(J.devtime){M=J.devtime}I.type=this.phrases.designer.instruments.options.instrument[L.type].label}I.cost=N;I.mass=K;I.temp=G;I.time=M;return I};H.prototype.buildRow=function(G,I,i){return(!G&&!I&&!i)?"":"<div"+(g(i,"string")?' class="'+i+'"':"")+"><strong>"+G+"</strong> "+this.formatValueSpan(I)+"</div>"};H.prototype.showDetails=function(Y,T){this.log("showDetails");var M="";if(!Y||Y==""){return this}var Z,P,U,R,O,V,aa,N,S;Z=this.phrases.designer;P=this.data;N=this.choices;if(Y=="satellite"){if(N.mirror&&P.mirror[N.mirror]){U=P.mirror[N.mirror];var X=this.copyValue(U.cost);var Q=this.copyValue(U.mass);var L=this.copyValue(U.devtime);var K=this.copyValue(U.bus.cost);var G=this.copyValue(U.bus.mass);var W=this.copyValue(U.bus.devtime);var J=this.copyValue(U.bus.diameter);if(N.deployablemirror){R=P.deployablemirror.multiplier;if(R.cost){X.value*=R.cost}if(R.mass){Q.value*=R.mass}if(R.time){L.value*=R.time}if(R.bus.cost){K.value*=R.bus.cost}if(R.bus.mass){G.value*=R.bus.mass}if(R.bus.time){W.value*=R.bus.time}if(R.bus.diameter){J.value*=R.bus.diameter}}if(N.uvmirror){R=P.uvmirror.multiplier;if(R.cost){X.value*=R.cost}if(R.mass){Q.value*=R.mass}if(R.time){L.value*=R.time}}O=Z.satellite;M+=this.buildRow(O.cost,X);M+=this.buildRow(O.mass,Q);M+=this.buildRow(O.devtime,L);M+=this.buildRow(O.bus.cost,K);M+=this.buildRow(O.bus.mass,G);M+=this.buildRow(O.bus.devtime,W);M+=this.buildRow(O.bus.diameter,J);M+=this.buildRow(O.bus.slots,U.bus.instrumentslots)}}else{if(Y=="instruments"){T=this.getInstrument(T);V=Z.instruments;M+=this.buildRow(V.cost,T.cost);M+=this.buildRow(V.mass,T.mass);M+=this.buildRow(V.temperature,T.temp);M+=this.buildRow(V.devtime,T.time)}else{if(Y=="cooling"){var aa=Z.cooling;M+=this.buildRow(aa.temperature,N.temperature);M+=this.buildRow(aa.cost,N.cooling.cost);M+=this.buildRow(aa.mass,N.cooling.mass);if(N.cooling.time.value>0){M+=this.buildRow(Z.cooling.devtime,N.cooling.time)}M+=this.buildRow(aa.life,N.cooling.life);M+=this.buildRow(aa.risk,this.makeValue(N.cooling.risk*100,"%"))}else{if(Y=="site"){if(g(P.site[T].latitude,"number")){M+=this.buildRow(Z.site.location,P.site[T].latitude.toFixed(2)+"&deg;, "+P.site[T].longitude.toFixed(2)+"&deg;")}if(P.site[T].operator){M+=this.buildRow(Z.site.operator,this.phrases.operator[P.site[T].operator].label)}M+=this.buildRow(Z.site.trajectories,Z.site.options[T].trajectories);var I="";for(var S in P.site[T].orbits){if(P.site[T].orbits[S]){I+=""+Z.orbit.options[S].label+"<br />"}}M+=this.buildRow(Z.site.orbits,I);if(g(P.site[T].risk,"number")){M+=this.buildRow(Z.site.risk,(P.site[T].risk*100).toFixed(0)+"%")}}else{if(Y=="orbit"){S=P.orbit[T];if(S.altitude){M+=this.buildRow(Z.orbit.altitude,S.altitude)}if(S.period){M+=this.buildRow(Z.orbit.period,S.period)}if(S.obsfrac){M+=this.buildRow(Z.orbit.obsfrac,{value:S.obsfrac*100,units:"%",dimension:"percent"})}if(S.fuellife){M+=this.buildRow(Z.orbit.fuellife,S.fuellife)}if(S.temperature){M+=this.buildRow(Z.orbit.temperature,S.temperature)}if(S.groundcost){M+=this.buildRow(Z.orbit.groundcost,S.groundcost)}if(S.risk){M+=this.buildRow(Z.orbit.risk,{value:S.risk*100,units:"%",dimension:"percent"})}}}}}}M+='<div class="clearall"></div>';e("#designer_"+Y+" .details").html(M).addClass("padded").show();return this};H.prototype.formatScenario=function(i){return""+((g(i.description,"string"))?i.description:"").replace(/%COST%/,this.formatValueSpan(i.budget))+""};H.prototype.updateOptions=function(){var G=this.phrases;e("#options").html("<h3>"+G.ui.menu.options.label+'</h3><form id="optionform"><ul></ul>');for(var i in G.ui.options){html='<li><label for="change'+i+'">'+G.ui.options[i]+'</label> <select id="change'+i+'" name="change'+i+'">';if(i=="currency"){for(var I in G.ui[i]){html+='<option value="'+I+'"'+(I==this.settings.currency?' selected="selected"':"")+">"+G.ui.currency[I].label+" "+G.ui.currency[I].symbol+"</option>"}}else{for(var I in G.ui.units){if(G.ui.units[I].dimension==i&&G.ui.units[I].selectable){html+='<option value="'+I+'"'+(I==this.settings[i]?' selected="selected"':"")+">"+G.ui.units[I].label+"</option>"}}}html+="</select></li>";e("#options ul").append(html);e("form#optionform #change"+i).on("change",{me:this,o:i},function(J){J.data.me.settings[J.data.o]=e(this).val();J.data.me.updateUnits()})}this.addCloser(e("#options"),{me:this},function(J){J.preventDefault();J.data.me.closeModal(e("#options"))});return this};H.prototype.updateUnits=function(){var K=e(".convertable");var L,N,G,I,M;for(var J=0;J<K.length;J++){L=e(K[J]);G=L.attr("data-value");I=L.attr("data-units");M=L.attr("data-dimension");if(G&&I&&M){L.html(this.formatValue({value:G,units:I,dimension:M}))}}this.updateDropdown("mirror_size");this.updateDropdown("cooling_temperature");return this};H.prototype.updateValue=function(P,O,G){var J;if(g(P,"object")){J=P}else{if(g(P,"string")){J=e("."+P+".value")}}if(J.length>0){if(g(O,"object")){var N={value:parseFloat(J.attr("data-value"),10),units:J.attr("data-units"),dimension:J.attr("data-dimension")};if(G&&N.dimension==O.dimension){var L=this;var M=20;if(!G){G=400}var Q=new Date();var K=0;if(O.units!=N.units){O=this.convertValue(O,N.dimension)}function I(){var i=(new Date())-Q;if(i>G){J.html(L.formatValue(O)).attr({"data-value":O.value,"data-units":O.units,"data-dimension":O.dimension}).addClass("convertable")}else{J.html(L.formatValue({value:(N.value+(O.value-N.value)*(i/G)),units:N.units,dimension:N.dimension}));requestAnimFrame(I)}}I()}else{J.attr({"data-value":O.value,"data-units":O.units,"data-dimension":O.dimension}).html(this.formatValue(O)).addClass("convertable")}}else{J.html(O)}}return this};H.prototype.formatValueSpan=function(G,i){i=(i)?" "+i:"";return(g(G,"object")?'<span class="value'+i+' convertable" data-value="'+G.value+'" data-units="'+G.units+'" data-dimension="'+G.dimension+'">'+this.formatValue(G)+"</span>":'<span class="value'+i+'">'+G+"</span>")};H.prototype.copyValue=function(i){if(g(i,"object")){return JSON.parse(JSON.stringify(i))}return{}};H.prototype.getValue=function(i){var G=e(i);if(G.length>0){if(G.prop("tagName")=="SELECT"){return G.find(":selected").attr("value")}if(G.prop("tagName")=="INPUT"){return G.val()}}return""};H.prototype.getChoice=function(G){var I=this.choices;if(G=="mirror.cost"){v=(I.mirror?this.copyValue(this.data.mirror[I.mirror].cost):this.makeValue(0,"GBP"));v.value=-v.value;if(I.deployablemirror&&this.data.deployablemirror.multiplier.cost){v.value*=this.data.deployablemirror.multiplier.cost}if(I.uvmirror&&this.data.uvmirror.multiplier.cost){v.value*=this.data.uvmirror.multiplier.cost}}else{if(G=="mirror.mass"){v=(I.mirror?this.copyValue(this.data.mirror[I.mirror].mass):this.makeValue(0,"kg"));if(I.deployablemirror&&this.data.deployablemirror.multiplier.mass){v.value*=this.data.deployablemirror.multiplier.mass}if(I.uvmirror&&this.data.uvmirror.multiplier.mass){v.value*=this.data.uvmirror.multiplier.mass}}else{if(G=="mirror.time"){v=(I.mirror?this.copyValue(this.data.mirror[I.mirror].devtime):this.makeValue(0,"months"));if(I.deployablemirror&&this.data.deployablemirror.multiplier.time){v.value*=this.data.deployablemirror.multiplier.time}if(I.uvmirror&&this.data.uvmirror.multiplier.time){v.value*=this.data.uvmirror.multiplier.time}}else{if(G=="mirror.prob"){v=(I.mirror?this.data.mirror[I.mirror].risk:1);if(I.deployablemirror&&this.data.deployablemirror.risk){v*=this.data.deployablemirror.risk}if(I.uvmirror&&this.data.uvmirror.risk){v*=this.data.uvmirror.risk}}else{if(G=="mirror"){v=(I.mirror)?this.data.mirror[I.mirror].diameter:this.makeValue(0,"m")}else{if(G=="cooling.cost"){v=(I.cooling?this.copyValue(I.cooling.cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(G=="cooling.mass"){v=(I.cooling&&I.cooling.mass?this.copyValue(I.cooling.mass):this.makeValue(0,"kg"))}else{if(G=="cooling.passive.mass"){v=(I.cooling&&I.cooling.passive?this.copyValue(I.cooling.passive):this.makeValue(0,"kg"))}else{if(G=="cooling.active.mass"){v=(I.cooling&&I.cooling.active?this.copyValue(I.cooling.active):this.makeValue(0,"kg"))}else{if(G=="cooling.cryogenic.mass"){v=(I.cooling&&I.cooling.cryogenic?this.copyValue(I.cooling.cryogenic):this.makeValue(0,"kg"))}else{if(G=="cooling.time"){v=(I.cooling?this.copyValue(I.cooling.time):this.makeValue(0,"months"))}else{if(G=="cooling.life"){v=(I.cooling&&I.cooling.life?this.copyValue(I.cooling.life):this.makeValue(99,"years"))}else{if(G=="cooling.prob"){v=1;if(I.cooling&&I.cooling.risk){v=I.cooling.risk}}else{if(G=="satellite.cost"){v=(I.mirror?this.copyValue(this.data.mirror[I.mirror].bus.cost):this.makeValue(0,"GBP"));if(I.deployablemirror&&this.data.deployablemirror.multiplier.bus.cost){v.value*=this.data.deployablemirror.multiplier.bus.cost}v.value=-v.value}else{if(G=="satellite.mass"){v=(I.mirror?this.copyValue(this.data.mirror[I.mirror].bus.mass):this.makeValue(0,"kg"));if(I.deployablemirror&&this.data.deployablemirror.multiplier.bus.mass){v.value*=this.data.deployablemirror.multiplier.bus.mass}}else{if(G=="satellite.time"){v=(I.mirror?this.copyValue(this.data.mirror[I.mirror].bus.devtime):this.makeValue(0,"months"));if(I.deployablemirror&&this.data.deployablemirror.multiplier.bus.time){v.value*=this.data.deployablemirror.multiplier.bus.time}}else{if(G=="instruments.time"){v=(I.instrument&&I.instrument.time)?I.instrument.time:this.makeValue(0,"months")}else{if(G=="instruments.cost"){v=(I.instrument&&I.instrument.cost)?I.instrument.cost:this.makeValue(0,"GBP");v.value=-v.value}else{if(G=="instruments.mass"){v=(I.instrument&&I.instrument.mass)?I.instrument.mass:this.makeValue(0,"kg")}else{if(G=="instruments.prob"){v=(I.instrument&&I.instrument.risk)?I.instrument.risk:1}else{if(G=="site"){v=(I.site?this.phrases.designer.site.options[I.site].label:"")}else{if(G=="site.prob"){v=0;if(I.site){v=(this.data.site[I.site].risk?this.data.site[I.site].risk:1)}}else{if(G=="vehicle"){v=(I.vehicle?this.phrases.designer.vehicle.options[I.vehicle].label:"")}else{if(G=="vehicle.cost"){v=(I.vehicle?this.copyValue(this.data.vehicle[I.vehicle].cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(G=="vehicle.prob"){v=0;if(I.vehicle){v=(this.data.vehicle[I.vehicle].risk?this.data.vehicle[I.vehicle].risk:1)}}else{if(G=="ground.cost"){var i=I.mission?this.copyValue(this.data.mission[I.mission].life):this.makeValue(0,"months");if(I.orbit){v=this.copyValue(this.data.orbit[I.orbit].groundcost);v.value*=-this.convertValue(i,"years").value}else{v=this.makeValue(0,"GBP")}}else{if(G=="temperature"){v=(I.temperature)?I.temperature:this.makeValue(400,"K");if(I.orbit){v=this.data.orbit[I.orbit].temperature}}else{if(G=="launch.cost"){v=(I.vehicle?this.copyValue(this.data.vehicle[I.vehicle].cost):this.makeValue(0,"GBP"));v.value*=-(I.orbit?this.data.orbit[I.orbit].multiplier.launchcost:1)}else{if(G=="orbit"){v=(I.orbit)?this.phrases.designer.orbit.options[I.orbit].label:""}else{if(G=="orbit.prob"){v=0;if(I.orbit){v=(this.data.orbit[I.orbit].risk)?this.data.orbit[I.orbit].risk:1}}else{if(G=="mission.time"){v=(I.mission?this.copyValue(this.data.mission[I.mission].life):this.makeValue(0,"months"))}else{if(G=="mission.prob"){v=(I.mission&&this.data.mission[I.mission].risk?this.data.mission[I.mission].risk:1)}else{if(G=="fuel.time"){v=(I.orbit?this.copyValue(this.data.orbit[I.orbit].fuellife):this.makeValue(0,"months"))}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return v};H.prototype.processSummaryList=function(L,K,M){M++;var J='<ul class="summary">';for(var I in L){var G=L[I];if(G.value||G.list){J+="<li>";if(I&&G.value){J+='<span class="label '+I+'">'+G.label+"</span>"+this.formatValueSpan(G.value,K+" "+I)}if(G.list){J+=this.processSummaryList(G.list,(M==1?K:""))}J+="</li>"}}J+="</ul>";return J};H.prototype.updateSummaryList=function(){for(var I in this.table){var J="";var i=I;if(i.indexOf("_")>0){i=i.substr(0,i.indexOf("_"))}var K=i;if(i!=I){K+=" "+I}var L=0;if(this.table[I].value){this.updateValue("baritem ."+I,this.table[I].value)}var G='<h3><img src="images/cleardot.gif" class="icon '+K+'" /> <span class="label '+K+'">'+this.table[I].label+"</span> "+(this.table[I].value?this.formatValueSpan(this.table[I].value,K):"")+"</h3>";if(this.table[I].list){G+=this.processSummaryList(this.table[I].list,i,L)}e("#summaryext_"+i).addClass("padded").html(G)}return this};H.prototype.updateSummary=function(){this.log("updateSummary");var O,ac,V,W,Q,P,G,M,T,Y,X,aa,R,S,ab;var N="";ab=this.phrases;S=ab.ui.summary;var L={};var Z={};var U={};var J={};var K={};L.mirror=this.getChoice("mirror.prob");L.site=this.getChoice("site.prob");L.vehicle=this.getChoice("vehicle.prob");L.cooling=this.getChoice("cooling.prob");L.orbit=this.getChoice("orbit.prob");L.instruments=this.getChoice("instruments.prob");L.mission=this.getChoice("mission.prob");L.total=L.orbit*L.site*L.vehicle*L.mirror*L.cooling*L.instruments*L.mission;if(L.total<0.5&&L.total>0){this.warnings.push({text:ab.warnings.risky})}if(L.total==0){this.errors.push({text:ab.errors.impossible})}Z.mirror=this.getChoice("mirror.cost");Z.satellite=this.getChoice("satellite.cost");Z.cooling=this.getChoice("cooling.cost");Z.instruments=this.getChoice("instruments.cost");Z.dev=this.sumValues(Z.mirror,Z.satellite,Z.cooling,Z.instruments);Z.vehicle=this.getChoice("vehicle.cost");Z.ground=this.getChoice("ground.cost");Z.launch=this.getChoice("launch.cost");Z.operations=this.sumValues(Z.launch,Z.ground);Z.total=this.sumValues(Z.dev,Z.operations);Z.free=this.sumValues(this.scenario.budget,Z.total);if(Z.free.value<0){this.errors.push({text:ab.errors.bankrupt})}J.mirror=this.getChoice("mirror.time");J.satellite=this.getChoice("satellite.time");J.instruments=this.getChoice("instruments.time");J.cooling=this.getChoice("cooling.time");J.total=this.sumValues(J.mirror,J.satellite,J.cooling,J.instruments);J.mission=this.getChoice("mission.time");J.lifecooling=this.getChoice("cooling.life");J.fuel=this.getChoice("fuel.time");O=this.minValue(J.mission,J.lifecooling,J.fuel);O.value*=(this.choices.orbit)?this.data.orbit[this.choices.orbit].obsfrac:0;J.observing=O;ac=this.convertValue(J.fuel,J.mission.units);if(J.mission.value>ac.value){this.warnings.push({text:ab.warnings.fuellifetime.replace(/%LIFE%/,this.formatValue(ac)).replace(/%DURATION%/,this.formatValue(J.mission)),link:"#designer_orbit"})}V=this.convertValue(J.lifecooling,J.mission.units);if(J.mission.value>V.value){this.warnings.push({text:ab.warnings.coolinglifetime.replace(/%LIFE%/,this.formatValue(V)).replace(/%DURATION%/,this.formatValue(J.mission)),link:"#designer_orbit"})}if(L.total>0&&J.mission.value==0){this.warnings.push({text:ab.warnings.missionlife,link:"#designer_orbit"})}U.mirror=this.getChoice("mirror.mass");U.satellite=this.getChoice("satellite.mass");U.cooling=this.getChoice("cooling.mass");U.instruments=this.getChoice("instruments.mass");U.total=this.sumValues(U.mirror,U.satellite,U.cooling,U.instruments);if(this.choices.orbit&&this.choices.vehicle){W=this.convertValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO),U.total.units);if(U.total.value>W.value){this.errors.push({text:ab.errors.heavy})}if(U.total.value<=W.value&&U.total.value>0.8*W.value){this.warnings.push({text:ab.warnings.heavy})}}this.table.success.value=this.formatPercent(L.total);this.table.success.list.success_orbit.value=this.formatPercent(L.orbit);this.table.success.list.success_site.value=this.formatPercent(L.site);this.table.success.list.success_vehicle.value=this.formatPercent(L.vehicle);this.table.success.list.success_deploy.value=this.formatPercent(L.mirror);this.table.success.list.success_cooling.value=this.formatPercent(L.cooling);this.table.success.list.success_instruments.value=this.formatPercent(L.instruments);this.table.success.list.success_mission.value=this.formatPercent(L.mission);this.updateTable("cost_available","value",Z.free);this.updateTable("cost_initial","value",this.scenario.budget);this.updateTable("cost_dev_total","value",Z.dev);this.updateTable("cost_dev_satellite","value",Z.satellite);this.updateTable("cost_dev_mirror","value",Z.mirror);this.updateTable("cost_dev_cooling","value",Z.cooling);this.updateTable("cost_dev_instruments","value",Z.instruments);this.updateTable("cost_operations_total","value",Z.operations);this.updateTable("cost_operations_launch","value",Z.launch);this.updateTable("cost_operations_ground","value",Z.ground);this.updateTable("cost_total","value",Z.total);this.table.cost_available.list.cost_available.value=Z.free;this.updateTable("time_dev_total","value",J.total);this.table.time_dev_total.list.time_dev_total.value=J.total;this.updateTable("time_dev_satellite","value",J.satellite);this.updateTable("time_dev_mirror","value",J.mirror);this.updateTable("time_dev_cooling","value",J.cooling);this.updateTable("time_dev_instruments","value",J.instruments);this.updateTable("time_mission","value",J.mission);this.updateTable("time_cooling","value",J.lifecooling);this.updateTable("time_fuel","value",J.fuel);this.updateTable("time_observing","value",J.observing);this.table.mass_total.value=U.total;this.table.mass_total.list.mass_satellite.value=U.satellite;this.table.mass_total.list.mass_mirror.value=U.mirror;this.table.mass_total.list.mass_cooling_total.value=U.cooling;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.value=this.getChoice("cooling.passive.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.value=this.getChoice("cooling.cryogenic.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.value=this.getChoice("cooling.active.mass")}this.table.mass_total.list.mass_instruments.value=U.instruments;Q=0;this.table.science_total.list={};if(this.scenario&&this.scenario.requires&&g(this.scenario.requires,"object")){var I=this.scenario.requires;this.table.science_total.list={};for(T=0;T<I.length;T++){G=0;if(I[T]["instruments"]){P=false;if(this.choices.instruments){for(Y=0;Y<I[T]["instruments"].length;Y++){P=false;for(X=0;X<this.choices.instruments.length;X++){if((this.choices.instruments[X].type==I[T]["instruments"][Y].type||this.choices.instruments[X].type=="both")&&this.choices.instruments[X].wavelength==I[T]["instruments"][Y].wavelength){P=true}}if(P){G+=100}}}if(I[T]["instruments"].length>0){G/=I[T]["instruments"].length}if(G!=100){this.errors.push({text:I[T].error})}}if(I[T]["mirror"]){M=this.copyValue(I[T]["mirror"]);O=this.convertValue(this.getChoice("mirror"),M.units);if(O.value<M.value){this.errors.push({text:I[T].error})}else{G=100}}if(I[T]["devtime"]){M=this.copyValue(I[T]["devtime"]);O=this.convertValue(this.table.time_dev_total.value,M.units);if(O.value>M.value){this.errors.push({text:I[T].error.replace(/%DEVTIME%/,this.formatValue(O))})}else{G=100}}if(I[T]["vehicle"]){P=false;if(g(I[T]["vehicle"],"object")){for(Y=0;Y<I[T]["vehicle"].length;Y++){if(this.choices.vehicle==I[T]["vehicle"][Y]){P=true}}}else{if(this.choices.vehicle==I[T]["vehicle"]){P=true}}if(!P){this.errors.push({text:I[T].error})}else{G=100}}if(I[T]["site"]){M=(this.choices.vehicle)?ab.designer.vehicle.options[this.choices.vehicle].label:"";if(this.choices.vehicle==I[T]["vehicle"]){this.errors.push({text:I[T].error})}else{G=100}}if(I[T]["observingtime"]){M=this.copyValue(I[T]["observingtime"]);O=this.convertValue(this.table.time_dev_total.list.time_observing.value,M.units);if(O.value<M.value){this.errors.push({text:I[T].error.replace(/%OBSERVINGTIME%/,this.formatValue(O))})}else{G=100}}if(!I[T]["label"]){I[T]["label"]="UNKNOWN"}this.table.science_total.list["target"+T]={label:(O?I[T].label.replace(/%VALUE%/,this.formatValue(M)):I[T].label),value:this.makeValue(G,"%")};Q+=G}if(I.length>0){Q/=I.length}else{Q=100}}this.table.science_total.value=this.makeValue(Q,"%");this.table.profile_total.list.profile_site.value=this.getChoice("site");this.table.profile_total.list.profile_vehicle.value=this.getChoice("vehicle");this.table.profile_total.list.profile_instruments.value=(this.choices.instruments)?this.choices.instruments.length:0;this.table.profile_total.list.profile_mirror.value=this.getChoice("mirror");this.table.profile_total.list.profile_temperature.value=this.getChoice("temperature");this.table.profile_total.list.profile_orbit.value=this.getChoice("orbit");aa=new Date();R=this.convertValue(J.total,"months");aa.setUTCMonth(aa.getUTCMonth()+R.value);this.launchdate=aa.toDateString();this.table.profile_total.list.profile_launch.value=aa.toDateString();R=this.convertValue(this.minValue(J.mission,J.fuel,J.lifecooling),"months");aa.setUTCMonth(aa.getUTCMonth()+R.value);this.table.profile_total.list.profile_end.value=aa.toDateString();if(this.choices.orbit&&this.choices.site&&this.choices.vehicle&&this.errors.length==0){this.enableLaunch()}else{this.disableLaunch()}this.updateSummaryList();return this};H.prototype.enableLaunch=function(){this.launchable=true;e(".togglelaunch").show();return this};H.prototype.disableLaunch=function(){this.launchable=false;e(".togglelaunch").hide();return this};H.prototype.processFile=function(M){if(g(M,"string")){M=M.split(/[\n\r]/)}var P,G,I,L,N,K,Q,J,O;P=false;L="";N=[];for(var K=0;K<M.length;K++){G=M[K].indexOf("---");if(P&&G==0){P=false}if(P){I=M[K].split(/\:\t/);if(I[0]=="MODE"){L=I[1]}else{N.push({key:I[0],value:I[1]})}}if(!P&&G==0){P=true}}if(L){this.setMode(L,function(){function i(){var S="";for(K=0;K<N.length;K++){if(N[K].key=="SCENARIO"){for(Q=0;Q<this.scenarios.length;Q++){if(this.scenarios[Q].name==N[K].value){S=Q}}}}this.chooseScenario(S);function R(){for(K=0;K<N.length;K++){J=N[K].key;O=N[K].value;if(J=="MIRROR"){e("#mirror_size").val(O)}if(J=="DEPLOYABLE"&&O=="true"){this.changeToggle("toggledeployable","mirror_deployable_yes")}if(J=="UVQUALITY"&&O=="true"){this.changeToggle("toggleuv","mirror_uv_yes")}if(J=="VEHICLE"){e("#vehicle_rocket_"+O).trigger("click")}if(J=="SITE"){e("a."+O).trigger("click")}if(J=="COOLING"&&O=="true"){this.changeToggle("hascooling","cooling_yes")}if(J=="COOLINGACTIVE"&&O=="true"){this.changeToggle("cooling_active","cooling_active_yes")}if(J=="COOLINGCRYO"){e("#cooling_cryogenic").val(O)}if(J=="COOLINGTEMP"){e("#cooling_temperature").val(O)}if(J=="DURATION"){e("#mission_duration").val(O)}if(J=="ORBIT"){e("#mission_orbit").val(O).trigger("change")}if(J.indexOf("INSTRUMENT")==0){var T=O.split(/\;/);e("#wavelengths").val(T[0]);e("#instruments").val(T[1]);e("#instrument_name").val(T[2]);e(".add_instrument").trigger("click")}}}this.showView("designer_objectives","",R)}this.showView("scenarios","",i)})}return this};H.prototype.save=function(){if(!g(Blob,"function")){return this}var K,G,Q,M;G=this.choices;Q="true";M="false";function P(R,i){return R+":	"+i+"\n"}K="---\n";if(this.settings.mode){K+=P("MODE",this.settings.mode)}if(this.scenario.name){K+=P("SCENARIO",this.scenario.name)}if(G.mirror){K+=P("MIRROR",G.mirror)}if(G.deployablemirror){K+=P("DEPLOYABLE",(G.deployablemirror?Q:M))}if(G.uvmirror){K+=P("UVQUALITY",(G.uvmirror?Q:M))}for(var J=0;J<G.instruments.length;J++){K+=P("INSTRUMENT-"+(J+1),G.instruments[J].wavelength+";"+G.instruments[J].type+";"+G.instruments[J].name)}if(G.cool.passive){K+=P("COOLING",(G.cool.passive=="yes"?Q:M))}if(G.cool.active=="yes"){K+=P("COOLINGACTIVE",(G.cool.active=="yes"?Q:M))}if(G.cool.cryogenic){K+=P("COOLINGCRYO",G.cool.cryogenic)}if(G.vehicle){K+=P("VEHICLE",G.vehicle)}if(G.site){K+=P("SITE",G.site)}if(G.mission){K+=P("DURATION",G.mission)}if(G.orbit){K+=P("ORBIT",G.orbit)}K+="---\n";var I=new Blob([K],{type:"text/plain"});var O="spacetelescope.txt";function N(i){document.body.removeChild(i.target)}var L=document.createElement("a");L.download=O;L.innerHTML="Download File";if(window.webkitURL!=null){L.href=window.webkitURL.createObjectURL(I)}else{L.href=window.URL.createObjectURL(I);L.onclick=N;L.style.display="none";document.body.appendChild(L)}L.click();return this};H.prototype.goForLaunch=function(){this.log("goForLaunch");if(!this.launchable){this.showView("designer");return this}if(this.stage=="launch"){e(".togglelaunch").hide();e("body").addClass("showlaunch");e("#launch").show();var G=this.phrases.designer.orbit.options[this.choices.orbit].label;var J=this.phrases.designer.vehicle.options[this.choices.vehicle].label;var i=this.phrases.designer.site.options[this.choices.site].label;var I=this.formatValue(this.table.time_dev_total.list.time_dev_total.value);e("#launch").html("<h2>"+this.phrases.launch.title+"</h2><p>"+this.phrases.launch.intro.replace(/%DEVTIME%/,I).replace(/%VEHICLE%/,J).replace(/%SITE%/,i).replace(/%ORBIT%/,G).replace(/%LAUNCHDATE%/,this.launchdate)+'</p><div id="launchanimation">'+('<div id="launchpadbg"><img src="images/launchpad_'+this.choices.site+'.png" /></div><div id="launchpadfg"><img src="images/launchpad_'+this.choices.site+'_fg.png" /></div><div id="launchrocket"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div>')+'<div id="countdown" class="padded">Countdown</div></div><div id="launchnav" class="toppadded"></div><ul id="launchtimeline" class="toppadded"></ul>');e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"});this.launchstep=0;if(this.launchstep==0){this.countdown(10)}}};H.prototype.countdown=function(G){this.launchstep=1;var I=this;if(G>0){e("#countdown").html('<div class="tick">'+this.phrases.launch.countdown[G.toFixed(0)]+"</div>");G--;if(!this.outtatime){clearTimeout(this.outtatime)}this.outtatime=setTimeout(function(){I.countdown(G)},1000)}else{e("#countdown").html(""+this.phrases.launch.countdown.liftoff);this.ok=true;this.okcool=true;this.temperature=this.copyValue(this.data.orbit[this.choices.orbit].temperature);this.launch()}};H.prototype.launch=function(){this.launchstep++;e("#launchnav").html('<a href="#" class="button fancybtn">'+this.phrases.launch.next+"</a>");var P={mirror:this.getChoice("mirror.prob"),site:this.getChoice("site.prob"),vehicle:this.getChoice("vehicle.prob"),cooling:this.getChoice("cooling.prob"),orbit:this.getChoice("orbit.prob"),mission:this.getChoice("mission.prob")};var X=this.phrases.launch.status;var S=true;var I=e("#launchtimeline");var N=e("#launchanimation");var ac=this.phrases;var ab=this.data;var R=this.choices;function W(i){I.prepend(e(i).hide().fadeIn(1000))}if(this.ok){if(this.launchstep==2){this.ok=this.roll(P.site*P.vehicle);W("<li>"+this.buildRow(ac.launch.launch.label,(this.ok?ac.launch.launch.success:ac.launch.launch.fail),"launch_launch")+"</li>");if(this.ok){N.addClass(R.vehicle).addClass("launched");this.exhaust=new C()}}else{this.exhaust.stop()}if(this.launchstep==3){this.ok=this.roll(P.orbit);W("<li>"+this.buildRow(ac.launch.orbit.label,(this.ok?ac.launch.orbit.success:ac.launch.orbit.fail).replace(/%ORBIT%/,this.getChoice("orbit")),"launch_orbit")+'<div id="launchorbit"></div></li>');if(this.ok){N.html("");this.launchanim=new F({id:"launchanimation",height:"50%",orbits:[R.orbit],phrases:ac.designer.orbit,data:this.data.orbit,interactive:false});this.launchanim.resize()}}if(this.launchstep==4){this.ok=this.roll(P.mirror);W("<li>"+this.buildRow(ac.launch.deploy.label,(this.ok?ac.launch.deploy.success:ac.launch.deploy.fail),"launch_mirror")+"</li>");N.html("");this.launchanim=new E({id:"launchanimation",spacetel:this,height:"50%",state:{mirror:this.ok},colourize:{mirror:true,bus:false,cooling:{passive:false,cryogenic:false,active:false}}});this.launchanim.resize()}if(this.launchstep==5){var M=true;var V=true;var Y="";var J=this.convertValue(R.instrument.temp,"K");this.launchtherm=new o({canvas:this.launchanim.paper,required:J.value,phrasebook:{req:ac.designer.instruments.temperature,y:ac.ui.summary.profile.temperature},context:this,x:0,y:0,width:this.launchanim.paper.width*0.3,format:this.formatValue});if(R.hascooling){if(R.cool.temperature){var U=this.data.cooling.temperature[e("#cooling_temperature").val()];if(U.temperature){this.temperature=this.copyValue(U.temperature)}if(!U.risk){U.risk=1}M=this.roll(U.risk);Y+="<li>"+this.buildRow(ac.launch.cooling.label.label,(M?ac.launch.cooling.label.success:ac.launch.cooling.label.fail),"launch_temperature")+"</li>";this.launchanim.state.cooling={passive:M,active:M,cryogenic:M};this.launchanim.colourize.cooling={passive:true,active:true,cryogenic:true};this.launchanim.build()}if(this.data.cooling.passive){Y+="<li>"+this.buildRow(ac.launch.cooling.label.label,"","launch_cooling")+"</li>";p=R.cool.passive;if(p=="yes"){M=this.roll(this.data.cooling.passive[p].risk);V=M;if(M){this.temperature.value*=this.data.cooling.passive[p].multiplier.temperature}Y+='<li class="indent">'+this.buildRow(ac.launch.cooling.passive.label,(M?ac.launch.cooling.passive.success:ac.launch.cooling.passive.fail),"launch_passive")+"</li>";this.launchanim.state.cooling.passive=M;this.launchanim.colourize.cooling.passive=true;this.launchanim.build();if(this.data.cooling.active&&V){p=R.cool.active;if(p=="yes"){M=this.roll(this.data.cooling.active[p].risk);if(M){this.temperature.value*=this.data.cooling.active[p].multiplier.temperature}Y+='<li class="indent">'+this.buildRow(ac.launch.cooling.active.label,(M?ac.launch.cooling.active.success:ac.launch.cooling.active.fail),"launch_active")+"</li>";this.launchanim.state.cooling.active=M;this.launchanim.colourize.cooling.active=true;this.launchanim.build()}}if(this.data.cooling.cryogenic&&V){p=R.cool.cryogenic;if(p&&p!="none"){M=this.roll(this.data.cooling.cryogenic[p].risk);if(M){this.temperature.value*=this.data.cooling.cryogenic[p].multiplier.temperature}Y+='<li class="indent">'+this.buildRow(ac.launch.cooling.cryogenic.label,(M?ac.launch.cooling.cryogenic.success:ac.launch.cooling.cryogenic.fail),"launch_cryogenic")+"</li>";this.launchanim.state.cooling.cryogenic=M;this.launchanim.colourize.cooling.cryogenic=true;this.launchanim.build()}}}}this.launchtherm.value(this.temperature.value)}Y+='<li class="indent">'+this.buildRow(ac.launch.cooling.achieved.label,(M?ac.launch.cooling.achieved.success:ac.launch.cooling.achieved.fail).replace(/\%TEMPERATURE%/,this.formatValue(this.temperature)))+"</li>";W(Y)}if(this.launchstep==6){var K=0;var Y="";if(R.instruments){Y+="<li>"+this.buildRow(ac.launch.instruments.label,"")+"</li>";this.beakers=[];var Q=(this.launchanim.paper.height/(R.instruments.length+1));for(var Z=0;Z<R.instruments.length;Z++){this.beakers.push(new D({canvas:this.launchanim.paper,x:this.launchanim.paper.width*0.8,y:(Q*(Z+1)-this.launchanim.paper.width*0.04),width:this.launchanim.paper.width*0.08,height:this.launchanim.paper.width*0.08,label:R.instruments[Z].name}));var O=this.convertValue(this.data.wavelengths[R.instruments[Z].wavelength].temperature,this.temperature.units);S=(O.value>=this.temperature.value)?true:false;R.instruments[Z].ok=S;Y+='<li class="indent">'+this.buildRow(R.instruments[Z].name+" ("+ac.wavelengths[R.instruments[Z].wavelength].label+" "+ac.designer.instruments.options.instrument[R.instruments[Z].type].label+")",(S?ac.launch.instruments.success:ac.launch.instruments.fail),"launch_instrument")+"</li>"}this.launchanim.colourize.bus=true;this.launchanim.build()}W(Y)}if(this.launchstep==7){var K=0;var Y="";if(R.instruments){Y+="<li>"+this.buildRow(ac.launch.science.label,"")+"</li>";for(var Z=0;Z<R.instruments.length;Z++){if(R.instruments[Z].ok){var U=this.copyValue(this.data.instrument.options[R.instruments[Z].type]);if(!U.risk){U.risk=1}U.risk*=P.mission;S=this.roll(U.risk);var G=100;if(!S){G=Math.random()*100}K+=G;this.beakers[Z].value(G/100);tmp=(S?ac.launch.science.success:ac.launch.science.fail).replace(/%PERCENT%/,this.formatValue(this.makeValue(G,"%")));Y+='<li class="indent">'+this.buildRow(R.instruments[Z].name+" ("+ac.wavelengths[R.instruments[Z].wavelength].label+" "+ac.designer.instruments.options.instrument[R.instruments[Z].type].label+")",tmp,"launch_science")+"</li>"}}if(R.instruments.length>0){K/=R.instruments.length}}tmp=(this.ok?ac.launch.overall.success:ac.launch.overall.fail).replace(/\%PERCENT%/,this.formatValue(this.makeValue(K,"%")));W(Y);W("<li>"+this.buildRow(ac.launch.overall.label,tmp,"finalresult")+"</li>");e(".printable").remove();I.after('<div class="printable toppadded"><a href="#" class="button fancybtn">'+ac.designer.proposal.reprint+"</a></div>").fadeIn();e("#launchnav").html("");this.launchstep=0}}if(!this.ok){e("#launchnav a.button").remove();if(!this.relaunched){var T=this.table.time_dev_total.list.time_dev_total.value;var L=this.copyValue(T);L.value*=0.5;var aa=this.sumValues(this.getChoice("mirror.cost"),this.getChoice("satellite.cost"),this.getChoice("cooling.cost"),this.getChoice("instruments.cost"));aa.value*=0.5;aa=this.sumValues(aa,this.getChoice("vehicle.cost"));aa.value*=-1;e("#launchnav").html('<div class="relaunch toppadded"><p>'+ac.launch.relaunch.text.replace(/\%DEVTIME\%/,this.formatValue(T)).replace(/%RELAUNCHTIME%/,this.formatValue(L)).replace(/%RELAUNCHCOST%/,this.formatValueSpan(aa))+'</p><a href="#" class="button fancybtn">'+ac.launch.relaunch.label+"</a></div>")}else{e(".relaunch").remove()}}return this};H.prototype.relaunch=function(){this.relaunched=true;this.goForLaunch()};H.prototype.roll=function(i){if(!i){i=1}return(Math.random()>i)?false:true};H.prototype.setKey=function(G,i,I,J){for(A in G){if(A==i){G[A][I]=J;return G}else{if(G[A].list){G[A].list=this.setKey(G[A].list,i,I,J)}}}return G};H.prototype.updateTable=function(i,G,I){this.table=this.setKey(this.table,i,G,I);return this};H.prototype.convertValue=function(i,G){if(!g(i,"object")){return i}if(g(i.value,"string")&&i.value!="inf"){i.value=parseFloat(i.value,10)}i=this.copyValue(i);if(i.dimension=="length"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="ft"){i.value/=3.281}if(i.units=="km"){i.value*=1000}if(i.units=="mile"){i.value*=1609}if(i.units=="cubit"){i.value*=0.4572}if(i.units=="bluewhale"){i.value*=30}if(i.units=="yard"){i.value*=0.9144}if(G=="ft"){i.value*=3.281}if(G=="km"){i.value*=0.001}if(G=="mile"){i.value/=1609}if(G=="cubit"){i.value/=0.4572}if(G=="bluewhale"){i.value/=30}if(G=="yard"){i.value/=0.9144}i.units=G}if(i.units=="m"&&i.value>1000){i.value/=1000;i.units="km"}if(i.units=="ft"&&i.value>5280){i.value/=5280;i.units="mile"}if(i.units=="yard"&&i.value>5280){i.value/=5280;i.units="league"}}}else{if(i.dimension=="mass"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="lb"){i.value/=2.205}if(i.units=="t"){i.value*=1000}if(i.units=="elephant"){i.value*=5400}if(G=="lb"){i.value*=2.205}if(G=="t"){i.value/=1000}if(G=="elephant"){i.value/=5400}i.units=G}}}else{if(i.dimension=="temperature"){if(i.dimension==this.phrases.ui.units[G].dimension){if(i.units!=G){if(i.units=="C"){i.value+=273}else{if(i.units=="F"){i.value=(5/9)*(i.value-32)+273}}if(G=="C"){i.value-=273}else{if(G=="F"){i.value=(9/5)*(i.value-273)+32}}i.units=G}}}else{if(i.dimension=="time"){if(G=="years"||G=="months"||G=="days"||G=="hours"){if(i.units!=G){if(i.units=="months"){i.value/=12}else{if(i.units=="days"){i.value/=365.25}else{if(i.units=="hours"){i.value/=365.25*24}else{if(i.units=="minutes"){i.value/=365.25*24*60}}}}if(G=="months"){i.value*=12}else{if(G=="days"){i.value*=365.25}else{if(G=="hours"){i.value*=365.25*24}else{if(G=="minutes"){i.value*=365.25*24*60}}}}i.units=G}}}else{if(i.dimension=="angle"){if(G=="degrees"||G=="arcmin"||G=="arcsec"){if(i.units!=G){if(i.units=="arcmin"){i.value/=60}else{if(i.units=="arcsec"){i.value/=3600}}if(G=="arcmin"){i.value*=60}else{if(G=="arcsec"){i.value*=3600}}i.units=G}}}else{if(i.dimension=="currency"){if(this.data.currency[G]){if(i.units!=G){if(i.value!="inf"){if(this.data.currency[i.units].conv){i.value/=this.data.currency[i.units].conv}if(this.data.currency[G].conv){i.value*=this.data.currency[G].conv}}i.units=G}}}}}}}}return i};H.prototype.sumValues=function(){var J=Array.prototype.slice.call(arguments,0);var G,I,K;if(J.length>0){I=this.convertValue(J[0],J[0].units);for(K=1;K<J.length;K++){if(g(J[K],"object")&&J[K].dimension&&J[K].dimension===I.dimension){G=this.convertValue(J[K],J[0].units);I.value+=G.value}}return I}return{}};H.prototype.negativeValue=function(){var J=Array.prototype.slice.call(arguments,0);var G,I,K;if(J.length>0){I=this.copyValue(J[0]);I.value*=-1;return I}return{}};H.prototype.minValue=function(){var I=Array.prototype.slice.call(arguments,0);var G,K,J;if(I.length>0){J=this.convertValue(I[0],I[0].units);for(K=1;K<I.length;K++){if(g(I[K],"object")&&I[K].dimension&&I[K].dimension===I[0].dimension){G=this.convertValue(I[K],I[0].units);if(G.value<J.value){J=G}}}return J}return{}};function c(i){if(i<1e-9){return 1}if(g(i,"number")&&i<1){return Math.ceil(s.log10(1/i))+1}else{return 1}return 1}H.prototype.formatValue=function(I,M){if(g(I,"string")||g(I,"number")){return I}if(!(g(I,"object")&&I.dimension)){return""}ph=this.phrases;I=this.copyValue(I);if(g(M,"string")){M=parseInt(M,10)}var K;var L=I.dimension;if(L=="length"){I=this.convertValue(I,(this.settings.length)?this.settings.length:"m");if(!g(M,"number")){M=(I.units=="km"?0:c(I.value))}K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(I.value>1000000000000000){return b(I.value,K)}return""+f((I.value).toFixed(M)).replace(/\.0+$/,"").replace(/(\.0?[1-9]+)0+$/,"$1")+""+K}else{if(L=="mass"){I=this.convertValue(I,(this.settings.mass)?this.settings.mass:"kg");K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(!g(M,"number")){M=(I.value>=1000)?0:c(I.value)}if(I.value>1000000000000000){return b(I.value,K)}else{return""+f((I.value).toFixed(M)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+""+K}}else{if(L=="currency"){I=this.convertValue(I,(this.settings.currency)?this.settings.currency:"GBP");if(!g(M,"number")){M=0}var i=(ph.ui.million.compact)?ph.ui.million.compact:"";var J=(ph.ui.currency[I.units]&&ph.ui.currency[I.units].symbol)?ph.ui.currency[I.units].symbol:(ph.ui.currency.GBP.symbol?ph.ui.currency.GBP.symbol:"");if(I.value=="inf"||I.value>=1000000000000000){return"&infin;"}var G=(I.value<0)?"-":"";I.value=Math.abs(I.value);if(I.value>=1000){I.value/=1000;i=(ph.ui.billion.compact)?ph.ui.billion.compact:""}if(M==0){if(I.value<100){M=1}if(I.value<10){M=2}}var N=(I.value).toFixed(M).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1").replace(/^ /,"&thinsp;");return G+J+N+i}else{if(L=="temperature"){I=this.convertValue(I,(this.settings.temperature)?this.settings.temperature:"K");if(g(M,"string")){M=parseInt(M,10)}if(!g(M,"number")){M=(I.value>1000)?0:c(I.value)}K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(g(I.value,"string")){I.value=parseInt(I.value,10)}return""+f((I.value).toFixed(M).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+K}else{if(L=="time"){if(I.units=="years"&&I.value<5){I=this.convertValue(I,"months")}if(!g(M,"number")){M=(I.value>=6)?0:c(I.value)}K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(g(I.value,"string")){I.value=parseInt(I.value,10)}return""+f((I.value).toFixed(M).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+K}else{if(L=="percent"){I=I.value;if(!g(I,"number")){I=parseInt(I,10)}if(!g(I,"number")){return"0"+K}if(!g(M,"number")){M=1}K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"%";return""+f(I.toFixed(M)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+K}else{if(L=="angle"){if(I.units=="degrees"&&I.value<1){I=this.convertValue(I,"arcmin")}if(I.units=="arcmin"&&I.value<1){I=this.convertValue(I,"arcsec")}if(!g(M,"number")){M=(I.value>=10)?0:c(I.value)}K=(ph.ui.units[I.units])?ph.ui.units[I.units].unit:"";if(g(I.value,"string")){I.value=parseInt(I.value,10)}return""+f((I.value).toFixed(M).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+K}else{return I.value}}}}}}}};H.prototype.makeValue=function(i,G,I){if(!I){if(this.phrases.ui.units[G]){I=this.phrases.ui.units[G].dimension}else{if(this.phrases.ui.currency[G]){I="currency"}else{I="unknown"}}}return{value:i,units:G,dimension:I}};H.prototype.formatPercent=function(i,G){if(!g(i,"number")){i=0}if(!g(G,"number")){G=1}return""+f((i*100).toFixed(G)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+"%"};H.prototype.toggleFullScreen=function(){this.elem=document.getElementById("application");if(u.isFullScreen()){u.cancelFullScreen(this.elem);this.fullscreen=false;e("#application").removeClass("fullscreen")}else{u.requestFullScreen(this.elem);this.fullscreen=true;e("#application").addClass("fullscreen")}return this};H.prototype.parseChoices=function(Q,ad){Q=(Q&&Q.indexOf("designer_")==0)?Q.substr(9):"";this.log("parseChoices",Q);var aa,Y,P,ag,S,O,T,V,X,R,ac,U,af,J,aj,G;this.errors=[];this.warnings=[];var N=this.choices;var ae=this.data;aa=e("#mission_duration").val();N.mission=(aa&&ae.mission[aa])?aa:"";Y=e("#mirror_size").val();N.mirror=(Y&&ae.mirror[Y])?Y:"";G=e("input[name=toggledeployable]:checked").val();N.deployablemirror=(G&&G=="yes")?true:false;P=e("input[name=toggleuv]:checked").val();N.uvmirror=(P&&P=="yes")?true:false;O=e("#designer_vehicle input[name=vehicle_rocket]:checked").val();N.vehicle=(O&&ae.vehicle[O])?O:"";T=e("#site").val();R=false;N.site=(T&&ae.site[T])?T:"";X=e("#mission_orbit").val();if(X&&ae.orbit[X]){N.orbit=X}else{N.orbit=""}ag=e("input[name=hascooling]:checked").val();N.hascooling=(ag&&ag=="yes")?true:false;N.cool={};S=e("#cooling_temperature").val();N.cool.temperature=(S)?S:"";N.cool.passive=this.getValue("input[name=cooling_passive]:checked");N.cool.active=this.getValue("input[name=cooling_active]:checked");N.cool.cryogenic=e("#cooling_cryogenic").val();N.temperature=this.makeValue(400,"K");N.instrument={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),temp:this.makeValue(400,"K"),time:this.makeValue(0,"months"),risk:1};if(N.instruments){var I=false;for(var ab=0;ab<N.instruments.length;ab++){var S=this.copyValue(ae.instrument.options[N.instruments[ab].type]);if(!S.multiplier){S.multiplier={}}if(!S.multiplier.cost){S.multiplier.cost=1}if(!S.multiplier.mass){S.multiplier.mass=1}var L=this.copyValue(ae.wavelengths[N.instruments[ab].wavelength]);if(L.cost){L.cost.value*=S.multiplier.cost}N.instrument.cost=this.sumValues(N.instrument.cost,L.cost);if(L.mass){N.instrument.mass=this.sumValues(N.instrument.mass,L.mass)}N.instrument.mass.value*=S.multiplier.mass;N.instrument.temp=this.minValue(N.instrument.temp,L.temperature);if(S.devtime){N.instrument.time=this.sumValues(N.instrument.time,S.devtime)}if(S.risk){N.instrument.risk*=S.risk}if(N.instruments[ab].wavelength=="uv"){I=true}}var M=(N.mirror)?ae.mirror[N.mirror].bus.instrumentslots:0;if(N.instruments.length>M){this.errors.push({text:this.phrases.errors.slots,link:"#designer_instruments"})}if(!N.uvmirror&&I){this.errors.push({text:this.phrases.errors.uv,link:"#designer_satellite"})}}if(N.site){if(N.vehicle){for(var ab=0;ab<ae.vehicle[N.vehicle].sites.length;ab++){if(ae.vehicle[N.vehicle].sites[ab]==T){R=true}}}else{R=true}if(!R){this.errors.push({text:this.phrases.errors.site.replace(/%SITE%/g,this.phrases.designer.site.options[T].label).replace(/%VEHICLE%/,this.phrases.designer.vehicle.options[O].label),link:"#designer_site"})}}if(N.vehicle&&N.mirror){var K=this.copyValue(ae.vehicle[N.vehicle].diameter);var Z=this.copyValue(ae.mirror[N.mirror].bus.diameter);if(N.deployablemirror&&ae.deployablemirror.multiplier.bus.diameter){Z.value*=ae.deployablemirror.multiplier.bus.diameter}if(Z.value>K.value){this.errors.push({text:this.phrases.errors.size,link:"#designer_satellite"})}}if(N.orbit){R=false;if(N.site){R=ae.site[N.site].orbits[X]}else{R=true}if(!R){this.errors.push({text:this.phrases.errors.orbit.replace(/%SITE%/g,this.phrases.designer.site.options[T].label).replace(/%ORBIT%/,this.phrases.designer.orbit.options[X].label),link:"#designer_orbit"})}N.temperature=this.copyValue(ae.orbit[N.orbit].temperature)}N.cooling={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),life:this.makeValue(99,"years"),time:this.makeValue(0,"months"),risk:1};if(N.hascooling){if(N.cool.temperature){S=ae.cooling.temperature[e("#cooling_temperature").val()];if(S.temperature){N.temperature=this.copyValue(S.temperature)}if(S.mass){N.cooling.mass=this.sumValues(N.cooling.mass,S.mass)}if(S.cost){N.cooling.cost=this.sumValues(N.cooling.cost,S.cost)}if(S.devtime){N.cooling.time=this.sumValues(N.cooling.time,S.devtime)}if(S.life){N.cooling.life=this.minValue(N.cooling.life,S.life)}if(S.risk){N.cooling.risk*=S.risk}if(N.mirror&&ae.mirror[Y]["passive"]){N.cooling.mass=this.sumValues(N.cooling.mass,ae.mirror[Y]["passive"].mass);N.cooling.cost=this.sumValues(N.cooling.cost,ae.mirror[Y]["passive"].cost);N.cooling.time=this.sumValues(N.cooling.time,ae.mirror[Y]["passive"].devtime)}}if(ae.cooling.passive){V=N.cool.passive;if(V=="yes"){N.cooling.time=this.sumValues(N.cooling.time,ae.cooling.passive[V].devtime);if(N.mirror&&ae.mirror[N.mirror].passive){N.cooling.mass=this.sumValues(N.cooling.mass,ae.mirror[N.mirror].passive.mass);N.cooling.passive=ae.mirror[N.mirror].passive.mass;N.cooling.cost=this.sumValues(N.cooling.cost,ae.mirror[N.mirror].passive.cost)}N.cooling.mass.value*=ae.cooling.passive[V].multiplier.mass;N.cooling.cost.value*=ae.cooling.passive[V].multiplier.cost;N.cooling.risk*=ae.cooling.passive[V].risk;N.temperature.value*=ae.cooling.passive[V].multiplier.temperature;if(ae.cooling.passive[V].life){N.cooling.life=this.minValue(N.cooling.life,ae.cooling.passive[V].life)}if(N.orbit){N.cooling.life.value*=ae.orbit[N.orbit].multiplier.passive.time;if(ae.orbit[N.orbit].multiplier.cryo.time==0){this.errors.push({text:this.phrases.errors.hotorbitpassive,link:"#designer_orbit"})}}if(ae.cooling.active){V=N.cool.active;if(V=="yes"){N.cooling.time=this.sumValues(N.cooling.time,ae.cooling.active[V].devtime);N.cooling.cost=this.sumValues(N.cooling.cost,ae.cooling.active[V].cost);N.cooling.mass=this.sumValues(N.cooling.mass,ae.cooling.active[V].mass);N.cooling.active=ae.cooling.active[V].mass;N.cooling.risk*=ae.cooling.active[V].risk;N.temperature.value*=ae.cooling.active[V].multiplier.temperature;if(ae.cooling.active[V].life){N.cooling.life=this.minValue(N.cooling.life,ae.cooling.active[V].life)}}}N.cooling.cryogeniclife=0;if(ae.cooling.cryogenic){V=N.cool.cryogenic;if(V&&V!="none"){N.cooling.time=this.sumValues(N.cooling.time,ae.cooling.cryogenic[V].devtime);N.cooling.cost=this.sumValues(N.cooling.cost,ae.cooling.cryogenic[V].cost);N.cooling.mass=this.sumValues(N.cooling.mass,ae.cooling.cryogenic[V].mass);N.cooling.cryogenic=ae.cooling.cryogenic[V].mass;N.cooling.risk*=ae.cooling.cryogenic[V].risk;N.temperature.value*=ae.cooling.cryogenic[V].multiplier.temperature;if(ae.cooling.cryogenic[V].life){N.cooling.life=this.minValue(N.cooling.life,ae.cooling.cryogenic[V].life);N.cooling.cyrogeniclife=this.convertValue(ae.cooling.cryogenic[V].life,"years");N.cooling.cyrogeniclife=N.cooling.cyrogeniclife.value}if(N.orbit){N.cooling.life.value*=ae.orbit[N.orbit].multiplier.cryo.time;var W=ae.orbit[N.orbit].multiplier.cryo.time;if(W==0){this.errors.push({text:this.phrases.errors.hotorbitcryo,link:"#designer_orbit"})}if(W<1&&W>0){this.warnings.push({text:this.phrases.warnings.warmorbitcryo,link:"#designer_orbit"})}}}}}else{if(ae.cooling.active&&this.getValue("input[name=cooling_active]:checked")=="yes"&&V=="no"){this.warnings.push({text:this.phrases.warnings.activenopassive,link:"#designer_cooling"})}if(ae.cooling.cryogenic&&this.getValue("#cooling_cryogenic")!="none"&&V=="no"){this.warnings.push({text:this.phrases.warnings.cryonopassive,link:"#designer_cooling"})}}}}var ai=this.convertValue(N.instrument.temp,"K");var ah=this.convertValue(N.temperature,"K");if(ah.value>ai.value){this.errors.push({text:this.phrases.errors.temperature.replace(/%TEMPERATURE%/,"<strong>"+this.formatValue(ah)+"</strong>").replace(/%REQUIREMENT%/,"<strong>"+this.formatValue(ai)+"</strong>"),link:"#designer_cooling"})}if(this.proposalCompleteness()<1){this.warnings.push({text:this.phrases.warnings.proposal,link:"#designer_proposal"})}this.choices=N;this.updateSummary().updateSidePanels().updateMessages("error",this.errors).updateMessages("warning",this.warnings);return this};H.prototype.updateMessages=function(K,L){this.log("updateMessages",L);if(K!="error"&&K!="warning"){return this}var G="";var I=0;if(L&&typeof L=="object"&&L.length>0){I=L.length;for(var J=0;J<L.length;J++){G+="<li>"+L[J].text+(L[J].link?' <a href="'+L[J].link+'">'+this.phrases.ui[K].link+"</a>":"")+"</li>"}}e("."+K+".value").html(I);e("#messages h3."+K).next().html(G);if(I==0){e(".toggle"+K+",."+K+"s").hide()}else{e(".toggle"+K+",."+K+"s").show()}return this};H.prototype.toggleView=function(i,G){this.log("toggleView",i);if(!e("#"+i).is(":visible")){this.showView(i,G)}else{this.showView(G)}return this};H.prototype.showView=function(i,J,G){this.log("showView",i,J);if(g(i,"object")){J=i;i=""}if(!g(i,"string")){i=""}if(i=="messages"||i=="menu"||i=="language"||i=="options"||i.indexOf("summaryext")==0){if(J&&g(J,"object")&&g(J.preventDefault,"function")){J.preventDefault()}if(i=="options"){if(J){J.preventDefault()}this.updateOptions();e("#summaryext").hide();this.showModal(e("#options"));e("body").addClass("showoptions")}return this}e(".view").hide();e("body").removeClass("showguide showintro showoptions showmessages");if(i.indexOf("designer")==0&&!this.scenario){i="intro"}if((i.indexOf("guide")==0&&i.length==5)||i.indexOf("guide_")==0){e("#summaryext").hide();this.showGuide(i);e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide")}else{if((i.indexOf("designer")==0&&i.length==8)||i.indexOf("designer_")==0){e("#summaryext").hide();if(i.indexOf("designer_")==0){var I=i.substr(i.indexOf("designer_")+9);e("#menubar li").removeClass("on");e("#menubar a.toggle"+I).parent().addClass("on");e(".designer .designer_content").hide();e("#"+i+" .designer_content").show();e("#designer").show();if(e("#"+i).find("a").is(":visible")){e("#"+i).find("a:visible").eq(0).focus()}else{if(e("#"+i).find("input")){e("#"+i).find("input").eq(0).focus()}else{e("#menubar a.toggle"+I).focus()}}if(I=="orbit"){this.makeSpace("orbits").displayOrbits()}else{this.removeOrbits()}if(I=="proposal"){this.updateProposal()}}else{e("#designer").show().find("a").eq(0).focus()}this.updateBodyClass("showdesigner");this.setScroll("#"+i);this.stage="designer"}else{if(i=="intro"){e("#summaryext").hide();e("#intro").show();this.updateBodyClass("showintro");this.stage="intro";this.startup()}else{if(i=="scenarios"){e("#summaryext").hide();e("#scenarios").show();this.updateBodyClass("showscenarios");this.stage="scenarios"}else{if(i=="launch"){e("#summaryext").hide();this.updateMessages("error",{}).updateMessages("warning",{});this.updateBodyClass("showlaunch");this.goForLaunch();this.stage="launch"}else{e("#"+this.stage).show();this.updateBodyClass("show"+this.stage)}}}}}if(this.pushstate&&!J){history.pushState({},"Guide","#"+i)}if(g(G,"function")){G.call(this)}return this};H.prototype.setScroll=function(I){this.log("setScroll",I);var i=e("#bar");var J=(i.is(":visible"))?i.outerHeight():0;var G=0;if(I&&e(I).length==1){G=Math.floor(e(I).offset().top-J);if(G<0){G=0}}e(window).scrollTop(G);return this};H.prototype.toggleGuide=function(i,G){this.log("toggleGuide",i);if(g(i,"object")){G=i;i=""}if(!e("#guide").is(":visible")){if(!i){i="guide"}this.showView(i)}else{this.showView()}return this};H.prototype.closeGuide=function(){this.log("closeGuide");e("body").removeClass("showguide");e("#guide").hide();e("#intro").show();return this};H.prototype.showGuide=function(S){this.log("showGuide",S);var I=S;if(g(S,"string")){var R=S.split("_");if(R.length>1&&this.phrases.guide[R[1]]){S=R[1]}}var M="";var N=this.phrases.guide;var T,O,U,L,G;if(S){e("body").addClass("showguide");e("#guide").show();if(e("#guide").length==0){e("#page").append('<div id="guide" class="view"></div>')}if(S=="guide"){M+="<h2>"+this.phrases.guide.title+"</h2><p>"+this.phrases.guide.about+'</p><ul class="index">';for(k in this.phrases.guide){if(k!="title"&&k!="about"&&g(this.phrases.guide[k].title,"string")){M+='<li><a href="#guide_'+k+'" class="guidelink">'+this.phrases.guide[k].title+"</a><br />"+(g(this.phrases.guide[k].summary,"string")?this.phrases.guide[k].summary:"")+"</li>"}}M+="</ul>"}else{if(N[S]){M+='<div class="guidetop"><span class="breadcrumb"><a href="#guide" class="guidelink">'+N.title+"</a> &raquo; "+N[S].title+"</span></div>";L=N[S].about;var J=this.data.mirror;if(S=="mirror"){U="";for(A in J){U+="<tr>";U+="<td>"+this.formatValue(J[A].diameter)+"</td>";U+="<td>"+this.formatValue(J[A].mass)+"</td>";U+="<td>"+this.formatValue(J[A].cost)+"</td>";if(this.settings.mode=="advanced"){U+="<td>"+this.formatValue(J[A].devtime)+"</td>"}U+="</tr>"}L=L.replace(/\%MIRRORTABLE\%/,U)}else{if(S=="structure"){U="";for(A in J){U+="<tr>";U+="<td>"+this.formatValue(J[A].diameter)+"</td>";U+="<td>"+this.formatValue(J[A].bus.diameter)+"</td>";U+="<td>"+this.formatValue(J[A].bus.cost)+"</td>";U+="<td>"+this.formatValue(J[A].bus.mass)+"</td>";U+="</tr>"}L=L.replace(/\%STRUCTURETABLE\%/,U)}else{if(S=="cooling"){U="";var Q=this.data.cooling;if(this.settings.mode=="advanced"){for(A in Q.cryogenic){if(A!="none"){U+="<tr>";U+="<td>"+this.formatValue(Q.cryogenic[A].life)+"</td>";U+="<td>"+this.formatValue(Q.cryogenic[A].cost)+"</td>";U+="<td>"+this.formatValue(Q.cryogenic[A].mass)+"</td>";U+="</tr>"}}L=L.replace(/\%ACTIVELIFE\%/,this.formatValue(Q.active.yes.life));L=L.replace(/\%ACTIVEMASS\%/,this.formatValue(Q.active.yes.mass));L=L.replace(/\%ACTIVECOST\%/,this.formatValue(Q.active.yes.cost))}else{for(A in Q.temperature){U+="<tr>";U+="<td>"+this.formatValue(Q.temperature[A].temperature)+"</td>";U+="<td>"+this.formatValue(Q.temperature[A].cost)+"</td>";U+="<td>"+this.formatValue(Q.temperature[A].mass)+"</td>";U+="</tr>"}}L=L.replace(/\%COOLINGTABLE\%/,U)}else{if(S=="instruments"){U="";for(A in this.data.wavelengths){if(A!="none"){U+="<tr>";U+="<td>"+this.phrases.wavelengths[A].label+"</td>";U+="<td>"+this.formatValue(this.data.wavelengths[A].temperature)+"</td>";U+="</tr>"}}L=L.replace(/\%WAVELENGTHTABLE\%/,U);if(this.settings.mode=="advanced"){U="";for(A in this.data.instrument.options){if(A!="none"){U+="<tr>";U+="<td>"+this.phrases.designer.instruments.options.instrument[A].label+"</td>";U+="<td>"+this.formatValue(this.data.instrument.options[A].multiplier.mass)+"</td>";U+="<td>"+this.formatValue(this.data.instrument.options[A].multiplier.cost)+"</td>";U+="<td>"+this.formatValue(this.data.instrument.options[A].devtime)+"</td>";U+="</tr>"}}L=L.replace(/\%INSTRUMENTTABLE\%/,U)}}else{if(S=="orbit"){U="";for(A in this.data.orbit){U+="<tr>";U+="<td>"+this.phrases.designer.orbit.options[A].label+"</td>";U+="<td>"+(this.phrases.designer.orbit.options[A].altitude?this.phrases.designer.orbit.options[A].altitude:"")+this.formatValue(this.data.orbit[A].altitude,0)+"</td>";U+="<td>"+this.formatValue(this.data.orbit[A].period)+"</td>";U+="<td>"+(this.data.orbit[A].obsfrac*100)+"%</td>";U+="<td>"+this.formatValue(this.data.orbit[A].temperature)+"</td>";U+="</tr>"}L=L.replace("%ORBITTABLE%",U);for(A in this.data.orbit){L=L.replace("%"+A+"ANCHOR%","guide_orbit_"+A);L=L.replace("%"+A+"LABEL%",this.phrases.designer.orbit.options[A].label);L=L.replace("%"+A+"GROUNDCOST%",this.formatValue(this.data.orbit[A].groundcost));L=L.replace("%"+A+"FUELLIFE%",this.formatValue(this.data.orbit[A].fuellife));L=L.replace("%"+A+"ALTITUDE%",this.formatValue(this.data.orbit[A].altitude));L=L.replace("%"+A+"PERIOD%",this.formatValue(this.data.orbit[A].period));L=L.replace("%"+A+"CRYOREDUCTION%",(100*(1-this.data.orbit[A].multiplier.cryo)).toFixed(0)+"%")}}else{if(S=="vehicle"){U="";for(A in this.data.vehicle){U+="<tr>";U+="<td>"+this.phrases.designer.vehicle.options[A].label+"</td>";U+="<td>"+this.formatValue(this.data.vehicle[A].diameter,0)+"</td>";U+="<td>"+this.formatValue(this.data.vehicle[A].mass.LEO,0)+"</td>";U+="<td>"+this.formatValue(this.data.vehicle[A].mass.GTO,0)+"</td>";U+="<td>"+this.formatValue(this.data.vehicle[A].cost,0)+"</td>";U+="<td>"+this.phrases.operator[this.data.vehicle[A].operator].label+"</td>";if(this.settings.mode=="advanced"){U+="<td>"+(this.data.vehicle[A].risk*100)+"%</td>"}U+="</tr>"}L=L.replace(/\%ROCKETTABLE\%/,U)}else{if(S=="site"){U="";for(A in this.data.site){U+="<tr>";U+="<td>"+this.phrases.designer.site.options[A].label+"</td>";U+="<td>"+this.phrases.designer.site.options[A].trajectories+"</td>";U+="<td>";var K="";for(var i in this.data.vehicle){for(var V=0;V<this.data.vehicle[i].sites.length;V++){if(this.data.vehicle[i].sites[V]==A){if(K.length>0){K+=", "}K+=""+this.phrases.designer.vehicle.options[i].label+""}}}U+=K;U+="</td>";U+="</tr>"}L=L.replace(/\%SITETABLE\%/,U)}}}}}}}if(L.indexOf("<p>")<0){L="<p>"+L+"</p>"}M+='<h2 id="guide_'+S+'">'+N[S].title+"</h2>"+L+'<div class="clearall" /></div>';if(S=="roles"){for(k in N[S]){if(k!="title"&&k!="about"&&g(N[S][k].title,"string")){M+="<h3>"+N[S][k].title+"</h3><p>"+N[S][k].about+"</p>"}}}else{if(S=="previous"){for(k in N[S]["missions"]){if(g(N[S]["missions"][k].title,"string")){O="<ul>";for(A in N[S]["missions"][k]){if(A!="title"&&A!="image"){T=this.formatValue(N[S]["missions"][k][A]);O+='<li><span class="key">'+N[S][A]+'</span> <span class="value">'+T+"</span></li>"}}O+="</ul>";M+='<h3 id="guide_'+S+"_"+k+'">'+N[S]["missions"][k].title+"</h3>";if(N[S]["missions"][k]["image"]){M+='<figure class="right"><img src="'+N[S]["missions"][k]["image"].src+'" alt="'+N[S]["missions"][k]["title"]+'" /><figcaption>'+N[S]["missions"][k]["title"]+"</figcaption></figure>"}M+="";M+=O}}}}}}if(N[S]&&N[S].questions){G='<h3 id="guide_'+S+'_questions">Questions</h3><ol>';for(A=0;A<N[S].questions.length;A++){G+="<li>"+N[S].questions[A].label.replace("%EARTHRADIUS%",this.formatValue({value:6500,units:"km",dimension:"length"})).replace("%EARTHMASS%",this.formatValue({value:6e+24,units:"kg",dimension:"mass"}))+"</li>"}G+="</ol>";M+=G}e("#guide").html(M);if(M.indexOf("script")>=0&&g(MathJax,"object")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"guide"])}this.addCloser(e("#guide"),{me:this},function(W){W.preventDefault();W.data.me.toggleGuide()});var P=this;e("#guide").show(function(){P.setScroll("#"+I)});e("#intro").hide()}else{this.closeGuide()}e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide");return this};H.prototype.updateBodyClass=function(i){e("body").removeClass("showguide showintro showoptions showmessages showlaunch").addClass(i);return this};H.prototype.addCloser=function(I,J,G){var i=location.href.split("#")[1];if(I.find(".close").length==0){I.prepend('<a href="#" class="close" title="Close"><img src="images/cleardot.gif" class="icon close" /></a>')}if(I.attr("id")!="guide"&&I.attr("id").indexOf(i)!=0){I.find("a.close").attr("href","#"+i)}I.find("a img.close").parent().on("click",J,G);return this};H.prototype.showModal=function(J){var G=e(window).width();var K=e(window).height();var i=0;var I=0;J.show().find("a").eq(0).focus();this.positionModal(J);this.modal=J;return this};H.prototype.closeModal=function(i){i.hide();e("#modalbg").hide();e("body").css("overflow-y","auto");this.modal=undefined;return this};H.prototype.positionModal=function(i){x(i);e("#modalbg").hide().css({left:0,top:0,height:e(document).height(),width:e(document).width()}).show().off("click").on("click",{me:this},function(G){G.data.me.closeModal(i)});return this};H.prototype.log=function(){var i=Array.prototype.slice.call(arguments,0);if(console&&g(console.log,"function")){console.log("LOG",i)}return this};function E(I){if(!I){I={}}if(I.spacetel){this.s=I.spacetel}else{return this}this.heightscale="";this.prop={mirror:0,bus:0,slots:0};this.id=(g(I.id,"string"))?I.id:"sidebar_satellite";if(!this.el){this.el=e("#"+this.id)}if(this.el.find("#"+this.id+"_schematic").length==0){this.el.html('<div class="schematic" id="'+this.id+'_schematic"></div>')}if(g(I.height,"string")&&I.height.indexOf("%")>0){this.heightscale=parseFloat(I.height)/100}this.state={cooling:{passive:true,active:true,cryogenic:true},mirror:true,bus:true};if(g(I.state,"object")){for(var G in I.state){this.state[G]=I.state[G]}}this.colourize={cooling:{passive:false,active:false,cryogenic:true},mirror:false,bus:true};if(g(I.colourize,"object")){for(var G in I.colourize){this.colourize[G]=I.colourize[G]}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}E.prototype.getScales=function(Q,O){var L=Math.floor(Q/32);var G=L*(this.prop.bus/this.prop.mirror);var M=8;var I=2;var K=10*G;var R=(this.s.choices.cooling.cryogenic?this.s.choices.cooling.cyrogeniclife:0);if(R==0&&this.s.choices.cool.temperature){var S=this.s.convertValue(this.s.choices.temperature,"K");if(S.value<50){R=Math.log(50/S.value)}}var P=4;var J=((M+P+R)*L);var i=13*L;var N=(this.s.choices.cooling.passive?2*L:0);if(this.s.choices.cool.temperature){var S=this.s.convertValue(this.s.choices.temperature,"K");if(S.value<300){N=2*L}}h=(this.s.choices.mirror)?K+J+i+N+(2*O):0;return{body:J,vgroove:N,bus:K,mirror:i,h:h,fb:G,f:L,top:P,bodyh:M,tank:R,instrument:I}};E.prototype.build=function(){var ag=160;var T=this.el.parent().innerWidth();var ak;var an=Math.cos(Math.PI*30/180);if(this.s.choices.mirror){for(var ab in this.s.data.mirror){ak=this.s.convertValue(this.s.data.mirror[ab].diameter,"m");if(ab==this.s.choices.mirror){this.prop.mirror=ak.value}}for(var ab in this.s.data.mirror){ak=this.s.convertValue(this.s.data.mirror[ab].bus.diameter,"m");if(ab==this.s.choices.mirror){this.prop.bus=ak.value;if(this.s.choices.deployablemirror&&this.s.data.deployablemirror.multiplier.bus.diameter){this.prop.bus*=this.s.data.deployablemirror.multiplier.bus.diameter}this.prop.slots=this.s.data.mirror[ab].bus.instrumentslots}}}var M=16;var ao;if(this.heightscale){ao=this.getScales(200,M);T=(T*this.heightscale)*200/ao.h}ao=this.getScales(T,M);var Y=ao.fb;var ai=ao.f;var N=ao.bodyh;var J=ao.tank;var G=ao.top;var I=ao.instrument;ag=(this.s.choices.mirror)?ao.bus+ao.body+ao.mirror+ao.vgroove+(2*M):0;if(this.heightscale){this.create(T,T*this.heightscale)}else{this.create("auto",ag)}if(this.bus){this.bus.remove();delete this.bus}if(this.body){this.body.remove();delete this.body}if(this.vgroove){this.vgroove.remove();delete this.vgroove}if(this.mirror){this.mirror.remove();delete this.mirror}var aj={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};var ap={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};var O={stroke:"white","stroke-width":1};var U,af;var W=this.paper;if(this.s.choices.mirror){this.bus=W.set();this.bus.push(W.ellipse(0,3.5*Y,10*Y,6*Y).attr(aj));this.bus.push(W.path("m "+(-8.5*Y)+", "+(-2*Y)+" l0,"+(4*Y)+" l"+(5*Y)+","+(3*Y)+" l"+(7*Y)+",0 l"+(5*Y)+","+(-3*Y)+" l0,"+(-4*Y)+" l"+(-5*Y)+","+(-3*Y)+" l"+(-7*Y)+",0 z").attr(aj));this.bus.push(W.path("m "+(-8.5*Y)+", "+(2*Y)+" l0,"+(3.5*Y)+" l"+(5*Y)+","+(3*Y)+" l0,"+(-3.5*Y)+" z").attr(aj));this.bus.push(W.path("m "+(-3.5*Y)+", "+(5*Y)+" l"+(7*Y)+",0 l0,"+(3.5*Y)+" l"+(-7*Y)+",0 z").attr(aj));this.bus.push(W.path("m "+(8.5*Y)+", "+(2*Y)+" l0,"+(3.5*Y)+" l"+(-5*Y)+","+(3*Y)+" l0,"+(-3.5*Y)+" z").attr(aj))}if(ao.vgroove>0){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};if(this.colourize.cooling.passive){af.fill=(this.state.cooling.passive)?e(".mass").css("color"):"black";af["fill-opacity"]=0.5}this.vgroove=W.set();this.vgroove.push(W.ellipse(0,-0.6*Y,8.5*Y,5*Y).attr(af));this.vgroove.push(W.ellipse(0,-1.2*Y,8.25*Y,4.75*Y).attr(af));this.vgroove.push(W.ellipse(0,-1.8*Y,8*Y,4.5*Y).attr(af));this.vgroove.push(W.path("m 0,"+(-0.6*Y)+" l"+(-5.5*Y)+","+(2.5*Y)+" m"+(5.5*Y)+","+(-2.5*Y)+" l"+(1.5*Y)+","+(3.5*Y)+" m"+(-1.5*Y)+","+(-3.5*Y)+" l"+(8*Y)+","+(-Y)+" m"+(-8*Y)+","+(Y)+" l"+(5*Y)+","+(-5*Y)+" m"+(-5*Y)+","+(5*Y)+" l"+(-2*Y)+","+(-5.5*Y)+" m"+(2*Y)+","+(5.5*Y)+" l"+(-7*Y)+","+(-3*Y)).attr({stroke:"white","stroke-width":1,"stroke-opacity":0.4}))}if(this.s.choices.mirror){this.body=W.set();var ah=Math.min(7,8.5*(this.prop.bus/this.prop.mirror));var am=ah*0.4;var K=(ah-am);this.body.push(W.ellipse(0,0,ah*ai,K*ai).attr(O));this.body.push(W.path("m "+(-ah*ai)+",0 a "+(ah*ai)+","+(K*ai)+" 0 0,0 "+(2*ah*ai)+",0 l 0,"+(-(N+J-1)*ai)+" q 0,"+(-2*ai)+" "+(-K*ai)+","+(-G*ai)+" l0,"+(-1*ai)+" a"+(am*ai)+","+(am*0.5*ai)+" 0 0,0 "+(-2*am*ai)+",0 l0,"+(1*ai)+" q"+(-K*ai)+","+(1*ai)+" "+(-K*ai)+","+(K*ai)+" z").attr(aj));if(J>0){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.cooling.cryogenic){af.fill=(this.state.cooling.cryogenic)?e(".mass").css("color"):"black";af["fill-opacity"]=0.8}this.body.push(W.path("m "+(-ah*ai)+",0 a "+(ah*ai)+","+(K*ai)+" 0 0,0 "+(2*ah*ai)+",0 l 0,"+(-J*ai)+" a "+(ah*ai)+","+(K*ai)+" 0 0,0 "+(-2*ah*ai)+",0 z").attr(af));this.body.push(W.ellipse(0,(-J*ai),ah*ai,K*ai).attr(O))}this.body.push(W.ellipse(0,(-(N+J+G)*ai),am*ai,am*0.5*ai).attr(O));var S=Math.ceil(this.prop.slots/2);var Q,P,V,al;var ad=2.2;ad=ah*2/(S+2);var aa=ad/2;var X=ad/4;var Z=0;var L=(this.s.choices.instruments)?this.s.choices.instruments.length:0;e("#"+this.id+"_schematic .label").remove();var R="";T=this.el.innerWidth();ag=this.el.innerHeight();for(var ae=0;ae<S;ae++){Q=(ae-(S-1)/2)*(ad*ai*1.25);for(var ac=0;ac<2;ac++){P=J+1.5+(ac==0?0:I*2);V=0.5+(Q+(ac==0?X*ai:0))/T;al=(M+(ao.bus+ao.vgroove+(P+(ac==0?-I:+I*1.5))*ai))/ag;if(Z<L){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.bus){af["fill-opacity"]=1;if(this.state.bus){af.fill=e(".science").css("color")}if(!this.s.choices.instruments[Z].ok){af.fill="black"}}}else{af={stroke:"white","stroke-width":1,"stroke-dasharray":"- ",fill:"white","fill-opacity":0.2}}this.body.push(W.path("m"+(Q-aa*ai)+","+(-P*ai)+" l"+(aa*ai)+","+(X*ai)+" l"+(aa*ai)+","+(-X*ai)+" l0,"+(-I*ai)+" l"+(-aa*ai)+","+(-X*ai)+" l"+(-aa*ai)+","+(X*ai)+" z m"+(aa*ai)+","+(X*ai)+" l0,"+(-I*ai)+" l"+(-aa*ai)+","+(-X*ai)+"m"+(aa*ai)+","+(X*ai)+"l"+(aa*ai)+","+(-X*ai)).attr(af));if(Z<L&&this.s.choices.instruments[Z]&&this.s.hastransform){R+='<div class="label '+(ac==0?"bottom":"top")+'" style="bottom:'+(100*al)+"%; left:"+(100*V)+'%">'+this.s.choices.instruments[Z].name+"</div>"}Z++}}if(R){e("#"+this.id+"_schematic").prepend(R)}}if(this.s.choices.mirror){af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};if(this.colourize.mirror){af.fill=e(".time").css("color");if(!this.state.mirror){af.fill="black";af.stroke="#ff0000"}}this.mirror=W.set();this.mirror.push(W.ellipse(0,-2.5*ai,10*ai,6*ai).attr(af));this.mirror.push(W.ellipse(0,0,1*ai,0.6*ai).attr(aj));this.mirror.push(W.path("m "+(-2*ai)+","+(-11*ai)+" l"+(-3*ai)+","+(6*ai)+" l "+(5*ai)+","+(-7*ai)+" l"+(5*ai)+","+(7*ai)+" l"+(-3*ai)+","+(-6*ai)).attr(O));this.mirror.push(W.path("m "+(-2*ai)+","+(-11*ai)+" l"+(2*ai)+","+(-1*ai)+" l 0,"+(-1*ai)+" l"+(-2*ai)+","+(1*ai)+" z").attr(aj));this.mirror.push(W.path("m "+(2*ai)+","+(-11*ai)+" l"+(-2*ai)+","+(-1*ai)+" l 0,"+(-1*ai)+" l"+(2*ai)+","+(1*ai)+" z").attr(aj));this.mirror.push(W.path("m "+(-2*ai)+","+(-11*ai)+" l"+(-4*ai)+","+(12*ai)+" l "+(6*ai)+","+(-11*ai)+" l"+(6*ai)+","+(11*ai)+" l"+(-4*ai)+","+(-12*ai)).attr(O));this.mirror.push(W.ellipse(0,(-11*ai),2*ai,1*ai).attr(af));this.mirror.push(W.path("m "+(-2*ai)+","+(-12*ai)+" l"+(2*ai)+","+(1*ai)+" l 0,"+(1*ai)+" l"+(-2*ai)+","+(-1*ai)+" z").attr(aj));this.mirror.push(W.path("m "+(2*ai)+","+(-12*ai)+" l"+(-2*ai)+","+(1*ai)+" l 0,"+(1*ai)+" l"+(2*ai)+","+(-1*ai)+" z").attr(aj))}if(this.bus){for(var ae=0;ae<this.bus.length;ae++){z(this.bus[ae],["t",this.width/2,ag-M-ao.bus])}}if(this.vgroove){for(var ae=0;ae<this.vgroove.length;ae++){z(this.vgroove[ae],["t",this.width/2,ag-M-ao.bus])}}if(this.body){for(var ae=0;ae<this.body.length;ae++){z(this.body[ae],["t",this.width/2,ag-M-ao.bus-ao.vgroove])}}if(this.mirror){for(var ae=0;ae<this.mirror.length;ae++){z(this.mirror[ae],["t",this.width/2,ag-M-ao.bus-ao.vgroove-ao.body])}}return this};E.prototype.resize=function(i,G){this.build();return this};E.prototype.create=function(i,I){e("#"+this.id+"_schematic").hide();this.el.css({width:"auto",display:"block"});if(!i||i=="auto"){i=this.el.innerWidth()}var G=this.el.parent();if(i<G.width()/2){i=G.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}if(!I){I=i/2}if(this.heightscale){I=i*this.heightscale}if(i!=this.width||I!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=G.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=I;if(!this.paper){this.paper=Raphael(this.id+"_schematic",this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}}e("#"+this.id+"_schematic").show();return this};function F(I){this.width=0;this.height=300;this.heightscale="";this.zoom=0;this.scale=[1,0.022];this.anim={};this.orbits={};this.labels={};this.svg={orbits:{}};this.phrases={};this.data={};this.callback;this.spacetel={};this.id="orbits";this.interactive=true;if(!I){I={}}if(g(I.id,"string")){this.id=I.id}if(g(I.zoom,"number")){this.zoom=I.zoom}this.el=e("#"+this.id);if(g(I.phrases,"object")){this.phrases=I.phrases}if(g(I.data,"object")){this.data=I.data}if(g(I.callback,"function")){this.callback=I.callback}if(g(I.interactive,"boolean")){this.interactive=I.interactive}if(g(I.height,"string")&&I.height.indexOf("%")>0){this.heightscale=I.height/100}if(g(I.height,"number")){this.height=I.height}if(I.context){this.spacetel=I.context}this.orbits={GEO:{i:0,color:"#048b9f",e:0.3,zoom:0,z:false,ok:false},SNS:{i:-90,color:"#7ac36a",e:0.4,zoom:0,z:true,ok:false},HEO:{i:30,color:"#de1f2a",e:0.4,zoom:0,z:false,ok:false},LEO:{i:-30,color:"#cccccc",e:0.4,zoom:0,z:true,ok:false},EM2:{i:0,color:"#cccccc",e:1,zoom:1,z:false,ok:false},ES2:{i:0,color:"#9467bd",e:1,zoom:1,z:false,ok:false},ETR:{i:0,color:"#fac900",e:1,zoom:1,z:false,ok:false}};if(!I.orbits){I.orbits=["GEO","SNS","HEO","LEO","EM2","ES2","ETR"]}for(var G=0;G<I.orbits.length;G++){if(this.orbits[I.orbits[G]]){this.orbits[I.orbits[G]].ok=true}}if(I.orbits.length==1){this.zoom=this.orbits[I.orbits[0]].zoom}if(!this.spacetel.convertValue||!g(this.spacetel.convertValue,"function")){this.spacetel.convertValue=function(i){return i}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}F.prototype.resize=function(){if(this.el.length>0){this.el.children().hide()}this.el.css({width:"auto",display:"block"});var i=this.el.innerWidth();if(i<this.el.parent().width()/2){i=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}var G=i/2;if(i!=this.width||G!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=(this.heightscale)?this.width*this.heightscale:G;if(!this.paper){this.paper=Raphael(this.id,this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}this.E={x:this.width/2,y:this.height/2,r:this.height/6,radius:6378};this.M={r:5,o:this.E.r*58}}this.displayOrbits();this.el.children().show();return this};F.prototype.removeOrbits=function(){for(var M in this.orbits){var G=this.svg.orbits[M];if(G){if(G.dotted){G.dotted.stop().remove()}if(G.solid){G.solid.stop().remove()}if(G.satellite){G.satellite.stop().remove()}delete G}}var J=["Moon","Moonorbit","Moonlagrangian","Earthorbit"];for(var K=0;K<J.length;K++){if(this[J[K]]){this[J[K]].remove();delete this[J[K]]}}for(var I in this.labels){var L=this.labels[I];for(var K in L){if(g(L[K].remove,"function")){L[K].remove();delete L[K]}}delete this.labels[I]}return this};F.prototype.displayOrbits=function(aa,I){if(!this.paper){return this}if(this.orbits.HEO){this.orbits.HEO.r=this.E.r*3.3}if(aa){this.zoom=this.orbits[aa].zoom}if(g(I,"number")){this.zoom=I}function W(ad,ae,ab){if(!ab||!g(ab,"number")){ab=0}var i=ad*Math.sin(ab*Math.PI/180);var ac=ad*Math.cos(ab*Math.PI/180);if(Math.abs(ab)>80){i+=ad;ac+=ad*ae}return" m "+(0-ac)+" "+(0-i)+" a "+(ad)+","+(ae*ad)+" "+ab+" 1,1 0,0.01"}function M(i){if(i){i.hide()}}function Y(i){if(i){i.show()}}if(this.rebuild){this.removeOrbits();this.rebuild=false}if(this.interactive){if(e("#"+this.id+" .zoomer").length==0){e("#"+this.id).prepend('<a href="#" class="zoomer button">-</a>');e("#"+this.id+" .zoomer").on("click",{me:this},function(i){i.preventDefault();i.data.me.displayOrbits("",(i.data.me.zoom==0?1:0));e(this).html(i.data.me.zoom==0?"&minus;":"&plus;").attr("title",(i.data.me.zoom==0?i.data.me.phrases.zoomout:i.data.me.phrases.zoomin))})}}if(this.Earth){this.Earth.remove()}if(this.zoom==0){this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m -6.92,42.86 c -10.79,-1.89 -21.17,-8.25 -27.52,-16.87 -15.02,-20.39 -9.63,-48.89 11.79,-62.41 16.94,-10.68 39.20,-8.16 53.44,6.06 5.87,5.86 9.54,12.35 11.55,20.40 1.16,4.68 1.47,12.35 0.67,16.96 -3.04,17.58 -15.44,30.93 -32.72,35.25 -4.33,1.08 -12.80,1.38 -17.21,0.61 z m 11.33,-4.82 c 6.97,-0.79 13.53,-3.42 19.13,-7.67 1.15,-0.87 1.54,-1.39 1.55,-2.07 0.01,-1.02 1.44,-5.01 2.21,-6.20 0.27,-0.42 1.14,-1.04 1.93,-1.38 1.16,-0.50 1.55,-0.90 2.12,-2.23 0.96,-2.24 1.24,-3.45 0.78,-3.45 -0.20,0 -0.37,-0.35 -0.37,-0.78 0,-0.79 1.79,-2.69 4.39,-4.66 0.67,-0.50 1.30,-1.14 1.40,-1.40 0.83,-2.18 0.99,-12.83 0.19,-12.83 -0.51,0 -0.70,2.11 -0.37,4.19 0.41,2.56 0.09,4.28 -0.80,4.41 -1.26,0.18 -2.13,-1.28 -2.84,-4.81 -1.04,-5.22 -1.12,-5.32 -4.56,-5.92 -1.02,-0.17 -1.08,-0.13 -1.08,0.81 0,2.22 -2.80,5.66 -5.01,6.15 -1.66,0.36 -2.62,-0.58 -4.17,-4.11 -0.73,-1.67 -1.59,-3.31 -1.92,-3.62 -0.55,-0.54 -0.58,-0.53 -0.58,0.12 0,1.72 2.25,7.61 3.13,8.19 0.20,0.13 1.09,0.24 1.97,0.25 2.19,0.00 3.57,0.75 3.56,1.93 -0.01,1.61 -1.23,3.68 -3.44,5.82 -2.98,2.89 -3.55,3.94 -3.55,6.53 -0.00,2.03 0.02,2.10 0.75,1.87 0.41,-0.12 1.04,-0.43 1.41,-0.68 0.98,-0.67 2.09,-0.56 2.35,0.23 0.24,0.77 -1.60,3.96 -3.39,5.87 -0.87,0.93 -1.18,1.07 -1.83,0.82 -0.67,-0.25 -0.78,-0.51 -0.76,-1.84 0.01,-0.95 -0.11,-1.50 -0.33,-1.43 -0.34,0.10 -0.65,0.55 -2.65,3.74 -1.17,1.88 -3.79,3.67 -6.07,4.16 -1.86,0.39 -3.48,0 -3.48,-0.79 0,-0.26 -0.43,-1.29 -0.96,-2.30 -1.69,-3.22 -1.84,-3.99 -1.37,-7.24 0.47,-3.33 0.19,-4.72 -1.21,-6.04 -1.23,-1.15 -1.87,-2.53 -1.64,-3.58 0.18,-0.83 0.08,-0.93 -1.34,-1.35 -1.63,-0.48 -5.15,-0.33 -7.61,0.33 -1.09,0.30 -1.50,0.23 -2.83,-0.42 -2.86,-1.42 -4.32,-4.81 -3.89,-9.11 0.39,-4.01 0.54,-4.51 1.80,-5.97 0.68,-0.78 1.43,-1.90 1.67,-2.47 0.39,-0.94 1.89,-1.94 3.70,-2.47 0.29,-0.08 0.93,-0.95 0.19,-1.19 -2.63,0.61 -3.49,-1.84 -1.69,-3.63 0.98,-0.98 1.35,-1.14 2.33,-1.03 1.08,0.12 1.16,0.07 1.16,-0.77 0,-0.49 0.15,-1.00 0.33,-1.12 0.18,-0.11 1.44,-0.95 1.44,-1.06 0,-0.36 -4.64,1.86 -2.85,-0.67 -0.26,0.41 -0.65,0.19 -1.12,-0.26 -0.87,-0.87 0.29,-1.80 1.00,-1.97 0.45,-0.00 0.96,1.28 1.31,0.58 -0.82,-1.14 -0.62,-2.63 -0.28,-2.70 1.28,-0.53 1.49,0.78 1.49,1.81 0,0.39 0.22,0.91 0.50,1.14 0.27,0.23 0.50,0.79 0.50,1.25 0,0.76 0.09,0.81 1.06,0.62 1.49,-0.30 2.53,-1.36 2.47,-2.53 2.67,-1.78 -0.15,-1.06 -0.29,-1.20 -0.63,-0.63 -0.13,-1.83 1.40,-3.38 2.14,-2.15 3.38,-2.70 6.99,-3.13 2.72,-0.32 3.09,-0.29 4.55,0.35 1.48,0.64 1.57,0.76 1.38,1.70 l -0.20,0.99 1.80,-0.96 c 0.99,-0.53 2.56,-1.15 3.49,-1.39 0.93,-0.23 1.69,-0.56 1.69,-0.72 0,-0.38 -4.20,-2.31 -6.97,-3.21 -5.23,-1.70 -13.51,-2.25 -18.83,-1.23 -4.60,0.87 -12.69,4.14 -13.13,5.31 -0.08,0.23 0.06,0.97 0.34,1.64 0.63,1.52 0.65,3.66 0.04,4.84 -0.61,1.18 -5.09,5.49 -6.37,6.14 -0.55,0.27 -2.28,0.92 -3.84,1.42 -4.30,1.40 -4.48,1.53 -5.46,3.96 -1.64,4.10 -2.26,7.13 -2.45,11.88 l -0.17,4.50 2.56,2.13 c 1.40,1.17 3.47,3.15 4.59,4.40 1.51,1.69 2.48,2.45 3.82,2.99 1.96,0.79 3.45,2.28 3.45,3.44 0,0.40 -0.24,1.46 -0.53,2.32 -0.49,1.46 -0.49,1.69 0.02,3.04 0.62,1.63 0.35,2.62 -0.81,3.00 -0.81,0.26 -0.85,1.23 -0.10,2.39 0.31,0.47 0.65,1.48 0.75,2.23 0.17,1.29 0.34,1.48 3.26,3.42 7.40,4.93 16.42,7.13 25.16,6.13 z m 8.48,-49.91 c 0.68,-0.67 0.66,-1.12 -0.05,-1.33 -0.32,-0.10 -2.25,-1.55 -2.92,-1.89 -1.01,-0.49 6.71,-1.01 1.45,-3.16 -5.26,-2.15 -2.56,4.83 -3.32,3.88 -0.65,-0.83 -2.00,-1.01 -2.58,-0.48 -1.15,-1.28 -2.98,-3.84 -3.70,-3.89 -1.03,-0.07 1.16,2.32 -0.27,2.81 -1.44,0.48 -2.20,-2.82 -4.09,-2.61 -2.10,0.23 -4.38,-0.72 -5.18,3.39 -0.00,0.52 3.06,0.16 4.50,0 2.32,-0.30 3.10,0 5.24,1.91 l 1.88,1.70 3.25,-0.23 c 2.19,-0.15 3.33,-0.11 3.48,0.12 0.32,0.53 1.72,0.42 2.32,-0.16 z M 4.90,-24.27 c 0.94,-0.43 1.16,-0.71 1.01,-1.25 -0.10,-0.38 -0.18,-0.86 -0.18,-1.09 0.15,-1.64 -0.72,-1.29 -1.57,-0.07 -0.77,1.13 -4.82,5.26 -0.61,2.96 0.07,-0.07 0.69,-0.25 1.35,-0.56 z m 20.69,-1.74 c 0.23,-0.38 -1.04,-1.12 -1.47,-0.86 -0.16,0.10 -0.95,-0.15 -1.74,-0.56 -1.95,-1.02 -6.42,-0.95 -5.77,0.10 0.10,0.17 1.42,0.31 2.92,0.31 2.03,8.3e-4 3.03,0.16 3.90,0.63 1.36,0.73 1.89,0.82 2.16,0.38 z")}else{this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m 0 -43.6 c,-19.19,-0.35,-37.44,13.34,-41.86,32.01 c,-4.56,17.16,2.72,37.24,17.65,46.97 c,13.37,9.28,32.05,9.99,45.99,1.50 c,5.95,-3.31,11.07,-8.03,14.54,-13.93 c,10.54,-15.64,8.72,-38.18,-4.01,-52.06 c,-8.07,-9.09,-20.11,-14.60,-32.30,-14.49 z m,0.09,5.37 c,12.57,-0.12,24.94,6.59,31.74,17.15 c,-0.94,5.00,-6.08,1.53,-3.04,-1.61 c,-1.45,-0.52,-4.93,2.87,-6.84,-0.60 c,-3.18,-1.30,-6.35,1.69,-5.15,4.18 c,-3.78,2.66,-6.16,-4.18,-10.15,-1.25 c,0.93,-0.71,6.35,-6.13,1.94,-5.74 c,-2.14,3.26,-5.90,5.61,-9.75,6.74 c,-3.03,1.66,3.48,3.91,5.08,3.87 c,4.45,2.28,8.58,7.10,6.19,12.18 c,1.90,3.21,3.99,6.75,2.95,10.74 c,-1.08,1.59,-1.99,6.64,-3.80,5.96 c,0.09,-5.55,-5.85,1.42,-5.90,3.92 c,-0.23,1.60,-2.08,4.66,0.31,3.45 c,1.57,3.03,4.04,1.23,2.57,-1.43 c,-0.75,-2.21,1.07,-4.45,1.43,-0.91 c,3.42,1.98,-2.07,8.02,-3.44,4.22 c,-0.05,3.19,-5.91,4.83,-6.25,5.74 c,2.90,2.90,-1.55,2.07,-3.22,2.25 c,-1.30,5.22,5.49,3.31,6.56,-0.06 c,2.57,-3.12,7.94,2.47,8.21,0.15 c,-5.15,-2.90,4.36,1.49,3.73,-0.17 c,0.35,-3.39,5.71,0.66,6.83,-2.63 c,2.78,1.05,-3.25,4.26,-4.94,4.47 c,-2.71,0.57,-2.35,4.23,-5.75,2.58 c,-3.91,-2.11,-7.99,-0.80,-12.06,-0.15 c,-4.93,2.23,-10.21,1.74,-14.83,-1.38 c,-10.81,-5.56,-18.52,-16.65,-20.00,-28.71 c,2.73,2.98,6.59,4.72,8.99,8.35 c,1.59,0.73,3.94,3.52,4.82,3.17 c,1.83,-2.48,4.15,-5.77,2.79,-8.54 c,3.36,-2.47,-0.28,-5.56,-3.15,-3.52 c,-4.39,0.81,-0.19,-4.94,1.39,-6.23 c,2.85,-0.46,3.51,2.41,3.98,3.73 c,3.31,-0.03,0.83,-3.88,4.37,-4.09 c,0.13,-1.41,-3.48,-2.70,-0.21,-1.77 c,4.26,-1.24,1.63,-4.36,-0.49,-3.17 c,2.76,-2.15,4.18,-7.67,8.50,-6.43 c,2.24,-0.41,2.61,-2.86,1.01,-3.53 c,2.71,-1.83,-1.40,-1.78,-0.10,-4.29 c,-1.83,-0.30,-4.30,-0.97,-2.13,-3.10 c,-3.38,2.57,-3.54,7.86,-8.96,7.39 c,-4.53,1.77,-8.33,-1.76,-12.01,-2.70 c,-1.47,0.69,-6.48,4.76,-4.02,0.66 c,6.58,-11.48,19.53,-19.03,32.80,-18.87 z m,-33.65,21.59 c,-0.63,0.60,-1.28,0.77,0,0 z m,25.03,13.87 c,-1.37,1.63,-4.72,3.73,-0.43,3.84 c,2.05,0.49,5.02,2.34,3.25,-0.95 c,-0.41,-1.86,-2.20,-1.09,-2.81,-2.89 z m,-4.06,1.78 c,-4.15,-0.46,-2.20,6.04,-6.12,6.47 c,-0.60,2.10,2.30,1.32,3.03,1.20 c,1.41,-2.46,3.73,-4.48,3.09,-7.68 z m,3.53,3.03 c,0.05,4.24,-2.37,7.12,-5.92,8.53 c,-2.81,3.20,0.32,5.68,2.91,2.40 c,3.66,0.82,7.45,0.46,8.59,-3.83 c,3.98,-4.13,-1.83,-7.10,-5.59,-7.10 z m,2.65,13.87 c,-4.08,2.58,5.79,0.94,0,0 z m,29.99,1 c,-0.31,2.69,7.00,1.53,2.61,4.52 c,-1.84,0.06,-6.30,-2.59,-2.61,-4.52 z m,-25.09,4.62 c,-2.60,0.71,1.04,4.16,-0.44,4.55 c,-1.43,1.94,4.72,-0.16,1.34,-1.89 c,-0.67,-1.04,-1.06,-1.69,-0.90,-2.65 z m,32.49,0.34 c,-0.01,2.70,-5.79,2.71,-1.54,0.95 l,0.80,-0.42 z m,-12.78,0.37 c,0.52,1.61,4.35,0.62,1.38,2.50 c,-1.24,2.92,-6.66,3.76,-3.93,-0.40 c,1.53,0.53,2.25,-0.75,2.54,-2.09 z m,-21.93,1.15 c,-3.15,1.82,0.36,3.97,0.81,0.93 c,-0.04,-0.43,-0.35,-0.86,-0.81,-0.93 z m,26.43,6.90 c,-1.92,1.51,-1.94,0.16,0,0 z")}this.Earth.attr({stroke:0,fill:"#69DFFF",opacity:0.8});var N,L,P,X,U,V;var R=this;function G(ab){if(!ab){return null}if(!ab.cx){ab.cx=0}if(!ab.cy){ab.cy=0}if(!ab.e){ab.e=1}if(!ab.i){ab.i=0}if(!ab.r){ab.r=1}if(!ab.z){ab.z=false}if(!ab.color){ab.color="#999999"}if(!ab.stroke){ab.stroke={}}if(!ab.stroke.on){ab.stroke.on=2.5}if(!ab.stroke.off){ab.stroke.off=1.5}if(!ab.stroke.selected){ab.stroke.selected=2.5}var ad={inp:ab};if(ab.key=="ES2"){ad.dotted=R.paper.path("M "+(ab.cx-ab.r)+",0 q "+(ab.r*2)+","+(R.height/2)+" 0,"+(R.height));ad.solid=R.paper.path("M "+(ab.cx-ab.r)+",0 q "+(ab.r*2)+","+(R.height/2)+" 0,"+(R.height))}else{if(ab.e==1){ad.dotted=R.paper.circle(ab.cx,ab.cy,ab.r);ad.solid=R.paper.circle(ab.cx,ab.cy,ab.r)}else{var ac="m "+ab.cx+","+ab.cy+" "+W(ab.r,ab.e,ab.i);ad.dotted=R.paper.path(ac);ad.solid=R.paper.path(ac)}}if(ab.period){ad.satellite=R.paper.circle(ab.cx,ab.cy,4).attr({fill:ab.color,stroke:0});if(ab.key!="ES2"){ad.anim=ad.satellite.animateAlong((ab.orbit?ab.orbit:ad.dotted),ab.period,Infinity,ab.orbitdir,ab.z)}}ad.dotted.attr({stroke:ab.color,"stroke-dasharray":"-","stroke-width":ab.stroke.off});ad.solid.attr({stroke:ab.color,opacity:0.1,"stroke-width":8});if(g(R.callback,"function")){var i=function(){e("#"+this.id).css("cursor","pointer");this.dotted.attr({"stroke-width":(this.selected?ab.stroke.selected:ab.stroke.on)})};var ae=function(){e("#"+this.id).css("cursor","default");this.dotted.attr({"stroke-width":(this.selected?ab.stroke.selected:ab.stroke.off)})};ad.solid.hover(i,ae,ad,ad);ad.satellite.hover(i,ae,ad,ad);ad.solid.click(function(){R.callback.call((R.spacetel?R.spacetel:this),ab.key)},ad,ad);ad.satellite.click(function(){R.callback.call((R.spacetel?R.spacetel:this),ab.key)},ad,ad)}ad.zoom=R.zoom+0;ad.hide=function(){M(ad.dotted);M(ad.solid);M(ad.satellite)};ad.show=function(){Y(ad.dotted);Y(ad.solid);Y(ad.satellite)};return ad}if(!this.E||!this.M||!this.scale){return this}if(this.zoom==0){for(var Q in this.data){if(this.orbits[Q]&&this.orbits[Q].ok&&this.orbits[Q].zoom==this.zoom&&!this.svg.orbits[Q]){if(Q=="HEO"){N=-this.E.r*1.2;L=-this.E.r*0.35}else{N=0;L=0}if(!this.orbits[Q].r){this.orbits[Q].r=this.E.r*(1+this.data[Q].altitude.value/this.E.radius)}V=this.spacetel.convertValue(this.data[Q].period,"hours");this.svg.orbits[Q]=G({key:Q,period:V.value*3*1000,r:this.orbits[Q].r,cx:(this.E.x+N),cy:(this.E.y+L),color:this.orbits[Q].color,e:this.orbits[Q].e,i:this.orbits[Q].i,z:this.orbits[Q].z})}}}else{if(this.zoom==1){if(!this.Moonorbit){var Q=this.svg.orbits;this.Moonorbit=this.paper.path("M "+this.E.x+","+this.E.y+" "+W(this.M.o*this.scale[1],1)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.Moon=this.paper.circle(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6),this.E.y-this.M.o*this.scale[1]*Math.sin(Math.PI/6),this.M.r).attr({fill:"#606060",stroke:0});var P=9;if(!Q.ETR&&this.data.ETR&&this.orbits.ETR.ok){V=this.spacetel.convertValue(this.data.ETR.period,"days");this.Earthorbit=this.paper.path("M "+(this.E.x-P)+",0 q "+(P*2)+","+(this.height/2)+" 0,"+(this.height)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});Q.ETR=G({key:"ETR",period:V.value*1000,r:1,cx:(this.E.x-P*0.78),cy:(this.E.y+2.1*this.M.o*this.scale[1]),color:this.orbits.ETR.color})}if(!Q.EM2&&this.data.EM2&&this.orbits.EM2.ok){this.Moonlagrangian=this.paper.path("M "+this.E.x+","+this.E.y+" "+W(this.M.o*this.scale[1]*440000/380000,1)).attr({stroke:"#000000","stroke-dasharray":"-","stroke-width":0.5,opacity:0.01});V=this.spacetel.convertValue(this.data.EM2.period,"days");this.Moon.animateAlong(this.Moonorbit,V.value*1000,Infinity,-1);Q.EM2=G({key:"EM2",period:V.value*1000,orbit:this.Moonlagrangian,orbitdir:-1,r:this.M.o*((440000/380000)-1)*this.scale[1],cx:(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6)),cy:(this.M.o*this.scale[1]*Math.sin(Math.PI/6)),color:this.orbits.EM2.color,e:1,i:0});Q.EM2.dotted.animateAlong(this.Moonorbit,V.value*1000,Infinity,-1);Q.EM2.solid.animateAlong(this.Moonorbit,V.value*1000,Infinity,-1)}if(!Q.ES2&&this.data.ES2&&this.orbits.ES2.ok){V=this.spacetel.convertValue(this.data.ES2.period,"days");Q.ES2=G({key:"ES2",period:V.value*1000,r:9,cx:(this.E.x+4*this.M.o*this.scale[1]),cy:this.E.y,color:this.orbits.ES2.color})}var S=this.M.o*this.scale[1];var O=0.3;var J=parseInt(this.el.css("font-size"));if(!this.labels){this.labels={}}if(!this.labels.sun){this.labels.sun={zoom:1,arrow:this.paper.path("M "+(this.E.x-4*S)+","+this.E.y+" l "+(O*S)+",-"+(O*0.3*S)+" q "+(-O*0.3*S)+","+(O*0.3*S)+" 0,"+(O*0.6*S)+" z M "+(this.E.x-4*S+O*0.85*S)+","+(this.E.y-O*0.05*S)+" l "+(O*S*1.5)+","+(-O*0.05*S)+" l 0,"+(O*0.2*S)+" l "+(-O*S*1.5)+","+(-O*0.05*S)+" z").attr({fill:"#fac900",stroke:0}),label:this.paper.text((this.E.x-4*S+2.5*O*S),(this.E.y),this.phrases.diagram.sun).attr({fill:"#fac900",stroke:0,"text-anchor":"start","font-size":J})}}if(!this.labels.earthorbit&&this.data.ETR&&this.orbits.ETR.ok){this.labels.earthorbit={zoom:1,arrow:this.paper.path("M "+(this.E.x)+","+(this.E.y-2.1*S)+" l -"+(O*0.3*S)+","+(O*S)+" q "+(O*0.3*S)+","+(-O*0.3*S)+" "+(O*0.6*S)+",0 z M "+(this.E.x-O*0.05*S)+","+(this.E.y-2.1*S+O*0.85*S)+" l "+(-O*0.05*S)+","+(O*S*1.5)+" l "+(O*0.2*S)+",0 l "+(-O*0.05*S)+","+(-O*S*1.5)+" z").attr({fill:"#999999",stroke:0}),label:this.paper.text((this.E.x+O*0.3*S),(this.E.y-2*S+O*S),this.phrases.diagram.earthorbit).attr({fill:"#999999",stroke:0,"text-anchor":"start","font-size":J})}}}}}for(var Q in this.svg.orbits){if(this.svg.orbits[Q].zoom!=this.zoom){M(this.svg.orbits[Q])}else{Y(this.svg.orbits[Q])}if(this.zoom==0){M(this.Moonorbit);M(this.Moon)}else{Y(this.Moonorbit);Y(this.Moon)}if(this.svg.orbits.EM2){if(this.zoom==0){M(this.Moonlagrangian);M(this.Earthorbit)}else{Y(this.Moonlagrangian);Y(this.Earthorbit)}}}for(var T in this.labels){var K=this.labels[T];if(K.zoom!=this.zoom){M(K.arrow);M(K.label)}else{Y(K.arrow);Y(K.label)}}var Z=this.E.r/48;if(this.scale[this.zoom]<1){Z*=this.scale[this.zoom]*10}if(this.Earth){z(this.Earth,["S",Z,Z,this.E.x,this.E.y])}return this};F.prototype.highlight=function(i){if(!i){return this}this.displayOrbits(i);for(var G in this.svg.orbits){if(G==i){this.svg.orbits[G].selected=true}else{this.svg.orbits[G].selected=false}this.svg.orbits[G].dotted.attr({"stroke-width":(this.svg.orbits[G].selected?this.svg.orbits[G].inp.stroke.selected:this.svg.orbits[G].inp.stroke.off)});this.svg.orbits[G].satellite.attr({r:(this.svg.orbits[G].selected?8:4),"stroke-width":(this.svg.orbits[G].selected?8:0),stroke:"white","stroke-opacity":0.5})}return this};function o(J){if(!J){J={}}this.id=(g(J.id,"string"))?J.id:"thermometer";this.pb=(J.phrasebook)?J.phrasebook:{y:""};this.txt=(J.txt)?J.txt:{font:"12px",fill:"#ffffff","text-anchor":"start"};this.labeltxt=(J.labeltxt)?J.labeltxt:{font:"10px","text-anchor":"start",fill:"#ffffff"};this.format=(g(J.format,"function"))?J.format:function(i){return f(i.value)+" K"};this.ctx=(g(J.context,"object"))?J.context:this;this.colour=(g(J.color,"string"))?J.color:"#df0000";this.wide=(g(J.width,"number"))?J.width:(g(J.canvas,"object"))?J.canvas.width:200;this.tall=(g(J.height,"number"))?J.height:(g(J.canvas,"object"))?J.canvas.height:200;this.req=(g(J.required,"number"))?J.required:300;this.xoff=(g(J.x,"number"))?J.x:0;this.yoff=(g(J.y,"number"))?J.y:0;this.p=7;this.tm=[0.1,0.3,1,3,10,30,100,300];this.bulb=4*this.p;this.bottom=this.tall-this.p*9.5;this.top=this.p*6;this.thermo=(g(J.canvas,"object"))?J.canvas:Raphael(this.id,this.wide,this.tall);this.mercurybase=this.thermo.rect((this.xoff+this.wide/2-this.p*2.5),this.yoff+this.bottom+this.p,this.p*5,this.bulb).attr({fill:this.colour,stroke:0});this.mercuryzero=this.thermo.rect((this.xoff+this.wide/2-this.p*1.5),this.yoff+this.bottom-0.5,this.p*3,Math.abs(this.p+1)).attr({fill:this.colour,stroke:0});this.mercury=this.thermo.rect(this.xoff+(this.wide/2-this.p*1.5),this.yoff+this.top,this.p*3,Math.abs(this.top-this.bottom)).attr({fill:this.colour,stroke:0});this.thermometer=this.thermo.path("M "+(this.xoff+this.wide/2-this.p)+","+(this.yoff+this.bottom+this.p)+" l 0,"+(this.top-this.bottom-this.p)+" c 0,-"+(this.p)+" "+(this.p*2)+",-"+(this.p)+" "+(this.p*2)+",0 l 0,"+(this.bottom-this.top+this.p)+" c "+(this.p*2)+","+(this.p*0.5)+" "+(this.p*2)+","+this.bulb+" "+(-this.p)+","+this.bulb+" c -"+(this.p*3)+",0 -"+(this.p*3)+",-"+(this.bulb-this.p*0.5)+" "+(-this.p)+",-"+this.bulb+" m -"+(this.p)+",-"+(this.p)+" c -"+(this.p*2.5)+","+(this.p)+" "+(-this.p*3)+","+(this.p*2+this.bulb)+" "+(this.p*2)+","+(this.p*2+this.bulb)+" c "+(this.p*5)+",0 "+(this.p*4.5)+",-"+(this.p+this.bulb)+" "+(this.p*2)+",-"+(this.p*2+this.bulb)+" l 0,-"+(this.bottom-this.top)+" c 0,-"+(this.p*2.5)+" -"+(this.p*4)+", -"+(this.p*2.5)+" -"+(this.p*4)+",0 l0,"+(this.bottom-this.top)).attr({fill:"#e4f6fe","fill-opacity":1,stroke:"#000000","stroke-width":1,"stroke-opacity":0.3});this.highlight=this.thermo.path("M "+(this.xoff+this.wide/2-this.p*0.35)+","+(this.yoff+this.bottom+this.p)+" l 0,-"+(this.bottom-this.top+this.p)+" l -"+(this.p*0.3)+",0 l 0,"+(this.bottom-this.top+this.p)+" l 0,"+(this.p*0.25)+" c -"+(this.p*0.5)+","+(this.p*0.25)+" -"+(this.p*1.75)+","+(this.p*0.75)+" -"+(this.p*0.75)+","+(this.p*2)+" c 0,-"+(this.p*0.5)+" "+(this.p*0.1)+",-"+(this.p*1.5)+" "+(this.p)+",-"+(this.p*2)+" z").attr({opacity:0.5,fill:"#f7fcfe","fill-opacity":1,stroke:0});this.shade=this.thermo.path("M "+(this.xoff+this.wide/2+this.p*0.5)+","+(this.yoff+this.bottom+this.p)+" l 0,-"+(this.bottom-this.top+this.p)+" l "+(this.p*0.9)+",0 l 0,"+(this.bottom-this.top+this.p)+" c "+this.p+","+this.p+" "+(this.p*1.25)+","+(this.bulb)+" -"+(this.p*2.5)+","+(this.bulb-this.p*0.75)+" q "+(this.p*3.25)+",-"+(this.bulb*0.1)+" "+(this.p*1.75)+",-"+(this.bulb-this.p)+" z").attr({opacity:0.2,fill:"#000000","fill-opacity":1,stroke:"#000000","stroke-width":1});this.labels=this.thermo.set();this.ticks=this.thermo.set();var G,K;for(var I=0;I<this.tm.length;I++){K=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.tm[I]))-0.5;this.ticks.push(this.thermo.path("M "+(this.xoff+this.wide/2+2)+","+(this.yoff+K)+" l "+(this.p*3)+",0").attr({stroke:"white","stroke-width":1}))}K=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.req))-0.5;this.ticks.push(this.thermo.path("M "+(this.xoff+this.wide/2-this.p*5)+","+(this.yoff+K)+" l "+(this.p*6)+",0").attr({stroke:"#ffffff","stroke-width":1,"stroke-dasharray":["-"]}));this.updateLanguage(this.pb);return this}o.prototype.updateLanguage=function(I){this.pb=I;if(this.rl){this.rl.remove()}y=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.req))-0.5;this.rl=this.thermo.text(this.xoff+this.wide/2-this.p*6,this.yoff+y,this.pb.req).attr(this.txt);this.rl.attr({"text-anchor":"middle"}).transform("r-90");if(this.labels){this.labels.remove()}for(var G=0;G<this.tm.length;G++){y=Math.round(this.bottom+(this.top-this.bottom)*this.getYFrac(this.tm[G]))-0.5;this.labels.push(this.thermo.text((this.xoff+this.wide/2+this.p*3.5),(this.yoff+y),n(this.format.call(this.ctx,{value:this.tm[G],units:"K",dimension:"temperature"}))).attr(this.labeltxt))}return this};o.prototype.getYFrac=function(i){return(Math.log10(i)-Math.log10(this.tm[0]))/(Math.log10(this.tm[this.tm.length-1])-Math.log10(this.tm[0]))};o.prototype.value=function(i){var I=this.getYFrac(i);if((I-1)*(this.bottom-this.top)>this.p){I=1+(this.p/(this.bottom-this.top))}if(i<this.tm[0]){I=0}this.mercury.transform("s1,"+I+",0,"+this.bottom);var G={value:i,units:"K",dimension:"temperature"};if(i<=this.tm[this.tm.length-1]){G.value=this.tm[this.tm.length-1]}this.labels[this.labels.length-1].attr("text",n(this.format.call(this.ctx,G)));return this};function D(i){if(!i){i={}}this.label=(g(i.label,"string"))?i.label:"";this.colour=(g(i.color,"string"))?i.color:e(".science").css("color");this.wide=(g(i.width,"number"))?i.width:50;this.tall=(g(i.height,"number"))?i.height:75;this.xoff=(g(i.x,"number"))?i.x:0;this.yoff=(g(i.y,"number"))?i.y:0;this.p=0.1;if(g(i.canvas,"object")){this.canvas=i.canvas}else{return this}p=this.wide*this.p;q=this.tall*this.p;this.liquid=this.canvas.rect(this.xoff+p,this.yoff+this.p*this.tall,this.wide-2*p,(1-2*this.p)*this.tall).attr({fill:this.colour,stroke:0});this.flask=this.canvas.path("M"+(this.xoff+p*3.75)+","+(this.yoff+q)+" l "+(p*0.25)+","+(q*0.25)+" l 0,"+(q*3)+" l -"+(p*2.5)+","+(q*3.75)+" q -"+(p*0.5)+","+(q*0.75)+" 0,"+(q)+" l "+(p*7)+",0 q "+(p*0.5)+",-"+(q*0.25)+" 0,-"+q+" l -"+(p*2.5)+",-"+(q*3.75)+" l 0,"+(-q*3)+" l "+(p*0.25)+",-"+(q*0.25)+" l -"+(p*2.5)+",0 m 0,-"+q+" l "+(p*6.25)+",0 l 0,"+(q*10)+" l-"+(p*10)+",0 l 0,-"+(q*10)+" z").attr({fill:"black",stroke:0});this.outline=this.canvas.path("M"+(this.xoff+p*3.75)+","+(this.yoff+q)+" l "+(p*0.25)+","+(q*0.25)+" l 0,"+(q*3)+" l -"+(p*2.5)+","+(q*3.75)+" q -"+(p*0.5)+","+(q*0.75)+" 0,"+(q)+" l "+(p*7)+",0 q "+(p*0.5)+",-"+(q*0.25)+" 0,-"+q+" l -"+(p*2.5)+",-"+(q*3.75)+" l 0,"+(-q*3)+" l "+(p*0.25)+",-"+(q*0.25)+"").attr({stroke:"white","stroke-width":2});this.label=this.canvas.text(this.xoff,this.yoff+this.tall/2,this.label).attr({font:"10px","text-anchor":"end",fill:"#ffffff"});this.value(0);return this}D.prototype.value=function(i){if(i>1){i=1}if(i<0){i=0}this.liquid.transform("s1,"+i+",0,"+(this.yoff+this.tall-this.p*this.tall));return this};function C(){var N=e("#launchrocket img");var J=e("#launchpadbg img");if(e("#launchexhaust").length==0){N.before('<canvas id="launchexhaust"></canvas>')}var G=document.getElementById("launchexhaust");var U=G.getContext("2d");this.active=true;var Q;var S=J.innerWidth(),L=J.innerHeight();G.width=S;G.height=L;var T=[];var O={};var I=80;for(var K=0;K<I;K++){T.push(new M())}function M(){this.speed={x:-0.5+Math.random()*1,y:-5+Math.random()*3};this.loc={x:N.offset().left+(N.width()/2)-J.offset().left,y:N.offset().top+N.height()-J.offset().top};this.radius=5+Math.random()*2;this.life=20+Math.random()*10;this.remaining_life=this.life;this.r=Math.round(Math.random()*55+200);this.g=this.r;this.b=this.r}var P=this;function R(){U.globalCompositeOperation="source-over";U.fillStyle="transparent";U.fillRect(0,0,S,L);for(var V=0;V<T.length;V++){var W=T[V];U.beginPath();W.opacity=Math.round(W.remaining_life/W.life*100)/100;var X=U.createRadialGradient(W.loc.x,W.loc.y,0,W.loc.x,W.loc.y,W.radius);Q="rgba("+W.r+", "+W.g+", "+W.b+", "+W.opacity+")";X.addColorStop(0,Q);X.addColorStop(0.5,Q);X.addColorStop(1,"rgba("+Math.round(W.r*0.9)+", "+Math.round(W.g*0.9)+", "+Math.round(W.b*0.9)+", 0)");U.fillStyle=X;U.arc(W.loc.x,W.loc.y,W.radius,Math.PI*2,false);U.fill();W.remaining_life-=0.5;W.radius+=0.5;W.loc.x+=W.speed.x;W.loc.y-=W.speed.y;if(W.remaining_life<0||W.radius<0){T[V]=new M()}}if(P.active){requestAnimationFrame(R)}}R();return this}C.prototype.stop=function(){this.active=false};function f(K){K+="";var i=K.split(".");var J=i[0];var G=i.length>1?"."+i[1]:"";var I=/(\d+)(\d{3})/;while(I.test(J)){J=J.replace(I,"$1,$2")}return J+G}function g(i,G){return(typeof i===G)}function b(G,I){var J=Math.floor(s.log10(G));var i=Math.round(G/Math.pow(10,J));return""+i+"&times;10<sup>"+J+"</sup>"+I}function n(i){return e("<div />").html(i).text()}function x(J){var G=e(window).width();var K=e(window).height();var i=0;var I=0;i=((G-J.outerWidth())/2);J.css({left:((G-J.outerWidth())/2)+"px"});if(e(window).height()>J.height()){I=((K-J.outerHeight())/2+e(window).scrollTop());e("body").css("overflow-y","hidden")}J.css({left:i+"px",top:I+"px",position:"absolute"})}function z(G,i){t=G.data("transform");if(g(t,"undefined")){t=G.attr("transform")}if(!g(t,"object")){t=[]}m=false;for(A=0;A<t.length;A++){for(j=0;j<i.length;j++){if(t[A][0]==i[j][0]){t[A]=i[j][0];m=true}}}if(!m){t.push(i)}G.transform(t).data("transform",t)}function w(I,J,K){if(K){var G=new Date();G.setTime(G.getTime()+(K*24*60*60*1000));var i="; expires="+G.toGMTString()}else{var i=""}document.cookie=I+"="+J+i+"; path=/"}function B(I){var K=I+"=";var G=document.cookie.split(";");for(var J=0;J<G.length;J++){var L=G[J];while(L.charAt(0)==" "){L=L.substring(1,L.length)}if(L.indexOf(K)==0){return L.substring(K.length,L.length)}}return null}function d(i){w(i,"",-1)}e.spacetelescope=function(G,i){if(typeof i=="object"){i.container=G}else{if(G){if(typeof G=="string"){i={container:G}}else{i=G}}else{i={}}}i.plugins=e.spacetelescope.plugins;return new H(i)};e.spacetelescope.plugins=[]})($);