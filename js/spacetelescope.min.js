/*!
	SpaceTelescope
	(c) Stuart Lowe and Chris North 2014
*/
if(typeof $==="undefined"){$={}}(function(e){var x={};x.log10=function(i){return Math.log(i)/2.302585092994046};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(i){window.setTimeout(i,1000/60)}})();var u={supportsFullScreen:false,isFullScreen:function(){return false},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},f="webkit moz o ms khtml".split(" ");if(typeof document.cancelFullScreen!="undefined"){u.supportsFullScreen=true}else{for(var g=0,s=f.length;g<s;g++){u.prefix=f[g];if(typeof document[u.prefix+"CancelFullScreen"]!="undefined"){u.supportsFullScreen=true;break}}}if(u.supportsFullScreen){u.fullScreenEventName=u.prefix+"fullscreenchange";u.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}};u.requestFullScreen=function(i){return(this.prefix==="")?i.requestFullScreen():i[this.prefix+"RequestFullScreen"]()};u.cancelFullScreen=function(i){return(this.prefix==="")?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}}if(typeof jQuery!="undefined"){jQuery.fn.requestFullScreen=function(){return this.each(function(){if(u.supportsFullScreen){u.requestFullScreen(this)}})}}window.fullScreenApi=u;Raphael.el.animateAlong=function(D,C,B,A){var i=this;i.path=D;i.direction=A;i.pathLen=i.path.getTotalLength();C=(typeof C==="undefined")?5000:C;B=(typeof B==="undefined")?1:B;i.paper.customAttributes.along=function(G){var F=(this.direction&&this.direction<0)?(1-G)*this.pathLen:(G*this.pathLen);var E=this.path.getPointAtLength(F),H={cx:E.x,cy:E.y};this.rotateWith&&(H.transform="r"+E.alpha);return H};i.attr({along:0});var z=Raphael.animation({along:1},C);i.animate(z.repeat(B))};e.query=function(){var i={length:0};var z=location.search;if(z&&z!="#"){z=z.replace(/^\?/,"").replace(/\&$/,"");jQuery.each(z.split("&"),function(){var A=this.split("=")[0];var B=this.split("=")[1];if(/^[0-9\.]+$/.test(B)){B=parseFloat(B)}i[A]=B})}return i};document.write('<style type="text/css">.noscriptmsg { display: none; }</style>');function q(z){if(typeof e!=="function"){this.log("No jQuery! Abort! Abort!");return this}this.q=e.query();this.i=z;this.stage="intro";this.choices={};this.sections=["objectives","satellite","instruments","cooling","vehicle","site","orbit","proposal"];this.keyboard=true;this.errors=[];this.warnings=[];this.langurl="config/%LANG%%MODE%.json";this.dataurl="config/options%MODE%.json";this.scenariourl="config/scenarios_%LANG%%MODE%.json";this.keys=new Array();this.pushstate=!!(window.history&&history.pushState);this.settings={length:"m",currency:"GBP",temperature:"K",mass:"kg",time:"years",usecookies:false,mode:"normal"};this.init(z);var A="transform WebkitTransform MozTransform OTransform msTransform".split(" ");this.hastransform=false;for(var i=0;i<A.length;i++){var B=document.createElement("div");if(B.style[A[i]]!=undefined){this.hastransform=true}}return this}q.prototype.init=function(A){this.lang=(typeof this.q.lang==="string")?this.q.lang:(navigator)?(navigator.userLanguage||navigator.systemLanguage||navigator.language||browser.language):"";this.langshort=(this.lang.indexOf("-")>0?this.lang.substring(0,this.lang.indexOf("-")):this.lang.substring(0,2));this.langs=(A&&A.langs)?A.langs:{en:"English"};this.setVar("currency","string");this.setVar("length","string");this.setVar("mass","string");this.setVar("temperature","string");this.setVar("time","string");this.setVar("mode","string");this.loadConfig(this.update);this.loadLanguage(this.lang,this.update);var C=this;window[(this.pushstate)?"onpopstate":"onhashchange"]=function(i){C.navigate(i)};var B="";var D=0;for(l in this.langs){B+='<li class="baritem"><a href="#" title="'+this.langs[l]+'" data="'+l+'">'+this.langs[l]+" ["+l+"]</a></li>";D++}e("#language ul").html(B);if(D<2){e(".togglelang").closest(".baritem").hide()}B=e("#language ul li a");for(var z=0;z<B.length;z++){e(B[z]).on("click",{me:this},function(i){i.preventDefault();i.data.me.loadLanguage(e(this).attr("data"),i.data.me.update)})}e("#summary a").on("click",{me:this},function(i){i.data.me.toggleMenus("summaryext",i)});e("a.togglewarning,a.toggleerror").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("messages")});e("a.togglemenu").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("menu")});e("a.togglelang").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("language")});e(".baritem .save").parent().on("click",{me:this},function(i){i.data.me.save().toggleMenus()});e(".baritem .help").parent().on("click",{me:this},function(i){i.data.me.toggleGuide(i).toggleMenus()});e(".baritem .options").parent().on("click",{me:this},function(i){i.data.me.showView("options",i).toggleMenus()});if(u.supportsFullScreen){e("#menu ul").append('<li class="baritem" data="fullscreen"><a href="#" class="fullscreenbtn"><img src="images/cleardot.gif" class="icon fullscreen" alt="" /> <span></span></li>');e(".baritem .fullscreenbtn").parent().on("click",{me:this},function(i){i.data.me.toggleFullScreen().toggleMenus()})}e("body").on("click","a.guidelink",{me:this},function(i){if(e(this).attr("href").indexOf("#")==0){i.data.me.showView(e(this).attr("href").substr(1),i)}i.data.me});e(document).on("keypress",{me:this},function(E){if(!E){E=window.event}var i=E.keyCode||E.charCode||E.which||0;E.data.me.keypress(i,E)});this.registerKey(["?"],function(i){this.toggleGuide(i)});e(document).on("scroll",{me:this},function(i){i.data.me.scrollMenus()});e(".scriptonly").removeClass("scriptonly");e(window).resize({me:this},function(i){i.data.me.resize()});return this};q.prototype.buildToggle=function(A,z,i){if(typeof A!=="string"&&typeof z!="object"&&typeof i!="object"){return""}html='<div class="toggleinput toggler"><label class="toggle-label1" for="'+z.id+'"></label>';html+='<div class="toggle-bg">';html+='	<input id="'+z.id+'" type="radio" '+(z.checked?'checked="checked" ':"")+'name="'+A+'" value="'+z.value+'">';html+='	<input id="'+i.id+'" type="radio" '+(i.checked?'checked="checked" ':"")+'name="'+A+'" value="'+i.value+'">';html+='	<span class="switch"></span>';html+="</div>";html+='<label class="toggle-label2" for="'+i.id+'"></label></div>';return html};q.prototype.updateToggle=function(z,i,A){if(typeof z!="object"&&typeof i!="object"||e("#"+z.id).length==0||e("#"+i.id).length==0){return this}if(!A){A=""}if(!z.label){z.label=""}if(!i.label){i.label=""}e("#"+z.id+",#"+i.id).attr("title",A);e("label[for="+z.id+"]").html(z.label);e("label[for="+i.id+"]").html(i.label);return this};q.prototype.buildPage=function(){if(this.built){return this}this.built=true;e(document).on("focus","input,textarea",{me:this},function(i){i.data.me.keyboard=false}).on("blur","input,textarea",{me:this},function(i){i.data.me.keyboard=true});e("#scenarios").html('<h2></h2><p class="about"></p><ul id="scenariolist"></ul>');e(document).on("click","#scenarios .button",{me:this},function(i){i.data.me.chooseScenario(e(this).attr("data"))});e("#messages .warnings").html('<div class="bigpadded"><h3 class="warning"><img src="images/cleardot.gif" class="icon warning" /> <span class="title"></span> <span class="warning value">0</span></h3><ul class="summary"></ul>');e("#messages .errors").html('<div class="bigpadded"><h3 class="error"><img src="images/cleardot.gif" class="icon error" /> <span class="title"></span> <span class="error value">0</span></h3><ul class="summary"></ul>');e("#designer").html('<div class="designer_inner bigpadded"><div id="main"><div id="menubar"></div><div id="output"></div><div id="sidebar"><div class="padded"></div></div></div></div>');for(var B=0;B<this.sections.length;B++){if(e("#designer_"+this.sections[B]).length==0){e("#output").append('<div id="designer_'+this.sections[B]+'" class="designer"><h2 class="designer_title"><a href="#designer_'+this.sections[B]+'" class="toggle'+this.sections[B]+'"></a></h2><div class="designer_content"><div class="intro"></div><div class="options"></div><div class="questions"></div></div></div>')}}var A="";for(var B=0;B<this.sections.length;B++){A+='<li><a href="#designer_'+this.sections[B]+'" class="toggle'+this.sections[B]+'"></a></li>'}e("#menubar").html("<ul>"+A+"</ul>");e(".barmenu").append('<div class="baritem togglelaunch"><a href="#launch" class="">Launch</a></div>');e(document).on("click","#messages a",{me:this},function(i){e("#messages").hide()});e("#designer_objectives .intro").after('<div class="summary"></div>');e("#designer_satellite .options").html('<div class="bigpadded"><form><ul><li class="option mirror_diameter"><label for="mirror_size"></label><select id="mirror_size" name="mirror_size"></select></li><li class="option mirror_deployable"><label for="mirror_deployable"></label>'+this.buildToggle("toggledeployable",{value:"no",id:"mirror_deployable_no",label:"",checked:true},{value:"yes",id:"mirror_deployable_yes",label:""})+'</li><li class="option mirror_uv"><label for="mirror_uv"></label>'+this.buildToggle("toggleuv",{value:"no",id:"mirror_uv_no",checked:true},{value:"yes",id:"mirror_uv_yes"})+'</li></ul></form><div class="details"></div></div>');e("#designer_satellite select, #designer_satellite input").on("change",{me:this},function(i){i.data.me.parseChoices().showDetails("satellite").showDetails("cooling")});e("#designer_instruments .options").html('<div class="bigpadded"><form><ul><li><label for="instruments"></label><select id="wavelengths" name="wavelengths"></select><select id="instruments" name="instruments"></select> <input type="text" id="instrument_name" name="instrument_name" /><a href="#" class="add_instrument"><img src="images/cleardot.gif" class="icon add" /></a></li></ul></form><div class="details"></div></div><div class="instrument_list bigpadded"></div>');e("#designer_instruments select").on("change",{me:this},function(F){var E=F.data.me.getValue("#instruments");var D=F.data.me.getValue("#wavelengths");F.data.me.parseChoices().showDetails("instruments",{wavelength:D,type:E})});e("#designer_instruments .add_instrument").on("click",{me:this},function(i){i.preventDefault();i.data.me.addInstrument()});e(document).on("click",".remove_instrument",{me:this},function(i){i.preventDefault();i.data.me.removeInstrument(e(this).attr("data"))});e("#designer_cooling .options").html('<div class="bigpadded"><form><ul><li><label for="hascooling"></label>'+this.buildToggle("hascooling",{value:"no",id:"cooling_no",checked:true},{value:"yes",id:"cooling_yes"})+'</li></ul></form><div class="details"></div></div>');if(this.data.cooling.temperature){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_temperature"></label><select id="cooling_temperature" name="cooling_temperature"></select></li>')}if(this.data.cooling.passive){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_passive"></label>'+this.buildToggle("cooling_passive",{value:"no",id:"cooling_passive_no"},{value:"yes",id:"cooling_passive_yes",checked:true})+"</li>")}if(this.data.cooling.active){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_active"></label>'+this.buildToggle("cooling_active",{value:"no",id:"cooling_active_no",checked:true},{value:"yes",id:"cooling_active_yes"})+"</li>")}if(this.data.cooling.cryogenic){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_cryogenic"></label><select id="cooling_cryogenic" name="cooling_cryogenic"></select></li>')}e(document).on("change","#designer_cooling .options input,#designer_cooling .options select",{me:this},function(i){if(i.data.me.getValue("input[name=hascooling]:checked")=="yes"){e("#designer_cooling li.hascooling").show()}else{e("#designer_cooling li.hascooling").hide()}i.data.me.parseChoices().showDetails("cooling")});A='<div class="bigpadded">';A+='<form><ul class="info">';for(var z in this.data.vehicle){A+='<li class="'+z+'" data="'+z+'">';A+='<div class="image"><img src="" alt="" title="" /></div><div class="operator"><img src="" alt="" title="" /></div>';A+='<div class="vehicle_details">';A+='<div class="rocket"></div>';var C=["operator","height","diameter","currency","massLEO","massGTO",(this.data.vehicle[z].risk?"risk":""),"sites"];for(var B=0;B<C.length;B++){A+=this.buildRow("","",C[B])}A+='<div class="clearall"></div>';A+="</div>";A+='<div class="selector"><input type="radio" name="vehicle_rocket" id="vehicle_rocket_'+z+'" data="'+z+'" /><label for="vehicle_rocket_'+z+'"></label></div>';A+="</li>"}A+='</ul></form><div class="details"></div></div>';e("#designer_vehicle .options").html(A);e(document).on("click","#designer_vehicle .options .button",{me:this},function(i){i.preventDefault();e("#designer_vehicle .info>li."+e(this).attr("data")).find("input").trigger("click")});e(document).on("change","#designer_vehicle .options .selector input",{me:this},function(i){e("#designer_vehicle .info>li").removeClass("selected");e("#designer_vehicle .info>li."+e(this).attr("data")).addClass("selected").find("input").trigger("click");i.data.me.parseChoices()});e(document).on("click","#designer_vehicle .options .info>li",{me:this},function(i){if(!e(this).hasClass("withinfo")){e(".withinfo").removeClass("withinfo");e(this).addClass("withinfo");e("#designer_vehicle .details").html(e(this).find(".vehicle_details").html()).addClass("padded")}});e("#designer_site .options").html('<div class="worldmap"><img src="images/worldmap.jpg" /></div><div class="bigpadded"><form><ul><li><label for="site"></label><select id="site" name="site"></select></li></ul></form><div class="details"></div></div>');e(document).on("click","#designer_site .launchsite",{me:this},function(i){i.preventDefault();e("#designer_site #site").val(e(this).attr("data"));e("#designer_site #site").trigger("change")});e("#designer_site #site").on("change",{me:this},function(D){var i=D.data.me.getValue("#site");e(".launchsite").removeClass("selected");e(".launchsite[data="+i+"]").addClass("selected");D.data.me.parseChoices().showDetails("site",i)});e("#designer_orbit .options").html('<div id="orbits"></div><div class="bigpadded"><form><ul><li><label for="mission_orbit"></label><select id="mission_orbit" name="mission_orbit"></select></li><li><label for="mission_duration"></label><select id="mission_duration" name="mission_duration"></select></li></ul></form><div class="details"></div></div>');e("#mission_orbit").on("change",{me:this},function(D){var i=D.data.me.getValue("#mission_orbit");D.data.me.highlightOrbit(i).parseChoices().showDetails("orbit",i).showDetails("cooling")});e("#mission_duration").on("change",{me:this},function(i){i.data.me.parseChoices()});e(document).on("submit","form",{me:this},function(i){i.preventDefault()});e("#designer_instruments form").on("submit",{me:this},function(i){i.preventDefault();e(this).find("a.add_instrument").trigger("click")});e("#designer_proposal .options").html('<div class="padded"><div class="doc"></div></div>');e(document).on("change",".doc input,.doc textarea",{me:this},function(i){i.data.me.updateProposal()});e("#sidebar").html('<div class="sidebar_inner"><div class="satellite panel"></div><div class="vehicle padded panel"></div><div class="site worldmap panel"></div><div class="orbit panel"></div></div>');e("#sidebar .panel").hide();e(document).on("click",".printable a.button",{me:this},function(i){i.preventDefault();i.data.me.printProposal()});e(document).on("click",".toggler",{me:this},function(D){var i=e(this).find("input:checked");if(i.attr("value")=="yes"){e(this).addClass("checked")}else{e(this).removeClass("checked")}});this.table={success:{list:{success_vehicle:{},success_site:{},success_orbit:{},success_deploy:{},success_cooling:{},success_instruments:{},success_mission:{}}},cost_available:{list:{cost_initial:{},cost_dev_total:{list:{cost_dev_satellite:{},cost_dev_mirror:{},cost_dev_cooling:{},cost_dev_instruments:{}}},cost_operations_total:{list:{cost_operations_launch:{},cost_operations_ground:{}}},cost_total:{},cost_available:{}}},mass_total:{list:{mass_satellite:{},mass_mirror:{},mass_cooling_total:(this.settings.mode=="advanced"?{list:{mass_cooling_passive:{},mass_cooling_cryo:{},mass_cooling_active:{}}}:{}),mass_instruments:{}}},time_dev_total:{list:{time_dev_total:{list:{time_dev_satellite:{},time_dev_mirror:{},time_dev_cooling:{},time_dev_instruments:{}}},time_mission:{},time_cooling:{},time_fuel:{},time_observing:{}}},science_total:{},profile_total:{list:{profile_site:{},profile_vehicle:{},profile_instruments:{},profile_mirror:{},profile_temperature:{},profile_orbit:{},profile_launch:{},profile_end:{}}}};return this};q.prototype.resize=function(){if(this.modal){this.positionModal(this.modal)}this.resizeSpace();return this};q.prototype.navigate=function(z,i){if(!i){var i=location.href.split("#")[1]}this.log("navigate",i,z);if(typeof i!=="string"){i=""}this.showView(i,z);return this};q.prototype.keypress=function(z,B){if(this.keyboard){if(!B){B={altKey:false}}for(var A=0;A<this.keys.length;A++){if(this.keys[A].charCode==z&&B.altKey==this.keys[A].altKey){this.keys[A].fn.call(this,{event:B});break}}}};q.prototype.registerKey=function(H,F,B){if(typeof F!="function"){return this}if(typeof H!="object"){H=[H]}var G,z,E,A,C,D;for(E=0;E<H.length;E++){C=false;if(typeof H[E]=="string"){if(H[E].indexOf("alt")==0){D=H[E];C=true;H[E]=H[E].substring(4)}else{D=H[E]}z=H[E].charCodeAt(0)}else{z=H[E];if(z==37){D="&larr;"}else{if(z==32){D="space"}else{if(z==38){D="up"}else{if(z==39){D="&rarr;"}else{if(z==40){D="down"}else{D=String.fromCharCode(z)}}}}}}G=true;for(A=0;A<this.keys.length;A++){if(this.keys.charCode==z&&this.keys.altKey==C){G=false}}if(G){this.keys.push({str:D,charCode:z,"char":String.fromCharCode(z),fn:F,txt:B,altKey:C})}}return this};q.prototype.toggleMenus=function(E,C){if(C&&typeof C==="object"){C.preventDefault()}var z=e(".dropdown");var A=(C)?e(C.currentTarget).attr("href"):"";for(var B=0;B<z.length;B++){var D=this;if(e(z[B]).attr("id")==E){e(z[B]).toggle(0,function(){if(A&&A.indexOf("#")>=0){D.setScroll("#"+A.split("#")[1])}})}else{e(z[B]).hide()}}if(E=="messages"){this.setScroll("#"+E)}return this};q.prototype.scrollMenus=function(i){e(".dropdown.fullwidth:visible").each(function(){var z=parseInt(e(this).css("top"));var A=e("#bar").outerHeight();var B=window.scrollY;if(z<=A){e(".dropdown").css({top:A})}if(z>B+A){e(".dropdown").css({top:B+A})}});return this};q.prototype.setVar=function(i,A){if(typeof i==="string"){if(this.i&&typeof this.i[i]===A){this.settings[i]=this.i[i]}if(typeof this.q[i]===A){this.settings[i]=this.q[i];if(this.settings.usecookies){w("spacetelescope."+i,this.settings[i],1)}}if(this.settings.usecookies){var z=n("spacetelescope."+i);if(z){this.settings[i]=z}}}return this};q.prototype.loadConfig=function(z){var i=this.dataurl.replace("%MODE%",this.getMode());e.ajax({url:i,method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+i)},success:function(A){this.data=A;if(typeof z==="function"){z.call(this)}}});return this};q.prototype.getMode=function(){return(this.settings.mode=="advanced")?"_advanced":""};q.prototype.loadLanguage=function(z,B){if(!z){z=this.langshort}var i=this.settings.mode;var A=this.langurl.replace("%LANG%",z).replace("%MODE%",this.getMode());e.ajax({url:A,method:"GET",cache:false,dataType:"json",context:this,error:function(){this.log("Error loading "+z+" ("+i+")");if(this.lang.length==2){this.log("Attempting to load default (en) instead");this.loadLanguage("en",B)}else{if(A.indexOf(this.lang)>0){this.log("Attempting to load "+this.langshort+" instead");this.loadLanguage(this.langshort,B)}}},success:function(C){this.langshort=z;this.lang=z;this.phrases=C;this.loadScenarios(B)}});return this};q.prototype.loadScenarios=function(A){var i=this.settings.mode;var z=this.scenariourl.replace("%LANG%",this.langshort).replace("%MODE%",this.getMode());e.ajax({url:z,method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+z+" ("+i+")");if(typeof A==="function"){A.call(this)}},success:function(B){this.scenarios=B.scenarios;if(typeof A==="function"){A.call(this)}}});return this};q.prototype.chooseScenario=function(z){this.log("chooseScenario",z);this.scenario=this.scenarios[z];this.stage="designer";e("#summary").show();this.updateSummary().updateLanguage();return this};q.prototype.update=function(){this.log("update");if(!this.phrases||!this.data){return this}this.buildPage().updateLanguage().makeSpace().displayOrbits();e("#language.dropdown").hide();if(!this.loaded){this.navigate();this.loaded=true}return this};q.prototype.addInstrument=function(){if(!this.choices.instruments){this.choices.instruments=[]}var A=this.getValue("#instruments");var z=this.getValue("#wavelengths");var B=this.getValue("#instrument_name");if(A&&z){if(!B){B=this.phrases.designer.instruments.defaultname.replace(/%d%/,(this.choices.instruments.length+1))}this.choices.instruments.push({name:B,type:A,wavelength:z});this.updateInstruments()}return this};q.prototype.removeInstrument=function(z){z=parseInt(z,10);if(z<this.choices.instruments.length){this.choices.instruments.splice(z,1)}this.updateInstruments();return this};q.prototype.updateInstruments=function(){this.log("updateInstruments");var B=this.phrases.designer;var A="";if(this.choices.instruments.length>0){A+="<h3>"+B.instruments.table.title+'</h3><div class="tablewrapper"><table><tr><th>'+B.instruments.table.name+"</th><th>"+B.instruments.table.type+"</th><th>"+B.instruments.table.cost+"</th><th>"+B.instruments.table.mass+"</th><th>"+B.instruments.table.temperature+"</th><th></th></tr>";for(var z=0;z<this.choices.instruments.length;z++){v=this.getInstrument({wavelength:this.choices.instruments[z].wavelength,type:this.choices.instruments[z].type});A+="<tr><td>"+this.choices.instruments[z].name+"</td><td>"+v.wavelength+" "+v.type+"</td><td>"+this.formatValueSpan(v.cost)+"</td><td>"+this.formatValueSpan(v.mass)+"</td><td>"+this.formatValueSpan(v.temp)+'</td><td><a class="remove_instrument" href="#" title="'+this.phrases.designer.instruments.options.remove+'" data="'+z+'"><img class="icon minus" src="images/cleardot.gif"></a></td></tr>'}A+="</table></div>"}e("#designer_instruments .instrument_list").html(A);this.parseChoices("designer_instruments");return this};q.prototype.makeSatellite=function(){this.log("makeSatellite");if(!this.satellite){this.satellite={}}var X=this.satellite;if(!X.el){X.el=e("#sidebar .satellite.panel")}if(X.el.find("#schematic").length==0){X.el.html('<div id="schematic"></div>')}var ad=160;var U=e("#sidebar").innerWidth();var ag;var J={mirror:0,bus:0,slots:0};var ai=Math.cos(Math.PI*30/180);if(this.choices.mirror){for(var aa in this.data.mirror){ag=this.convertValue(this.data.mirror[aa].diameter,"m");if(aa==this.choices.mirror){J.mirror=ag.value}}for(var aa in this.data.mirror){ag=this.convertValue(this.data.mirror[aa].bus.diameter,"m");if(aa==this.choices.mirror){J.bus=ag.value;if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.diameter){J.bus*=this.data.deployablemirror.multiplier.bus.diameter}J.slots=this.data.mirror[aa].bus.instrumentslots}}}var B=16;var ae=Math.floor(U/32);var P=ae*(J.bus/J.mirror);var O=8;var C=2;var ak=10*P;var H=(this.choices.cooling.cryogenic?this.choices.cooling.cyrogeniclife:0);if(H==0&&this.choices.cool.temperature){var W=this.convertValue(this.choices.temperature,"K");if(W.value<50){H=Math.log(50/W.value)}}var A=4;var z=((O+A+H)*ae);var aj=13*ae;var L=(this.choices.cooling.passive?2*ae:0);if(this.choices.cool.temperature){var W=this.convertValue(this.choices.temperature,"K");if(W.value<300){L=2*ae}}ad=(this.choices.mirror)?ak+z+aj+L+(2*B):0;this.resizeSatellite("auto",ad);if(this.satellite.bus){this.satellite.bus.remove();delete this.satellite.bus}if(this.satellite.body){this.satellite.body.remove();delete this.satellite.body}if(this.satellite.vgroove){this.satellite.vgroove.remove();delete this.satellite.vgroove}if(this.satellite.mirror){this.satellite.mirror.remove();delete this.satellite.mirror}var F={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};var ah={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};var N={stroke:"white","stroke-width":1};if(this.choices.mirror){X.bus=X.paper.set();X.bus.push(X.paper.ellipse(0,3.5*P,10*P,6*P).attr(F));X.bus.push(X.paper.path("m "+(-8.5*P)+", "+(-2*P)+" l0,"+(4*P)+" l"+(5*P)+","+(3*P)+" l"+(7*P)+",0 l"+(5*P)+","+(-3*P)+" l0,"+(-4*P)+" l"+(-5*P)+","+(-3*P)+" l"+(-7*P)+",0 z").attr(F));X.bus.push(X.paper.path("m "+(-8.5*P)+", "+(2*P)+" l0,"+(3.5*P)+" l"+(5*P)+","+(3*P)+" l0,"+(-3.5*P)+" z").attr(F));X.bus.push(X.paper.path("m "+(-3.5*P)+", "+(5*P)+" l"+(7*P)+",0 l0,"+(3.5*P)+" l"+(-7*P)+",0 z").attr(F));X.bus.push(X.paper.path("m "+(8.5*P)+", "+(2*P)+" l0,"+(3.5*P)+" l"+(-5*P)+","+(3*P)+" l0,"+(-3.5*P)+" z").attr(F))}if(L>0){X.vgroove=X.paper.set();X.vgroove.push(X.paper.ellipse(0,-0.6*P,8.5*P,5*P).attr(ah));X.vgroove.push(X.paper.ellipse(0,-1.2*P,8.25*P,4.75*P).attr(ah));X.vgroove.push(X.paper.ellipse(0,-1.8*P,8*P,4.5*P).attr(ah));X.vgroove.push(X.paper.path("m 0,"+(-0.6*P)+" l"+(-5.5*P)+","+(2.5*P)+" m"+(5.5*P)+","+(-2.5*P)+" l"+(1.5*P)+","+(3.5*P)+" m"+(-1.5*P)+","+(-3.5*P)+" l"+(8*P)+","+(-P)+" m"+(-8*P)+","+(P)+" l"+(5*P)+","+(-5*P)+" m"+(-5*P)+","+(5*P)+" l"+(-2*P)+","+(-5.5*P)+" m"+(2*P)+","+(5.5*P)+" l"+(-7*P)+","+(-3*P)).attr({stroke:"white","stroke-width":1,"stroke-opacity":0.4}))}if(this.choices.mirror){X.body=X.paper.set();var V=Math.min(7,8.5*(J.bus/J.mirror));var Y=V*0.4;var af=(V-Y);X.body.push(X.paper.ellipse(0,0,V*ae,af*ae).attr(N));X.body.push(X.paper.path("m "+(-V*ae)+",0 a "+(V*ae)+","+(af*ae)+" 0 0,0 "+(2*V*ae)+",0 l 0,"+(-(O+H-1)*ae)+" q 0,"+(-2*ae)+" "+(-af*ae)+","+(-A*ae)+" l0,"+(-1*ae)+" a"+(Y*ae)+","+(Y*0.5*ae)+" 0 0,0 "+(-2*Y*ae)+",0 l0,"+(1*ae)+" q"+(-af*ae)+","+(1*ae)+" "+(-af*ae)+","+(af*ae)+" z").attr(F));if(H>0){X.body.push(X.paper.path("m "+(-V*ae)+",0 a "+(V*ae)+","+(af*ae)+" 0 0,0 "+(2*V*ae)+",0 l 0,"+(-H*ae)+" a "+(V*ae)+","+(af*ae)+" 0 0,0 "+(-2*V*ae)+",0 z").attr({stroke:"white","stroke-width":1,fill:e(".mass").css("color"),"fill-opacity":0.3}));X.body.push(X.paper.ellipse(0,(-H*ae),V*ae,af*ae).attr(N))}X.body.push(X.paper.ellipse(0,(-(O+H+A)*ae),Y*ae,Y*0.5*ae).attr(N));var G=Math.ceil(J.slots/2);var T,R,Q,I;var am=2.2;am=V*2/(G+2);var E=am/2;var D=am/4;var K={stroke:"white","stroke-width":1,"stroke-dasharray":"- ",fill:"white","fill-opacity":0.2};var S={stroke:"white","stroke-width":1,fill:e(".science").css("color"),"fill-opacity":1};var Z=0;var al=0;if(this.choices.instruments){al=this.choices.instruments.length}e("#schematic .label").remove();var M="";for(var ac=0;ac<G;ac++){T=(ac-(G-1)/2)*(am*ae*1.25);for(var ab=0;ab<2;ab++){R=H+1.5+(ab==0?0:C*2);Q=0.5+(T+(ab==0?D*ae:0))/U;I=(B+(ak+L+(R+(ab==0?-C:+C*1.5))*ae))/ad;X.body.push(X.paper.path("m"+(T-E*ae)+","+(-R*ae)+" l"+(E*ae)+","+(D*ae)+" l"+(E*ae)+","+(-D*ae)+" l0,"+(-C*ae)+" l"+(-E*ae)+","+(-D*ae)+" l"+(-E*ae)+","+(D*ae)+" z m"+(E*ae)+","+(D*ae)+" l0,"+(-C*ae)+" l"+(-E*ae)+","+(-D*ae)+"m"+(E*ae)+","+(D*ae)+"l"+(E*ae)+","+(-D*ae)).attr((Z<al)?S:K));if(Z<al&&this.choices.instruments[Z]&&this.hastransform){M+='<div class="label '+(ab==0?"bottom":"top")+'" style="bottom:'+(100*I)+"%; left:"+(100*Q)+'%">'+this.choices.instruments[Z].name+"</div>"}Z++}}if(M){e("#schematic").prepend(M)}}if(this.choices.mirror){X.mirror=X.paper.set();X.mirror.push(X.paper.ellipse(0,-2.5*ae,10*ae,6*ae).attr(F));X.mirror.push(X.paper.ellipse(0,0,1*ae,0.6*ae).attr(F));X.mirror.push(X.paper.path("m "+(-2*ae)+","+(-11*ae)+" l"+(-3*ae)+","+(6*ae)+" l "+(5*ae)+","+(-7*ae)+" l"+(5*ae)+","+(7*ae)+" l"+(-3*ae)+","+(-6*ae)).attr(N));X.mirror.push(X.paper.path("m "+(-2*ae)+","+(-11*ae)+" l"+(2*ae)+","+(-1*ae)+" l 0,"+(-1*ae)+" l"+(-2*ae)+","+(1*ae)+" z").attr(F));X.mirror.push(X.paper.path("m "+(2*ae)+","+(-11*ae)+" l"+(-2*ae)+","+(-1*ae)+" l 0,"+(-1*ae)+" l"+(2*ae)+","+(1*ae)+" z").attr(F));X.mirror.push(X.paper.path("m "+(-2*ae)+","+(-11*ae)+" l"+(-4*ae)+","+(12*ae)+" l "+(6*ae)+","+(-11*ae)+" l"+(6*ae)+","+(11*ae)+" l"+(-4*ae)+","+(-12*ae)).attr(N));X.mirror.push(X.paper.ellipse(0,(-11*ae),2*ae,1*ae).attr(F));X.mirror.push(X.paper.path("m "+(-2*ae)+","+(-12*ae)+" l"+(2*ae)+","+(1*ae)+" l 0,"+(1*ae)+" l"+(-2*ae)+","+(-1*ae)+" z").attr(F));X.mirror.push(X.paper.path("m "+(2*ae)+","+(-12*ae)+" l"+(-2*ae)+","+(1*ae)+" l 0,"+(1*ae)+" l"+(2*ae)+","+(-1*ae)+" z").attr(F))}if(X.bus){for(var ac=0;ac<X.bus.length;ac++){o(X.bus[ac],["t",U/2,ad-B-ak])}}if(X.vgroove){for(var ac=0;ac<X.vgroove.length;ac++){o(X.vgroove[ac],["t",U/2,ad-B-ak])}}if(X.body){for(var ac=0;ac<X.body.length;ac++){o(X.body[ac],["t",U/2,ad-B-ak-L])}}if(X.mirror){for(var ac=0;ac<X.mirror.length;ac++){o(X.mirror[ac],["t",U/2,ad-B-ak-L-z])}}this.satellite=X;return this};q.prototype.resizeSatellite=function(i,A){this.log("resizeSatellite");var z=e("#sidebar");this.satellite.el.children().hide();this.satellite.el.css({width:"auto",display:"block"});if(!i||i=="auto"){i=this.satellite.el.innerWidth()}if(i<z.width()/2){i=z.width()-(parseInt(this.satellite.el.css("margin-left"),10)+parseInt(this.satellite.el.css("margin-right"),10))}if(!A){A=i/2}if(i!=this.satellite.width||A!=this.satellite.height||this.satellite.width==0){this.satellite.width=i;if(this.satellite.width==0){this.satellite.width=z.width()-(parseInt(this.satellite.el.css("margin-left"),10)+parseInt(this.satellite.el.css("margin-right"),10))}this.satellite.height=A;if(!this.satellite.paper){this.satellite.paper=Raphael("schematic",this.satellite.width,this.satellite.height)}else{this.satellite.paper.setSize(this.satellite.width,this.satellite.height);this.satellite.rebuild=true}}this.satellite.el.children().show();return this};q.prototype.makeSpace=function(i){this.log("makeSpace",i);if(!this.space){this.space={width:0,height:300,zoom:0,scale:[1,0.022],anim:{},orbits:{},labels:{}}}if(typeof i==="number"){this.space.zoom=i}if(!this.space.el){this.space.el=e("#orbits")}if(!this.space.el.is(":visible")){return this}if(!this.space.paper){this.resizeSpace()}return this};q.prototype.resizeSpace=function(){if(!this.space){this.makeSpace()}if(this.space&&this.space.el.length>0){this.space.el.children().hide()}this.space.el.css({width:"auto",display:"block"});var i=this.space.el.innerWidth();if(i<e("#designer_orbit").width()/2){i=e("#designer_orbit").width()-(parseInt(this.space.el.css("margin-left"),10)+parseInt(this.space.el.css("margin-right"),10))}var z=i/2;if(i!=this.space.width||z!=this.space.height||this.space.width==0){this.space.width=i;if(this.space.width==0){this.space.width=e("#designer_orbit").width()-(parseInt(this.space.el.css("margin-left"),10)+parseInt(this.space.el.css("margin-right"),10))}this.space.height=z;if(!this.space.paper){this.space.paper=Raphael("orbits",this.space.width,this.space.height)}else{this.space.paper.setSize(this.space.width,this.space.height);this.space.rebuild=true}this.space.E={x:this.space.width/2,y:this.space.height/2,r:this.space.height/6,radius:6378};this.space.M={r:5,o:this.space.E.r*58}}this.displayOrbits();this.space.el.children().show();return this};q.prototype.selectOrbit=function(i){if(i){e("#designer_orbit #mission_orbit").val(i);e("#designer_orbit #mission_orbit").trigger("change")}return this};q.prototype.highlightOrbit=function(i){this.log("highlightOrbit",i,this.space);if(!i){return this}this.displayOrbits(i);for(var z in this.space.orbits){if(z==i){this.space.orbits[z].selected=true}else{this.space.orbits[z].selected=false}this.space.orbits[z].dotted.attr({"stroke-width":(this.space.orbits[z].selected?this.space.orbits[z].inp.stroke.selected:this.space.orbits[z].inp.stroke.off)});this.space.orbits[z].satellite.attr({r:(this.space.orbits[z].selected?8:4),"stroke-width":(this.space.orbits[z].selected?8:0),stroke:"white","stroke-opacity":0.5})}return this};q.prototype.removeOrbits=function(){for(var C in this.space.orbits){if(this.space.orbits[C].dotted){this.space.orbits[C].dotted.stop().remove()}if(this.space.orbits[C].solid){this.space.orbits[C].solid.stop().remove()}if(this.space.orbits[C].satellite){this.space.orbits[C].satellite.stop().remove()}delete this.space.orbits[C]}var A=["Moon","Moonorbit","Moonlagrangian","Earthorbit"];for(var B=0;B<A.length;B++){if(this.space[A[B]]){this.space[A[B]].remove();delete this.space[A[B]]}}for(var z in this.space.labels){for(var B in this.space.labels[z]){if(typeof this.space.labels[z][B].remove==="function"){this.space.labels[z][B].remove();delete this.space.labels[z][B]}}delete this.space.labels[z]}return this};q.prototype.displayOrbits=function(R,A){this.log("displayOrbits",R,A);if(!this.space.paper){return this}this.orbits={GEO:{inclination:0,color:"#048b9f",ellipticity:0.3,zoom:0},SNS:{inclination:-90,color:"#7ac36a",ellipticity:0.4,zoom:0},HEO:{inclination:30,color:"#de1f2a",ellipticity:0.4,r:this.space.E.r*3.3,zoom:0},LEO:{inclination:-30,color:"#cccccc",ellipticity:0.4,zoom:0},EM2:{inclination:0,color:"#cccccc",ellipticity:1,zoom:1},ES2:{inclination:0,color:"#9467bd",ellipticity:1,zoom:1},ETR:{inclination:0,color:"#fac900",ellipticity:1,zoom:1}};if(R){this.space.zoom=this.orbits[R].zoom}if(typeof A==="number"){this.space.zoom=A}function N(U,V,S){if(!S||typeof S!=="number"){S=0}var i=U*Math.sin(S*Math.PI/180);var T=U*Math.cos(S*Math.PI/180);if(Math.abs(S)>80){i+=U;T+=U*V}return" m "+(0-T)+" "+(0-i)+" a "+(U)+","+(V*U)+" "+S+" 1,1 0,0.01"}function D(i){if(i){i.hide()}}function P(i){if(i){i.show()}}if(this.space.rebuild){this.removeOrbits();this.space.rebuild=false}if(e("#orbits .zoomer").length==0){e("#orbits").prepend('<a href="#" class="zoomer button">-</a>');e("#orbits .zoomer").on("click",{me:this},function(i){i.preventDefault();i.data.me.displayOrbits("",(i.data.me.space.zoom==0?1:0));e(this).html(i.data.me.space.zoom==0?"&minus;":"&plus;").attr("title",(i.data.me.space.zoom==0?i.data.me.phrases.designer.orbit.zoomout:i.data.me.phrases.designer.orbit.zoomin))})}if(this.space.Earth){this.space.Earth.remove()}if(this.space.zoom==0){this.space.Earth=this.space.paper.path("M "+(this.space.E.x)+" "+(this.space.E.y)+" m -6.927379,42.861897 c -10.79338,-1.89118 -21.17473,-8.25868 -27.52258,-16.87977 -15.02038,-20.3975403 -9.63593,-48.89125 11.79388,-62.41291 16.94554,-10.68989 39.20392,-8.16663 53.44137,6.06404 5.87268,5.86844 9.54913,12.35889 11.55616,20.4047297 1.16835,4.68267 1.47335,12.35457 0.67442,16.96248 -3.048,17.5816003 -15.4426,30.9321203 -32.72769,35.2509203 -4.33566,1.08222 -12.80575,1.3828 -17.21554,0.61124 z m 11.33951,-4.82289 c 6.979,-0.79891 13.53188,-3.42643 19.13933,-7.67694 1.15933,-0.87801 1.54372,-1.39287 1.55148,-2.07816 0.0111,-1.02039 1.44195,-5.01704 2.21985,-6.20209 0.27849,-0.42427 1.14761,-1.04771 1.93147,-1.3828 1.16726,-0.50337 1.55149,-0.90389 2.12308,-2.23204 0.96595,-2.24427 1.24242,-3.45664 0.78812,-3.45664 -0.20378,0 -0.37027,-0.35953 -0.37027,-0.78883 0,-0.79173 1.79473,-2.69441 4.39774,-4.66182 0.67305,-0.50337 1.30726,-1.14263 1.40925,-1.40725 0.839,-2.1845903 0.99945,-12.8320603 0.19322,-12.8320603 -0.51768,0 -0.70521,2.11843004 -0.37077,4.19083 0.41376,2.56281 0.0979,4.2843 -0.80975,4.4166 -1.268,0.18698 -2.13725,-1.28571 -2.84295,-4.81066 -1.04641,-5.22558 -1.1243,-5.32626 -4.56601,-5.9267 -1.02684,-0.17978 -1.08581,-0.13664 -1.08581,0.81689 0,2.22772 -2.80355,5.66709 -5.01389,6.15248 -1.66562,0.36674 -2.62557,-0.58246 -4.17367,-4.1182 -0.735,-1.67907 -1.59947,-3.31138 -1.92103,-3.62778 -0.55377,-0.5465 -0.58461,-0.53932 -0.58461,0.12942 0,1.72221 2.25458,7.61438 3.13524,8.1954 0.20501,0.13663 1.09432,0.2445 1.97628,0.25168 2.19326,0.006 3.57706,0.7572 3.56758,1.9329 -0.013,1.61147 -1.23802,3.68026 -3.44872,5.8238503 -2.98531,2.89432 -3.55713,3.9449 -3.55867,6.5372 -0.001,2.03428 0.0252,2.10116 0.75047,1.87393 0.41348,-0.12941 1.04826,-0.43864 1.4107,-0.68312 0.98159,-0.67594 2.09973,-0.56808 2.35382,0.2373 0.2447,0.77084 -1.60253,3.96287 -3.39818,5.87203 -0.87967,0.93553 -1.18294,1.07144 -1.83751,0.82552 -0.6725,-0.25169 -0.7809,-0.51776 -0.76252,-1.84374 0.013,-0.95351 -0.11516,-1.50505 -0.33409,-1.43314 -0.34616,0.10794 -0.65537,0.55369 -2.65289,3.74859 -1.17673,1.884 -3.79425,3.67597 -6.07803,4.16206 -1.86971,0.3955 -3.48492,0 -3.48492,-0.7953 0,-0.26607 -0.43326,-1.29723 -0.96281,-2.30323 -1.69574,-3.22007 -1.84288,-3.99595 -1.37585,-7.24909 0.47848,-3.33582 0.19975,-4.72582 -1.21076997,-6.04247 -1.23809,-1.15484 -1.87063003,-2.53763 -1.64033003,-3.58606 0.18366003,-0.8355803 0.0857,-0.9340903 -1.34377,-1.3540303 -1.63056,-0.4818 -5.15549,-0.33078 -7.61198,0.33796 -1.09992,0.30202 -1.50461,0.23729 -2.83756,-0.42426 -2.86801,-1.42451 -4.32003,-4.81858 -3.89918,-9.11581996 0.39299,-4.01250004 0.54491,-4.51441004 1.80953,-5.97273004 0.68343,-0.78955 1.4365,-1.90268 1.67352,-2.47365 0.39117,-0.94344 1.89274,-1.9479897 3.70135,-2.4779597 0.29382,-0.0863 0.93542,-0.95925 0.19912,-1.19654 -2.63115,0.61121 -3.4916,-1.84374 -1.69974,-3.63426 0.98587,-0.98515 1.35751,-1.14982 2.33866,-1.03549 1.08194,0.12941 1.16649,0.0791 1.16649,-0.77733 0,-0.49616 0.15034,-1.00814 0.33409,-1.12032 0.18367,-0.11497 1.44636,-0.95208 1.44636,-1.06713 0,-0.36673 -4.64238,1.86027 -2.8525,-0.67594 -0.26146,0.41707 -0.65956,0.19416 -1.1224,-0.26605 -0.87213,-0.87083 0.29445,-1.80204 1.00761,-1.97534 0.45202,-0.006 0.96756,1.28718 1.31068,0.58247 -0.82013,-1.1455 -0.62158,-2.63904 -0.28282,-2.70519 1.2859,-0.53932 1.49537,0.78523 1.49537,1.81137 0,0.39548 0.2255,0.91683 0.50112,1.14478 0.27563,0.2373 0.50113,0.79099 0.50113,1.25048 0,0.76151 0.0941,0.81689 1.06974,0.62562 1.49278,-0.30203 2.53575,-1.36699 2.47682,-2.53838 2.67534003,-1.78908 -0.15886,-1.06713 -0.29398,-1.20302 -0.63709,-0.63281 -0.13885,-1.83798 1.40482003,-3.38761 2.14169997,-2.15005 3.38975997,-2.7095 6.99786997,-3.13593 2.72694,-0.32359 3.09543,-0.29482 4.55125,0.35235 1.4815,0.64719 1.57109,0.76511 1.3838,1.70136 l -0.20026,0.99953 1.80809,-0.9643 c 0.99444,-0.53212 2.56916,-1.15844 3.49938,-1.39646 0.93019,-0.2373 1.69128,-0.56808 1.69128,-0.72556 0,-0.3811 -4.20122,-2.31041 -6.97024,-3.21358 -5.23627,-1.70998 -13.51182,-2.25217 -18.83832,-1.23323 -4.60384,0.87944 -12.69228,4.14912 -13.13855,5.31187 -0.0896,0.2373 0.0676,0.97293 0.34883,1.64671 0.63899,1.52734 0.65767,3.66589 0.0424,4.84878 -0.61531,1.18145 -5.09802,5.49956 -6.37985,6.14601 -0.55124,0.27325 -2.28017,0.92043 -3.84205,1.42882 -4.30776,1.40509 -4.48483,1.5338 -5.46145,3.96935 -1.64357,4.1023697 -2.26852,7.1311597 -2.45187,11.88357974 l -0.17385,4.50720996 2.56104,2.13282 c 1.40855,1.17211 3.47725,3.15461 4.59709,4.4043803 1.51998,1.6956 2.48972,2.45639 3.82568,2.99714 1.96471,0.79675 3.45111,2.28165 3.45111,3.4473 0,0.40987 -0.24263,1.46045 -0.53917,2.3291 -0.49906,1.46407 -0.49746,1.69129 0.0209,3.04604 0.6264,1.6388 0.35646,2.62899 -0.81789,3.00146 -0.81891,0.26607 -0.85988,1.23396 -0.10053,2.39168 0.31237,0.4746 0.65063,1.48204 0.7517,2.23635 0.17385,1.29723 0.34977,1.48131 3.26152,3.42284 7.40928,4.93795 16.4231,7.13547 25.16577,6.13379 z m 8.48287,-49.9181103 c 0.68449,-0.6759197 0.66479,-1.1239097 -0.0596,-1.3360497 -0.3215,-0.10072 -2.2514,-1.55826 -2.92906,-1.89694 -1.01081,-0.49617 6.7196,-1.01966 1.45075,-3.16972 -5.26885,-2.15079 -2.56176,4.83655 -3.32655,3.88017 -0.65552,-0.8327 -2.0022,-1.01104 -2.5835,-0.48178 -1.15634,-1.28069 -2.98745,-3.84351 -3.70189,-3.89241 -1.03907997,-0.0718 1.16978,2.32983 -0.27577,2.81665 -1.44553997,0.48898 -2.20706997,-2.826 -4.09265,-2.61817 -2.10817,0.2373 -4.38327,-0.72484 -5.18683,3.39191 -0.004,0.52493 3.06135,0.16533 4.50771,0 2.32603003,-0.3092 3.10989003,0 5.24841,1.91132 l 1.88004,1.7013597 3.25884,-0.2373 c 2.19723,-0.1583 3.33099,-0.11497 3.48033,0.1222 0.3297,0.53212 1.72994,0.42425 2.32983,-0.16534 z M 4.909541,-24.277303 c 0.94202,-0.43865 1.16153,-0.7191 1.01819,-1.2505 -0.10053,-0.38112 -0.18477,-0.86794 -0.18732,-1.09733 0.15107,-1.64957 -0.72375,-1.29793 -1.57539,-0.0718 -0.77094,1.13326 -4.82187997,5.26872 -0.61209,2.96477 0.0752,-0.0718 0.69614,-0.25886 1.35664,-0.56807 z m 20.69451,-1.74667 c 0.2363,-0.38111 -1.04497,-1.12824 -1.47795,-0.86075 -0.16792,0.10072 -0.95404,-0.15107 -1.74709,-0.56808 -1.95859,-1.02828 -6.42112,-0.95134 -5.77085,0.10072 0.10572,0.17256 1.42366,0.3164 2.92877,0.3164 2.03716,8.3e-4 3.03539,0.16533 3.90586,0.6328 1.36846,0.73274 1.8913,0.82694 2.16126,0.3883 z")}else{this.space.Earth=this.space.paper.path("M "+(this.space.E.x)+" "+(this.space.E.y)+" m 0 -43.6 c,-19.195,-0.359,-37.44,13.34,-41.865,32.015 c,-4.561096,17.1667748,2.72917,37.246587,17.656538,46.977656 c,13.373687,9.285707,32.0526208,9.996435,45.992018,1.508414 c,5.957424,-3.319826,11.075156,-8.039317,14.543607,-13.935126 c,10.546018,-15.6499112,8.720274,-38.18332,-4.018314,-52.068038 c,-8.07768,-9.096389,-20.115729,-14.609639,-32.30837958,-14.498209 z m,0.09375,5.375 c,12.57022058,-0.128555,24.94591858,6.5994,31.74999958,17.15625 c,-0.94917,5.002919,-6.086293,1.530374,-3.041063,-1.619594 c,-1.457671,-0.526126,-4.932858,2.878261,-6.847657,-0.603915 c,-3.184453,-1.308637,-6.3599,1.691261,-5.15979,4.188482 c,-3.782846,2.664376,-6.163477,-4.184848,-10.1526402,-1.250482 c,0.930713,-0.712397,6.3522672,-6.132291,1.9485113,-5.743768 c,-2.1471153,3.268504,-5.9001547,5.6116,-9.7549386,6.742359 c,-3.0333281,1.666497,3.4871809,3.919715,5.0848899,3.874212 c,4.4525294,2.286084,8.5800896,7.1007845,6.1927696,12.1877615 c,1.90772,3.21337796,3.996962,6.758283,2.957496,10.7455353 c,-1.088944,1.5975017,-1.993627,6.6457482,-3.8098779,5.9629142 c,0.09411,-5.5523502,-5.8551147,1.424572,-5.9032977,3.921686 c,-0.233555,1.607328,-2.089538,4.666463,0.316221,3.452139 c,1.5791784,3.031545,4.0433554,1.23024,2.5706854,-1.432668 c,-0.755832,-2.214988,1.071785,-4.450478,1.431817,-0.910521 c,3.4227102,1.986574,-2.079278,8.026424,-3.441317,4.221977 c,-0.05038,3.190668,-5.9116094,4.835384,-6.2547064,5.746188 c,2.90918203,2.904457,-1.551746,2.079951,-3.228894,2.254064 c,-1.300676,5.220523,5.49423002,3.315504,6.569102,-0.06951 c,2.572843,-3.120142,7.9417807,2.476723,8.2176023,0.158591 c,-5.1570029,-2.906592,4.3679773,1.498193,3.7328613,-0.172704 c,0.355589,-3.393695,5.711734,0.663429,6.832822,-2.635732 c,2.782198,1.056601,-3.254675,4.26505,-4.941003,4.473991 c,-2.714088,0.573027,-2.35272,4.236763,-5.7564619,2.583428 c,-3.9108453,-2.119881,-7.9960437,-0.807618,-12.0653907,-0.15703 c,-4.931145,2.236895,-10.2173174,1.74978,-14.8366384,-1.385684 c,-10.813803,-5.566552,-18.524599,-16.654538,-20.004852,-28.7192222 c,2.732778,2.989211,6.598056,4.7293091,8.998081,8.3559682 c,1.599527,0.730324,3.945675,3.523961,4.82994,3.171984 c,1.833841,-2.480098,4.151057,-5.772095,2.790203,-8.5464922 c,3.363681,-2.474446,-0.289772,-5.5676083,-3.153322,-3.525176 c,-4.391341,0.818177,-0.191169,-4.9463963,1.391046,-6.2324653 c,2.857681,-0.460706,3.513174,2.41500097,3.980956,3.732494 c,3.316523,-0.0353,0.834669,-3.882306,4.374542,-4.092336 c,0.130908,-1.411563,-3.481833,-2.709873,-0.211945,-1.771103 c,4.26026,-1.249006,1.634257,-4.365219,-0.493731,-3.1780419 c,2.763194,-2.1547021,4.181646,-7.6700956,8.5041634,-6.4331296 c,2.24906,-0.416067,2.612667,-2.860803,1.014942,-3.538046 c,2.719085,-1.835258,-1.409228,-1.787455,-0.10076,-4.29649 c,-1.830306,-0.309672,-4.304873,-0.973664,-2.132519,-3.101562 c,-3.3845944,2.57314,-3.5487544,7.860395,-8.9615664,7.398945 c,-4.539774,1.777416,-8.333796,-1.761858,-12.015717,-2.70409 c,-1.477835,0.696073,-6.487149,4.76626,-4.024621,0.665479 c,6.584664,-11.488859,19.533888,-19.038283,32.80405842,-18.874686 z m,-33.65625042,21.59375 c,-0.631472,0.607654,-1.285523,0.774007,0,0 z m,25.0312504,13.8749985 c,-1.378264,1.634778,-4.7210584,3.734578,-0.438841,3.849626 c,2.052676,0.491366,5.022044,2.343429,3.253406,-0.95631404 c,-0.419504,-1.86979296,-2.20923,-1.09186896,-2.814565,-2.89331196 z m,-4.0625014,1.78125 c,-4.153103,-0.46570203,-2.208863,6.0465023,-6.129842,6.4757613 c,-0.605185,2.103009,2.300217,1.325155,3.030352,1.204245 c,1.416321,-2.463228,3.738442,-4.4874303,3.09949,-7.6800063 z m,3.5312514,3.03125 c,0.05302,4.2453083,-2.3776964,7.126859,-5.9261904,8.5371375 c,-2.819523,3.208873,0.326358,5.688926,2.91859,2.404436 c,3.6624634,0.820099,7.4597394,0.468648,8.5987314,-3.8347225 c,3.98761402,-4.1394317,-1.837631,-7.108603,-5.591131,-7.106851 z m,2.65625,13.8750015 c,-4.0821284,2.583778,5.79884807,0.948002,0,0 z m,29.9999996,1 c,-0.310613,2.698258,7.000211,1.533177,2.616976,4.524626 c,-1.843124,0.0678,-6.305665,-2.59259,-2.616976,-4.524626 z m,-25.0937496,4.625 c,-2.608331,0.710104,1.04075402,4.160157,-0.444775,4.552104 c,-1.433649,1.942609,4.729631,-0.163724,1.34758302,-1.892931 c,-0.672,-1.046,-1.062,-1.697,-0.903,-2.659 z m,32.4999996,0.34375 c,-0.01479,2.705677,-5.791353,2.714607,-1.548038,0.956689 l,0.803335,-0.425532 z m,-12.78125,0.375 c,0.523617,1.617196,4.358842,0.626771,1.387,2.500788 c,-1.249506,2.929193,-6.666484,3.760447,-3.932662,-0.407517 c,1.533416,0.532153,2.258563,-0.753125,2.545662,-2.093271 z m,-21.9374996,1.15625 c,-3.15159,1.823608,0.365256,3.975785,0.815462,0.936364 c,-0.0466,-0.434703,-0.359015,-0.867276,-0.815462,-0.936364 z m,26.4374996,6.90625 c,-1.920358,1.510414,-1.942756,0.166742,0,0 z")}this.space.Earth.attr({stroke:0,fill:"#69DFFF",opacity:0.8});var E,C,G,O,L,M;var I=this;function z(S){if(!S){return null}if(!S.cx){S.cx=0}if(!S.cy){S.cy=0}if(!S.e){S.e=1}if(!S.i){S.i=0}if(!S.r){S.r=1}if(!S.color){S.color="#999999"}if(!S.stroke){S.stroke={}}if(!S.stroke.on){S.stroke.on=2.5}if(!S.stroke.off){S.stroke.off=1.5}if(!S.stroke.selected){S.stroke.selected=2.5}var U={inp:S};if(S.key=="ES2"){U.dotted=I.space.paper.path("M "+(S.cx-S.r)+",0 q "+(S.r*2)+","+(I.space.height/2)+" 0,"+(I.space.height));U.solid=I.space.paper.path("M "+(S.cx-S.r)+",0 q "+(S.r*2)+","+(I.space.height/2)+" 0,"+(I.space.height))}else{if(S.e==1){U.dotted=I.space.paper.circle(S.cx,S.cy,S.r);U.solid=I.space.paper.circle(S.cx,S.cy,S.r)}else{var T="m "+S.cx+","+S.cy+" "+N(S.r,S.e,S.i);U.dotted=I.space.paper.path(T);U.solid=I.space.paper.path(T)}}if(S.period){U.satellite=I.space.paper.circle(S.cx,S.cy,4).attr({fill:S.color,stroke:0});if(S.key!="ES2"){U.anim=U.satellite.animateAlong((S.orbit?S.orbit:U.dotted),S.period,Infinity,S.orbitdir)}}U.dotted.attr({stroke:S.color,"stroke-dasharray":"-","stroke-width":S.stroke.off});U.solid.attr({stroke:S.color,opacity:0.1,"stroke-width":8});var i=function(){e("#orbits").css("cursor","pointer");this.dotted.attr({"stroke-width":(this.selected?S.stroke.selected:S.stroke.on)})};var V=function(){e("#orbits").css("cursor","default");this.dotted.attr({"stroke-width":(this.selected?S.stroke.selected:S.stroke.off)})};U.solid.hover(i,V,U,U);U.satellite.hover(i,V,U,U);U.solid.click(function(){I.selectOrbit(S.key)},U,U);U.satellite.click(function(){I.selectOrbit(S.key)},U,U);U.zoom=I.space.zoom+0;U.hide=function(){D(U.dotted);D(U.solid);D(U.satellite)};U.show=function(){P(U.dotted);P(U.solid);P(U.satellite)};return U}if(!this.space.E||!this.space.M||!this.space.scale){return this}if(this.space.zoom==0){for(var H in this.data.orbit){if(this.orbits[H]&&this.orbits[H].zoom==this.space.zoom&&!this.space.orbits[H]){if(H=="HEO"){E=-this.space.E.r*1.2;C=-this.space.E.r*0.35}else{E=0;C=0}if(!this.orbits[H].r){this.orbits[H].r=this.space.E.r*(1+this.data.orbit[H].altitude.value/this.space.E.radius)}M=this.convertValue(this.data.orbit[H].period,"hours");this.space.orbits[H]=z({key:H,period:M.value*3*1000,r:this.orbits[H].r,cx:(this.space.E.x+E),cy:(this.space.E.y+C),color:this.orbits[H].color,e:this.orbits[H].ellipticity,i:this.orbits[H].inclination})}}}else{if(this.space.zoom==1){if(!this.space.Moonorbit){this.space.Moonorbit=this.space.paper.path("M "+this.space.E.x+","+this.space.E.y+" "+N(this.space.M.o*this.space.scale[1],1)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.space.Moon=this.space.paper.circle(this.space.E.x-this.space.M.o*this.space.scale[1]*Math.cos(Math.PI/6),this.space.E.y-this.space.M.o*this.space.scale[1]*Math.sin(Math.PI/6),this.space.M.r).attr({fill:"#606060",stroke:0});var G=9;if(!this.space.orbits.ETR&&this.data.orbit.ETR){M=this.convertValue(this.data.orbit.ETR.period,"days");this.space.Earthorbit=this.space.paper.path("M "+(this.space.E.x-G)+",0 q "+(G*2)+","+(this.space.height/2)+" 0,"+(this.space.height)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.space.orbits.ETR=z({key:"ETR",period:M.value*1000,r:1,cx:(this.space.E.x-G*0.78),cy:(this.space.E.y+2.1*this.space.M.o*this.space.scale[1]),color:this.orbits.ETR.color})}if(!this.space.orbits.EM2&&this.data.orbit.EM2){this.space.Moonlagrangian=this.space.paper.path("M "+this.space.E.x+","+this.space.E.y+" "+N(this.space.M.o*this.space.scale[1]*440000/380000,1)).attr({stroke:"#000000","stroke-dasharray":"-","stroke-width":0.5,opacity:0.01});M=this.convertValue(this.data.orbit.EM2.period,"days");this.space.Moon.animateAlong(this.space.Moonorbit,M.value*1000,Infinity,-1);this.space.orbits.EM2=z({key:"EM2",period:M.value*1000,orbit:this.space.Moonlagrangian,orbitdir:-1,r:this.space.M.o*((440000/380000)-1)*this.space.scale[1],cx:(this.space.E.x-this.space.M.o*this.space.scale[1]*Math.cos(Math.PI/6)),cy:(this.space.M.o*this.space.scale[1]*Math.sin(Math.PI/6)),color:this.orbits.EM2.color,e:1,i:0});this.space.orbits.EM2.dotted.animateAlong(this.space.Moonorbit,M.value*1000,Infinity,-1);this.space.orbits.EM2.solid.animateAlong(this.space.Moonorbit,M.value*1000,Infinity,-1)}if(!this.space.orbits.ES2&&this.data.orbit.ES2){M=this.convertValue(this.data.orbit.ES2.period,"days");this.space.orbits.ES2=z({key:"ES2",period:M.value*1000,r:9,cx:(this.space.E.x+4*this.space.M.o*this.space.scale[1]),cy:this.space.E.y,color:this.orbits.ES2.color})}var J=this.space.M.o*this.space.scale[1];var F=0.3;var B=parseInt(this.space.el.css("font-size"));if(!this.space.labels){this.space.labels={}}if(!this.space.labels.sun){this.space.labels.sun={zoom:1,arrow:this.space.paper.path("M "+(this.space.E.x-4*J)+","+this.space.E.y+" l "+(F*J)+",-"+(F*0.3*J)+" q "+(-F*0.3*J)+","+(F*0.3*J)+" 0,"+(F*0.6*J)+" z M "+(this.space.E.x-4*J+F*0.85*J)+","+(this.space.E.y-F*0.05*J)+" l "+(F*J*1.5)+","+(-F*0.05*J)+" l 0,"+(F*0.2*J)+" l "+(-F*J*1.5)+","+(-F*0.05*J)+" z").attr({fill:"#fac900",stroke:0}),label:this.space.paper.text((this.space.E.x-4*J+2.5*F*J),(this.space.E.y),this.phrases.designer.orbit.diagram.sun).attr({fill:"#fac900",stroke:0,"text-anchor":"start","font-size":B})}}if(!this.space.labels.earthorbit&&this.data.orbit.ETR){this.space.labels.earthorbit={zoom:1,arrow:this.space.paper.path("M "+(this.space.E.x)+","+(this.space.E.y-2.1*J)+" l -"+(F*0.3*J)+","+(F*J)+" q "+(F*0.3*J)+","+(-F*0.3*J)+" "+(F*0.6*J)+",0 z M "+(this.space.E.x-F*0.05*J)+","+(this.space.E.y-2.1*J+F*0.85*J)+" l "+(-F*0.05*J)+","+(F*J*1.5)+" l "+(F*0.2*J)+",0 l "+(-F*0.05*J)+","+(-F*J*1.5)+" z").attr({fill:"#999999",stroke:0}),label:this.space.paper.text((this.space.E.x+F*0.3*J),(this.space.E.y-2*J+F*J),this.phrases.designer.orbit.diagram.earthorbit).attr({fill:"#999999",stroke:0,"text-anchor":"start","font-size":B})}}}}}for(var H in this.space.orbits){if(this.space.orbits[H].zoom!=this.space.zoom){D(this.space.orbits[H])}else{P(this.space.orbits[H])}if(this.space.zoom==0){D(this.space.Moonorbit);D(this.space.Moon)}else{P(this.space.Moonorbit);P(this.space.Moon)}if(this.space.orbits.EM2){if(this.space.zoom==0){D(this.space.Moonlagrangian);D(this.space.Earthorbit)}else{P(this.space.Moonlagrangian);P(this.space.Earthorbit)}}}for(var K in this.space.labels){if(this.space.labels[K].zoom!=this.space.zoom){D(this.space.labels[K].arrow);D(this.space.labels[K].label)}else{P(this.space.labels[K].arrow);P(this.space.labels[K].label)}}var Q=this.space.E.r/48;if(this.space.scale[this.space.zoom]<1){Q*=this.space.scale[this.space.zoom]*10}if(this.space.Earth){o(this.space.Earth,["S",Q,Q,this.space.E.x,this.space.E.y])}return this};q.prototype.updateProposal=function(){this.log("updateProposal");e(".printable").remove();if(this.proposalCompleteness()!=0){e(".doc").after('<div class="printable bigpadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.print+"</a></div>")}return this};q.prototype.proposalCompleteness=function(){this.log("proposalCompleteness");var D=0;var A=e(".doc").find("input");var z=e(".doc").find("textarea");var C=A.length+z.length;for(var B=0;B<A.length;B++){if(e(A[B]).val()!=""){D++}}for(var B=0;B<z.length;B++){if(e(z[B]).val()!=""){D++}}return D/C};q.prototype.printProposal=function(){this.log("printProposal");var z=e(".doc").eq(0).html();z=z.replace(/<label[^\>]*>[^\<]*<\/label>/g,"").replace(/<input [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(B,C){var A=e("#"+C).val();return(A!=""?'<span class="userinput">'+A+"</span>":'<span class="emptyinput">BLANK</span>')}).replace(/<textarea [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(B,C){var A=e("#"+C).text();return(A!=""?'<span class="userinput">'+A+"</span>":'<span class="emptyinput">BLANK</span>')});var i=window.open("","","width="+e(window).width()+",height="+e(window).height()+",resizeable,scrollbars");i.document.write('<!DOCTYPE html><html><head><link type="text/css" href="css/fonts.css" media="all" rel="stylesheet"><link type="text/css" href="css/style.css" media="all" rel="stylesheet"><script>function onload(){ window.print(); }<\/script></head><body onload="onload()"><div id="main" class="bigpadded"><div class="doc">'+z+"</div></div></body></html>");i.document.close();return this};q.prototype.updateSidePanels=function(){if(this.choices.mirror||this.choices.hascooling||this.choices.instruments){this.makeSatellite();e("#sidebar .satellite.panel").show()}else{e("#sidebar .satellite.panel").hide()}if(this.choices.vehicle){e("#sidebar .vehicle.panel").html('<div class="image"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div><div class="info"><div>'+this.phrases.designer.vehicle.options[this.choices.vehicle].label+"</div><div>"+this.phrases.designer.vehicle.diameter+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].diameter)+"</div><div>"+this.phrases.designer.vehicle.massLEO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.LEO)+"</div><div>"+this.phrases.designer.vehicle.massGTO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.GTO)+"</div><div>"+this.phrases.designer.vehicle.operator+" "+this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label+"</div></div>").show()}else{e("#sidebar .vehicle.panel").hide()}if(this.choices.site){html='<img src="images/worldmap.png" />';var i=this.data.site[this.choices.site].latitude;var z=this.data.site[this.choices.site].longitude;if(!i&&!z){i=34;z=-116}html+='<a href="#" class="launchsite '+this.choices.site+'" title="'+this.phrases.designer.site.options[this.choices.site].label+'" style="left:'+Math.round(100*(z+180)/360)+"%;top:"+Math.round(100*(90-i)/180)+'%"></a>';e("#sidebar .site.panel").html(html).show()}else{e("#sidebar .site.panel").hide()}if(this.choices.orbit){e("#sidebar .orbit.panel").html('<img src="'+this.data.orbit[this.choices.orbit].img+'" />').show()}else{e("#sidebar .orbit.panel").hide()}return this};q.prototype.updateDropdown=function(D){var A="";var B,C,z;B=e("#"+D);if(B.length==0){return this}C=B.find("option");if(D=="mirror_size"){if(this.phrases.designer.satellite.options.diameter.placeholder){A='<option value="">'+this.phrases.designer.satellite.options.diameter.placeholder+"</option>"}for(var i in this.data.mirror){A+='<option value="'+i+'">'+this.formatValue(this.data.mirror[i].diameter)+"</option>"}B.html(A)}else{if(D=="instruments"){if(this.phrases.designer.instruments.options.instrument.none){A='<option value="">'+this.phrases.designer.instruments.options.instrument.none.label+"</option>"}for(var i in this.data.instrument.options){z=this.phrases.designer.instruments.options.instrument[i].label;if(C.length==0){A+='<option value="'+i+'">'+z+"</option>"}else{B.find('option[value="'+i+'"]').text(z)}}if(C.length==0){B.html(A)}}else{if(D=="wavelengths"){if(this.phrases.wavelengths.none.label){A='<option value="">'+this.phrases.wavelengths.none.label+"</option>"}for(var i in this.data.wavelengths){z=this.phrases.wavelengths[i].label;if(C.length==0){A+='<option value="'+i+'">'+z+"</option>"}else{B.find('option[value="'+i+'"]').text(z)}}if(C.length==0){B.html(A)}}else{if(D=="mission_duration"){if(this.phrases.designer.orbit.duration.none){A='<option value="">'+this.phrases.designer.orbit.duration.none+"</option>"}for(var i in this.data.mission){z=this.formatValue(this.data.mission[i].life);if(C.length==0){A+='<option value="'+i+'">'+z+"</option>"}else{B.find('option[value="'+i+'"]').text(z)}}if(C.length==0){B.html(A)}}else{if(D=="mission_orbit"){if(this.phrases.designer.orbit.orbit.none){A='<option value="">'+this.phrases.designer.orbit.orbit.none+"</option>"}for(var i in this.data.orbit){if(C.length==0){A+='<option value="'+i+'">'+this.phrases.designer.orbit.options[i].label+"</option>"}else{B.find('option[value="'+i+'"]').text(this.phrases.designer.orbit.options[i].label)}}if(C.length==0){B.html(A)}}else{if(D=="cooling_temperature"){if(this.data.cooling.temperature){for(var i in this.data.cooling.temperature){z=y(this.formatValue(this.data.cooling.temperature[i].temperature));if(C.length==0){A+='<option value="'+i+'">'+z+"</option>"}else{B.find('option[value="'+i+'"]').text(z)}}if(C.length==0){B.html(A)}}}else{if(D=="site"){if(this.phrases.designer.site.hint){A='<option value="">'+this.phrases.designer.site.hint+"</option>"}for(var i in this.data.site){if(this.phrases.designer.site.options[i]){z=this.phrases.designer.site.options[i].label;if(C.length==0){A+='<option value="'+i+'">'+z+"</option>"}else{B.find('option[value="'+i+'"]').text(z)}}}if(C.length==0){B.html(A)}}else{if(D=="cooling_cryogenic"){for(var i in this.data.cooling.cryogenic){z=(this.phrases.designer.cooling.options.cryogenic.options[i]?this.phrases.designer.cooling.options.cryogenic.options[i]:this.formatValue(this.data.cooling.cryogenic[i].life));if(C.length==0){A+='<option value="'+i+'">'+z+"</option>"}else{B.find('option[value="'+i+'"]').text(z)}}if(C.length==0){B.html(A)}}}}}}}}}return this};q.prototype.updateLanguage=function(){this.log("updateLanguage");if(!this.phrases||!this.data){return this}var Q=this.phrases;var D,O,J,E,F;if(Q.title){document.title=y(Q.title)}e("h1").text(Q.title);e("body").attr("dir",(Q.language.alignment=="right"?"rtl":"ltr")).removeClass("ltr rtl").addClass((Q.language.alignment=="right"?"rtl":"ltr"));if(this.scenario){if(e("#designer_objectives .banner").length==0){e("#designer_objectives .intro").before('<div class="banner"></div>')}e("#designer_objectives .banner").html('<div class="title">'+this.scenario.name+"</div>");if(this.scenario.image&&this.scenario.image.banner){e("#designer_objectives .banner").css("background-image","url("+this.scenario.image.banner+")")}if(Q.designer.objectives.intro){e("#designer_objectives .intro").html("<p><strong>"+Q.scenarios.mission+"</strong> &quot;"+this.formatScenario(this.scenario)+"&quot;</p>"+(this.scenario.funder?Q.designer.objectives.intro:Q.designer.objectives.intronofunder).replace(/%TITLE%/,this.scenario.name).replace(/%FUNDER%/,this.scenario.funder)).addClass("bigpadded")}}e("#designer_satellite .options .mirror_diameter label").html(Q.designer.satellite.options.diameter.label);this.updateDropdown("mirror_size");e("#designer_satellite .options .mirror_deployable label").html(Q.designer.satellite.options.deployable.label);e("#designer_satellite .options .mirror_uv label").html(Q.designer.satellite.options.uv.label);if(Q.designer.satellite.intro){e("#designer_satellite .intro").html(Q.designer.satellite.intro).addClass("bigpadded")}this.updateToggle({id:"mirror_deployable_no",label:this.phrases.designer.satellite.options.deployable.no},{id:"mirror_deployable_yes",label:this.phrases.designer.satellite.options.deployable.yes},this.phrases.designer.satellite.options.deployable.label);this.updateToggle({id:"mirror_uv_no",label:this.phrases.designer.satellite.options.uv.no},{id:"mirror_uv_yes",label:this.phrases.designer.satellite.options.uv.yes},this.phrases.designer.satellite.options.uv.label);this.updateDropdown("instruments");this.updateDropdown("wavelengths");e("#designer_instruments .options label").html(Q.designer.instruments.options.label);e("#designer_instruments .options input#instrument_name").attr("placeholder",Q.designer.instruments.options.name);e("#designer_instruments .options a.add_instrument").attr("title",Q.designer.instruments.options.add);if(Q.designer.instruments.intro){e("#designer_instruments .intro").html(Q.designer.instruments.intro.replace(/%MAX%/,this.data.instrument.maxsize.length)).addClass("bigpadded")}if(Q.designer.cooling.intro){e("#designer_cooling .intro").html(Q.designer.cooling.intro).addClass("bigpadded")}e("#designer_cooling .options label[for=hascooling]").html(Q.designer.cooling.enable.label);this.updateToggle({id:"cooling_no",label:Q.designer.cooling.enable.no},{id:"cooling_yes",label:Q.designer.cooling.enable.yes},this.phrases.designer.cooling.enable.label);if(this.data.cooling.temperature){this.updateDropdown("cooling_temperature");e("#designer_cooling .options label[for=cooling_temperature]").html(Q.designer.cooling.options.temperature.label)}if(this.data.cooling.passive){D="";this.updateToggle({id:"cooling_passive_no",label:this.phrases.designer.cooling.options.passive.options.no},{id:"cooling_passive_yes",label:this.phrases.designer.cooling.options.passive.options.yes},this.phrases.designer.cooling.options.passive.label);e("#designer_cooling .options label[for=cooling_passive]").html(Q.designer.cooling.options.passive.label)}if(this.data.cooling.active){D="";this.updateToggle({id:"cooling_active_no",label:this.phrases.designer.cooling.options.active.options.no},{id:"cooling_active_yes",label:this.phrases.designer.cooling.options.active.options.yes},this.phrases.designer.cooling.options.active.label);e("#designer_cooling .options label[for=cooling_active]").html(Q.designer.cooling.options.active.label)}if(this.data.cooling.cryogenic){this.updateDropdown("cooling_cryogenic");e("#designer_cooling .options label[for=cooling_cryogenic]").html(Q.designer.cooling.options.cryogenic.label)}O=0;F=Q.designer.vehicle;var I="";var K=0;for(var N in this.data.vehicle){K++}var C=100/K;for(var N in this.data.vehicle){E=e("#designer_vehicle .options li").eq(O);E.attr({data:N}).css({width:C+"%"});J=this.data.vehicle[N];E.find(".image img").attr({src:J.img,alt:F.options[N].label,title:F.options[N].label});E.find(".selector label").html(F.options[N].label);E.find(".rocket").html(F.options[N].label);E.find(".operator img").attr({src:this.data.operator[J.operator].img,alt:Q.operator[J.operator].label,title:Q.operator[J.operator].label});E.find(".details .operator strong").html(F.operator);E.find(".details .operator .value").html(Q.operator[J.operator].label);if(J.height){E.find(".height strong").html(F.height);this.updateValue(E.find(".height .value"),J.height)}E.find(".diameter strong").html(F.diameter);this.updateValue(E.find(".diameter .value"),J.diameter);E.find(".currency strong").html(F.cost);this.updateValue(E.find(".currency .value"),J.cost);E.find(".massLEO strong").html(F.massLEO);this.updateValue(E.find(".massLEO .value"),J.mass.LEO);E.find(".massGTO strong").html(F.massGTO);this.updateValue(E.find(".massGTO .value"),J.mass.GTO);if(J.risk){E.find(".risk strong").html(F.risk);this.updateValue(E.find(".risk .value"),(J.risk*100)+"%")}E.find(".sites strong").html(F.sites);D="";for(var H=0;H<J.sites.length;H++){D+=""+Q.designer.site.options[J.sites[H]].label+"<br />"}this.updateValue(E.find(".sites .value"),D);E.find("input").attr("value",N);E.find(".button").html(F.select);O++}if(Q.designer.vehicle.intro){e("#designer_vehicle .intro").html(Q.designer.vehicle.intro).addClass("bigpadded")}var P="";this.updateDropdown("site");var G='<option value="">'+Q.designer.site.hint+"</option>";for(var H in this.data.site){var B=this.data.site[H].latitude;var A=this.data.site[H].longitude;G+='<option value="'+H+'">'+Q.designer.site.options[H].label+"</option>";if(!B&&!A){B=34;A=-116}P+='<a href="#" class="launchsite '+H+'" data="'+H+'" title="'+Q.designer.site.options[H].label+'" style="left:'+Math.round(100*(A+180)/360)+"%;top:"+Math.round(100*(90-B)/180)+'%"></a>'}e("#designer_site .worldmap .launchsite").remove();e("#designer_site .worldmap").append(P);e("#designer_site .options label").html(Q.designer.site.hint);if(Q.designer.site.intro){e("#designer_site .intro").html(Q.designer.site.intro).addClass("bigpadded")}e("#designer_orbit .options label[for=mission_duration]").html(Q.designer.orbit.duration.label);this.updateDropdown("mission_duration");e("#designer_orbit .options label[for=mission_orbit]").html(Q.designer.orbit.orbit.label);this.updateDropdown("mission_orbit");var z=(Q.designer.proposal.labels?Q.designer.proposal.labels:{});String.prototype.formify=function(T,S,R,V,i){if(!i&&z[T]){i=z[T]}if(i){i='<label for="'+R+'">'+i+"</label>"}else{i=""}if(!V){V=""}if(S=="text"){var U='<input type="text" name="'+R+'" id="'+R+'" value="'+V+'" >'}else{if(S=="textarea"){var U='<textarea name="'+R+'" id="'+R+'">'+V+"</textarea>"}}return this.replace("%"+T+"%",i+U,"g")};var L=Q.designer.proposal.doc;e("#designer_proposal .options .doc").html(L.replace(/%FUNDER%/g,"Funder").replace(/%DATE%/,(new Date()).toDateString()).formify("TO","text","proposal_to").formify("NAME","text","proposal_name").formify("AIM","textarea","proposal_aim").formify("PREVIOUS","text","proposal_previous").formify("ADVANCE","textarea","proposal_advance").formify("INSTRUMENTS","textarea","proposal_instruments").formify("GOALS","textarea","proposal_goal").formify("RESLOW","text","proposal_reslow").formify("RESHIGH","text","proposal_reshigh").formify("MIRROR","text","proposal_mirror").formify("REQTEMPERATURE","text","proposal_reqtemp").formify("TEMPERATURE","text","proposal_temp").formify("MASS","text","proposal_mass").formify("MASSSATELLITE","text","proposal_mass_satellite").formify("MASSMIRROR","text","proposal_mass_mirror").formify("MASSCOOLING","text","proposal_mass_cooling").formify("MASSINSTRUMENTS","text","proposal_mass_instruments").formify("ORBIT","text","proposal_orbit").formify("DISTANCE","text","proposal_distance").formify("PERIOD","text","proposal_period").formify("FUEL","text","proposal_fuel").formify("DURATION","text","proposal_duration").formify("VEHICLE","text","proposal_vehicle").formify("OPERATOR","text","proposal_operator").formify("SITE","text","proposal_site").formify("LAUNCHMASS","text","proposal_launchmass").formify("COST","text","proposal_cost").formify("COSTSATELLITE","text","proposal_cost_satellite").formify("COSTMIRROR","text","proposal_cost_mirror").formify("COSTCOOLING","text","proposal_cost_cooling").formify("COSTINSTRUMENTS","text","proposal_cost_instruments").formify("COSTDEV","text","proposal_cost_dev").formify("COSTLAUNCH","text","proposal_cost_launch").formify("COSTGROUND","text","proposal_cost_ground").formify("COSTOPERATIONS","text","proposal_cost_operations"));for(var O=0;O<this.sections.length;O++){if(Q.designer[this.sections[O]]){e(".toggle"+this.sections[O]).text(Q.designer[this.sections[O]].label).attr("title",(Q.designer[this.sections[O]].hint?Q.designer[this.sections[O]].hint.replace(/<([^>]*)>/g,""):""))}}e(".togglemenu").attr("title",Q.ui.menu.title);e("#menu ul li").each(function(R){var S=e(this).attr("data");e(this).find("a").attr("title",Q.ui.menu[S].title).find("span").html(Q.ui.menu[S].label)});var M=["warnings","errors","success","time","cost","mass","science"];for(var O=0;O<M.length;O++){if(Q.ui[M[O]]){e(".toggle"+M[O]).attr("title",Q.ui[M[O]].title)}if(Q.ui.summary[M[O]]){e(".toggle"+M[O]).attr("title",Q.ui.summary[M[O]].title)}}e("#introduction").html(Q.intro.about);e("#introduction").append('<div class="centre"><a href="#scenarios" class="button fancybtn">'+Q.intro.button+"</a></div>");var E="";for(var O=0;O<this.scenarios.length;O++){E+='<li><div class="padded"><h3>'+this.scenarios[O].name+"</h3><p>"+this.formatScenario(this.scenarios[O])+'</p><a href="#designer_objectives" class="button" title="'+this.scenarios[O].name+'" data="'+O+'">Choose this mission<!--LANGUAGE--></a></div></li>'}e("#scenariolist").html(E);e("#scenarios h2").html(Q.scenarios.title);e("#scenarios p.about").html(Q.scenarios.intro);this.updateUnits();e("#messages h3.warning .title").text(this.phrases.ui.warning.title);e("#messages h3.error .title").text(this.phrases.ui.error.title);e(".togglelaunch a").text(this.phrases.launch.label).attr("title",(this.phrases.launch.hint?this.phrases.launch.hint:""));var H=Q.ui.summary;this.table.success.label=H.success.title;this.table.success.list.success_orbit.label=H.success.orbit;this.table.success.list.success_site.label=H.success.site;this.table.success.list.success_vehicle.label=H.success.vehicle;this.table.success.list.success_deploy.label=H.success.deploy;this.table.success.list.success_cooling.label=H.success.cooling;this.table.success.list.success_instruments.label=H.success.instruments;this.table.success.list.success_mission.label=H.success.mission;this.table.cost_available.label=H.cost.title;this.table.cost_available.list.cost_initial.label=H.cost.initial;this.table.cost_available.list.cost_dev_total.label=H.cost.dev.title;this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.label=H.cost.dev.satellite;this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.label=H.cost.dev.mirror;this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.label=H.cost.dev.cooling;this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.label=H.cost.dev.instruments;this.table.cost_available.list.cost_operations_total.label=H.cost.operations.title;this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.label=H.cost.operations.launch;this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.label=H.cost.operations.ground;this.table.cost_available.list.cost_total.label=H.cost.total;this.table.cost_available.list.cost_available.label=H.cost.available;this.table.time_dev_total.label=H.time.title;this.table.time_dev_total.list.time_dev_total.label=H.time.dev.title;this.table.time_dev_total.list.time_dev_total.list.time_dev_satellite.label=H.time.dev.satellite;this.table.time_dev_total.list.time_dev_total.list.time_dev_mirror.label=H.time.dev.mirror;this.table.time_dev_total.list.time_dev_total.list.time_dev_cooling.label=H.time.dev.cooling;this.table.time_dev_total.list.time_dev_total.list.time_dev_instruments.label=H.time.dev.instruments;this.table.time_dev_total.list.time_mission.label=H.time.mission;this.table.time_dev_total.list.time_cooling.label=H.time.cooling;this.table.time_dev_total.list.time_fuel.label=H.time.fuel;this.table.time_dev_total.list.time_observing.label=H.time.observing;this.table.mass_total.label=H.mass.title;this.table.mass_total.list.mass_satellite.label=H.mass.satellite;this.table.mass_total.list.mass_mirror.label=H.mass.mirror;this.table.mass_total.list.mass_cooling_total.label=H.mass.cooling.title;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.label=H.mass.cooling.passive;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.label=H.mass.cooling.cryo;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.label=H.mass.cooling.active}this.table.mass_total.list.mass_instruments.label=H.mass.instruments;this.table.science_total.label=H.science.title;this.table.profile_total.label=H.profile.title;this.table.profile_total.list.profile_site.label=H.profile.site;this.table.profile_total.list.profile_vehicle.label=H.profile.vehicle;this.table.profile_total.list.profile_instruments.label=H.profile.instruments;this.table.profile_total.list.profile_mirror.label=H.profile.mirror;this.table.profile_total.list.profile_temperature.label=H.profile.temperature;this.table.profile_total.list.profile_orbit.label=H.profile.orbit;this.table.profile_total.list.profile_launch.label=H.profile.launch;this.table.profile_total.list.profile_end.label=H.profile.end;this.updateSummaryList();return this};q.prototype.getInstrument=function(D){var A=D;var F=this.makeValue(0,"GBP");var C=this.makeValue(0,"kg");var z=this.makeValue(0,"K");var E=this.makeValue(0,"months");if(D.wavelength&&this.data.wavelengths[D.wavelength]){var i=this.copyValue(this.data.wavelengths[D.wavelength]);if(i.cost){F=i.cost}if(i.mass){C=i.mass}if(i.temperature){z=i.temperature}A.wavelength=this.phrases.wavelengths[D.wavelength].label}if(D.type&&this.data.instrument.options[D.type]){var B=this.copyValue(this.data.instrument.options[D.type]);if(B.multiplier&&B.multiplier.cost){F.value*=B.multiplier.cost}if(B.multiplier&&B.multiplier.mass){C.value*=B.multiplier.mass}if(B.devtime){E=B.devtime}A.type=this.phrases.designer.instruments.options.instrument[D.type].label}A.cost=F;A.mass=C;A.temp=z;A.time=E;return A};q.prototype.buildRow=function(z,A,i){return(!z&&!A&&!i)?"":"<div"+(typeof i==="string"?' class="'+i+'"':"")+"><strong>"+z+"</strong> "+this.formatValueSpan(A)+"</div>"};q.prototype.showDetails=function(i,L){this.log("showDetails");var H="";if(!i||i==""){return this}var I=this.phrases.designer;if(i=="satellite"){if(this.choices.mirror&&this.data.mirror[this.choices.mirror]){var C=this.data.mirror[this.choices.mirror];var A=this.copyValue(C.cost);var J=this.copyValue(C.mass);var B=this.copyValue(C.devtime);var G=this.copyValue(C.bus.cost);var K=this.copyValue(C.bus.mass);var F=this.copyValue(C.bus.devtime);var E=this.copyValue(C.bus.diameter);if(this.choices.deployablemirror){var M=this.data.deployablemirror.multiplier;if(M.cost){A.value*=M.cost}if(M.mass){J.value*=M.mass}if(M.time){B.value*=M.time}if(M.bus.cost){G.value*=M.bus.cost}if(M.bus.mass){K.value*=M.bus.mass}if(M.bus.time){F.value*=M.bus.time}if(M.bus.diameter){E.value*=M.bus.diameter}}if(this.choices.uvmirror){var M=this.data.uvmirror.multiplier;if(M.cost){A.value*=M.cost}if(M.mass){J.value*=M.mass}if(M.time){B.value*=M.time}}H+=this.buildRow(I.satellite.cost,A);H+=this.buildRow(I.satellite.mass,J);H+=this.buildRow(I.satellite.devtime,B);H+=this.buildRow(I.satellite.bus.cost,G);H+=this.buildRow(I.satellite.bus.mass,K);H+=this.buildRow(I.satellite.bus.devtime,F);H+=this.buildRow(I.satellite.bus.diameter,E);H+=this.buildRow(I.satellite.bus.slots,C.bus.instrumentslots)}}else{if(i=="instruments"){L=this.getInstrument(L);H+=this.buildRow(I.instruments.cost,L.cost);H+=this.buildRow(I.instruments.mass,L.mass);H+=this.buildRow(I.instruments.temperature,L.temp);H+=this.buildRow(I.instruments.devtime,L.time)}else{if(i=="cooling"){H+=this.buildRow(I.cooling.temperature,this.choices.temperature);H+=this.buildRow(I.cooling.cost,this.choices.cooling.cost);H+=this.buildRow(I.cooling.mass,this.choices.cooling.mass);if(this.choices.cooling.time.value>0){H+=this.buildRow(I.cooling.devtime,this.choices.cooling.time)}H+=this.buildRow(I.cooling.life,this.choices.cooling.life);H+=this.buildRow(I.cooling.risk,this.makeValue(this.choices.cooling.risk*100,"%"))}else{if(i=="site"){if(typeof this.data.site[L].latitude==="number"){H+=this.buildRow(I.site.location,this.data.site[L].latitude.toFixed(2)+"&deg;, "+this.data.site[L].longitude.toFixed(2)+"&deg;")}if(this.data.site[L].operator){H+=this.buildRow(I.site.operator,this.phrases.operator[this.data.site[L].operator].label)}H+=this.buildRow(I.site.trajectories,I.site.options[L].trajectories);var D="";for(var z in this.data.site[L].orbits){if(this.data.site[L].orbits[z]){D+=""+I.orbit.options[z].label+"<br />"}}H+=this.buildRow(I.site.orbits,D);if(typeof this.data.site[L].risk==="number"){H+=this.buildRow(I.site.risk,(this.data.site[L].risk*100).toFixed(0)+"%")}}else{if(i=="orbit"){if(this.data.orbit[L].altitude){H+=this.buildRow(I.orbit.altitude,this.data.orbit[L].altitude)}if(this.data.orbit[L].period){H+=this.buildRow(I.orbit.period,this.data.orbit[L].period)}if(this.data.orbit[L].obsfrac){H+=this.buildRow(I.orbit.obsfrac,{value:this.data.orbit[L].obsfrac*100,units:"%",dimension:"percent"})}if(this.data.orbit[L].fuellife){H+=this.buildRow(I.orbit.fuellife,this.data.orbit[L].fuellife)}if(this.data.orbit[L].temperature){H+=this.buildRow(I.orbit.temperature,this.data.orbit[L].temperature)}if(this.data.orbit[L].groundcost){H+=this.buildRow(I.orbit.groundcost,this.data.orbit[L].groundcost)}if(this.data.orbit[L].risk){H+=this.buildRow(I.orbit.risk,{value:this.data.orbit[L].risk*100,units:"%",dimension:"percent"})}}}}}}H+='<div class="clearall"></div>';e("#designer_"+i+" .details").html(H).addClass("padded");return this};q.prototype.formatScenario=function(i){return""+((typeof i.description==="string")?i.description:"").replace(/%COST%/,this.formatValueSpan(i.budget))+""};q.prototype.updateOptions=function(){e("#options").html("<h3>"+this.phrases.ui.menu.options.label+'</h3><form id="optionform"><ul></ul>');for(var i in this.phrases.ui.options){html='<li><label for="change'+i+'">'+this.phrases.ui.options[i]+'</label> <select id="change'+i+'" name="change'+i+'">';if(i=="currency"){for(var z in this.phrases.ui[i]){html+='<option value="'+z+'"'+(z==this.settings.currency?' selected="selected"':"")+">"+this.phrases.ui.currency[z].label+" "+this.phrases.ui.currency[z].symbol+"</option>"}}else{for(var z in this.phrases.ui.units){if(this.phrases.ui.units[z].dimension==i&&this.phrases.ui.units[z].selectable){html+='<option value="'+z+'"'+(z==this.settings[i]?' selected="selected"':"")+">"+this.phrases.ui.units[z].label+"</option>"}}}html+="</select></li>";e("#options ul").append(html);e("form#optionform #change"+i).on("change",{me:this,o:i},function(A){A.data.me.settings[A.data.o]=e(this).val();A.data.me.updateUnits()})}this.addCloser(e("#options"),{me:this},function(A){A.preventDefault();A.data.me.closeModal(e("#options"))});return this};q.prototype.updateUnits=function(){var C=e(".convertable");var D,F,z,A,E;for(var B=0;B<C.length;B++){D=e(C[B]);z=D.attr("data-value");A=D.attr("data-units");E=D.attr("data-dimension");if(z&&A&&E){D.html(this.formatValue({value:z,units:A,dimension:E}))}}this.updateDropdown("mirror_size");this.updateDropdown("cooling_temperature");return this};q.prototype.updateValue=function(H,G,z){var B;if(typeof H==="object"){B=H}else{if(typeof H==="string"){B=e("."+H+".value")}}if(B.length>0){if(typeof G==="object"){var F={value:parseFloat(B.attr("data-value"),10),units:B.attr("data-units"),dimension:B.attr("data-dimension")};if(z&&F.dimension==G.dimension){var D=this;var E=20;if(!z){z=400}var I=new Date();var C=0;if(G.units!=F.units){G=this.convertValue(G,F.dimension)}function A(){var i=(new Date())-I;if(i>z){B.html(D.formatValue(G)).attr({"data-value":G.value,"data-units":G.units,"data-dimension":G.dimension}).addClass("convertable")}else{B.html(D.formatValue({value:(F.value+(G.value-F.value)*(i/z)),units:F.units,dimension:F.dimension}));requestAnimFrame(A)}}A()}else{B.attr({"data-value":G.value,"data-units":G.units,"data-dimension":G.dimension}).html(this.formatValue(G)).addClass("convertable")}}else{B.html(G)}}return this};q.prototype.formatValueSpan=function(z,i){i=(i)?" "+i:"";return(typeof z==="object"?'<span class="value'+i+' convertable" data-value="'+z.value+'" data-units="'+z.units+'" data-dimension="'+z.dimension+'">'+this.formatValue(z)+"</span>":'<span class="value'+i+'">'+z+"</span>")};q.prototype.copyValue=function(i){if(typeof i==="object"){return JSON.parse(JSON.stringify(i))}return{}};q.prototype.getValue=function(i){var z=e(i);if(z.length>0){if(z.prop("tagName")=="SELECT"){return z.find(":selected").attr("value")}if(z.prop("tagName")=="INPUT"){return z.val()}}return""};q.prototype.getChoice=function(z){if(z=="mirror.cost"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].cost):this.makeValue(0,"GBP"));v.value=-v.value;if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.cost){v.value*=this.data.deployablemirror.multiplier.cost}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.cost){v.value*=this.data.uvmirror.multiplier.cost}}else{if(z=="mirror.mass"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].mass):this.makeValue(0,"kg"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.mass){v.value*=this.data.deployablemirror.multiplier.mass}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.mass){v.value*=this.data.uvmirror.multiplier.mass}}else{if(z=="mirror.time"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].devtime):this.makeValue(0,"months"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.time){v.value*=this.data.deployablemirror.multiplier.time}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.time){v.value*=this.data.uvmirror.multiplier.time}}else{if(z=="mirror.prob"){v=(this.choices.mirror?this.data.mirror[this.choices.mirror].risk:1);if(this.choices.deployablemirror&&this.data.deployablemirror.risk){v*=this.data.deployablemirror.risk}if(this.choices.uvmirror&&this.data.uvmirror.risk){v*=this.data.uvmirror.risk}}else{if(z=="mirror"){v=(this.choices.mirror)?this.data.mirror[this.choices.mirror].diameter:this.makeValue(0,"m")}else{if(z=="cooling.cost"){v=(this.choices.cooling?this.copyValue(this.choices.cooling.cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(z=="cooling.mass"){v=(this.choices.cooling&&this.choices.cooling.mass?this.copyValue(this.choices.cooling.mass):this.makeValue(0,"kg"))}else{if(z=="cooling.passive.mass"){v=(this.choices.cooling&&this.choices.cooling.passive?this.copyValue(this.choices.cooling.passive):this.makeValue(0,"kg"))}else{if(z=="cooling.active.mass"){v=(this.choices.cooling&&this.choices.cooling.active?this.copyValue(this.choices.cooling.active):this.makeValue(0,"kg"))}else{if(z=="cooling.cryogenic.mass"){v=(this.choices.cooling&&this.choices.cooling.cryogenic?this.copyValue(this.choices.cooling.cryogenic):this.makeValue(0,"kg"))}else{if(z=="cooling.time"){v=(this.choices.cooling?this.copyValue(this.choices.cooling.time):this.makeValue(0,"months"))}else{if(z=="cooling.life"){v=(this.choices.cooling&&this.choices.cooling.life?this.copyValue(this.choices.cooling.life):this.makeValue(99,"years"))}else{if(z=="cooling.prob"){v=1;if(this.choices.cooling&&this.choices.cooling.risk){v=this.choices.cooling.risk}}else{if(z=="satellite.cost"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.cost):this.makeValue(0,"GBP"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.cost){v.value*=this.data.deployablemirror.multiplier.bus.cost}v.value=-v.value}else{if(z=="satellite.mass"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.mass):this.makeValue(0,"kg"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.mass){v.value*=this.data.deployablemirror.multiplier.bus.mass}}else{if(z=="satellite.time"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.devtime):this.makeValue(0,"months"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.time){v.value*=this.data.deployablemirror.multiplier.bus.time}}else{if(z=="instruments.time"){v=(this.choices.instrument&&this.choices.instrument.time)?this.choices.instrument.time:this.makeValue(0,"months")}else{if(z=="instruments.cost"){v=(this.choices.instrument&&this.choices.instrument.cost)?this.choices.instrument.cost:this.makeValue(0,"GBP");v.value=-v.value}else{if(z=="instruments.mass"){v=(this.choices.instrument&&this.choices.instrument.mass)?this.choices.instrument.mass:this.makeValue(0,"kg")}else{if(z=="instruments.prob"){v=(this.choices.instrument&&this.choices.instrument.risk)?this.choices.instrument.risk:1}else{if(z=="site"){v=(this.choices.site?this.phrases.designer.site.options[this.choices.site].label:"")}else{if(z=="site.prob"){v=0;if(this.choices.site){v=(this.data.site[this.choices.site].risk?this.data.site[this.choices.site].risk:1)}}else{if(z=="vehicle"){v=(this.choices.vehicle?this.phrases.designer.vehicle.options[this.choices.vehicle].label:"")}else{if(z=="vehicle.cost"){v=(this.choices.vehicle?this.copyValue(this.data.vehicle[this.choices.vehicle].cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(z=="vehicle.prob"){v=0;if(this.choices.vehicle){v=(this.data.vehicle[this.choices.vehicle].risk?this.data.vehicle[this.choices.vehicle].risk:1)}}else{if(z=="ground.cost"){var i=this.choices.mission?this.copyValue(this.data.mission[this.choices.mission].life):this.makeValue(0,"months");if(this.choices.orbit){v=this.copyValue(this.data.orbit[this.choices.orbit].groundcost);v.value*=-this.convertValue(i,"years").value}else{v=this.makeValue(0,"GBP")}}else{if(z=="temperature"){v=(this.choices.temperature)?this.choices.temperature:this.makeValue(400,"K");if(this.choices.orbit){v=this.data.orbit[this.choices.orbit].temperature}}else{if(z=="launch.cost"){v=(this.choices.vehicle?this.copyValue(this.data.vehicle[this.choices.vehicle].cost):this.makeValue(0,"GBP"));v.value*=-(this.choices.orbit?this.data.orbit[this.choices.orbit].multiplier.launchcost:1)}else{if(z=="orbit"){v=(this.choices.orbit)?this.phrases.designer.orbit.options[this.choices.orbit].label:""}else{if(z=="orbit.prob"){v=0;if(this.choices.orbit){v=(this.data.orbit[this.choices.orbit].risk)?this.data.orbit[this.choices.orbit].risk:1}}else{if(z=="mission.time"){v=(this.choices.mission?this.copyValue(this.data.mission[this.choices.mission].life):this.makeValue(0,"months"))}else{if(z=="mission.prob"){v=(this.choices.mission&&this.data.mission[this.choices.mission].risk?this.data.mission[this.choices.mission].risk:1)}else{if(z=="fuel.time"){v=(this.choices.orbit?this.copyValue(this.data.orbit[this.choices.orbit].fuellife):this.makeValue(0,"months"))}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return v};q.prototype.processSummaryList=function(C,B,D){D++;var A='<ul class="summary">';for(var z in C){if(C[z].value||C[z].list){A+="<li>";if(z&&C[z].value){A+='<span class="label '+z+'">'+C[z].label+"</span>"+this.formatValueSpan(C[z].value,B+" "+z)}if(C[z].list){A+=this.processSummaryList(C[z].list,(D==1?B:""))}A+="</li>"}}A+="</ul>";return A};q.prototype.updateSummaryList=function(){for(var A in this.table){var z="";var C=A;if(C.indexOf("_")>0){C=C.substr(0,C.indexOf("_"))}var B=C;if(C!=A){B+=" "+A}var D=0;if(this.table[A].value){this.updateValue("baritem ."+A,this.table[A].value)}var i='<h3><img src="images/cleardot.gif" class="icon '+B+'" /> <span class="label '+B+'">'+this.table[A].label+"</span> "+(this.table[A].value?this.formatValueSpan(this.table[A].value,B):"")+"</h3>";if(this.table[A].list){i+=this.processSummaryList(this.table[A].list,C,D)}e("#summaryext_"+C).addClass("padded").html(i)}return this};q.prototype.updateSummary=function(){this.log("updateSummary");var F="";var K=this.phrases.ui.summary;var D={};var R={};var M={};var B={};var C={};D.mirror=this.getChoice("mirror.prob");D.site=this.getChoice("site.prob");D.vehicle=this.getChoice("vehicle.prob");D.cooling=this.getChoice("cooling.prob");D.orbit=this.getChoice("orbit.prob");D.instruments=this.getChoice("instruments.prob");D.mission=this.getChoice("mission.prob");D.total=D.orbit*D.site*D.vehicle*D.mirror*D.cooling*D.instruments*D.mission;if(D.total<0.5&&D.total>0){this.warnings.push({text:this.phrases.warnings.risky})}if(D.total==0){this.errors.push({text:this.phrases.errors.impossible})}R.mirror=this.getChoice("mirror.cost");R.satellite=this.getChoice("satellite.cost");R.cooling=this.getChoice("cooling.cost");R.instruments=this.getChoice("instruments.cost");R.dev=this.sumValues(R.mirror,R.satellite,R.cooling,R.instruments);R.vehicle=this.getChoice("vehicle.cost");R.ground=this.getChoice("ground.cost");R.launch=this.getChoice("launch.cost");R.operations=this.sumValues(R.launch,R.ground);R.total=this.sumValues(R.dev,R.operations);R.free=this.sumValues(this.scenario.budget,R.total);if(R.free.value<0){this.errors.push({text:this.phrases.errors.bankrupt})}B.mirror=this.getChoice("mirror.time");B.satellite=this.getChoice("satellite.time");B.instruments=this.getChoice("instruments.time");B.cooling=this.getChoice("cooling.time");B.total=this.sumValues(B.mirror,B.satellite,B.cooling,B.instruments);B.mission=this.getChoice("mission.time");B.lifecooling=this.getChoice("cooling.life");B.fuel=this.getChoice("fuel.time");var G=this.minValue(B.mission,B.lifecooling,B.fuel);G.value*=(this.choices.orbit)?this.data.orbit[this.choices.orbit].obsfrac:0;B.observing=G;var T=this.convertValue(B.fuel,B.mission.units);if(B.mission.value>T.value){this.warnings.push({text:this.phrases.warnings.fuellifetime.replace(/%LIFE%/,this.formatValue(T)).replace(/%DURATION%/,this.formatValue(B.mission)),link:"#designer_orbit"})}var N=this.convertValue(B.lifecooling,B.mission.units);if(B.mission.value>N.value){this.warnings.push({text:this.phrases.warnings.coolinglifetime.replace(/%LIFE%/,this.formatValue(N)).replace(/%DURATION%/,this.formatValue(B.mission)),link:"#designer_orbit"})}M.mirror=this.getChoice("mirror.mass");M.satellite=this.getChoice("satellite.mass");M.cooling=this.getChoice("cooling.mass");M.instruments=this.getChoice("instruments.mass");M.total=this.sumValues(M.mirror,M.satellite,M.cooling,M.instruments);if(this.choices.orbit&&this.choices.vehicle){var O=this.convertValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO),M.total.units);if(M.total.value>O.value){this.errors.push({text:this.phrases.errors.heavy})}if(M.total.value<=O.value&&M.total.value>0.8*O.value){this.warnings.push({text:this.phrases.warnings.heavy})}}this.table.success.value=this.formatPercent(D.total);this.table.success.list.success_orbit.value=this.formatPercent(D.orbit);this.table.success.list.success_site.value=this.formatPercent(D.site);this.table.success.list.success_vehicle.value=this.formatPercent(D.vehicle);this.table.success.list.success_deploy.value=this.formatPercent(D.mirror);this.table.success.list.success_cooling.value=this.formatPercent(D.cooling);this.table.success.list.success_instruments.value=this.formatPercent(D.instruments);this.table.success.list.success_mission.value=this.formatPercent(D.mission);this.updateTable("cost_available","value",R.free);this.updateTable("cost_initial","value",this.scenario.budget);this.updateTable("cost_dev_total","value",R.dev);this.updateTable("cost_dev_satellite","value",R.satellite);this.updateTable("cost_dev_mirror","value",R.mirror);this.updateTable("cost_dev_cooling","value",R.cooling);this.updateTable("cost_dev_instruments","value",R.instruments);this.updateTable("cost_operations_total","value",R.operations);this.updateTable("cost_operations_launch","value",R.launch);this.updateTable("cost_operations_ground","value",R.ground);this.updateTable("cost_total","value",R.total);this.table.cost_available.list.cost_available.value=R.free;this.updateTable("time_dev_total","value",B.total);this.table.time_dev_total.list.time_dev_total.value=B.total;this.updateTable("time_dev_satellite","value",B.satellite);this.updateTable("time_dev_mirror","value",B.mirror);this.updateTable("time_dev_cooling","value",B.cooling);this.updateTable("time_dev_instruments","value",B.instruments);this.updateTable("time_mission","value",B.mission);this.updateTable("time_cooling","value",B.lifecooling);this.updateTable("time_fuel","value",B.fuel);this.updateTable("time_observing","value",B.observing);this.table.mass_total.value=M.total;this.table.mass_total.list.mass_satellite.value=M.satellite;this.table.mass_total.list.mass_mirror.value=M.mirror;this.table.mass_total.list.mass_cooling_total.value=M.cooling;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.value=this.getChoice("cooling.passive.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.value=this.getChoice("cooling.cryogenic.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.value=this.getChoice("cooling.active.mass")}this.table.mass_total.list.mass_instruments.value=M.instruments;var I=0;this.table.science_total.list={};if(this.scenario&&this.scenario.requires&&typeof this.scenario.requires==="object"){var A=this.scenario.requires;var G,H,z,E;this.table.science_total.list={};for(var L=0;L<A.length;L++){z=0;if(A[L]["instruments"]){H=false;if(this.choices.instruments){for(var Q=0;Q<A[L]["instruments"].length;Q++){H=false;for(var P=0;P<this.choices.instruments.length;P++){if((this.choices.instruments[P].type==A[L]["instruments"][Q].type||this.choices.instruments[P].type=="both")&&this.choices.instruments[P].wavelength==A[L]["instruments"][Q].wavelength){H=true}}if(H){z+=100}}}if(A[L]["instruments"].length>0){z/=A[L]["instruments"].length}if(z!=100){this.errors.push({text:A[L].error})}}if(A[L]["mirror"]){E=this.copyValue(A[L]["mirror"]);G=this.convertValue(this.getChoice("mirror"),E.units);if(G.value<E.value){this.errors.push({text:A[L].error})}else{z=100}}if(A[L]["devtime"]){E=this.copyValue(A[L]["devtime"]);G=this.convertValue(this.table.time_dev_total.value,E.units);if(G.value>E.value){this.errors.push({text:A[L].error.replace(/%DEVTIME%/,this.formatValue(G))})}else{z=100}}if(A[L]["vehicle"]){H=false;if(typeof A[L]["vehicle"]==="object"){for(var Q=0;Q<A[L]["vehicle"].length;Q++){if(this.choices.vehicle==A[L]["vehicle"][Q]){H=true}}}else{if(this.choices.vehicle==A[L]["vehicle"]){H=true}}if(!H){this.errors.push({text:A[L].error})}else{z=100}}if(A[L]["site"]){E=(this.choices.vehicle)?this.phrases.designer.vehicle.options[this.choices.vehicle].label:"";if(this.choices.vehicle==A[L]["vehicle"]){this.errors.push({text:A[L].error})}else{z=100}}if(A[L]["observingtime"]){E=this.copyValue(A[L]["observingtime"]);G=this.convertValue(this.table.time_dev_total.list.time_observing.value,E.units);if(G.value<E.value){this.errors.push({text:A[L].error.replace(/%OBSERVINGTIME%/,this.formatValue(G))})}else{z=100}}this.table.science_total.list["target"+L]={label:(G?A[L].label.replace(/%VALUE%/,this.formatValue(E)):A[L].label),value:this.makeValue(z,"%")};I+=z}if(A.length>0){I/=A.length}else{I=100}}this.table.science_total.value=this.makeValue(I,"%");this.table.profile_total.list.profile_site.value=this.getChoice("site");this.table.profile_total.list.profile_vehicle.value=this.getChoice("vehicle");this.table.profile_total.list.profile_instruments.value=(this.choices.instruments)?this.choices.instruments.length:0;this.table.profile_total.list.profile_mirror.value=this.getChoice("mirror");this.table.profile_total.list.profile_temperature.value=this.getChoice("temperature");this.table.profile_total.list.profile_orbit.value=this.getChoice("orbit");var S=new Date();var J=this.convertValue(B.total,"months");S.setUTCMonth(S.getUTCMonth()+J.value);this.launchdate=S.toDateString();this.table.profile_total.list.profile_launch.value=S.toDateString();J=this.convertValue(this.minValue(B.mission,B.fuel,B.lifecooling),"months");S.setUTCMonth(S.getUTCMonth()+J.value);this.table.profile_total.list.profile_end.value=S.toDateString();if(this.choices.orbit&&this.choices.site&&this.choices.vehicle&&this.errors.length==0){this.enableLaunch()}else{this.disableLaunch()}this.updateSummaryList();return this};q.prototype.enableLaunch=function(){this.launchable=true;e(".togglelaunch").show();return this};q.prototype.disableLaunch=function(){this.launchable=false;e(".togglelaunch").hide();return this};q.prototype.test=function(){e("#introduction .fancybtn").trigger("click");e("#scenarios .button").eq(8).trigger("click");e("#mirror_size").val("1.0m");e("#wavelengths").val("submm");e("#instruments").val("camera");e("#instrument_name").val("SPIRE");e(".add_instrument").trigger("click");e("#wavelengths").val("farir");e("#instrument_name").val("FIRAS");e(".add_instrument").trigger("click");e("#wavelengths").val("optical");e("#instrument_name").val("WFPC2");e(".add_instrument").trigger("click");e("input[name=hascooling]").trigger("click");e("input[name=cooling_active]").trigger("click");e("#cooling_cryogenic").val("2yr");e("#cooling_temperature").val("0.3K");e("#vehicle_rocket_ARI5").trigger("click");e("#site").val("CSG");e("#mission_duration").val("7");e("#mission_orbit").val("ES2").trigger("change");return this};q.prototype.goForLaunch=function(){this.log("goForLaunch");if(!this.launchable){this.showView("designer");return this}e(".togglelaunch").hide();e("body").addClass("showlaunch");e("#launch").show();var Q=this.phrases.designer.orbit.options[this.choices.orbit].label;var C=this.phrases.designer.vehicle.options[this.choices.vehicle].label;var J=this.phrases.designer.site.options[this.choices.site].label;var H=this.formatValue(this.table.time_dev_total.list.time_dev_total.value);e("#launch").html("<h2>"+this.phrases.launch.title+"</h2><p>"+this.phrases.launch.intro.replace(/%DEVTIME%/,H).replace(/%VEHICLE%/,C).replace(/%SITE%/,J).replace(/%ORBIT%/,Q).replace(/%LAUNCHDATE%/,this.launchdate)+'</p><ul id="launchtimeline"></ul>');var L=1000;var E={};E.mirror=this.getChoice("mirror.prob");E.site=this.getChoice("site.prob");E.vehicle=this.getChoice("vehicle.prob");E.cooling=this.getChoice("cooling.prob");E.orbit=this.getChoice("orbit.prob");E.mission=this.getChoice("mission.prob");var M=this.phrases.launch.status;var F=true;var B=true;var K=true;var A=0;var P=this.copyValue(this.data.orbit[this.choices.orbit].temperature);var O="";if(this.data.vehicle[this.choices.vehicle].sites.length==this.data.vehicle[this.choices.vehicle].video.length){for(var I=0;I<this.data.vehicle[this.choices.vehicle].sites.length;I++){if(this.data.vehicle[this.choices.vehicle].sites[I]==this.choices.site){O=r(this.data.vehicle[this.choices.vehicle].video[I])}}}else{O=r(this.data.vehicle[this.choices.vehicle].video)}e("#launchtimeline").before('<div id="launchvideo" class="padded">'+this.phrases.launch.countdown["10"]+"..."+this.phrases.launch.countdown["9"]+"..."+this.phrases.launch.countdown["8"]+"..."+this.phrases.launch.countdown["7"]+"..."+this.phrases.launch.countdown["6"]+"..."+this.phrases.launch.countdown["5"]+"..."+this.phrases.launch.countdown["4"]+"..."+this.phrases.launch.countdown["3"]+"..."+this.phrases.launch.countdown["2"]+"..."+this.phrases.launch.countdown["1"]+"..."+this.phrases.launch.countdown["0"]+"..."+this.phrases.launch.countdown.liftoff+"<br />"+O+"</div>");F=this.roll(E.site*E.vehicle);e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.launch,(F?M.success:M.fail),"launch_launch")+"</li>");if(F){F=this.roll(E.orbit);e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.orbit,(F?M.success:M.fail),"launch_orbit")+"</li>");if(F){F=this.roll(E.mirror);e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.deploy,(F?M.success:M.fail),"launch_mirror")+"</li>");if(F){if(this.choices.hascooling){if(this.choices.cool.temperature){var G=this.data.cooling.temperature[e("#cooling_temperature").val()];if(G.temperature){P=this.copyValue(G.temperature)}if(!G.risk){G.risk=1}B=this.roll(G.risk);e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.cooling.label,(B?M.success:M.fail),"launch_temperature")+"</li>")}if(this.data.cooling.passive){e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.cooling.label,"","launch_cooling")+"</li>");p=this.choices.cool.passive;if(p=="yes"){B=this.roll(this.data.cooling.passive[p].risk);K=B;if(B){P.value*=this.data.cooling.passive[p].multiplier.temperature}e("#launchtimeline").append('<li class="indent">'+this.buildRow(this.phrases.launch.cooling.passive,(B?M.success:M.fail),"launch_passive")+"</li>");if(this.data.cooling.active&&K){p=this.choices.cool.active;if(p=="yes"){B=this.roll(this.data.cooling.active[p].risk);if(B){P.value*=this.data.cooling.active[p].multiplier.temperature}e("#launchtimeline").append('<li class="indent">'+this.buildRow(this.phrases.launch.cooling.active,(B?M.success:M.fail),"launch_active")+"</li>")}}if(this.data.cooling.cryogenic&&K){p=this.choices.cool.cryogenic;if(p&&p!="none"){B=this.roll(this.data.cooling.cryogenic[p].risk);if(B){P.value*=this.data.cooling.cryogenic[p].multiplier.temperature}e("#launchtimeline").append('<li class="indent">'+this.buildRow(this.phrases.launch.cooling.cryogenic,(B?M.success:M.fail),"launch_cryogenic")+"</li>")}}}}}e("#launchtimeline").append('<li class="indent">'+this.buildRow(this.phrases.launch.cooling.achieved,P)+"</li>");if(this.choices.instruments){e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.instruments,"")+"</li>");for(var N=0;N<this.choices.instruments.length;N++){var D=this.convertValue(this.data.wavelengths[this.choices.instruments[N].wavelength].temperature,P.units);F=(D.value>=P.value)?true:false;this.choices.instruments[N].ok=F;e("#launchtimeline").append('<li class="indent">'+this.buildRow(this.choices.instruments[N].name+" ("+this.phrases.wavelengths[this.choices.instruments[N].wavelength].label+" "+this.phrases.designer.instruments.options.instrument[this.choices.instruments[N].type].label+")",(F?M.success:M.fail),"launch_instrument")+"</li>")}e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.science,"")+"</li>");for(var N=0;N<this.choices.instruments.length;N++){if(this.choices.instruments[N].ok){var G=this.copyValue(this.data.instrument.options[this.choices.instruments[N].type]);if(!G.risk){G.risk=1}G.risk*=E.mission;F=this.roll(G.risk);this.log(N,G.risk,F);var z=100;if(!F){z=Math.random()*100}A+=z;e("#launchtimeline").append('<li class="indent">'+this.buildRow(this.choices.instruments[N].name+" ("+this.phrases.wavelengths[this.choices.instruments[N].wavelength].label+" "+this.phrases.designer.instruments.options.instrument[this.choices.instruments[N].type].label+")",this.makeValue(z,"%"),"launch_science")+"</li>")}}if(this.choices.instruments.length>0){A/=this.choices.instruments.length}}}}}e("#launchtimeline").append("<li>"+this.buildRow(this.phrases.launch.overall,this.makeValue(A,"%"),"finalresult")+"</li>");e("#launch").append('<div class="printable bigpadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.reprint+"</a></div>");return this};q.prototype.roll=function(i){if(!i){i=1}return(Math.random()>i)?false:true};q.prototype.setKey=function(z,i,A,B){for(g in z){if(g==i){z[g][A]=B;return z}else{if(z[g].list){z[g].list=this.setKey(z[g].list,i,A,B)}}}return z};q.prototype.updateTable=function(i,z,A){this.table=this.setKey(this.table,i,z,A);return this};q.prototype.convertValue=function(i,z){if(typeof i!="object"){return i}if(typeof i.value==="string"&&i.value!="inf"){i.value=parseFloat(i.value,10)}i=this.copyValue(i);if(i.dimension=="length"){if(i.dimension==this.phrases.ui.units[z].dimension){if(i.units!=z){if(i.units=="ft"){i.value/=3.281}if(i.units=="km"){i.value*=1000}if(i.units=="mile"){i.value*=1609}if(i.units=="cubit"){i.value*=0.4572}if(i.units=="bluewhale"){i.value*=30}if(i.units=="yard"){i.value*=0.9144}if(z=="ft"){i.value*=3.281}if(z=="km"){i.value*=0.001}if(z=="mile"){i.value/=1609}if(z=="cubit"){i.value/=0.4572}if(z=="bluewhale"){i.value/=30}if(z=="yard"){i.value/=0.9144}i.units=z}if(i.units=="m"&&i.value>1000){i.value/=1000;i.units="km"}if(i.units=="ft"&&i.value>5280){i.value/=5280;i.units="mile"}if(i.units=="yard"&&i.value>5280){i.value/=5280;i.units="league"}}}else{if(i.dimension=="mass"){if(i.dimension==this.phrases.ui.units[z].dimension){if(i.units!=z){if(i.units=="lb"){i.value/=2.205}if(i.units=="t"){i.value*=1000}if(i.units=="elephant"){i.value*=5400}if(z=="lb"){i.value*=2.205}if(z=="t"){i.value/=1000}if(z=="elephant"){i.value/=5400}i.units=z}}}else{if(i.dimension=="temperature"){if(i.dimension==this.phrases.ui.units[z].dimension){if(i.units!=z){if(i.units=="C"){i.value+=273}else{if(i.units=="F"){i.value=(5/9)*(i.value-32)+273}}if(z=="C"){i.value-=273}else{if(z=="F"){i.value=(9/5)*(i.value-273)+32}}i.units=z}}}else{if(i.dimension=="time"){if(z=="years"||z=="months"||z=="days"||z=="hours"){if(i.units!=z){if(i.units=="months"){i.value/=12}else{if(i.units=="days"){i.value/=365.25}else{if(i.units=="hours"){i.value/=365.25*24}else{if(i.units=="minutes"){i.value/=365.25*24*60}}}}if(z=="months"){i.value*=12}else{if(z=="days"){i.value*=365.25}else{if(z=="hours"){i.value*=365.25*24}else{if(z=="minutes"){i.value*=365.25*24*60}}}}i.units=z}}}else{if(i.dimension=="currency"){if(this.data.currency[z]){if(i.units!=z){if(i.value!="inf"){if(this.data.currency[i.units].conv){i.value/=this.data.currency[i.units].conv}if(this.data.currency[z].conv){i.value*=this.data.currency[z].conv}}i.units=z}}}}}}}return i};q.prototype.sumValues=function(){var B=Array.prototype.slice.call(arguments,0);var z,A,C;if(B.length>0){A=this.convertValue(B[0],B[0].units);for(C=1;C<B.length;C++){if(typeof B[C]==="object"&&B[C].dimension&&B[C].dimension===A.dimension){z=this.convertValue(B[C],B[0].units);A.value+=z.value}}return A}return{}};q.prototype.minValue=function(){var A=Array.prototype.slice.call(arguments,0);var z,C,B;if(A.length>0){B=this.convertValue(A[0],A[0].units);for(C=1;C<A.length;C++){if(typeof A[C]==="object"&&A[C].dimension&&A[C].dimension===A[0].dimension){z=this.convertValue(A[C],A[0].units);if(z.value<B.value){B=z}}}return B}return{}};function a(i){if(i<1e-9){return 1}if(typeof i==="number"&&i<1){return Math.ceil(x.log10(1/i))+1}else{return 1}return 1}q.prototype.formatValue=function(A,D){if(typeof A==="string"||typeof A==="number"){return A}if(!(typeof A==="object"&&A.dimension)){return""}A=this.copyValue(A);if(typeof D==="string"){D=parseInt(D,10)}if(A.dimension=="length"){A=this.convertValue(A,(this.settings.length)?this.settings.length:"m");if(typeof D!=="number"){D=(A.units=="km"?0:a(A.value))}var C=(this.phrases.ui.units[A.units])?this.phrases.ui.units[A.units].unit:"";if(A.value>1000000000000000){return d(A.value,C)}return""+h((A.value).toFixed(D)).replace(/\.0+$/,"").replace(/(\.0?[1-9]+)0+$/,"$1")+""+C}else{if(A.dimension=="mass"){A=this.convertValue(A,(this.settings.mass)?this.settings.mass:"kg");var C=(this.phrases.ui.units[A.units])?this.phrases.ui.units[A.units].unit:"";if(typeof D!=="number"){D=(A.value>=1000)?0:a(A.value)}if(A.value>1000000000000000){return d(A.value,C)}else{return""+h((A.value).toFixed(D)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+""+C}}else{if(A.dimension=="currency"){A=this.convertValue(A,(this.settings.currency)?this.settings.currency:"GBP");if(typeof D!=="number"){D=0}var i=(this.phrases.ui.million.compact)?this.phrases.ui.million.compact:"";var B=(this.phrases.ui.currency[A.units]&&this.phrases.ui.currency[A.units].symbol)?this.phrases.ui.currency[A.units].symbol:(this.phrases.ui.currency.GBP.symbol?this.phrases.ui.currency.GBP.symbol:"");if(A.value=="inf"||A.value>=1000000000000000){return"&infin;"}var z=(A.value<0)?"-":"";A.value=Math.abs(A.value);if(A.value>=1000){A.value/=1000;i=(this.phrases.ui.billion.compact)?this.phrases.ui.billion.compact:""}if(D==0){if(A.value<100){D=1}if(A.value<10){D=2}}var E=(A.value).toFixed(D).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1");return z+B+E+i}else{if(A.dimension=="temperature"){A=this.convertValue(A,(this.settings.temperature)?this.settings.temperature:"K");if(typeof D==="string"){D=parseInt(D,10)}if(typeof D!=="number"){D=(A.value>1000)?0:a(A.value)}var C=(this.phrases.ui.units[A.units])?this.phrases.ui.units[A.units].unit:"";if(typeof A.value==="string"){A.value=parseInt(A.value,10)}return""+h((A.value).toFixed(D).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+C}else{if(A.dimension=="time"){if(A.units=="years"&&A.value<5){A=this.convertValue(A,"months")}if(typeof D!=="number"){D=(A.value>=6)?0:a(A.value)}var C=(this.phrases.ui.units[A.units])?this.phrases.ui.units[A.units].unit:"";if(typeof A.value==="string"){A.value=parseInt(A.value,10)}return""+h((A.value).toFixed(D).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+C}else{if(A.dimension=="percent"){A=A.value;if(typeof A!=="number"){A=parseInt(A,10)}if(typeof A!=="number"){return"0"+C}if(typeof D!=="number"){D=1}var C=(this.phrases.ui.units[A.units])?this.phrases.ui.units[A.units].unit:"%";return""+h(A.toFixed(D)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+C}else{return A.value}}}}}}};q.prototype.makeValue=function(i,z,A){if(!A){if(this.phrases.ui.units[z]){A=this.phrases.ui.units[z].dimension}else{if(this.phrases.ui.currency[z]){A="currency"}else{A="unknown"}}}return{value:i,units:z,dimension:A}};q.prototype.formatPercent=function(i,z){if(typeof i!=="number"){i=0}if(typeof z!=="number"){z=1}return""+h((i*100).toFixed(z)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+"%"};function d(z,A){var B=Math.floor(x.log10(z));var i=Math.round(z/Math.pow(10,B));return""+i+"&times;10<sup>"+B+"</sup>"+A}q.prototype.toggleFullScreen=function(){this.elem=document.getElementById("application");if(u.isFullScreen()){u.cancelFullScreen(this.elem);this.fullscreen=false;e("#application").removeClass("fullscreen")}else{u.requestFullScreen(this.elem);this.fullscreen=true;e("#application").addClass("fullscreen")}return this};q.prototype.parseChoices=function(G,T){G=(G&&G.indexOf("designer_")==0)?G.substr(9):"";this.log("parseChoices",G);var Q,O,V,F,W,I,E,J,L;var S,K,U,A,Z;this.errors=[];this.warnings=[];Q=e("#mission_duration").val();this.choices.mission=(Q&&this.data.mission[Q])?Q:"";O=e("#mirror_size").val();this.choices.mirror=(O&&this.data.mirror[O])?O:"";V=e("input[name=toggledeployable]:checked").val();this.choices.deployablemirror=(V&&V=="yes")?true:false;F=e("input[name=toggleuv]:checked").val();this.choices.uvmirror=(F&&F=="yes")?true:false;E=e("#designer_vehicle input[name=vehicle_rocket]:checked").val();this.choices.vehicle=(E&&this.data.vehicle[E])?E:"";J=e("#site").val();var H=false;this.choices.site=(J&&this.data.site[J])?J:"";var N=e("#mission_orbit").val();if(N&&this.data.orbit[N]){this.choices.orbit=N}else{this.choices.orbit=""}W=e("input[name=hascooling]:checked").val();this.choices.hascooling=(W&&W=="yes")?true:false;this.choices.cool={};I=e("#cooling_temperature").val();this.choices.cool.temperature=(I)?I:"";this.choices.cool.passive=this.getValue("input[name=cooling_passive]:checked");this.choices.cool.active=this.getValue("input[name=cooling_active]:checked");this.choices.cool.cryogenic=e("#cooling_cryogenic").val();this.choices.temperature=this.makeValue(400,"K");this.choices.instrument={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),temp:this.makeValue(400,"K"),time:this.makeValue(0,"months"),risk:1};if(this.choices.instruments){var z=false;for(var R=0;R<this.choices.instruments.length;R++){var I=this.copyValue(this.data.instrument.options[this.choices.instruments[R].type]);if(!I.multiplier){I.multiplier={}}if(!I.multiplier.cost){I.multiplier.cost=1}if(!I.multiplier.mass){I.multiplier.mass=1}var C=this.copyValue(this.data.wavelengths[this.choices.instruments[R].wavelength]);if(C.cost){C.cost.value*=I.multiplier.cost}this.choices.instrument.cost=this.sumValues(this.choices.instrument.cost,C.cost);if(C.mass){this.choices.instrument.mass=this.sumValues(this.choices.instrument.mass,C.mass)}this.choices.instrument.mass.value*=I.multiplier.mass;this.choices.instrument.temp=this.minValue(this.choices.instrument.temp,C.temperature);if(I.devtime){this.choices.instrument.time=this.sumValues(this.choices.instrument.time,I.devtime)}if(I.risk){this.choices.instrument.risk*=I.risk}if(this.choices.instruments[R].wavelength=="uv"){z=true}}var D=(this.choices.mirror)?this.data.mirror[this.choices.mirror].bus.instrumentslots:0;if(this.choices.instruments.length>D){this.errors.push({text:this.phrases.errors.slots,link:"#designer_instruments"})}if(!this.choices.uvmirror&&z){this.errors.push({text:this.phrases.errors.uv,link:"#designer_satellite"})}}if(this.choices.site){if(this.choices.vehicle){for(var R=0;R<this.data.vehicle[this.choices.vehicle].sites.length;R++){if(this.data.vehicle[this.choices.vehicle].sites[R]==J){H=true}}}else{H=true}if(!H){this.errors.push({text:this.phrases.errors.site.replace(/%SITE%/g,this.phrases.designer.site.options[J].label).replace(/%VEHICLE%/,this.phrases.designer.vehicle.options[E].label),link:"#designer_site"})}}if(this.choices.vehicle&&this.choices.mirror){var B=this.copyValue(this.data.vehicle[this.choices.vehicle].diameter);var P=this.copyValue(this.data.mirror[this.choices.mirror].bus.diameter);if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.diameter){P.value*=this.data.deployablemirror.multiplier.bus.diameter}if(P.value>B.value){this.errors.push({text:this.phrases.errors.size,link:"#designer_satellite"})}}if(this.choices.orbit){H=false;if(this.choices.site){H=this.data.site[this.choices.site].orbits[N]}else{H=true}if(!H){this.errors.push({text:this.phrases.errors.orbit.replace(/%SITE%/g,this.phrases.designer.site.options[J].label).replace(/%ORBIT%/,this.phrases.designer.orbit.options[N].label),link:"#designer_orbit"})}this.choices.temperature=this.copyValue(this.data.orbit[this.choices.orbit].temperature)}this.choices.cooling={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),life:this.makeValue(99,"years"),time:this.makeValue(0,"months"),risk:1};if(this.choices.hascooling){if(this.choices.cool.temperature){I=this.data.cooling.temperature[e("#cooling_temperature").val()];if(I.temperature){this.choices.temperature=this.copyValue(I.temperature)}if(I.mass){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,I.mass)}if(I.cost){this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,I.cost)}if(I.devtime){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,I.devtime)}if(I.life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,I.life)}if(I.risk){this.choices.cooling.risk*=I.risk}if(this.choices.mirror&&this.data.mirror[O]["passive"]){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.mirror[O]["passive"].mass);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.mirror[O]["passive"].cost);this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.mirror[O]["passive"].devtime)}}if(this.data.cooling.passive){L=this.choices.cool.passive;if(L=="yes"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.passive[L].devtime);if(this.choices.mirror&&this.data.mirror[this.choices.mirror].passive){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.mirror[this.choices.mirror].passive.mass);this.choices.cooling.passive=this.data.mirror[this.choices.mirror].passive.mass;this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.mirror[this.choices.mirror].passive.cost)}this.choices.cooling.mass.value*=this.data.cooling.passive[L].multiplier.mass;this.choices.cooling.cost.value*=this.data.cooling.passive[L].multiplier.cost;this.choices.cooling.risk*=this.data.cooling.passive[L].risk;this.choices.temperature.value*=this.data.cooling.passive[L].multiplier.temperature;if(this.data.cooling.passive[L].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.passive[L].life)}if(this.choices.orbit){this.choices.cooling.life.value*=this.data.orbit[this.choices.orbit].multiplier.passive.time;if(this.data.orbit[this.choices.orbit].multiplier.cryo.time==0){this.errors.push({text:this.phrases.errors.hotorbitpassive,link:"#designer_orbit"})}}if(this.data.cooling.active){L=this.choices.cool.active;if(L=="yes"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.active[L].devtime);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.cooling.active[L].cost);this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.cooling.active[L].mass);this.choices.cooling.active=this.data.cooling.active[L].mass;this.choices.cooling.risk*=this.data.cooling.active[L].risk;this.choices.temperature.value*=this.data.cooling.active[L].multiplier.temperature;if(this.data.cooling.active[L].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.active[L].life)}}}this.choices.cooling.cryogeniclife=0;if(this.data.cooling.cryogenic){L=this.choices.cool.cryogenic;if(L&&L!="none"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.cryogenic[L].devtime);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.cooling.cryogenic[L].cost);this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.cooling.cryogenic[L].mass);this.choices.cooling.cryogenic=this.data.cooling.cryogenic[L].mass;this.choices.cooling.risk*=this.data.cooling.cryogenic[L].risk;this.choices.temperature.value*=this.data.cooling.cryogenic[L].multiplier.temperature;if(this.data.cooling.cryogenic[L].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.cryogenic[L].life);this.choices.cooling.cyrogeniclife=this.convertValue(this.data.cooling.cryogenic[L].life,"years");this.choices.cooling.cyrogeniclife=this.choices.cooling.cyrogeniclife.value}if(this.choices.orbit){this.choices.cooling.life.value*=this.data.orbit[this.choices.orbit].multiplier.cryo.time;var M=this.data.orbit[this.choices.orbit].multiplier.cryo.time;if(M==0){this.errors.push({text:this.phrases.errors.hotorbitcryo,link:"#designer_orbit"})}if(M<1&&M>0){this.warnings.push({text:this.phrases.warnings.warmorbitcryo,link:"#designer_orbit"})}}}}}else{if(this.data.cooling.active&&this.getValue("input[name=cooling_active]:checked")=="yes"&&L=="no"){this.warnings.push({text:this.phrases.warnings.activenopassive,link:"#designer_cooling"})}if(this.data.cooling.cryogenic&&this.getValue("#cooling_cryogenic")!="none"&&L=="no"){this.warnings.push({text:this.phrases.warnings.cryonopassive,link:"#designer_cooling"})}}}}var Y=this.convertValue(this.choices.instrument.temp,"K");var X=this.convertValue(this.choices.temperature,"K");if(X.value>Y.value){this.errors.push({text:this.phrases.errors.temperature.replace(/%TEMPERATURE%/,"<strong>"+this.formatValue(X)+"</strong>").replace(/%REQUIREMENT%/,"<strong>"+this.formatValue(Y)+"</strong>"),link:"#designer_cooling"})}if(this.proposalCompleteness()<1){this.warnings.push({text:this.phrases.warnings.proposal,link:"#designer_proposal"})}this.updateSummary().updateSidePanels().updateMessages("error",this.errors).updateMessages("warning",this.warnings);return this};q.prototype.updateMessages=function(C,D){this.log("updateMessages",D);if(C!="error"&&C!="warning"){return this}var z="";var A=0;if(D&&typeof D=="object"&&D.length>0){A=D.length;for(var B=0;B<D.length;B++){z+="<li>"+D[B].text+(D[B].link?' <a href="'+D[B].link+'">'+this.phrases.ui[C].link+"</a>":"")+"</li>"}}e("."+C+".value").html(A);e("#messages h3."+C).next().html(z);if(A==0){e(".toggle"+C+",."+C+"s").hide()}else{e(".toggle"+C+",."+C+"s").show()}return this};q.prototype.toggleView=function(i,z){this.log("toggleView",i);if(!e("#"+i).is(":visible")){this.showView(i,z)}else{this.showView(z)}return this};q.prototype.showView=function(i,A){this.log("showView",i,A);if(typeof i==="object"){A=i;i=""}if(typeof i!=="string"){i=""}if(i=="messages"||i=="menu"||i=="language"||i=="options"||i.indexOf("summaryext")==0){if(A&&typeof A==="object"&&typeof A.preventDefault==="function"){A.preventDefault()}if(i=="options"){if(A){A.preventDefault()}this.updateOptions();e("#summaryext").hide();this.showModal(e("#options"));e("body").addClass("showoptions")}return this}e(".view").hide();e("body").removeClass("showguide showintro showoptions showmessages");if(i.indexOf("designer")==0&&!this.scenario){i="intro"}if((i.indexOf("guide")==0&&i.length==5)||i.indexOf("guide_")==0){e("#summaryext").hide();this.showGuide(i);e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide")}else{if((i.indexOf("designer")==0&&i.length==8)||i.indexOf("designer_")==0){e("#summaryext").hide();if(i.indexOf("designer_")==0){var z=i.substr(i.indexOf("designer_")+9);e("#menubar li").removeClass("on");e("#menubar a.toggle"+z).parent().addClass("on");e(".designer .designer_content").hide();e("#"+i+" .designer_content").show();e("#designer").show();if(e("#"+i).find("a").is(":visible")){e("#"+i).find("a:visible").eq(0).focus()}else{if(e("#"+i).find("input")){e("#"+i).find("input").eq(0).focus()}else{e("#menubar a.toggle"+z).focus()}}if(z=="orbit"){this.makeSpace().displayOrbits()}else{this.removeOrbits()}if(z=="proposal"){this.updateProposal()}}else{e("#designer").show().find("a").eq(0).focus()}this.updateBodyClass("showdesigner");this.setScroll("#"+i);this.stage="designer"}else{if(i=="intro"){e("#summaryext").hide();e("#intro").show();this.updateBodyClass("showintro");this.stage="intro"}else{if(i=="scenarios"){e("#summaryext").hide();e("#scenarios").show();this.updateBodyClass("showscenarios");this.stage="scenarios"}else{if(i=="launch"){e("#summaryext").hide();this.updateMessages("error",{}).updateMessages("warning",{});this.goForLaunch();this.updateBodyClass("showlaunch");this.stage="launch"}else{e("#"+this.stage).show();this.updateBodyClass("show"+this.stage)}}}}}if(this.pushstate&&!A){history.pushState({},"Guide","#"+i)}return this};q.prototype.setScroll=function(A){this.log("setScroll",A);var i=e("#bar");var B=(i.is(":visible"))?i.outerHeight():0;var z=0;if(A&&e(A).length==1){z=Math.floor(e(A).offset().top-B);if(z<0){z=0}}e(window).scrollTop(z);return this};q.prototype.toggleGuide=function(i,z){this.log("toggleGuide",i);if(typeof i==="object"){z=i;i=""}if(!e("#guide").is(":visible")){if(!i){i="guide"}this.showView(i)}else{this.showView()}return this};q.prototype.closeGuide=function(){this.log("closeGuide");e("body").removeClass("showguide");e("#guide").hide();e("#intro").show();return this};q.prototype.showGuide=function(I){this.log("showGuide",I);var A=I;if(typeof I==="string"){var H=I.split("_");if(H.length>1&&this.phrases.guide[H[1]]){I=H[1]}}var D="";var E=this.phrases.guide;var J,F,K,C,z;if(I){e("body").addClass("showguide");e("#guide").show();if(e("#guide").length==0){e("#page").append('<div id="guide" class="view"></div>')}if(I=="guide"){D+="<h2>"+this.phrases.guide.title+"</h2><p>"+this.phrases.guide.about+'</p><ul class="index">';for(k in this.phrases.guide){if(k!="title"&&k!="about"&&typeof this.phrases.guide[k].title==="string"){D+='<li><a href="#guide_'+k+'" class="guidelink">'+this.phrases.guide[k].title+"</a><br />"+(typeof this.phrases.guide[k].summary==="string"?this.phrases.guide[k].summary:"")+"</li>"}}D+="</ul>"}else{if(E[I]){D+='<div class="guidetop"><span class="breadcrumb"><a href="#guide" class="guidelink">'+E.title+"</a> &raquo; "+E[I].title+"</span></div>";C=E[I].about;if(I=="mirror"){K="";for(g in this.data.mirror){K+="<tr>";K+="<td>"+this.formatValue(this.data.mirror[g].diameter)+"</td>";K+="<td>"+this.formatValue(this.data.mirror[g].mass)+"</td>";K+="<td>"+this.formatValue(this.data.mirror[g].cost)+"</td>";if(this.settings.mode=="advanced"){K+="<td>"+this.formatValue(this.data.mirror[g].devtime)+"</td>"}K+="</tr>"}C=C.replace(/\%MIRRORTABLE\%/,K)}else{if(I=="structure"){K="";for(g in this.data.mirror){K+="<tr>";K+="<td>"+this.formatValue(this.data.mirror[g].diameter)+"</td>";K+="<td>"+this.formatValue(this.data.mirror[g].bus.diameter)+"</td>";K+="<td>"+this.formatValue(this.data.mirror[g].bus.cost)+"</td>";K+="<td>"+this.formatValue(this.data.mirror[g].bus.mass)+"</td>";K+="</tr>"}C=C.replace(/\%STRUCTURETABLE\%/,K)}else{if(I=="cooling"){K="";if(this.settings.mode=="advanced"){for(g in this.data.cooling.cryogenic){if(g!="none"){K+="<tr>";K+="<td>"+this.formatValue(this.data.cooling.cryogenic[g].life)+"</td>";K+="<td>"+this.formatValue(this.data.cooling.cryogenic[g].cost)+"</td>";K+="<td>"+this.formatValue(this.data.cooling.cryogenic[g].mass)+"</td>";K+="</tr>"}}C=C.replace(/\%ACTIVELIFE\%/,this.formatValue(this.data.cooling.active.yes.life));C=C.replace(/\%ACTIVEMASS\%/,this.formatValue(this.data.cooling.active.yes.mass));C=C.replace(/\%ACTIVECOST\%/,this.formatValue(this.data.cooling.active.yes.cost))}else{for(g in this.data.cooling.temperature){K+="<tr>";K+="<td>"+this.formatValue(this.data.cooling.temperature[g].temperature)+"</td>";K+="<td>"+this.formatValue(this.data.cooling.temperature[g].cost)+"</td>";K+="<td>"+this.formatValue(this.data.cooling.temperature[g].mass)+"</td>";K+="</tr>"}}C=C.replace(/\%COOLINGTABLE\%/,K)}else{if(I=="instruments"){K="";for(g in this.data.wavelengths){if(g!="none"){K+="<tr>";K+="<td>"+this.phrases.wavelengths[g].label+"</td>";K+="<td>"+this.formatValue(this.data.wavelengths[g].temperature)+"</td>";K+="</tr>"}}C=C.replace(/\%WAVELENGTHTABLE\%/,K);if(this.settings.mode=="advanced"){K="";for(g in this.data.instrument.options){if(g!="none"){K+="<tr>";K+="<td>"+this.phrases.designer.instruments.options.instrument[g].label+"</td>";K+="<td>"+this.formatValue(this.data.instrument.options[g].multiplier.mass)+"</td>";K+="<td>"+this.formatValue(this.data.instrument.options[g].multiplier.cost)+"</td>";K+="<td>"+this.formatValue(this.data.instrument.options[g].devtime)+"</td>";K+="</tr>"}}C=C.replace(/\%INSTRUMENTTABLE\%/,K)}}else{if(I=="orbit"){K="";for(g in this.data.orbit){K+="<tr>";K+="<td>"+this.phrases.designer.orbit.options[g].label+"</td>";K+="<td>"+(this.phrases.designer.orbit.options[g].altitude?this.phrases.designer.orbit.options[g].altitude:"")+this.formatValue(this.data.orbit[g].altitude,0)+"</td>";K+="<td>"+this.formatValue(this.data.orbit[g].period)+"</td>";K+="<td>"+(this.data.orbit[g].obsfrac*100)+"%</td>";K+="<td>"+this.formatValue(this.data.orbit[g].temperature)+"</td>";K+="</tr>"}C=C.replace("%ORBITTABLE%",K);for(g in this.data.orbit){C=C.replace("%"+g+"ANCHOR%","guide_orbit_"+g);C=C.replace("%"+g+"LABEL%",this.phrases.designer.orbit.options[g].label);C=C.replace("%"+g+"GROUNDCOST%",this.formatValue(this.data.orbit[g].groundcost));C=C.replace("%"+g+"FUELLIFE%",this.formatValue(this.data.orbit[g].fuellife));C=C.replace("%"+g+"ALTITUDE%",this.formatValue(this.data.orbit[g].altitude));C=C.replace("%"+g+"PERIOD%",this.formatValue(this.data.orbit[g].period));C=C.replace("%"+g+"CRYOREDUCTION%",(100*(1-this.data.orbit[g].multiplier.cryo)).toFixed(0)+"%")}}else{if(I=="vehicle"){K="";for(g in this.data.vehicle){K+="<tr>";K+="<td>"+this.phrases.designer.vehicle.options[g].label+"</td>";K+="<td>"+this.formatValue(this.data.vehicle[g].diameter,0)+"</td>";K+="<td>"+this.formatValue(this.data.vehicle[g].mass.LEO,0)+"</td>";K+="<td>"+this.formatValue(this.data.vehicle[g].mass.GTO,0)+"</td>";K+="<td>"+this.formatValue(this.data.vehicle[g].cost,0)+"</td>";K+="<td>"+this.phrases.operator[this.data.vehicle[g].operator].label+"</td>";if(this.settings.mode=="advanced"){K+="<td>"+(this.data.vehicle[g].risk*100)+"%</td>"}K+="</tr>"}C=C.replace(/\%ROCKETTABLE\%/,K)}else{if(I=="site"){K="";for(g in this.data.site){K+="<tr>";K+="<td>"+this.phrases.designer.site.options[g].label+"</td>";K+="<td>"+this.phrases.designer.site.options[g].trajectories+"</td>";K+="<td>";var B="";for(var i in this.data.vehicle){for(var L=0;L<this.data.vehicle[i].sites.length;L++){if(this.data.vehicle[i].sites[L]==g){if(B.length>0){B+=", "}B+=""+this.phrases.designer.vehicle.options[i].label+""}}}K+=B;K+="</td>";K+="</tr>"}C=C.replace(/\%SITETABLE\%/,K)}}}}}}}if(C.indexOf("<p>")<0){C="<p>"+C+"</p>"}D+='<h2 id="guide_'+I+'">'+E[I].title+"</h2>"+C+'<div class="clearall" /></div>';if(I=="roles"){for(k in E[I]){if(k!="title"&&k!="about"&&typeof E[I][k].title==="string"){D+="<h3>"+E[I][k].title+"</h3><p>"+E[I][k].about+"</p>"}}}else{if(I=="previous"){for(k in E[I]["missions"]){if(typeof E[I]["missions"][k].title==="string"){F="<ul>";for(g in E[I]["missions"][k]){if(g!="title"&&g!="image"){J=this.formatValue(E[I]["missions"][k][g]);F+='<li><span class="key">'+E[I][g]+'</span> <span class="value">'+J+"</span></li>"}}F+="</ul>";D+='<h3 id="guide_'+I+"_"+k+'">'+E[I]["missions"][k].title+"</h3>";if(E[I]["missions"][k]["image"]){D+='<figure class="right"><img src="'+E[I]["missions"][k]["image"].src+'" alt="'+E[I]["missions"][k]["title"]+'" /><figcaption>'+E[I]["missions"][k]["title"]+"</figcaption></figure>"}D+="";D+=F}}}}}}if(E[I]&&E[I].questions){z='<h3 id="guide_'+I+'_questions">Questions</h3><ol>';for(g=0;g<E[I].questions.length;g++){z+="<li>"+E[I].questions[g].label.replace("%EARTHRADIUS%",this.formatValue({value:6500,units:"km",dimension:"length"})).replace("%EARTHMASS%",this.formatValue({value:6e+24,units:"kg",dimension:"mass"}))+"</li>"}z+="</ol>";D+=z}e("#guide").html(D);if(D.indexOf("script")>=0&&typeof MathJax==="object"){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"guide"])}this.addCloser(e("#guide"),{me:this},function(M){M.preventDefault();M.data.me.toggleGuide()});var G=this;e("#guide").show(function(){G.setScroll("#"+A)});e("#intro").hide()}else{this.closeGuide()}e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide");return this};q.prototype.updateBodyClass=function(i){e("body").removeClass("showguide showintro showoptions showmessages showlaunch").addClass(i);return this};q.prototype.addCloser=function(A,B,z){var i=location.href.split("#")[1];if(A.find(".close").length==0){A.prepend('<a href="#" class="close" title="Close"><img src="images/cleardot.gif" class="icon close" /></a>')}if(A.attr("id")!="guide"&&A.attr("id").indexOf(i)!=0){A.find("a.close").attr("href","#"+i)}A.find("a img.close").parent().on("click",B,z);return this};q.prototype.save=function(){if(typeof Blob!=="function"){return this}var C="blah";var A=new Blob([C],{type:"text/plain"});var B="spacetelescope.txt";function z(D){document.body.removeChild(D.target)}var i=document.createElement("a");i.download=B;i.innerHTML="Download File";if(window.webkitURL!=null){i.href=window.webkitURL.createObjectURL(A)}else{i.href=window.URL.createObjectURL(A);i.onclick=z;i.style.display="none";document.body.appendChild(i)}i.click();return this};q.prototype.showModal=function(B){var z=e(window).width();var C=e(window).height();var i=0;var A=0;B.show().find("a").eq(0).focus();this.positionModal(B);this.modal=B;return this};q.prototype.closeModal=function(i){i.hide();e("#modalbg").hide();e("body").css("overflow-y","auto");this.modal=undefined;return this};q.prototype.positionModal=function(i){b(i);e("#modalbg").hide().css({left:0,top:0,height:e(document).height(),width:e(document).width()}).show().off("click").on("click",{me:this},function(z){z.data.me.closeModal(i)});return this};q.prototype.log=function(){var i=Array.prototype.slice.call(arguments,0);if(console&&typeof console.log==="function"){console.log("LOG",i)}return this};function h(C){C+="";var i=C.split(".");var B=i[0];var z=i.length>1?"."+i[1]:"";var A=/(\d+)(\d{3})/;while(A.test(B)){B=B.replace(A,"$1,$2")}return B+z}function y(i){return e("<div />").html(i).text()}function b(B){var z=e(window).width();var C=e(window).height();var i=0;var A=0;i=((z-B.outerWidth())/2);B.css({left:((z-B.outerWidth())/2)+"px"});if(e(window).height()>B.height()){A=((C-B.outerHeight())/2+e(window).scrollTop());e("body").css("overflow-y","hidden")}B.css({left:i+"px",top:A+"px",position:"absolute"})}function o(z,i){t=z.data("transform");if(typeof t==="undefined"){t=z.attr("transform")}if(typeof t!=="object"){t=[]}m=false;for(g=0;g<t.length;g++){for(j=0;j<i.length;j++){if(t[g][0]==i[j][0]){t[g]=i[j][0];m=true}}}if(!m){t.push(i)}z.transform(t).data("transform",t)}function r(i){if(!i.url){return""}i.url=i.url.replace(/watch\?v=/,"embed/");if(i.start&&typeof i.start==="number"){i.url+="?start="+i.start;if(i.end&&typeof i.end==="number"){i.url+="&end="+i.end}}i.url+=(i.url.indexOf("?")>0?"&":"?")+"rel=0&autoplay=1";return'<iframe width="560" height="315" src="'+i.url+'" frameborder="0"></iframe>'}function w(A,B,C){if(C){var z=new Date();z.setTime(z.getTime()+(C*24*60*60*1000));var i="; expires="+z.toGMTString()}else{var i=""}document.cookie=A+"="+B+i+"; path=/"}function n(A){var C=A+"=";var z=document.cookie.split(";");for(var B=0;B<z.length;B++){var D=z[B];while(D.charAt(0)==" "){D=D.substring(1,D.length)}if(D.indexOf(C)==0){return D.substring(C.length,D.length)}}return null}function c(i){w(i,"",-1)}e.spacetelescope=function(z,i){if(typeof i=="object"){i.container=z}else{if(z){if(typeof z=="string"){i={container:z}}else{i=z}}else{i={}}}i.plugins=e.spacetelescope.plugins;return new q(i)};e.spacetelescope.plugins=[]})($);