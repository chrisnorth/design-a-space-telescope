/*!
	SpaceTelescope
	(c) Stuart Lowe and Chris North 2014-5
*/
if(typeof $==="undefined"){$={}}(function(e){var q={};q.log10=function(i){return Math.log(i)/2.302585092994046};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(i){window.setTimeout(i,1000/60)}})();var r={supportsFullScreen:false,isFullScreen:function(){return false},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},a="webkit moz o ms khtml".split(" ");if(typeof document.cancelFullScreen!="undefined"){r.supportsFullScreen=true}else{for(var x=0,o=a.length;x<o;x++){r.prefix=a[x];if(typeof document[r.prefix+"CancelFullScreen"]!="undefined"){r.supportsFullScreen=true;break}}}if(r.supportsFullScreen){r.fullScreenEventName=r.prefix+"fullscreenchange";r.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}};r.requestFullScreen=function(i){return(this.prefix==="")?i.requestFullScreen():i[this.prefix+"RequestFullScreen"]()};r.cancelFullScreen=function(i){return(this.prefix==="")?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}}if(typeof jQuery!="undefined"){jQuery.fn.requestFullScreen=function(){return this.each(function(){if(r.supportsFullScreen){r.requestFullScreen(this)}})}}window.fullScreenApi=r;Raphael.el.animateAlong=function(H,G,F,E,I){var i=this;i.zforward=(!g(I,"boolean"))?false:I;i.atFront=false;i.path=H;i.direction=E;i.pathLen=i.path.getTotalLength();G=(g(G,"undefined"))?5000:G;F=(g(F,"undefined"))?1:F;i.paper.customAttributes.along=function(L){var K=(this.direction&&this.direction<0)?(1-L)*this.pathLen:(L*this.pathLen);var J=this.path.getPointAtLength(K),M={cx:J.x,cy:J.y};if(this.zforward){if(L>0.5&&!this.atFront){this.toFront();this.atFront=true}if(L>0&&L<0.5&&this.atFront){this.toBack();this.atFront=false}}this.rotateWith&&(M.transform="r"+J.alpha);return M};i.attr({along:0});var D=Raphael.animation({along:1},G);i.animate(D.repeat(F))};(function(){var D=0;var E=["ms","moz","webkit","o"];for(var i=0;i<E.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[E[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[E[i]+"CancelAnimationFrame"]||window[E[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(J,G){var F=new Date().getTime();var H=Math.max(0,16-(F-D));var I=window.setTimeout(function(){J(F+H)},H);D=F+H;return I}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(F){clearTimeout(F)}}}());e.query=function(){var i={length:0};var D=location.search;if(D&&D!="#"){D=D.replace(/^\?/,"").replace(/\&$/,"");jQuery.each(D.split("&"),function(){var E=this.split("=")[0];var F=this.split("=")[1];if(/^[0-9\.]+$/.test(F)){F=parseFloat(F)}i[E]=F})}return i};document.write('<style type="text/css">.noscriptmsg { display: none; }</style>');function C(D){if(typeof e!=="function"){this.log("No jQuery! Abort! Abort!");return this}this.q=e.query();this.i=D;this.stage="intro";this.choices={};this.sections=["objectives","satellite","instruments","cooling","vehicle","site","orbit","proposal"];this.keyboard=true;this.errors=[];this.warnings=[];this.launchstep=0;this.langurl="config/%LANG%%MODE%.json";this.dataurl="config/options%MODE%.json";this.scenariourl="config/scenarios_%LANG%%MODE%.json";this.keys=new Array();this.pushstate=!!(window.history&&history.pushState);this.settings={length:"m",currency:"GBP",temperature:"K",mass:"kg",time:"years",usecookies:false,mode:"normal"};this.init(D);var E="transform WebkitTransform MozTransform OTransform msTransform".split(" ");this.hastransform=false;for(var i=0;i<E.length;i++){var F=document.createElement("div");if(F.style[E[i]]!=undefined){this.hastransform=true}}return this}C.prototype.init=function(i){this.lang=(g(this.q.lang,"string"))?this.q.lang:(navigator)?(navigator.userLanguage||navigator.systemLanguage||navigator.language||browser.language):"";this.langshort=(this.lang.indexOf("-")>0?this.lang.substring(0,this.lang.indexOf("-")):this.lang.substring(0,2));this.langs=(i&&i.langs)?i.langs:{en:"English"};this.setVar("currency","string");this.setVar("length","string");this.setVar("mass","string");this.setVar("temperature","string");this.setVar("time","string");this.setVar("mode","string");this.addEvents();this.startup();return this};C.prototype.addEvents=function(){var F=this;window[(this.pushstate)?"onpopstate":"onhashchange"]=function(i){F.navigate(i)};list=e("#language ul li a");for(var E=0;E<list.length;E++){e(list[E]).on("click",{me:this},function(i){i.preventDefault();i.data.me.loadLanguage(e(this).attr("data"),i.data.me.update)})}e("#summary a").on("click",{me:this},function(i){i.data.me.toggleMenus("summaryext",i)});e("a.togglewarning,a.toggleerror").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("messages")});e("a.togglemenu").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("menu")});e("a.togglelang").on("click",{me:this},function(i){i.preventDefault();i.data.me.toggleMenus("language")});e(document).on("dragenter","#application",function(i){i.preventDefault()});e(document).on("dragover","#application",function(i){i.preventDefault();e(this).css("opacity",0.75)});e(document).on("drop",function(i){i.preventDefault()});function D(G,H){if(G[0].type=="text/plain"||G[0].type==""){var i=new FileReader();i.onload=(function(I){return function(J){H.processFile(J.target.result).toggleMenus()}})(G[0]);i.readAsText(G[0])}}e(document).on("drop","#application",{me:this},function(G){G.preventDefault();e(this).css({opacity:1});var i=G.originalEvent.dataTransfer.files;D(i,G.data.me);return false});if(g(Blob,"function")){e("#menu ul").append('<li class="baritem" data="load"><a href="#"><img src="images/cleardot.gif" class="icon load" alt="" /><span>Load</span></a><input type="file" id="files" name="files[]" multiple /></li>');e(document).on("change","#files",{me:this},function(i){D(i.target.files,i.data.me)});e("#menu ul").append('<li class="baritem" data="save"><a href="#"><img src="images/cleardot.gif" class="icon save" alt="" /><span>Save</span></a></li>')}if(r.supportsFullScreen){e("#menu ul").append('<li class="baritem" data="fullscreen"><a href="#" class="fullscreenbtn"><img src="images/cleardot.gif" class="icon fullscreen" alt="" /> <span></span></li>');e(".baritem .fullscreenbtn").parent().on("click",{me:this},function(i){i.data.me.toggleFullScreen().toggleMenus()})}e(".baritem .load").parent().on("click",{me:this},function(i){e("#files").trigger("click")});e(".baritem .save").parent().on("click",{me:this},function(i){i.data.me.save().toggleMenus()});e(".baritem .help").parent().on("click",{me:this},function(i){i.data.me.toggleGuide(i).toggleMenus()});e(".baritem .restart").parent().on("click",{me:this},function(i){i.data.me.toggleMenus()});e(".baritem .options").parent().on("click",{me:this},function(i){i.data.me.showView("options",i).toggleMenus()});e("body").on("click","a.guidelink",{me:this},function(i){if(e(this).attr("href").indexOf("#")==0){i.data.me.showView(e(this).attr("href").substr(1),i)}i.data.me});e(document).on("keypress",{me:this},function(G){if(!G){G=window.event}var i=G.keyCode||G.charCode||G.which||0;G.data.me.keypress(i,G)});this.registerKey(["?"],function(i){this.toggleGuide(i)});e(document).on("scroll",{me:this},function(i){i.data.me.scrollMenus()});e(".scriptonly").removeClass("scriptonly");e(document).on("focus","input,textarea",{me:this},function(i){i.data.me.keyboard=false}).on("blur","input,textarea",{me:this},function(i){i.data.me.keyboard=true});e(document).on("click","#scenarios .button",{me:this},function(i){i.data.me.chooseScenario(e(this).attr("data"))});e(document).on("click","#messages a",{me:this},function(i){e("#messages").hide()});e(document).on("click",".remove_instrument",{me:this},function(i){i.preventDefault();i.data.me.removeInstrument(e(this).attr("data"))});e(document).on("change","#designer_cooling .options input,#designer_cooling .options select",{me:this},function(i){if(i.data.me.getValue("input[name=hascooling]:checked")=="yes"){e("#designer_cooling li.hascooling").show()}else{e("#designer_cooling li.hascooling").hide()}i.data.me.parseChoices().showDetails("cooling")});e(document).on("click","#designer_vehicle .options .button",{me:this},function(i){i.preventDefault();e("#designer_vehicle .info>li."+e(this).attr("data")).find("input").trigger("click")});e(document).on("change","#designer_vehicle .options .selector input",{me:this},function(i){e("#designer_vehicle .info>li").removeClass("selected");e("#designer_vehicle .info>li."+e(this).attr("data")).addClass("selected").find("input").trigger("click");i.data.me.parseChoices()});e(document).on("click","#designer_vehicle .options .info>li",{me:this},function(i){if(!e(this).hasClass("withinfo")){e(".withinfo").removeClass("withinfo");e(this).addClass("withinfo");e("#designer_vehicle .details").html(e(this).find(".vehicle_details").html()).addClass("padded")}});e(document).on("click","#designer_site .launchsite",{me:this},function(i){i.preventDefault();e("#designer_site #site").val(e(this).attr("data"));e("#designer_site #site").trigger("change")});e(document).on("submit","form",{me:this},function(i){i.preventDefault()});e(document).on("change",".doc input,.doc textarea",{me:this},function(i){i.data.me.updateProposal()});e(document).on("click",".printable a.button",{me:this},function(i){i.preventDefault();i.data.me.printProposal()});e(document).on("click",".relaunch a.button",{me:this},function(i){i.preventDefault();i.data.me.relaunch()});e(document).on("click","#launchnav a.button",{me:this},function(i){i.preventDefault();i.data.me.launch()});e(document).on("click",".toggler",{me:this},function(G){var i=e(this).find("input:checked");if(i.attr("value")=="yes"){e(this).addClass("checked")}else{e(this).removeClass("checked")}if(i.attr("id").indexOf("mode")==0){var H=(i.attr("value")=="yes"?"advanced":"normal");if(G.data.me.settings.mode!=H){G.data.me.setMode(H)}}});e(document).on("change","#designer_satellite select, #designer_satellite input",{me:this},function(i){i.data.me.parseChoices().showDetails("satellite").showDetails("cooling")});e(document).on("change","#designer_instruments select",{me:this},function(I){var H=I.data.me.getValue("#instruments");var G=I.data.me.getValue("#wavelengths");I.data.me.parseChoices().showDetails("instruments",{wavelength:G,type:H});e(".add_instrument.hidden").removeClass("hidden")});e(document).on("click","#designer_instruments .add_instrument",{me:this},function(i){i.preventDefault();i.data.me.addInstrument()});e(document).on("change","#designer_site #site",{me:this},function(G){var i=G.data.me.getValue("#site");e(".launchsite").removeClass("selected");e(".launchsite[data="+i+"]").addClass("selected");G.data.me.parseChoices().showDetails("site",i)});e(document).on("change","#mission_orbit",{me:this},function(G){var i=G.data.me.getValue("#mission_orbit");G.data.me.highlightOrbit(i).parseChoices().showDetails("orbit",i).showDetails("cooling")});e(document).on("change","#mission_duration",{me:this},function(i){i.data.me.parseChoices()});e(document).on("submit","#designer_instruments form",{me:this},function(i){i.preventDefault();e(this).find("a.add_instrument").trigger("click")});e(window).resize({me:this},function(i){i.data.me.resize()});return this};C.prototype.startup=function(i){this.data=null;this.phrases=null;this.choices={};this.scenarios=null;this.buildTable();if(g(i,"function")){i=[this.update,i]}else{i=[this.update]}this.loadConfig();this.loadLanguage(this.lang,i);var D="";var E=0;for(l in this.langs){D+='<li class="baritem"><a href="#" title="'+this.langs[l]+'" data="'+l+'">'+this.langs[l]+" ["+l+"]</a></li>";E++}e("#language ul").html(D);if(E<2){e(".togglelang").closest(".baritem").hide()}return this};C.prototype.setMode=function(i,D){this.settings.mode=i;this.q.mode=i;this.startup(D)};C.prototype.changeMode=function(i){this.changeToggle("togglemode","mode_"+i);return this};C.prototype.changeToggle=function(E,i){var D=this.toggles[E];if(!D){return this}if(i==D.a.id&&e("#"+D.a.id).length>0){e("#"+D.a.id).trigger("click").closest(".toggler").trigger("click")}if(i==D.b.id&&e("#"+D.a.id).length>0){e("#"+D.b.id).trigger("click").closest(".toggler").trigger("click")}return this};C.prototype.buildToggle=function(F,D,i){if(!g(F,"string")&&!g(D,"object")&&!g(i,"object")){return""}if(!this.toggles){this.toggles={}}this.toggles[F]={a:D,b:i};var E='<label class="toggle-label';if(D.checked){html='<div class="toggleinput toggler">'+E+'1" for="'+D.id+'"></label>'}else{html='<div class="toggleinput toggler checked">'+E+'1" for="'+D.id+'"></label>'}html+='<div class="toggle-bg">';html+='	<input id="'+D.id+'" type="radio" '+(D.checked?'checked="checked" ':"")+'name="'+F+'" value="'+D.value+'">';html+='	<input id="'+i.id+'" type="radio" '+(i.checked?'checked="checked" ':"")+'name="'+F+'" value="'+i.value+'">';html+='	<span class="switch"></span>';html+="</div>";html+=""+E+'2" for="'+i.id+'"></label></div>';return html};C.prototype.updateToggle=function(D,i,E){if(!g(D,"object")&&!g(i,"object")||e("#"+D.id).length==0||e("#"+i.id).length==0){return this}if(!E){E=""}if(!D.label){D.label=""}if(!i.label){i.label=""}e("#"+D.id+",#"+i.id).attr("title",E);e("label[for="+D.id+"]").html(D.label);e("label[for="+i.id+"]").html(i.label);return this};C.prototype.buildPage=function(){if(this.built){return this.updatePage()}this.built=true;e("#scenarios").html('<h2></h2><p class="about"></p><ul id="scenariolist"></ul>');e("#messages .warnings").html('<div class="bigpadded"><h3 class="warning"><img src="images/cleardot.gif" class="icon warning" /> <span class="title"></span> <span class="warning value">0</span></h3><ul class="summary"></ul>');e("#messages .errors").html('<div class="bigpadded"><h3 class="error"><img src="images/cleardot.gif" class="icon error" /> <span class="title"></span> <span class="error value">0</span></h3><ul class="summary"></ul>');e("#designer").html('<div class="designer_inner bigpadded"><div id="main"><div id="menubar"></div><div id="output"></div><div id="sidebar"><div class="padded"></div></div></div></div>');for(var D=0;D<this.sections.length;D++){if(e("#designer_"+this.sections[D]).length==0){e("#output").append('<div id="designer_'+this.sections[D]+'" class="designer"><h2 class="designer_title"><a href="#designer_'+this.sections[D]+'" class="toggle'+this.sections[D]+'"></a></h2><div class="designer_content"><div class="intro"></div><div class="options"></div><div class="questions"></div></div></div>')}}e(".barmenu").append('<div class="baritem togglelaunch"><a href="#launch" class="">Launch</a></div>');e("#designer_objectives .intro").after('<div class="summary"></div>');e("#designer_satellite .options").html('<div class="bigpadded"><form><ul><li class="option mirror_diameter"><label for="mirror_size"></label><select id="mirror_size" name="mirror_size"></select></li><li class="option mirror_deployable"><label for="mirror_deployable"></label>'+this.buildToggle("toggledeployable",{value:"no",id:"mirror_deployable_no",label:"",checked:true},{value:"yes",id:"mirror_deployable_yes",label:""})+'</li><li class="option mirror_uv"><label for="mirror_uv"></label>'+this.buildToggle("toggleuv",{value:"no",id:"mirror_uv_no",checked:true},{value:"yes",id:"mirror_uv_yes"})+'</li></ul></form><div class="details"></div></div>');e("#designer_instruments .options").html('<div class="bigpadded"><form><ul><li><label for="instruments"></label><select id="wavelengths" name="wavelengths"></select><select id="instruments" name="instruments"></select> <input type="text" id="instrument_name" name="instrument_name" /></li></ul></form><div class="details"></div><a href="#" class="add_instrument hidden"><img src="images/cleardot.gif" class="icon add" /><span>'+this.phrases.designer.instruments.options.add+'</span></a></div><div class="instrument_list bigpadded"></div>');e("#designer_cooling .options").html('<div class="bigpadded"><form><ul></ul></form><div class="details"></div></div>');e("#designer_site .options").html('<div class="worldmap"><img src="images/worldmap.jpg" /></div><div class="bigpadded"><form><ul><li><label for="site"></label><select id="site" name="site"></select></li></ul></form><div class="details"></div></div>');e("#designer_orbit .options").html('<div id="orbits"></div><div id="orbits2"></div><div class="bigpadded"><form><ul><li><label for="mission_orbit"></label><select id="mission_orbit" name="mission_orbit"></select></li><li><label for="mission_duration"></label><select id="mission_duration" name="mission_duration"></select></li></ul></form><div class="details"></div></div>');e("#designer_proposal .options").html('<div class="padded"><div class="doc"></div></div>');e("#sidebar").html('<div class="sidebar_inner"><div class="satellite panel" id="sidebar_satellite"></div><div class="vehicle padded panel"></div><div class="site worldmap panel"></div><div class="orbit panel"></div></div>');this.buildTable();this.updatePage();return this};C.prototype.updatePage=function(){var F="";for(var E=0;E<this.sections.length;E++){F+='<li><a href="#designer_'+this.sections[E]+'" class="toggle'+this.sections[E]+'"></a></li>'}e("#menubar").html("<ul>"+F+"</ul>");e("#designer_cooling .options form ul li").remove();e("#designer_cooling .options form ul").append('<li><label for="hascooling"></label>'+this.buildToggle("hascooling",{value:"no",id:"cooling_no",checked:true},{value:"yes",id:"cooling_yes"})+"</li>");if(this.data.cooling.temperature){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_temperature"></label><select id="cooling_temperature" name="cooling_temperature"></select></li>')}if(this.data.cooling.passive){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_passive"></label>'+this.buildToggle("cooling_passive",{value:"no",id:"cooling_passive_no"},{value:"yes",id:"cooling_passive_yes",checked:true})+"</li>")}if(this.data.cooling.active){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_active"></label>'+this.buildToggle("cooling_active",{value:"no",id:"cooling_active_no",checked:true},{value:"yes",id:"cooling_active_yes"})+"</li>")}if(this.data.cooling.cryogenic){e("#designer_cooling .options form ul").append('<li class="hascooling"><label for="cooling_cryogenic"></label><select id="cooling_cryogenic" name="cooling_cryogenic"></select></li>')}F='<div class="bigpadded">';F+='<form><ul class="info">';for(var D in this.data.vehicle){F+='<li class="'+D+'" data="'+D+'">';F+='<div class="image"><img src="" alt="" title="" /></div><div class="operator"><img src="" alt="" title="" /></div>';F+='<div class="vehicle_details">';F+='<div class="rocket"></div>';var G=["operator","height","diameter","currency","massLEO","massGTO",(this.data.vehicle[D].risk?"risk":""),"sites"];for(var E=0;E<G.length;E++){F+=this.buildRow("","",G[E])}F+='<div class="clearall"></div>';F+="</div>";F+='<div class="selector"><input type="radio" name="vehicle_rocket" id="vehicle_rocket_'+D+'" data="'+D+'" /><label for="vehicle_rocket_'+D+'"></label></div>';F+="</li>"}F+='</ul></form><div class="details"></div></div>';e("#designer_vehicle .options").html(F);e(".details").html("").removeClass("padded");e("#sidebar .panel").hide();return this};C.prototype.buildTable=function(){this.table={success:{list:{success_vehicle:{},success_site:{},success_orbit:{},success_deploy:{},success_cooling:{},success_instruments:{},success_mission:{}}},cost_available:{list:{cost_initial:{},cost_dev_total:{list:{cost_dev_satellite:{},cost_dev_mirror:{},cost_dev_cooling:{},cost_dev_instruments:{}}},cost_operations_total:{list:{cost_operations_launch:{},cost_operations_ground:{}}},cost_total:{},cost_available:{}}},mass_total:{list:{mass_satellite:{},mass_mirror:{},mass_cooling_total:(this.settings.mode=="advanced"?{list:{mass_cooling_passive:{},mass_cooling_cryo:{},mass_cooling_active:{}}}:{}),mass_instruments:{}}},time_dev_total:{list:{time_dev_total:{list:{time_dev_satellite:{},time_dev_mirror:{},time_dev_cooling:{},time_dev_instruments:{}}},time_mission:{},time_cooling:{},time_fuel:{},time_observing:{}}},science_total:{},profile_total:{list:{profile_site:{},profile_vehicle:{},profile_instruments:{},profile_mirror:{},profile_temperature:{},profile_orbit:{},profile_launch:{},profile_end:{}}}}};C.prototype.resize=function(){if(this.modal){this.positionModal(this.modal)}if(e("#launchanimation").length>0){e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"})}return this};C.prototype.navigate=function(D,i){if(!i){var i=location.href.split("#")[1]}this.log("navigate",i,D);if(!g(i,"string")){i=""}this.showView(i,D);return this};C.prototype.keypress=function(D,F){if(this.keyboard){if(!F){F={altKey:false}}for(var E=0;E<this.keys.length;E++){if(this.keys[E].charCode==D&&F.altKey==this.keys[E].altKey){this.keys[E].fn.call(this,{event:F});break}}}};C.prototype.registerKey=function(L,J,F){if(!g(J,"function")){return this}if(!g(L,"object")){L=[L]}var K,D,I,E,G,H;for(I=0;I<L.length;I++){G=false;if(typeof L[I]=="string"){if(L[I].indexOf("alt")==0){H=L[I];G=true;L[I]=L[I].substring(4)}else{H=L[I]}D=L[I].charCodeAt(0)}else{D=L[I];if(D==37){H="&larr;"}else{if(D==32){H="space"}else{if(D==38){H="up"}else{if(D==39){H="&rarr;"}else{if(D==40){H="down"}else{H=String.fromCharCode(D)}}}}}}K=true;for(E=0;E<this.keys.length;E++){if(this.keys.charCode==D&&this.keys.altKey==G){K=false}}if(K){this.keys.push({str:H,charCode:D,"char":String.fromCharCode(D),fn:J,txt:F,altKey:G})}}return this};C.prototype.toggleMenus=function(I,G){if(G&&g(G,"object")){G.preventDefault()}var D=e(".dropdown");var E=(G)?e(G.currentTarget).attr("href"):"";for(var F=0;F<D.length;F++){var H=this;if(e(D[F]).attr("id")==I){e(D[F]).toggle(0,function(){if(E&&E.indexOf("#")>=0){H.setScroll("#"+E.split("#")[1])}})}else{e(D[F]).hide()}}if(I=="messages"){this.setScroll("#"+I)}return this};C.prototype.scrollMenus=function(i){e(".dropdown.fullwidth:visible").each(function(){var D=parseInt(e(this).css("top"));var E=e("#bar").outerHeight();var F=window.scrollY;if(D<=E){e(".dropdown").css({top:E})}if(D>F+E){e(".dropdown").css({top:F+E})}});return this};C.prototype.setVar=function(i,E){if(g(i,"string")){if(this.i&&typeof this.i[i]===E){this.settings[i]=this.i[i]}if(typeof this.q[i]===E){this.settings[i]=this.q[i];if(this.settings.usecookies){s("spacetelescope."+i,this.settings[i],1)}}if(this.settings.usecookies){var D=y("spacetelescope."+i);if(D){this.settings[i]=D}}}return this};C.prototype.loadConfig=function(D){var i=this.dataurl.replace("%MODE%",this.getMode());e.ajax({url:i,beforeSend:function(E){if(E.overrideMimeType){E.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+i)},success:function(F){this.data=F;if(g(D,"function")){D.call(this)}if(g(D,"object")&&D.length>0){for(var E=0;E<D.length;E++){D[E].call(this)}}}});return this};C.prototype.getMode=function(){return(this.settings.mode=="advanced")?"_advanced":""};C.prototype.loadLanguage=function(D,F){if(!D){D=this.langshort}var i=this.settings.mode;var E=this.langurl.replace("%LANG%",D).replace("%MODE%",this.getMode());e.ajax({url:E,beforeSend:function(G){if(G.overrideMimeType){G.overrideMimeType("application/json")}},method:"GET",cache:false,dataType:"json",context:this,error:function(){this.log("Error loading "+D+" ("+i+")");if(this.lang.length==2){this.log("Attempting to load default (en) instead");this.loadLanguage("en",F)}else{if(E.indexOf(this.lang)>0){this.log("Attempting to load "+this.langshort+" instead");this.loadLanguage(this.langshort,F)}}},success:function(G){this.langshort=D;this.lang=D;this.phrases=G;this.log("Loaded "+D);this.loadScenarios(F)}});return this};C.prototype.loadScenarios=function(E){var i=this.settings.mode;var D=this.scenariourl.replace("%LANG%",this.langshort).replace("%MODE%",this.getMode());e.ajax({url:D,beforeSend:function(F){if(F.overrideMimeType){F.overrideMimeType("application/json")}},method:"GET",dataType:"json",context:this,error:function(){this.log("Error loading "+D+" ("+i+")");if(g(E,"function")){E.call(this)}if(g(E,"object")&&E.length>0){for(var F=0;F<E.length;F++){E[F].call(this)}}},success:function(G){this.scenarios=G.scenarios;this.log("Loaded Scenario");if(g(E,"function")){E.call(this)}if(g(E,"object")&&E.length>0){for(var F=0;F<E.length;F++){E[F].call(this)}}}});return this};C.prototype.chooseScenario=function(D){this.log("chooseScenario",D);this.scenario=this.scenarios[D];this.stage="designer";e("#summary").show();this.updateSummary().updateLanguage();return this};C.prototype.update=function(){this.log("update");if(!this.phrases||!this.data){return this}this.buildPage().updateLanguage().makeSpace("orbits").displayOrbits();e("#language.dropdown").hide();if(!this.loaded){this.navigate();this.loaded=true}return this};C.prototype.addInstrument=function(){if(!this.choices.instruments){this.choices.instruments=[]}var E=this.getValue("#instruments");var D=this.getValue("#wavelengths");var F=this.getValue("#instrument_name");if(E&&D){if(!F){F=this.phrases.designer.instruments.defaultname.replace(/%d%/,(this.choices.instruments.length+1))}this.choices.instruments.push({name:F,type:E,wavelength:D,ok:true});this.updateInstruments()}return this};C.prototype.removeInstrument=function(D){D=parseInt(D,10);if(D<this.choices.instruments.length){this.choices.instruments.splice(D,1)}this.updateInstruments();return this};C.prototype.displayInstruments=function(){var E="";var F=this.phrases.designer;this.log("displayInstruments");E+="<h3>"+F.instruments.table.title+'</h3><div class="tablewrapper"><table><tr><th>'+F.instruments.table.name+"</th><th>"+F.instruments.table.type+"</th><th>"+F.instruments.table.cost+"</th><th>"+F.instruments.table.mass+"</th><th>"+F.instruments.table.temperature+"</th><th></th></tr>";if(this.choices.instruments&&this.choices.instruments.length>0){for(var D=0;D<this.choices.instruments.length;D++){v=this.getInstrument({wavelength:this.choices.instruments[D].wavelength,type:this.choices.instruments[D].type});E+="<tr><td>"+this.choices.instruments[D].name+"</td><td>"+v.wavelength+" "+v.type+"</td><td>"+this.formatValueSpan(v.cost)+"</td><td>"+this.formatValueSpan(v.mass)+"</td><td>"+this.formatValueSpan(v.temp)+'</td><td><a class="remove_instrument" href="#" title="'+this.phrases.designer.instruments.options.remove+'" data="'+D+'"><img class="icon minus" src="images/cleardot.gif"></a></td></tr>'}}E+="</table></div>";e("#designer_instruments .instrument_list").html(E);return E};C.prototype.updateInstruments=function(){this.log("updateInstruments");this.displayInstruments();this.parseChoices("designer_instruments");return this};C.prototype.makeSatellite=function(){this.log("makeSatellite");if(!this.satellite){this.satellite=new A({id:"sidebar_satellite",spacetel:this})}this.satellite.resize();return this};C.prototype.makeSpace=function(i){this.log("makeSpace");if(!this.space){this.space=new B({id:i,phrases:this.phrases.designer.orbit,data:this.data.orbit,callback:this.selectOrbit,context:this,interactive:true})}if(!this.space.el.is(":visible")){return this}this.space.data=this.data.orbit;this.space.phrases=this.phrases.designer.orbit;if(!this.space.paper){this.space.resize()}return this};C.prototype.selectOrbit=function(i){if(i){e("#designer_orbit #mission_orbit").val(i);e("#designer_orbit #mission_orbit").trigger("change")}return this};C.prototype.highlightOrbit=function(i){this.log("highlightOrbit",i,this.space);this.space.highlight(i);return this};C.prototype.removeOrbits=function(){this.space.removeOrbits();return this};C.prototype.displayOrbits=function(i,D){this.log("displayOrbits",i,D);this.space.displayOrbits(i,D);return this};C.prototype.updateProposal=function(){this.log("updateProposal");e(".printable").remove();var G={};var I={};var E;if(this.choices.instruments&&this.choices.instruments.length>0){var J="";for(var F=0;F<this.choices.instruments.length;F++){E=this.choices.instruments[F].wavelength;v=this.getInstrument({wavelength:this.choices.instruments[F].wavelength,type:this.choices.instruments[F].type});J+=""+this.choices.instruments[F].name+" - "+v.wavelength+" "+v.type+"\n";if(this.data.wavelengths[E].min){if(!I.value||this.data.wavelengths[E].min.value<I.value){I=this.copyValue(this.data.wavelengths[E].min)}}if(this.data.wavelengths[E].max){if(!G.value||this.data.wavelengths[E].max.value>G.value){G=this.copyValue(this.data.wavelengths[E].max)}}}e("#proposal_instruments").val(J)}if(this.choices.mirror){e("#proposal_mirror").val(this.choices.mirror);if(this.settings.mode!="advanced"){var H=this.data.mirror[this.choices.mirror].diameter;e("#proposal_reslow").val(n(this.formatValue(this.makeValue(1.22*I.value/H.value,"degrees"))));e("#proposal_reshigh").val(n(this.formatValue(this.makeValue(1.22*G.value/H.value,"degrees"))))}}if(this.choices.temperature){e("#proposal_reqtemp").val(this.formatValue(this.choices.instrument.temp));e("#proposal_temp").val(this.formatValue(this.choices.temperature))}if(this.table.mass_total){e("#proposal_mass").val(this.formatValue(this.table.mass_total.value));e("#proposal_mass_satellite").val(this.formatValue(this.table.mass_total.list.mass_satellite.value));e("#proposal_mass_mirror").val(this.formatValue(this.table.mass_total.list.mass_mirror.value));e("#proposal_mass_cooling").val(this.formatValue(this.table.mass_total.list.mass_cooling_total.value));e("#proposal_mass_instruments").val(this.formatValue(this.table.mass_total.list.mass_instruments.value))}if(this.choices.orbit){e("#proposal_orbit").val(this.phrases.designer.orbit.options[this.choices.orbit].label);e("#proposal_distance").val(this.formatValue(this.data.orbit[this.choices.orbit].altitude));if(this.settings.mode!="advanced"){e("#proposal_period").val(this.formatValue(this.data.orbit[this.choices.orbit].period));e("#proposal_fuel").val(this.formatValue(this.data.orbit[this.choices.orbit].fuellife))}}if(this.choices.mission){e("#proposal_duration").val(this.formatValue(this.copyValue(this.data.mission[this.choices.mission].life)))}if(this.choices.vehicle){e("#proposal_vehicle").val(this.phrases.designer.vehicle.options[this.choices.vehicle].label);e("#proposal_operator").val(this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label);e("#proposal_launchmass").val(this.formatValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO)));e("#proposal_launchsize").val(this.formatValue(this.data.vehicle[this.choices.vehicle].diameter))}if(this.choices.site){e("#proposal_site").val(this.phrases.designer.site.options[this.choices.site].label)}if(this.table){e("#proposal_cost").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_total.value))));e("#proposal_cost_satellite").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.value))));e("#proposal_cost_mirror").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.value))));e("#proposal_cost_cooling").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.value))));e("#proposal_cost_instruments").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.value))));e("#proposal_cost_dev").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_dev_total.value))));e("#proposal_cost_launch").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.value))));e("#proposal_cost_ground").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.value))));e("#proposal_cost_operations").val(n(this.formatValue(this.negativeValue(this.table.cost_available.list.cost_operations_total.value))))}if(this.proposalCompleteness()!=0){e(".doc").after('<div class="printable bigpadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.print+"</a></div>")}return this};C.prototype.proposalCompleteness=function(){this.log("proposalCompleteness");var H=0;var E=e(".doc").find("input");var D=e(".doc").find("textarea");var G=E.length+D.length;for(var F=0;F<E.length;F++){if(e(E[F]).val()!=""){H++}}for(var F=0;F<D.length;F++){if(e(D[F]).val()!=""){H++}}return H/G};C.prototype.printProposal=function(){this.log("printProposal");var D=e(".doc").eq(0).html();D=D.replace(/<label[^\>]*>[^\<]*<\/label>/g,"").replace(/<input [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(F,G){var E=e("#"+G).val();return(E!=""?'<span class="userinput">'+E+"</span>":'<span class="emptyinput">BLANK</span>')}).replace(/<textarea [^\>]*id=\"([^\"]*)\"[^\>]*>/g,function(F,G){var E=e("#"+G).val();return(E!=""?'<span class="userinput">'+E+"</span>":'<span class="emptyinput">BLANK</span>')});var i=window.open("","","width="+e(window).width()+",height="+e(window).height()+",resizeable,scrollbars");i.document.write('<!DOCTYPE html><html><head><link type="text/css" href="css/fonts.css" media="all" rel="stylesheet"><link type="text/css" href="css/style.css" media="all" rel="stylesheet"><script>function onload(){ window.print(); }<\/script></head><body onload="onload()"><div id="main" class="bigpadded"><div class="doc">'+D+"</div></div></body></html>");i.document.close();return this};C.prototype.updateSidePanels=function(){if(this.choices.mirror||this.choices.hascooling||this.choices.instruments){this.makeSatellite();e("#sidebar .satellite.panel").show()}else{e("#sidebar .satellite.panel").hide()}if(this.choices.vehicle){e("#sidebar .vehicle.panel").html('<div class="image"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div><div class="info"><div>'+this.phrases.designer.vehicle.options[this.choices.vehicle].label+"</div><div>"+this.phrases.designer.vehicle.diameter+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].diameter)+"</div><div>"+this.phrases.designer.vehicle.massLEO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.LEO)+"</div><div>"+this.phrases.designer.vehicle.massGTO+" "+this.formatValueSpan(this.data.vehicle[this.choices.vehicle].mass.GTO)+"</div><div>"+this.phrases.designer.vehicle.operator+" "+this.phrases.operator[this.data.vehicle[this.choices.vehicle].operator].label+"</div></div>").show()}else{e("#sidebar .vehicle.panel").hide()}if(this.choices.site){html='<img src="images/worldmap.png" />';var i=this.data.site[this.choices.site].latitude;var D=this.data.site[this.choices.site].longitude;if(!i&&!D){i=34;D=-116}html+='<a href="#" class="launchsite '+this.choices.site+'" title="'+this.phrases.designer.site.options[this.choices.site].label+'" style="left:'+Math.round(100*(D+180)/360)+"%;top:"+Math.round(100*(90-i)/180)+'%"></a>';e("#sidebar .site.panel").html(html).show()}else{e("#sidebar .site.panel").hide()}if(this.choices.orbit){e("#sidebar .orbit.panel").html('<img src="'+this.data.orbit[this.choices.orbit].img+'" />').show()}else{e("#sidebar .orbit.panel").hide()}return this};C.prototype.updateDropdown=function(H){var E="";var F,G,D;F=e("#"+H);if(F.length==0){return this}G=F.find("option");this.log("updateDropdown");if(H=="mirror_size"){if(this.phrases.designer.satellite.options.diameter.placeholder){E='<option value="">'+this.phrases.designer.satellite.options.diameter.placeholder+"</option>"}for(var i in this.data.mirror){E+='<option value="'+i+'">'+this.formatValue(this.data.mirror[i].diameter)+"</option>"}F.html(E)}else{if(H=="instruments"){if(this.phrases.designer.instruments.options.instrument.none&&this.settings.mode=="advanced"){E='<option value="">'+this.phrases.designer.instruments.options.instrument.none.label+"</option>"}for(var i in this.data.instrument.options){D=this.phrases.designer.instruments.options.instrument[i].label;E+='<option value="'+i+'">'+D+"</option>"}F.html(E);if(this.settings.mode!="advanced"){e("#instruments option:first-child").attr("selected","selected")}this.displayInstruments()}else{if(H=="wavelengths"){if(this.phrases.wavelengths.none.label){E='<option value="">'+this.phrases.wavelengths.none.label+"</option>"}for(var i in this.data.wavelengths){D=this.phrases.wavelengths[i].label;E+='<option value="'+i+'">'+D+"</option>"}F.html(E)}else{if(H=="mission_duration"){if(this.phrases.designer.orbit.duration.none){E='<option value="">'+this.phrases.designer.orbit.duration.none+"</option>"}for(var i in this.data.mission){D=this.formatValue(this.data.mission[i].life);E+='<option value="'+i+'">'+D+"</option>"}F.html(E)}else{if(H=="mission_orbit"){if(this.phrases.designer.orbit.orbit.none){E='<option value="">'+this.phrases.designer.orbit.orbit.none+"</option>"}for(var i in this.data.orbit){E+='<option value="'+i+'">'+this.phrases.designer.orbit.options[i].label+"</option>"}F.html(E)}else{if(H=="cooling_temperature"){if(this.data.cooling.temperature){for(var i in this.data.cooling.temperature){D=n(this.formatValue(this.data.cooling.temperature[i].temperature));E+='<option value="'+i+'">'+D+"</option>"}F.html(E)}}else{if(H=="site"){if(this.phrases.designer.site.hint){E='<option value="">'+this.phrases.designer.site.hint+"</option>"}for(var i in this.data.site){if(this.phrases.designer.site.options[i]){D=this.phrases.designer.site.options[i].label;E+='<option value="'+i+'">'+D+"</option>"}}F.html(E)}else{if(H=="cooling_cryogenic"){for(var i in this.data.cooling.cryogenic){D=(this.phrases.designer.cooling.options.cryogenic.options[i]?this.phrases.designer.cooling.options.cryogenic.options[i]:this.formatValue(this.data.cooling.cryogenic[i].life));E+='<option value="'+i+'">'+D+"</option>"}F.html(E)}}}}}}}}return this};C.prototype.updateLanguage=function(){this.log("updateLanguage");if(!this.phrases||!this.data){return this}var U=this.phrases;var H,S,N,I,J;if(U.title){document.title=n(U.title)}e("h1").text(U.title);e("body").attr("dir",(U.language.alignment=="right"?"rtl":"ltr")).removeClass("ltr rtl").addClass((U.language.alignment=="right"?"rtl":"ltr"));if(this.scenario){if(e("#designer_objectives .banner").length==0){e("#designer_objectives .intro").before('<div class="banner"></div>')}e("#designer_objectives .banner").html('<div class="title">'+this.scenario.name+"</div>");if(this.scenario.image&&this.scenario.image.banner){e("#designer_objectives .banner").css("background-image","url("+this.scenario.image.banner+")")}if(U.designer.objectives.intro){e("#designer_objectives .intro").html("<p><strong>"+U.scenarios.mission+"</strong> &quot;"+this.formatScenario(this.scenario)+"&quot;</p>"+(this.scenario.funder?U.designer.objectives.intro:U.designer.objectives.intronofunder).replace(/%TITLE%/,this.scenario.name).replace(/%FUNDER%/,this.scenario.funder)).addClass("bigpadded")}}e("#designer_satellite .options .mirror_diameter label").html(U.designer.satellite.options.diameter.label);this.updateDropdown("mirror_size");e("#designer_satellite .options .mirror_deployable label").html(U.designer.satellite.options.deployable.label);e("#designer_satellite .options .mirror_uv label").html(U.designer.satellite.options.uv.label);if(U.designer.satellite.intro){e("#designer_satellite .intro").html(U.designer.satellite.intro).addClass("bigpadded")}this.updateToggle({id:"mirror_deployable_no",label:this.phrases.designer.satellite.options.deployable.no},{id:"mirror_deployable_yes",label:this.phrases.designer.satellite.options.deployable.yes},this.phrases.designer.satellite.options.deployable.label);this.updateToggle({id:"mirror_uv_no",label:this.phrases.designer.satellite.options.uv.no},{id:"mirror_uv_yes",label:this.phrases.designer.satellite.options.uv.yes},this.phrases.designer.satellite.options.uv.label);this.updateDropdown("instruments");this.updateDropdown("wavelengths");e("#designer_instruments .options label").html(U.designer.instruments.options.label);e("#designer_instruments .options input#instrument_name").attr("placeholder",U.designer.instruments.options.name);e("#designer_instruments .options a.add_instrument").attr("title",U.designer.instruments.options.add);e("#designer_instruments .options a.add_instrument span").html(U.designer.instruments.options.add);if(U.designer.instruments.intro){e("#designer_instruments .intro").html(U.designer.instruments.intro.replace(/%MAX%/,this.data.instrument.maxsize.length)).addClass("bigpadded")}if(U.designer.cooling.intro){e("#designer_cooling .intro").html(U.designer.cooling.intro).addClass("bigpadded")}e("#designer_cooling .options label[for=hascooling]").html(U.designer.cooling.enable.label);this.updateToggle({id:"cooling_no",label:U.designer.cooling.enable.no},{id:"cooling_yes",label:U.designer.cooling.enable.yes},this.phrases.designer.cooling.enable.label);if(this.data.cooling.temperature){this.updateDropdown("cooling_temperature");e("#designer_cooling .options label[for=cooling_temperature]").html(U.designer.cooling.options.temperature.label)}if(this.data.cooling.passive){H="";this.updateToggle({id:"cooling_passive_no",label:this.phrases.designer.cooling.options.passive.options.no},{id:"cooling_passive_yes",label:this.phrases.designer.cooling.options.passive.options.yes},this.phrases.designer.cooling.options.passive.label);e("#designer_cooling .options label[for=cooling_passive]").html(U.designer.cooling.options.passive.label)}if(this.data.cooling.active){H="";this.updateToggle({id:"cooling_active_no",label:this.phrases.designer.cooling.options.active.options.no},{id:"cooling_active_yes",label:this.phrases.designer.cooling.options.active.options.yes},this.phrases.designer.cooling.options.active.label);e("#designer_cooling .options label[for=cooling_active]").html(U.designer.cooling.options.active.label)}if(this.data.cooling.cryogenic){this.updateDropdown("cooling_cryogenic");e("#designer_cooling .options label[for=cooling_cryogenic]").html(U.designer.cooling.options.cryogenic.label)}S=0;J=U.designer.vehicle;var M="";var O=0;for(var R in this.data.vehicle){O++}var G=100/O;for(var R in this.data.vehicle){I=e("#designer_vehicle .options li").eq(S);I.attr({data:R}).css({width:G+"%"});N=this.data.vehicle[R];I.find(".image img").attr({src:N.img,alt:J.options[R].label,title:J.options[R].label});I.find(".selector label").html(J.options[R].label);I.find(".rocket").html(J.options[R].label);I.find(".operator img").attr({src:this.data.operator[N.operator].img,alt:U.operator[N.operator].label,title:U.operator[N.operator].label});I.find(".details .operator strong").html(J.operator);I.find(".details .operator .value").html(U.operator[N.operator].label);if(N.height){I.find(".height strong").html(J.height);this.updateValue(I.find(".height .value"),N.height)}I.find(".diameter strong").html(J.diameter);this.updateValue(I.find(".diameter .value"),N.diameter);I.find(".currency strong").html(J.cost);this.updateValue(I.find(".currency .value"),N.cost);I.find(".massLEO strong").html(J.massLEO);this.updateValue(I.find(".massLEO .value"),N.mass.LEO);I.find(".massGTO strong").html(J.massGTO);this.updateValue(I.find(".massGTO .value"),N.mass.GTO);if(N.risk){I.find(".risk strong").html(J.risk);this.updateValue(I.find(".risk .value"),(N.risk*100)+"%")}I.find(".sites strong").html(J.sites);H="";for(var L=0;L<N.sites.length;L++){H+=""+U.designer.site.options[N.sites[L]].label+"<br />"}this.updateValue(I.find(".sites .value"),H);I.find("input").attr("value",R);I.find(".button").html(J.select);S++}if(U.designer.vehicle.intro){e("#designer_vehicle .intro").html(U.designer.vehicle.intro).addClass("bigpadded")}var T="";this.updateDropdown("site");var K='<option value="">'+U.designer.site.hint+"</option>";for(var L in this.data.site){var F=this.data.site[L].latitude;var E=this.data.site[L].longitude;K+='<option value="'+L+'">'+U.designer.site.options[L].label+"</option>";if(!F&&!E){F=34;E=-116}T+='<a href="#" class="launchsite '+L+'" data="'+L+'" title="'+U.designer.site.options[L].label+'" style="left:'+Math.round(100*(E+180)/360)+"%;top:"+Math.round(100*(90-F)/180)+'%"></a>'}e("#designer_site .worldmap .launchsite").remove();e("#designer_site .worldmap").append(T);e("#designer_site .options label").html(U.designer.site.hint);if(U.designer.site.intro){e("#designer_site .intro").html(U.designer.site.intro).addClass("bigpadded")}e("#designer_orbit .options label[for=mission_duration]").html(U.designer.orbit.duration.label);this.updateDropdown("mission_duration");e("#designer_orbit .options label[for=mission_orbit]").html(U.designer.orbit.orbit.label);this.updateDropdown("mission_orbit");var D=(U.designer.proposal.labels?U.designer.proposal.labels:{});String.prototype.formify=function(X,W,V,Z,i){if(!i&&D[X]){i=D[X]}if(i){i='<label for="'+V+'">'+i+"</label>"}else{i=""}if(!Z){Z=""}if(W=="text"){var Y='<input type="text" name="'+V+'" id="'+V+'" value="'+Z+'" >'}else{if(W=="textarea"){var Y='<textarea name="'+V+'" id="'+V+'">'+Z+"</textarea>"}}return this.replace("%"+X+"%",i+Y,"g")};var P=U.designer.proposal.doc;e("#designer_proposal .options .doc").html(P.replace(/%FUNDER%/g,"Funder").replace(/%DATE%/,(new Date()).toDateString()).formify("TO","text","proposal_to").formify("NAME","text","proposal_name").formify("AIM","textarea","proposal_aim").formify("PREVIOUS","text","proposal_previous").formify("ADVANCE","textarea","proposal_advance").formify("INSTRUMENTS","textarea","proposal_instruments").formify("GOALS","textarea","proposal_goal").formify("RESLOW","text","proposal_reslow").formify("RESHIGH","text","proposal_reshigh").formify("MIRROR","text","proposal_mirror").formify("REQTEMPERATURE","text","proposal_reqtemp").formify("TEMPERATURE","text","proposal_temp").formify("MASS","text","proposal_mass").formify("MASSSATELLITE","text","proposal_mass_satellite").formify("MASSMIRROR","text","proposal_mass_mirror").formify("MASSCOOLING","text","proposal_mass_cooling").formify("MASSINSTRUMENTS","text","proposal_mass_instruments").formify("ORBIT","text","proposal_orbit").formify("DISTANCE","text","proposal_distance").formify("PERIOD","text","proposal_period").formify("FUEL","text","proposal_fuel").formify("DURATION","text","proposal_duration").formify("VEHICLE","text","proposal_vehicle").formify("OPERATOR","text","proposal_operator").formify("SITE","text","proposal_site").formify("LAUNCHMASS","text","proposal_launchmass").formify("LAUNCHSIZE","text","proposal_launchsize").formify("COST","text","proposal_cost").formify("COSTSATELLITE","text","proposal_cost_satellite").formify("COSTMIRROR","text","proposal_cost_mirror").formify("COSTCOOLING","text","proposal_cost_cooling").formify("COSTINSTRUMENTS","text","proposal_cost_instruments").formify("COSTDEV","text","proposal_cost_dev").formify("COSTLAUNCH","text","proposal_cost_launch").formify("COSTGROUND","text","proposal_cost_ground").formify("COSTOPERATIONS","text","proposal_cost_operations"));for(var S=0;S<this.sections.length;S++){if(U.designer[this.sections[S]]){e(".toggle"+this.sections[S]).text(U.designer[this.sections[S]].label).attr("title",(U.designer[this.sections[S]].hint?U.designer[this.sections[S]].hint.replace(/<([^>]*)>/g,""):""))}}e(".togglemenu").attr("title",U.ui.menu.title);e("#menu ul li").each(function(V){var W=e(this).attr("data");e(this).find("a").attr("title",U.ui.menu[W].title).find("span").html(U.ui.menu[W].label)});var Q=["warnings","errors","success","time","cost","mass","science"];for(var S=0;S<Q.length;S++){if(U.ui[Q[S]]){e(".toggle"+Q[S]).attr("title",U.ui[Q[S]].title)}if(U.ui.summary[Q[S]]){e(".toggle"+Q[S]).attr("title",U.ui.summary[Q[S]].title)}}e("#introduction").html(U.intro.about);e("#introduction").append('<div class="centre"><a href="#scenarios" class="button fancybtn">'+U.intro.button+"</a></div>");e("#introduction").append('<div class="centre toppadded">'+this.buildToggle("togglemode",{value:"no",id:"mode_basic",checked:(this.settings.mode!="advanced"?true:false)},{value:"yes",id:"mode_advanced",checked:(this.settings.mode=="advanced"?true:false)})+"</div>");this.updateToggle({id:"mode_basic",label:this.phrases.modes.basic},{id:"mode_advanced",label:this.phrases.modes.advanced},this.phrases.modes.label);var I="";for(var S=0;S<this.scenarios.length;S++){I+='<li><div class="padded">'+(this.scenarios[S].image&&this.scenarios[S].image.banner?'<img src="'+this.scenarios[S].image.banner+'"'+(this.scenarios[S].image.alt?'alt="'+this.scenarios[S].image.alt+'"':"")+' style="width: 100%;" />':"")+"<h3>"+this.scenarios[S].name+"</h3><p>"+this.formatScenario(this.scenarios[S])+'</p><a href="#designer_objectives" class="button" title="'+this.scenarios[S].name+'" data="'+S+'">Choose this mission<!--LANGUAGE--></a></div></li>'}e("#scenariolist").html(I);e("#scenarios h2").html(U.scenarios.title);e("#scenarios p.about").html(U.scenarios.intro);this.updateUnits();e("#messages h3.warning .title").text(this.phrases.ui.warning.title);e("#messages h3.error .title").text(this.phrases.ui.error.title);e(".togglelaunch a").text(this.phrases.launch.label).attr("title",(this.phrases.launch.hint?this.phrases.launch.hint:""));var L=U.ui.summary;this.table.success.label=L.success.title;this.table.success.list.success_orbit.label=L.success.orbit;this.table.success.list.success_site.label=L.success.site;this.table.success.list.success_vehicle.label=L.success.vehicle;this.table.success.list.success_deploy.label=L.success.deploy;this.table.success.list.success_cooling.label=L.success.cooling;this.table.success.list.success_instruments.label=L.success.instruments;this.table.success.list.success_mission.label=L.success.mission;this.table.cost_available.label=L.cost.title;this.table.cost_available.list.cost_initial.label=L.cost.initial;this.table.cost_available.list.cost_dev_total.label=L.cost.dev.title;this.table.cost_available.list.cost_dev_total.list.cost_dev_satellite.label=L.cost.dev.satellite;this.table.cost_available.list.cost_dev_total.list.cost_dev_mirror.label=L.cost.dev.mirror;this.table.cost_available.list.cost_dev_total.list.cost_dev_cooling.label=L.cost.dev.cooling;this.table.cost_available.list.cost_dev_total.list.cost_dev_instruments.label=L.cost.dev.instruments;this.table.cost_available.list.cost_operations_total.label=L.cost.operations.title;this.table.cost_available.list.cost_operations_total.list.cost_operations_launch.label=L.cost.operations.launch;this.table.cost_available.list.cost_operations_total.list.cost_operations_ground.label=L.cost.operations.ground;this.table.cost_available.list.cost_total.label=L.cost.total;this.table.cost_available.list.cost_available.label=L.cost.available;this.table.time_dev_total.label=L.time.title;this.table.time_dev_total.list.time_dev_total.label=L.time.dev.title;this.table.time_dev_total.list.time_dev_total.list.time_dev_satellite.label=L.time.dev.satellite;this.table.time_dev_total.list.time_dev_total.list.time_dev_mirror.label=L.time.dev.mirror;this.table.time_dev_total.list.time_dev_total.list.time_dev_cooling.label=L.time.dev.cooling;this.table.time_dev_total.list.time_dev_total.list.time_dev_instruments.label=L.time.dev.instruments;this.table.time_dev_total.list.time_mission.label=L.time.mission;this.table.time_dev_total.list.time_cooling.label=L.time.cooling;this.table.time_dev_total.list.time_fuel.label=L.time.fuel;this.table.time_dev_total.list.time_observing.label=L.time.observing;this.table.mass_total.label=L.mass.title;this.table.mass_total.list.mass_satellite.label=L.mass.satellite;this.table.mass_total.list.mass_mirror.label=L.mass.mirror;this.table.mass_total.list.mass_cooling_total.label=L.mass.cooling.title;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.label=L.mass.cooling.passive;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.label=L.mass.cooling.cryo;this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.label=L.mass.cooling.active}this.table.mass_total.list.mass_instruments.label=L.mass.instruments;this.table.science_total.label=L.science.title;this.table.profile_total.label=L.profile.title;this.table.profile_total.list.profile_site.label=L.profile.site;this.table.profile_total.list.profile_vehicle.label=L.profile.vehicle;this.table.profile_total.list.profile_instruments.label=L.profile.instruments;this.table.profile_total.list.profile_mirror.label=L.profile.mirror;this.table.profile_total.list.profile_temperature.label=L.profile.temperature;this.table.profile_total.list.profile_orbit.label=L.profile.orbit;this.table.profile_total.list.profile_launch.label=L.profile.launch;this.table.profile_total.list.profile_end.label=L.profile.end;this.updateSummaryList();return this};C.prototype.getInstrument=function(H){var E=H;var J=this.makeValue(0,"GBP");var G=this.makeValue(0,"kg");var D=this.makeValue(0,"K");var I=this.makeValue(0,"months");if(H.wavelength&&this.data.wavelengths[H.wavelength]){var i=this.copyValue(this.data.wavelengths[H.wavelength]);if(i.cost){J=i.cost}if(i.mass){G=i.mass}if(i.temperature){D=i.temperature}E.wavelength=this.phrases.wavelengths[H.wavelength].label}if(H.type&&this.data.instrument.options[H.type]){var F=this.copyValue(this.data.instrument.options[H.type]);if(F.multiplier&&F.multiplier.cost){J.value*=F.multiplier.cost}if(F.multiplier&&F.multiplier.mass){G.value*=F.multiplier.mass}if(F.devtime){I=F.devtime}E.type=this.phrases.designer.instruments.options.instrument[H.type].label}E.cost=J;E.mass=G;E.temp=D;E.time=I;return E};C.prototype.buildRow=function(D,E,i){return(!D&&!E&&!i)?"":"<div"+(g(i,"string")?' class="'+i+'"':"")+"><strong>"+D+"</strong> "+this.formatValueSpan(E)+"</div>"};C.prototype.showDetails=function(i,P){this.log("showDetails");var L="";if(!i||i==""){return this}var M=this.phrases.designer;if(i=="satellite"){if(this.choices.mirror&&this.data.mirror[this.choices.mirror]){var G=this.data.mirror[this.choices.mirror];var E=this.copyValue(G.cost);var N=this.copyValue(G.mass);var F=this.copyValue(G.devtime);var K=this.copyValue(G.bus.cost);var O=this.copyValue(G.bus.mass);var J=this.copyValue(G.bus.devtime);var I=this.copyValue(G.bus.diameter);if(this.choices.deployablemirror){var Q=this.data.deployablemirror.multiplier;if(Q.cost){E.value*=Q.cost}if(Q.mass){N.value*=Q.mass}if(Q.time){F.value*=Q.time}if(Q.bus.cost){K.value*=Q.bus.cost}if(Q.bus.mass){O.value*=Q.bus.mass}if(Q.bus.time){J.value*=Q.bus.time}if(Q.bus.diameter){I.value*=Q.bus.diameter}}if(this.choices.uvmirror){var Q=this.data.uvmirror.multiplier;if(Q.cost){E.value*=Q.cost}if(Q.mass){N.value*=Q.mass}if(Q.time){F.value*=Q.time}}L+=this.buildRow(M.satellite.cost,E);L+=this.buildRow(M.satellite.mass,N);L+=this.buildRow(M.satellite.devtime,F);L+=this.buildRow(M.satellite.bus.cost,K);L+=this.buildRow(M.satellite.bus.mass,O);L+=this.buildRow(M.satellite.bus.devtime,J);L+=this.buildRow(M.satellite.bus.diameter,I);L+=this.buildRow(M.satellite.bus.slots,G.bus.instrumentslots)}}else{if(i=="instruments"){P=this.getInstrument(P);L+=this.buildRow(M.instruments.cost,P.cost);L+=this.buildRow(M.instruments.mass,P.mass);L+=this.buildRow(M.instruments.temperature,P.temp);L+=this.buildRow(M.instruments.devtime,P.time)}else{if(i=="cooling"){L+=this.buildRow(M.cooling.temperature,this.choices.temperature);L+=this.buildRow(M.cooling.cost,this.choices.cooling.cost);L+=this.buildRow(M.cooling.mass,this.choices.cooling.mass);if(this.choices.cooling.time.value>0){L+=this.buildRow(M.cooling.devtime,this.choices.cooling.time)}L+=this.buildRow(M.cooling.life,this.choices.cooling.life);L+=this.buildRow(M.cooling.risk,this.makeValue(this.choices.cooling.risk*100,"%"))}else{if(i=="site"){if(g(this.data.site[P].latitude,"number")){L+=this.buildRow(M.site.location,this.data.site[P].latitude.toFixed(2)+"&deg;, "+this.data.site[P].longitude.toFixed(2)+"&deg;")}if(this.data.site[P].operator){L+=this.buildRow(M.site.operator,this.phrases.operator[this.data.site[P].operator].label)}L+=this.buildRow(M.site.trajectories,M.site.options[P].trajectories);var H="";for(var D in this.data.site[P].orbits){if(this.data.site[P].orbits[D]){H+=""+M.orbit.options[D].label+"<br />"}}L+=this.buildRow(M.site.orbits,H);if(g(this.data.site[P].risk,"number")){L+=this.buildRow(M.site.risk,(this.data.site[P].risk*100).toFixed(0)+"%")}}else{if(i=="orbit"){if(this.data.orbit[P].altitude){L+=this.buildRow(M.orbit.altitude,this.data.orbit[P].altitude)}if(this.data.orbit[P].period){L+=this.buildRow(M.orbit.period,this.data.orbit[P].period)}if(this.data.orbit[P].obsfrac){L+=this.buildRow(M.orbit.obsfrac,{value:this.data.orbit[P].obsfrac*100,units:"%",dimension:"percent"})}if(this.data.orbit[P].fuellife){L+=this.buildRow(M.orbit.fuellife,this.data.orbit[P].fuellife)}if(this.data.orbit[P].temperature){L+=this.buildRow(M.orbit.temperature,this.data.orbit[P].temperature)}if(this.data.orbit[P].groundcost){L+=this.buildRow(M.orbit.groundcost,this.data.orbit[P].groundcost)}if(this.data.orbit[P].risk){L+=this.buildRow(M.orbit.risk,{value:this.data.orbit[P].risk*100,units:"%",dimension:"percent"})}}}}}}L+='<div class="clearall"></div>';e("#designer_"+i+" .details").html(L).addClass("padded").show();return this};C.prototype.formatScenario=function(i){return""+((g(i.description,"string"))?i.description:"").replace(/%COST%/,this.formatValueSpan(i.budget))+""};C.prototype.updateOptions=function(){e("#options").html("<h3>"+this.phrases.ui.menu.options.label+'</h3><form id="optionform"><ul></ul>');for(var i in this.phrases.ui.options){html='<li><label for="change'+i+'">'+this.phrases.ui.options[i]+'</label> <select id="change'+i+'" name="change'+i+'">';if(i=="currency"){for(var D in this.phrases.ui[i]){html+='<option value="'+D+'"'+(D==this.settings.currency?' selected="selected"':"")+">"+this.phrases.ui.currency[D].label+" "+this.phrases.ui.currency[D].symbol+"</option>"}}else{for(var D in this.phrases.ui.units){if(this.phrases.ui.units[D].dimension==i&&this.phrases.ui.units[D].selectable){html+='<option value="'+D+'"'+(D==this.settings[i]?' selected="selected"':"")+">"+this.phrases.ui.units[D].label+"</option>"}}}html+="</select></li>";e("#options ul").append(html);e("form#optionform #change"+i).on("change",{me:this,o:i},function(E){E.data.me.settings[E.data.o]=e(this).val();E.data.me.updateUnits()})}this.addCloser(e("#options"),{me:this},function(E){E.preventDefault();E.data.me.closeModal(e("#options"))});return this};C.prototype.updateUnits=function(){var G=e(".convertable");var H,J,D,E,I;for(var F=0;F<G.length;F++){H=e(G[F]);D=H.attr("data-value");E=H.attr("data-units");I=H.attr("data-dimension");if(D&&E&&I){H.html(this.formatValue({value:D,units:E,dimension:I}))}}this.updateDropdown("mirror_size");this.updateDropdown("cooling_temperature");return this};C.prototype.updateValue=function(L,K,D){var F;if(g(L,"object")){F=L}else{if(g(L,"string")){F=e("."+L+".value")}}if(F.length>0){if(g(K,"object")){var J={value:parseFloat(F.attr("data-value"),10),units:F.attr("data-units"),dimension:F.attr("data-dimension")};if(D&&J.dimension==K.dimension){var H=this;var I=20;if(!D){D=400}var M=new Date();var G=0;if(K.units!=J.units){K=this.convertValue(K,J.dimension)}function E(){var i=(new Date())-M;if(i>D){F.html(H.formatValue(K)).attr({"data-value":K.value,"data-units":K.units,"data-dimension":K.dimension}).addClass("convertable")}else{F.html(H.formatValue({value:(J.value+(K.value-J.value)*(i/D)),units:J.units,dimension:J.dimension}));requestAnimFrame(E)}}E()}else{F.attr({"data-value":K.value,"data-units":K.units,"data-dimension":K.dimension}).html(this.formatValue(K)).addClass("convertable")}}else{F.html(K)}}return this};C.prototype.formatValueSpan=function(D,i){i=(i)?" "+i:"";return(g(D,"object")?'<span class="value'+i+' convertable" data-value="'+D.value+'" data-units="'+D.units+'" data-dimension="'+D.dimension+'">'+this.formatValue(D)+"</span>":'<span class="value'+i+'">'+D+"</span>")};C.prototype.copyValue=function(i){if(g(i,"object")){return JSON.parse(JSON.stringify(i))}return{}};C.prototype.getValue=function(i){var D=e(i);if(D.length>0){if(D.prop("tagName")=="SELECT"){return D.find(":selected").attr("value")}if(D.prop("tagName")=="INPUT"){return D.val()}}return""};C.prototype.getChoice=function(D){if(D=="mirror.cost"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].cost):this.makeValue(0,"GBP"));v.value=-v.value;if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.cost){v.value*=this.data.deployablemirror.multiplier.cost}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.cost){v.value*=this.data.uvmirror.multiplier.cost}}else{if(D=="mirror.mass"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].mass):this.makeValue(0,"kg"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.mass){v.value*=this.data.deployablemirror.multiplier.mass}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.mass){v.value*=this.data.uvmirror.multiplier.mass}}else{if(D=="mirror.time"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].devtime):this.makeValue(0,"months"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.time){v.value*=this.data.deployablemirror.multiplier.time}if(this.choices.uvmirror&&this.data.uvmirror.multiplier.time){v.value*=this.data.uvmirror.multiplier.time}}else{if(D=="mirror.prob"){v=(this.choices.mirror?this.data.mirror[this.choices.mirror].risk:1);if(this.choices.deployablemirror&&this.data.deployablemirror.risk){v*=this.data.deployablemirror.risk}if(this.choices.uvmirror&&this.data.uvmirror.risk){v*=this.data.uvmirror.risk}}else{if(D=="mirror"){v=(this.choices.mirror)?this.data.mirror[this.choices.mirror].diameter:this.makeValue(0,"m")}else{if(D=="cooling.cost"){v=(this.choices.cooling?this.copyValue(this.choices.cooling.cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(D=="cooling.mass"){v=(this.choices.cooling&&this.choices.cooling.mass?this.copyValue(this.choices.cooling.mass):this.makeValue(0,"kg"))}else{if(D=="cooling.passive.mass"){v=(this.choices.cooling&&this.choices.cooling.passive?this.copyValue(this.choices.cooling.passive):this.makeValue(0,"kg"))}else{if(D=="cooling.active.mass"){v=(this.choices.cooling&&this.choices.cooling.active?this.copyValue(this.choices.cooling.active):this.makeValue(0,"kg"))}else{if(D=="cooling.cryogenic.mass"){v=(this.choices.cooling&&this.choices.cooling.cryogenic?this.copyValue(this.choices.cooling.cryogenic):this.makeValue(0,"kg"))}else{if(D=="cooling.time"){v=(this.choices.cooling?this.copyValue(this.choices.cooling.time):this.makeValue(0,"months"))}else{if(D=="cooling.life"){v=(this.choices.cooling&&this.choices.cooling.life?this.copyValue(this.choices.cooling.life):this.makeValue(99,"years"))}else{if(D=="cooling.prob"){v=1;if(this.choices.cooling&&this.choices.cooling.risk){v=this.choices.cooling.risk}}else{if(D=="satellite.cost"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.cost):this.makeValue(0,"GBP"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.cost){v.value*=this.data.deployablemirror.multiplier.bus.cost}v.value=-v.value}else{if(D=="satellite.mass"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.mass):this.makeValue(0,"kg"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.mass){v.value*=this.data.deployablemirror.multiplier.bus.mass}}else{if(D=="satellite.time"){v=(this.choices.mirror?this.copyValue(this.data.mirror[this.choices.mirror].bus.devtime):this.makeValue(0,"months"));if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.time){v.value*=this.data.deployablemirror.multiplier.bus.time}}else{if(D=="instruments.time"){v=(this.choices.instrument&&this.choices.instrument.time)?this.choices.instrument.time:this.makeValue(0,"months")}else{if(D=="instruments.cost"){v=(this.choices.instrument&&this.choices.instrument.cost)?this.choices.instrument.cost:this.makeValue(0,"GBP");v.value=-v.value}else{if(D=="instruments.mass"){v=(this.choices.instrument&&this.choices.instrument.mass)?this.choices.instrument.mass:this.makeValue(0,"kg")}else{if(D=="instruments.prob"){v=(this.choices.instrument&&this.choices.instrument.risk)?this.choices.instrument.risk:1}else{if(D=="site"){v=(this.choices.site?this.phrases.designer.site.options[this.choices.site].label:"")}else{if(D=="site.prob"){v=0;if(this.choices.site){v=(this.data.site[this.choices.site].risk?this.data.site[this.choices.site].risk:1)}}else{if(D=="vehicle"){v=(this.choices.vehicle?this.phrases.designer.vehicle.options[this.choices.vehicle].label:"")}else{if(D=="vehicle.cost"){v=(this.choices.vehicle?this.copyValue(this.data.vehicle[this.choices.vehicle].cost):this.makeValue(0,"GBP"));v.value=-v.value}else{if(D=="vehicle.prob"){v=0;if(this.choices.vehicle){v=(this.data.vehicle[this.choices.vehicle].risk?this.data.vehicle[this.choices.vehicle].risk:1)}}else{if(D=="ground.cost"){var i=this.choices.mission?this.copyValue(this.data.mission[this.choices.mission].life):this.makeValue(0,"months");if(this.choices.orbit){v=this.copyValue(this.data.orbit[this.choices.orbit].groundcost);v.value*=-this.convertValue(i,"years").value}else{v=this.makeValue(0,"GBP")}}else{if(D=="temperature"){v=(this.choices.temperature)?this.choices.temperature:this.makeValue(400,"K");if(this.choices.orbit){v=this.data.orbit[this.choices.orbit].temperature}}else{if(D=="launch.cost"){v=(this.choices.vehicle?this.copyValue(this.data.vehicle[this.choices.vehicle].cost):this.makeValue(0,"GBP"));v.value*=-(this.choices.orbit?this.data.orbit[this.choices.orbit].multiplier.launchcost:1)}else{if(D=="orbit"){v=(this.choices.orbit)?this.phrases.designer.orbit.options[this.choices.orbit].label:""}else{if(D=="orbit.prob"){v=0;if(this.choices.orbit){v=(this.data.orbit[this.choices.orbit].risk)?this.data.orbit[this.choices.orbit].risk:1}}else{if(D=="mission.time"){v=(this.choices.mission?this.copyValue(this.data.mission[this.choices.mission].life):this.makeValue(0,"months"))}else{if(D=="mission.prob"){v=(this.choices.mission&&this.data.mission[this.choices.mission].risk?this.data.mission[this.choices.mission].risk:1)}else{if(D=="fuel.time"){v=(this.choices.orbit?this.copyValue(this.data.orbit[this.choices.orbit].fuellife):this.makeValue(0,"months"))}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return v};C.prototype.processSummaryList=function(G,F,H){H++;var E='<ul class="summary">';for(var D in G){if(G[D].value||G[D].list){E+="<li>";if(D&&G[D].value){E+='<span class="label '+D+'">'+G[D].label+"</span>"+this.formatValueSpan(G[D].value,F+" "+D)}if(G[D].list){E+=this.processSummaryList(G[D].list,(H==1?F:""))}E+="</li>"}}E+="</ul>";return E};C.prototype.updateSummaryList=function(){for(var E in this.table){var D="";var G=E;if(G.indexOf("_")>0){G=G.substr(0,G.indexOf("_"))}var F=G;if(G!=E){F+=" "+E}var H=0;if(this.table[E].value){this.updateValue("baritem ."+E,this.table[E].value)}var i='<h3><img src="images/cleardot.gif" class="icon '+F+'" /> <span class="label '+F+'">'+this.table[E].label+"</span> "+(this.table[E].value?this.formatValueSpan(this.table[E].value,F):"")+"</h3>";if(this.table[E].list){i+=this.processSummaryList(this.table[E].list,G,H)}e("#summaryext_"+G).addClass("padded").html(i)}return this};C.prototype.updateSummary=function(){this.log("updateSummary");var J="";var O=this.phrases.ui.summary;var H={};var V={};var Q={};var F={};var G={};H.mirror=this.getChoice("mirror.prob");H.site=this.getChoice("site.prob");H.vehicle=this.getChoice("vehicle.prob");H.cooling=this.getChoice("cooling.prob");H.orbit=this.getChoice("orbit.prob");H.instruments=this.getChoice("instruments.prob");H.mission=this.getChoice("mission.prob");H.total=H.orbit*H.site*H.vehicle*H.mirror*H.cooling*H.instruments*H.mission;if(H.total<0.5&&H.total>0){this.warnings.push({text:this.phrases.warnings.risky})}if(H.total==0){this.errors.push({text:this.phrases.errors.impossible})}V.mirror=this.getChoice("mirror.cost");V.satellite=this.getChoice("satellite.cost");V.cooling=this.getChoice("cooling.cost");V.instruments=this.getChoice("instruments.cost");V.dev=this.sumValues(V.mirror,V.satellite,V.cooling,V.instruments);V.vehicle=this.getChoice("vehicle.cost");V.ground=this.getChoice("ground.cost");V.launch=this.getChoice("launch.cost");V.operations=this.sumValues(V.launch,V.ground);V.total=this.sumValues(V.dev,V.operations);V.free=this.sumValues(this.scenario.budget,V.total);if(V.free.value<0){this.errors.push({text:this.phrases.errors.bankrupt})}F.mirror=this.getChoice("mirror.time");F.satellite=this.getChoice("satellite.time");F.instruments=this.getChoice("instruments.time");F.cooling=this.getChoice("cooling.time");F.total=this.sumValues(F.mirror,F.satellite,F.cooling,F.instruments);F.mission=this.getChoice("mission.time");F.lifecooling=this.getChoice("cooling.life");F.fuel=this.getChoice("fuel.time");var K=this.minValue(F.mission,F.lifecooling,F.fuel);K.value*=(this.choices.orbit)?this.data.orbit[this.choices.orbit].obsfrac:0;F.observing=K;var X=this.convertValue(F.fuel,F.mission.units);if(F.mission.value>X.value){this.warnings.push({text:this.phrases.warnings.fuellifetime.replace(/%LIFE%/,this.formatValue(X)).replace(/%DURATION%/,this.formatValue(F.mission)),link:"#designer_orbit"})}var R=this.convertValue(F.lifecooling,F.mission.units);if(F.mission.value>R.value){this.warnings.push({text:this.phrases.warnings.coolinglifetime.replace(/%LIFE%/,this.formatValue(R)).replace(/%DURATION%/,this.formatValue(F.mission)),link:"#designer_orbit"})}if(H.total>0&&F.mission.value==0){this.warnings.push({text:this.phrases.warnings.missionlife,link:"#designer_orbit"})}Q.mirror=this.getChoice("mirror.mass");Q.satellite=this.getChoice("satellite.mass");Q.cooling=this.getChoice("cooling.mass");Q.instruments=this.getChoice("instruments.mass");Q.total=this.sumValues(Q.mirror,Q.satellite,Q.cooling,Q.instruments);if(this.choices.orbit&&this.choices.vehicle){var S=this.convertValue((this.data.orbit[this.choices.orbit].LEO?this.data.vehicle[this.choices.vehicle].mass.LEO:this.data.vehicle[this.choices.vehicle].mass.GTO),Q.total.units);if(Q.total.value>S.value){this.errors.push({text:this.phrases.errors.heavy})}if(Q.total.value<=S.value&&Q.total.value>0.8*S.value){this.warnings.push({text:this.phrases.warnings.heavy})}}this.table.success.value=this.formatPercent(H.total);this.table.success.list.success_orbit.value=this.formatPercent(H.orbit);this.table.success.list.success_site.value=this.formatPercent(H.site);this.table.success.list.success_vehicle.value=this.formatPercent(H.vehicle);this.table.success.list.success_deploy.value=this.formatPercent(H.mirror);this.table.success.list.success_cooling.value=this.formatPercent(H.cooling);this.table.success.list.success_instruments.value=this.formatPercent(H.instruments);this.table.success.list.success_mission.value=this.formatPercent(H.mission);this.updateTable("cost_available","value",V.free);this.updateTable("cost_initial","value",this.scenario.budget);this.updateTable("cost_dev_total","value",V.dev);this.updateTable("cost_dev_satellite","value",V.satellite);this.updateTable("cost_dev_mirror","value",V.mirror);this.updateTable("cost_dev_cooling","value",V.cooling);this.updateTable("cost_dev_instruments","value",V.instruments);this.updateTable("cost_operations_total","value",V.operations);this.updateTable("cost_operations_launch","value",V.launch);this.updateTable("cost_operations_ground","value",V.ground);this.updateTable("cost_total","value",V.total);this.table.cost_available.list.cost_available.value=V.free;this.updateTable("time_dev_total","value",F.total);this.table.time_dev_total.list.time_dev_total.value=F.total;this.updateTable("time_dev_satellite","value",F.satellite);this.updateTable("time_dev_mirror","value",F.mirror);this.updateTable("time_dev_cooling","value",F.cooling);this.updateTable("time_dev_instruments","value",F.instruments);this.updateTable("time_mission","value",F.mission);this.updateTable("time_cooling","value",F.lifecooling);this.updateTable("time_fuel","value",F.fuel);this.updateTable("time_observing","value",F.observing);this.table.mass_total.value=Q.total;this.table.mass_total.list.mass_satellite.value=Q.satellite;this.table.mass_total.list.mass_mirror.value=Q.mirror;this.table.mass_total.list.mass_cooling_total.value=Q.cooling;if(this.settings.mode=="advanced"){this.table.mass_total.list.mass_cooling_total.list.mass_cooling_passive.value=this.getChoice("cooling.passive.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_cryo.value=this.getChoice("cooling.cryogenic.mass");this.table.mass_total.list.mass_cooling_total.list.mass_cooling_active.value=this.getChoice("cooling.active.mass")}this.table.mass_total.list.mass_instruments.value=Q.instruments;var M=0;this.table.science_total.list={};if(this.scenario&&this.scenario.requires&&g(this.scenario.requires,"object")){var E=this.scenario.requires;var K,L,D,I;this.table.science_total.list={};for(var P=0;P<E.length;P++){D=0;if(E[P]["instruments"]){L=false;if(this.choices.instruments){for(var U=0;U<E[P]["instruments"].length;U++){L=false;for(var T=0;T<this.choices.instruments.length;T++){if((this.choices.instruments[T].type==E[P]["instruments"][U].type||this.choices.instruments[T].type=="both")&&this.choices.instruments[T].wavelength==E[P]["instruments"][U].wavelength){L=true}}if(L){D+=100}}}if(E[P]["instruments"].length>0){D/=E[P]["instruments"].length}if(D!=100){this.errors.push({text:E[P].error})}}if(E[P]["mirror"]){I=this.copyValue(E[P]["mirror"]);K=this.convertValue(this.getChoice("mirror"),I.units);if(K.value<I.value){this.errors.push({text:E[P].error})}else{D=100}}if(E[P]["devtime"]){I=this.copyValue(E[P]["devtime"]);K=this.convertValue(this.table.time_dev_total.value,I.units);if(K.value>I.value){this.errors.push({text:E[P].error.replace(/%DEVTIME%/,this.formatValue(K))})}else{D=100}}if(E[P]["vehicle"]){L=false;if(g(E[P]["vehicle"],"object")){for(var U=0;U<E[P]["vehicle"].length;U++){if(this.choices.vehicle==E[P]["vehicle"][U]){L=true}}}else{if(this.choices.vehicle==E[P]["vehicle"]){L=true}}if(!L){this.errors.push({text:E[P].error})}else{D=100}}if(E[P]["site"]){I=(this.choices.vehicle)?this.phrases.designer.vehicle.options[this.choices.vehicle].label:"";if(this.choices.vehicle==E[P]["vehicle"]){this.errors.push({text:E[P].error})}else{D=100}}if(E[P]["observingtime"]){I=this.copyValue(E[P]["observingtime"]);K=this.convertValue(this.table.time_dev_total.list.time_observing.value,I.units);if(K.value<I.value){this.errors.push({text:E[P].error.replace(/%OBSERVINGTIME%/,this.formatValue(K))})}else{D=100}}if(!E[P]["label"]){E[P]["label"]="UNKNOWN"}this.table.science_total.list["target"+P]={label:(K?E[P].label.replace(/%VALUE%/,this.formatValue(I)):E[P].label),value:this.makeValue(D,"%")};M+=D}if(E.length>0){M/=E.length}else{M=100}}this.table.science_total.value=this.makeValue(M,"%");this.table.profile_total.list.profile_site.value=this.getChoice("site");this.table.profile_total.list.profile_vehicle.value=this.getChoice("vehicle");this.table.profile_total.list.profile_instruments.value=(this.choices.instruments)?this.choices.instruments.length:0;this.table.profile_total.list.profile_mirror.value=this.getChoice("mirror");this.table.profile_total.list.profile_temperature.value=this.getChoice("temperature");this.table.profile_total.list.profile_orbit.value=this.getChoice("orbit");var W=new Date();var N=this.convertValue(F.total,"months");W.setUTCMonth(W.getUTCMonth()+N.value);this.launchdate=W.toDateString();this.table.profile_total.list.profile_launch.value=W.toDateString();N=this.convertValue(this.minValue(F.mission,F.fuel,F.lifecooling),"months");W.setUTCMonth(W.getUTCMonth()+N.value);this.table.profile_total.list.profile_end.value=W.toDateString();if(this.choices.orbit&&this.choices.site&&this.choices.vehicle&&this.errors.length==0){this.enableLaunch()}else{this.disableLaunch()}this.updateSummaryList();return this};C.prototype.enableLaunch=function(){this.launchable=true;e(".togglelaunch").show();return this};C.prototype.disableLaunch=function(){this.launchable=false;e(".togglelaunch").hide();return this};C.prototype.test=function(){return this.processFile("---\nMODE	advanced\nSCENARIO	Star Birth & Evolution\nMIRROR	1.0m\nINSTRUMENT	submm;both;SPIRE\nINSTRUMENT	farir;spectrometer;HIFI\nINSTRUMENT	farir;both;PACS\nCOOLING	true\nCOOLINGACTIVE	true\nCOOLINGCRYO	2yr\nVEHICLE	ARI5\nSITE	CSG\nDURATION	7\nORBIT	ES2\n---")};C.prototype.processFile=function(J){if(g(J,"string")){J=J.split(/[\n\r]/)}var F=false;var H,D;var I="";var G=[];for(var E=0;E<J.length;E++){H=J[E].indexOf("---");if(F&&H==0){F=false}if(F){D=J[E].split(/\:\t/);if(D[0]=="MODE"){I=D[1]}else{G.push({key:D[0],value:D[1]})}}if(!F&&H==0){F=true}}if(I){this.setMode(I,function(){function i(){var N="";for(var K=0;K<G.length;K++){if(G[K].key=="SCENARIO"){for(var M=0;M<this.scenarios.length;M++){if(this.scenarios[M].name==G[K].value){N=M}}}}this.chooseScenario(N);function L(){for(var O=0;O<G.length;O++){if(G[O].key=="MIRROR"){e("#mirror_size").val(G[O].value)}if(G[O].key=="DEPLOYABLE"&&G[O].value=="true"){this.changeToggle("toggledeployable","mirror_deployable_yes")}if(G[O].key=="UVQUALITY"&&G[O].value=="true"){this.changeToggle("toggleuv","mirror_uv_yes")}if(G[O].key=="VEHICLE"){e("#vehicle_rocket_"+G[O].value).trigger("click")}if(G[O].key=="SITE"){e("a."+G[O].value).trigger("click")}if(G[O].key=="COOLING"&&G[O].value=="true"){this.changeToggle("hascooling","cooling_yes")}if(G[O].key=="COOLINGACTIVE"&&G[O].value=="true"){this.changeToggle("cooling_active","cooling_active_yes")}if(G[O].key=="COOLINGCRYO"){e("#cooling_cryogenic").val(G[O].value)}if(G[O].key=="COOLINGTEMP"){e("#cooling_temperature").val(G[O].value)}if(G[O].key=="DURATION"){e("#mission_duration").val(G[O].value)}if(G[O].key=="ORBIT"){e("#mission_orbit").val(G[O].value).trigger("change")}if(G[O].key.indexOf("INSTRUMENT")==0){var P=G[O].value.split(/\;/);e("#wavelengths").val(P[0]);e("#instruments").val(P[1]);e("#instrument_name").val(P[2]);e(".add_instrument").trigger("click")}}}this.showView("designer_objectives","",L)}this.showView("scenarios","",i)})}return this};C.prototype.save=function(){if(!g(Blob,"function")){return this}var E="---\n";if(this.settings.mode){E+="MODE:	"+this.settings.mode+"\n"}if(this.scenario.name){E+="SCENARIO:	"+this.scenario.name+"\n"}if(this.choices.mirror){E+="MIRROR:	"+this.choices.mirror+"\n"}if(this.choices.deployablemirror){E+="DEPLOYABLE:	"+(this.choices.deployablemirror?"true":"false")+"\n"}if(this.choices.uvmirror){E+="UVQUALITY:	"+(this.choices.uvmirror?"true":"false")+"\n"}for(var G=0;G<this.choices.instruments.length;G++){E+="INSTRUMENT-"+(G+1)+":	"+this.choices.instruments[G].wavelength+";"+this.choices.instruments[G].type+";"+this.choices.instruments[G].name+"\n"}if(this.choices.cool.passive){E+="COOLING:	"+(this.choices.cool.passive=="yes"?"true":"false")+"\n"}if(this.choices.cool.active=="yes"){E+="COOLINGACTIVE:	"+(this.choices.cool.active=="yes"?"true":"false")+"\n"}if(this.choices.cool.cryogenic){E+="COOLINGCRYO:	"+this.choices.cool.cryogenic+"\n"}if(this.choices.vehicle){E+="VEHICLE:	"+this.choices.vehicle+"\n"}if(this.choices.site){E+="SITE:	"+this.choices.site+"\n"}if(this.choices.mission){E+="DURATION:	"+this.choices.mission+"\n"}if(this.choices.orbit){E+="ORBIT:	"+this.choices.orbit+"\n"}E+="---\n";var H=new Blob([E],{type:"text/plain"});var I="spacetelescope.txt";function F(i){document.body.removeChild(i.target)}var D=document.createElement("a");D.download=I;D.innerHTML="Download File";if(window.webkitURL!=null){D.href=window.webkitURL.createObjectURL(H)}else{D.href=window.URL.createObjectURL(H);D.onclick=F;D.style.display="none";document.body.appendChild(D)}D.click();return this};C.prototype.goForLaunch=function(){this.log("goForLaunch");if(!this.launchable){this.showView("designer");return this}if(this.stage=="launch"){e(".togglelaunch").hide();e("body").addClass("showlaunch");e("#launch").show();var D=this.phrases.designer.orbit.options[this.choices.orbit].label;var F=this.phrases.designer.vehicle.options[this.choices.vehicle].label;var i=this.phrases.designer.site.options[this.choices.site].label;var E=this.formatValue(this.table.time_dev_total.list.time_dev_total.value);e("#launch").html("<h2>"+this.phrases.launch.title+"</h2><p>"+this.phrases.launch.intro.replace(/%DEVTIME%/,E).replace(/%VEHICLE%/,F).replace(/%SITE%/,i).replace(/%ORBIT%/,D).replace(/%LAUNCHDATE%/,this.launchdate)+'</p><div id="launchanimation">'+('<div id="launchpadbg"><img src="images/launchpad_'+this.choices.site+'.png" /></div><div id="launchpadfg"><img src="images/launchpad_'+this.choices.site+'_fg.png" /></div><div id="launchrocket"><img src="'+this.data.vehicle[this.choices.vehicle].img+'" /></div>')+'<div id="countdown" class="padded">Countdown</div></div><div id="launchnav" class="toppadded"></div><ul id="launchtimeline" class="toppadded"></ul>');e("#launchanimation").css({height:(e("#launchanimation").innerWidth()/2)+"px"});this.launchstep=0;if(this.launchstep==0){this.countdown(10)}}};C.prototype.countdown=function(D){this.launchstep=1;var E=this;if(D>0){e("#countdown").html('<div class="tick">'+this.phrases.launch.countdown[D.toFixed(0)]+"</div>");D--;if(!this.outtatime){clearTimeout(this.outtatime)}this.outtatime=setTimeout(function(){E.countdown(D)},1000)}else{e("#countdown").html(""+this.phrases.launch.countdown.liftoff);this.ok=true;this.okcool=true;this.temperature=this.copyValue(this.data.orbit[this.choices.orbit].temperature);this.launch()}};C.prototype.launch=function(){this.launchstep++;e("#launchnav").html('<a href="#" class="button fancybtn">'+this.phrases.launch.next+"</a>");var M={mirror:this.getChoice("mirror.prob"),site:this.getChoice("site.prob"),vehicle:this.getChoice("vehicle.prob"),cooling:this.getChoice("cooling.prob"),orbit:this.getChoice("orbit.prob"),mission:this.getChoice("mission.prob")};var I=this.phrases.launch.status;var O=true;var R=e("#launchtimeline");var T=e("#launchanimation");function K(i){R.prepend(e(i).hide().fadeIn(1000))}if(this.ok){if(this.launchstep==2){this.ok=this.roll(M.site*M.vehicle);K("<li>"+this.buildRow(this.phrases.launch.launch.label,(this.ok?this.phrases.launch.launch.success:this.phrases.launch.launch.fail),"launch_launch")+"</li>");if(this.ok){T.addClass(this.choices.vehicle).addClass("launched");this.exhaust=new z()}}else{this.exhaust.stop()}if(this.launchstep==3){this.ok=this.roll(M.orbit);K("<li>"+this.buildRow(this.phrases.launch.orbit.label,(this.ok?this.phrases.launch.orbit.success:this.phrases.launch.orbit.fail).replace(/%ORBIT%/,this.getChoice("orbit")),"launch_orbit")+'<div id="launchorbit"></div></li>');if(this.ok){T.html("");this.launchanim=new B({id:"launchanimation",height:"50%",orbits:[this.choices.orbit],phrases:this.phrases.designer.orbit,data:this.data.orbit,interactive:false});this.launchanim.resize()}}if(this.launchstep==4){this.ok=this.roll(M.mirror);K("<li>"+this.buildRow(this.phrases.launch.deploy.label,(this.ok?this.phrases.launch.deploy.success:this.phrases.launch.deploy.fail),"launch_mirror")+"</li>");T.html("");this.launchanim=new A({id:"launchanimation",spacetel:this,height:"50%",state:{mirror:this.ok},colourize:{mirror:true,bus:false,cooling:{passive:false,cryogenic:false,active:false}}});this.launchanim.resize()}if(this.launchstep==5){var P=true;var Q=true;var G="";if(this.choices.hascooling){if(this.choices.cool.temperature){var S=this.data.cooling.temperature[e("#cooling_temperature").val()];if(S.temperature){this.temperature=this.copyValue(S.temperature)}if(!S.risk){S.risk=1}P=this.roll(S.risk);G+="<li>"+this.buildRow(this.phrases.launch.cooling.label.label,(P?this.phrases.launch.cooling.label.success:this.phrases.launch.cooling.label.fail),"launch_temperature")+"</li>";this.launchanim.state.cooling={passive:P,active:P,cryogenic:P};this.launchanim.colourize.cooling={passive:true,active:true,cryogenic:true};this.launchanim.build()}if(this.data.cooling.passive){G+="<li>"+this.buildRow(this.phrases.launch.cooling.label.label,"","launch_cooling")+"</li>";p=this.choices.cool.passive;if(p=="yes"){P=this.roll(this.data.cooling.passive[p].risk);Q=P;if(P){this.temperature.value*=this.data.cooling.passive[p].multiplier.temperature}G+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.passive.label,(P?this.phrases.launch.cooling.passive.success:this.phrases.launch.cooling.passive.fail),"launch_passive")+"</li>";this.launchanim.state.cooling.passive=P;this.launchanim.colourize.cooling.passive=true;this.launchanim.build();if(this.data.cooling.active&&Q){p=this.choices.cool.active;if(p=="yes"){P=this.roll(this.data.cooling.active[p].risk);if(P){this.temperature.value*=this.data.cooling.active[p].multiplier.temperature}G+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.active.label,(P?this.phrases.launch.cooling.active.success:this.phrases.launch.cooling.active.fail),"launch_active")+"</li>";this.launchanim.state.cooling.active=P;this.launchanim.colourize.cooling.active=true;this.launchanim.build()}}if(this.data.cooling.cryogenic&&Q){p=this.choices.cool.cryogenic;if(p&&p!="none"){P=this.roll(this.data.cooling.cryogenic[p].risk);if(P){this.temperature.value*=this.data.cooling.cryogenic[p].multiplier.temperature}G+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.cryogenic.label,(P?this.phrases.launch.cooling.cryogenic.success:this.phrases.launch.cooling.cryogenic.fail),"launch_cryogenic")+"</li>";this.launchanim.state.cooling.cryogenic=P;this.launchanim.colourize.cooling.cryogenic=true;this.launchanim.build()}}}}}G+='<li class="indent">'+this.buildRow(this.phrases.launch.cooling.achieved.label,(P?this.phrases.launch.cooling.achieved.success:this.phrases.launch.cooling.achieved.fail).replace(/\%TEMPERATURE%/,this.formatValue(this.temperature)))+"</li>";K(G)}if(this.launchstep==6){var L=0;var G="";if(this.choices.instruments){G+="<li>"+this.buildRow(this.phrases.launch.instruments.label,"")+"</li>";for(var J=0;J<this.choices.instruments.length;J++){var H=this.convertValue(this.data.wavelengths[this.choices.instruments[J].wavelength].temperature,this.temperature.units);O=(H.value>=this.temperature.value)?true:false;this.choices.instruments[J].ok=O;G+='<li class="indent">'+this.buildRow(this.choices.instruments[J].name+" ("+this.phrases.wavelengths[this.choices.instruments[J].wavelength].label+" "+this.phrases.designer.instruments.options.instrument[this.choices.instruments[J].type].label+")",(O?this.phrases.launch.instruments.success:this.phrases.launch.instruments.fail),"launch_instrument")+"</li>"}this.launchanim.colourize.bus=true;this.launchanim.build()}K(G)}if(this.launchstep==7){var L=0;var G="";if(this.choices.instruments){G+="<li>"+this.buildRow(this.phrases.launch.science.label,"")+"</li>";for(var J=0;J<this.choices.instruments.length;J++){if(this.choices.instruments[J].ok){var S=this.copyValue(this.data.instrument.options[this.choices.instruments[J].type]);if(!S.risk){S.risk=1}S.risk*=M.mission;O=this.roll(S.risk);this.log(J,S.risk,O);var N=100;if(!O){N=Math.random()*100}L+=N;tmp=(O?this.phrases.launch.science.success:this.phrases.launch.science.fail).replace(/%PERCENT%/,this.formatValue(this.makeValue(N,"%")));G+='<li class="indent">'+this.buildRow(this.choices.instruments[J].name+" ("+this.phrases.wavelengths[this.choices.instruments[J].wavelength].label+" "+this.phrases.designer.instruments.options.instrument[this.choices.instruments[J].type].label+")",tmp,"launch_science")+"</li>"}}if(this.choices.instruments.length>0){L/=this.choices.instruments.length}}tmp=(this.ok?this.phrases.launch.overall.success:this.phrases.launch.overall.fail).replace(/\%PERCENT%/,this.formatValue(this.makeValue(L,"%")));K(G);K("<li>"+this.buildRow(this.phrases.launch.overall.label,tmp,"finalresult")+"</li>");e(".printable").remove();R.after('<div class="printable toppadded"><a href="#" class="button fancybtn">'+this.phrases.designer.proposal.reprint+"</a></div>").fadeIn();e("#launchnav").html("");this.launchstep=0}}if(!this.ok){e("#launchnav a.button").remove();if(!this.relaunched){var E=this.table.time_dev_total.list.time_dev_total.value;var D=this.copyValue(E);D.value*=0.5;var F=this.sumValues(this.getChoice("mirror.cost"),this.getChoice("satellite.cost"),this.getChoice("cooling.cost"),this.getChoice("instruments.cost"));F.value*=0.5;F=this.sumValues(F,this.getChoice("vehicle.cost"));F.value*=-1;e("#launchnav").html('<div class="relaunch toppadded"><p>'+this.phrases.launch.relaunch.text.replace(/\%DEVTIME\%/,this.formatValue(E)).replace(/%RELAUNCHTIME%/,this.formatValue(D)).replace(/%RELAUNCHCOST%/,this.formatValueSpan(F))+'</p><a href="#" class="button fancybtn">'+this.phrases.launch.relaunch.label+"</a></div>")}else{e(".relaunch").remove()}}return this};C.prototype.relaunch=function(){this.relaunched=true;this.goForLaunch()};C.prototype.roll=function(i){if(!i){i=1}return(Math.random()>i)?false:true};C.prototype.setKey=function(D,i,E,F){for(x in D){if(x==i){D[x][E]=F;return D}else{if(D[x].list){D[x].list=this.setKey(D[x].list,i,E,F)}}}return D};C.prototype.updateTable=function(i,D,E){this.table=this.setKey(this.table,i,D,E);return this};C.prototype.convertValue=function(i,D){if(!g(i,"object")){return i}if(g(i.value,"string")&&i.value!="inf"){i.value=parseFloat(i.value,10)}i=this.copyValue(i);if(i.dimension=="length"){if(i.dimension==this.phrases.ui.units[D].dimension){if(i.units!=D){if(i.units=="ft"){i.value/=3.281}if(i.units=="km"){i.value*=1000}if(i.units=="mile"){i.value*=1609}if(i.units=="cubit"){i.value*=0.4572}if(i.units=="bluewhale"){i.value*=30}if(i.units=="yard"){i.value*=0.9144}if(D=="ft"){i.value*=3.281}if(D=="km"){i.value*=0.001}if(D=="mile"){i.value/=1609}if(D=="cubit"){i.value/=0.4572}if(D=="bluewhale"){i.value/=30}if(D=="yard"){i.value/=0.9144}i.units=D}if(i.units=="m"&&i.value>1000){i.value/=1000;i.units="km"}if(i.units=="ft"&&i.value>5280){i.value/=5280;i.units="mile"}if(i.units=="yard"&&i.value>5280){i.value/=5280;i.units="league"}}}else{if(i.dimension=="mass"){if(i.dimension==this.phrases.ui.units[D].dimension){if(i.units!=D){if(i.units=="lb"){i.value/=2.205}if(i.units=="t"){i.value*=1000}if(i.units=="elephant"){i.value*=5400}if(D=="lb"){i.value*=2.205}if(D=="t"){i.value/=1000}if(D=="elephant"){i.value/=5400}i.units=D}}}else{if(i.dimension=="temperature"){if(i.dimension==this.phrases.ui.units[D].dimension){if(i.units!=D){if(i.units=="C"){i.value+=273}else{if(i.units=="F"){i.value=(5/9)*(i.value-32)+273}}if(D=="C"){i.value-=273}else{if(D=="F"){i.value=(9/5)*(i.value-273)+32}}i.units=D}}}else{if(i.dimension=="time"){if(D=="years"||D=="months"||D=="days"||D=="hours"){if(i.units!=D){if(i.units=="months"){i.value/=12}else{if(i.units=="days"){i.value/=365.25}else{if(i.units=="hours"){i.value/=365.25*24}else{if(i.units=="minutes"){i.value/=365.25*24*60}}}}if(D=="months"){i.value*=12}else{if(D=="days"){i.value*=365.25}else{if(D=="hours"){i.value*=365.25*24}else{if(D=="minutes"){i.value*=365.25*24*60}}}}i.units=D}}}else{if(i.dimension=="angle"){if(D=="degrees"||D=="arcmin"||D=="arcsec"){if(i.units!=D){if(i.units=="arcmin"){i.value/=60}else{if(i.units=="arcsec"){i.value/=3600}}if(D=="arcmin"){i.value*=60}else{if(D=="arcsec"){i.value*=3600}}i.units=D}}}else{if(i.dimension=="currency"){if(this.data.currency[D]){if(i.units!=D){if(i.value!="inf"){if(this.data.currency[i.units].conv){i.value/=this.data.currency[i.units].conv}if(this.data.currency[D].conv){i.value*=this.data.currency[D].conv}}i.units=D}}}}}}}}return i};C.prototype.sumValues=function(){var F=Array.prototype.slice.call(arguments,0);var D,E,G;if(F.length>0){E=this.convertValue(F[0],F[0].units);for(G=1;G<F.length;G++){if(g(F[G],"object")&&F[G].dimension&&F[G].dimension===E.dimension){D=this.convertValue(F[G],F[0].units);E.value+=D.value}}return E}return{}};C.prototype.negativeValue=function(){var F=Array.prototype.slice.call(arguments,0);var D,E,G;if(F.length>0){E=this.copyValue(F[0]);E.value*=-1;return E}return{}};C.prototype.minValue=function(){var E=Array.prototype.slice.call(arguments,0);var D,G,F;if(E.length>0){F=this.convertValue(E[0],E[0].units);for(G=1;G<E.length;G++){if(g(E[G],"object")&&E[G].dimension&&E[G].dimension===E[0].dimension){D=this.convertValue(E[G],E[0].units);if(D.value<F.value){F=D}}}return F}return{}};function c(i){if(i<1e-9){return 1}if(g(i,"number")&&i<1){return Math.ceil(q.log10(1/i))+1}else{return 1}return 1}C.prototype.formatValue=function(E,H){if(g(E,"string")||g(E,"number")){return E}if(!(g(E,"object")&&E.dimension)){return""}ph=this.phrases;E=this.copyValue(E);if(g(H,"string")){H=parseInt(H,10)}if(E.dimension=="length"){E=this.convertValue(E,(this.settings.length)?this.settings.length:"m");if(!g(H,"number")){H=(E.units=="km"?0:c(E.value))}var G=(ph.ui.units[E.units])?ph.ui.units[E.units].unit:"";if(E.value>1000000000000000){return b(E.value,G)}return""+f((E.value).toFixed(H)).replace(/\.0+$/,"").replace(/(\.0?[1-9]+)0+$/,"$1")+""+G}else{if(E.dimension=="mass"){E=this.convertValue(E,(this.settings.mass)?this.settings.mass:"kg");var G=(ph.ui.units[E.units])?ph.ui.units[E.units].unit:"";if(!g(H,"number")){H=(E.value>=1000)?0:c(E.value)}if(E.value>1000000000000000){return b(E.value,G)}else{return""+f((E.value).toFixed(H)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+""+G}}else{if(E.dimension=="currency"){E=this.convertValue(E,(this.settings.currency)?this.settings.currency:"GBP");if(!g(H,"number")){H=0}var i=(ph.ui.million.compact)?ph.ui.million.compact:"";var F=(ph.ui.currency[E.units]&&ph.ui.currency[E.units].symbol)?ph.ui.currency[E.units].symbol:(ph.ui.currency.GBP.symbol?ph.ui.currency.GBP.symbol:"");if(E.value=="inf"||E.value>=1000000000000000){return"&infin;"}var D=(E.value<0)?"-":"";E.value=Math.abs(E.value);if(E.value>=1000){E.value/=1000;i=(ph.ui.billion.compact)?ph.ui.billion.compact:""}if(H==0){if(E.value<100){H=1}if(E.value<10){H=2}}var I=(E.value).toFixed(H).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1").replace(/^ /,"&thinsp;");return D+F+I+i}else{if(E.dimension=="temperature"){E=this.convertValue(E,(this.settings.temperature)?this.settings.temperature:"K");if(g(H,"string")){H=parseInt(H,10)}if(!g(H,"number")){H=(E.value>1000)?0:c(E.value)}var G=(ph.ui.units[E.units])?ph.ui.units[E.units].unit:"";if(g(E.value,"string")){E.value=parseInt(E.value,10)}return""+f((E.value).toFixed(H).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+G}else{if(E.dimension=="time"){if(E.units=="years"&&E.value<5){E=this.convertValue(E,"months")}if(!g(H,"number")){H=(E.value>=6)?0:c(E.value)}var G=(ph.ui.units[E.units])?ph.ui.units[E.units].unit:"";if(g(E.value,"string")){E.value=parseInt(E.value,10)}return""+f((E.value).toFixed(H).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+G}else{if(E.dimension=="percent"){E=E.value;if(!g(E,"number")){E=parseInt(E,10)}if(!g(E,"number")){return"0"+G}if(!g(H,"number")){H=1}var G=(ph.ui.units[E.units])?ph.ui.units[E.units].unit:"%";return""+f(E.toFixed(H)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+G}else{if(E.dimension=="angle"){if(E.units=="degrees"&&E.value<1){E=this.convertValue(E,"arcmin")}if(E.units=="arcmin"&&E.value<1){E=this.convertValue(E,"arcsec")}if(!g(H,"number")){H=(E.value>=10)?0:c(E.value)}var G=(ph.ui.units[E.units])?ph.ui.units[E.units].unit:"";if(g(E.value,"string")){E.value=parseInt(E.value,10)}return""+f((E.value).toFixed(H).replace(/\.0+$/,"").replace(/(\.[1-9])0+$/,"$1"))+""+G}else{return E.value}}}}}}}};C.prototype.makeValue=function(i,D,E){if(!E){if(this.phrases.ui.units[D]){E=this.phrases.ui.units[D].dimension}else{if(this.phrases.ui.currency[D]){E="currency"}else{E="unknown"}}}return{value:i,units:D,dimension:E}};C.prototype.formatPercent=function(i,D){if(!g(i,"number")){i=0}if(!g(D,"number")){D=1}return""+f((i*100).toFixed(D)).replace(/\.0+$/,"").replace(/(\.[1-9]+)0+$/,"$1")+"%"};C.prototype.toggleFullScreen=function(){this.elem=document.getElementById("application");if(r.isFullScreen()){r.cancelFullScreen(this.elem);this.fullscreen=false;e("#application").removeClass("fullscreen")}else{r.requestFullScreen(this.elem);this.fullscreen=true;e("#application").addClass("fullscreen")}return this};C.prototype.parseChoices=function(K,X){K=(K&&K.indexOf("designer_")==0)?K.substr(9):"";this.log("parseChoices",K);var U,S,Z,J,aa,M,I,N,P;var W,O,Y,E,ad;this.errors=[];this.warnings=[];U=e("#mission_duration").val();this.choices.mission=(U&&this.data.mission[U])?U:"";S=e("#mirror_size").val();this.choices.mirror=(S&&this.data.mirror[S])?S:"";Z=e("input[name=toggledeployable]:checked").val();this.choices.deployablemirror=(Z&&Z=="yes")?true:false;J=e("input[name=toggleuv]:checked").val();this.choices.uvmirror=(J&&J=="yes")?true:false;I=e("#designer_vehicle input[name=vehicle_rocket]:checked").val();this.choices.vehicle=(I&&this.data.vehicle[I])?I:"";N=e("#site").val();var L=false;this.choices.site=(N&&this.data.site[N])?N:"";var R=e("#mission_orbit").val();if(R&&this.data.orbit[R]){this.choices.orbit=R}else{this.choices.orbit=""}aa=e("input[name=hascooling]:checked").val();this.choices.hascooling=(aa&&aa=="yes")?true:false;this.choices.cool={};M=e("#cooling_temperature").val();this.choices.cool.temperature=(M)?M:"";this.choices.cool.passive=this.getValue("input[name=cooling_passive]:checked");this.choices.cool.active=this.getValue("input[name=cooling_active]:checked");this.choices.cool.cryogenic=e("#cooling_cryogenic").val();this.choices.temperature=this.makeValue(400,"K");this.choices.instrument={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),temp:this.makeValue(400,"K"),time:this.makeValue(0,"months"),risk:1};if(this.choices.instruments){var D=false;for(var V=0;V<this.choices.instruments.length;V++){var M=this.copyValue(this.data.instrument.options[this.choices.instruments[V].type]);if(!M.multiplier){M.multiplier={}}if(!M.multiplier.cost){M.multiplier.cost=1}if(!M.multiplier.mass){M.multiplier.mass=1}var G=this.copyValue(this.data.wavelengths[this.choices.instruments[V].wavelength]);if(G.cost){G.cost.value*=M.multiplier.cost}this.choices.instrument.cost=this.sumValues(this.choices.instrument.cost,G.cost);if(G.mass){this.choices.instrument.mass=this.sumValues(this.choices.instrument.mass,G.mass)}this.choices.instrument.mass.value*=M.multiplier.mass;this.choices.instrument.temp=this.minValue(this.choices.instrument.temp,G.temperature);if(M.devtime){this.choices.instrument.time=this.sumValues(this.choices.instrument.time,M.devtime)}if(M.risk){this.choices.instrument.risk*=M.risk}if(this.choices.instruments[V].wavelength=="uv"){D=true}}var H=(this.choices.mirror)?this.data.mirror[this.choices.mirror].bus.instrumentslots:0;if(this.choices.instruments.length>H){this.errors.push({text:this.phrases.errors.slots,link:"#designer_instruments"})}if(!this.choices.uvmirror&&D){this.errors.push({text:this.phrases.errors.uv,link:"#designer_satellite"})}}if(this.choices.site){if(this.choices.vehicle){for(var V=0;V<this.data.vehicle[this.choices.vehicle].sites.length;V++){if(this.data.vehicle[this.choices.vehicle].sites[V]==N){L=true}}}else{L=true}if(!L){this.errors.push({text:this.phrases.errors.site.replace(/%SITE%/g,this.phrases.designer.site.options[N].label).replace(/%VEHICLE%/,this.phrases.designer.vehicle.options[I].label),link:"#designer_site"})}}if(this.choices.vehicle&&this.choices.mirror){var F=this.copyValue(this.data.vehicle[this.choices.vehicle].diameter);var T=this.copyValue(this.data.mirror[this.choices.mirror].bus.diameter);if(this.choices.deployablemirror&&this.data.deployablemirror.multiplier.bus.diameter){T.value*=this.data.deployablemirror.multiplier.bus.diameter}if(T.value>F.value){this.errors.push({text:this.phrases.errors.size,link:"#designer_satellite"})}}if(this.choices.orbit){L=false;if(this.choices.site){L=this.data.site[this.choices.site].orbits[R]}else{L=true}if(!L){this.errors.push({text:this.phrases.errors.orbit.replace(/%SITE%/g,this.phrases.designer.site.options[N].label).replace(/%ORBIT%/,this.phrases.designer.orbit.options[R].label),link:"#designer_orbit"})}this.choices.temperature=this.copyValue(this.data.orbit[this.choices.orbit].temperature)}this.choices.cooling={cost:this.makeValue(0,"GBP"),mass:this.makeValue(0,"kg"),life:this.makeValue(99,"years"),time:this.makeValue(0,"months"),risk:1};if(this.choices.hascooling){if(this.choices.cool.temperature){M=this.data.cooling.temperature[e("#cooling_temperature").val()];if(M.temperature){this.choices.temperature=this.copyValue(M.temperature)}if(M.mass){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,M.mass)}if(M.cost){this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,M.cost)}if(M.devtime){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,M.devtime)}if(M.life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,M.life)}if(M.risk){this.choices.cooling.risk*=M.risk}if(this.choices.mirror&&this.data.mirror[S]["passive"]){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.mirror[S]["passive"].mass);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.mirror[S]["passive"].cost);this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.mirror[S]["passive"].devtime)}}if(this.data.cooling.passive){P=this.choices.cool.passive;if(P=="yes"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.passive[P].devtime);if(this.choices.mirror&&this.data.mirror[this.choices.mirror].passive){this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.mirror[this.choices.mirror].passive.mass);this.choices.cooling.passive=this.data.mirror[this.choices.mirror].passive.mass;this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.mirror[this.choices.mirror].passive.cost)}this.choices.cooling.mass.value*=this.data.cooling.passive[P].multiplier.mass;this.choices.cooling.cost.value*=this.data.cooling.passive[P].multiplier.cost;this.choices.cooling.risk*=this.data.cooling.passive[P].risk;this.choices.temperature.value*=this.data.cooling.passive[P].multiplier.temperature;if(this.data.cooling.passive[P].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.passive[P].life)}if(this.choices.orbit){this.choices.cooling.life.value*=this.data.orbit[this.choices.orbit].multiplier.passive.time;if(this.data.orbit[this.choices.orbit].multiplier.cryo.time==0){this.errors.push({text:this.phrases.errors.hotorbitpassive,link:"#designer_orbit"})}}if(this.data.cooling.active){P=this.choices.cool.active;if(P=="yes"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.active[P].devtime);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.cooling.active[P].cost);this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.cooling.active[P].mass);this.choices.cooling.active=this.data.cooling.active[P].mass;this.choices.cooling.risk*=this.data.cooling.active[P].risk;this.choices.temperature.value*=this.data.cooling.active[P].multiplier.temperature;if(this.data.cooling.active[P].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.active[P].life)}}}this.choices.cooling.cryogeniclife=0;if(this.data.cooling.cryogenic){P=this.choices.cool.cryogenic;if(P&&P!="none"){this.choices.cooling.time=this.sumValues(this.choices.cooling.time,this.data.cooling.cryogenic[P].devtime);this.choices.cooling.cost=this.sumValues(this.choices.cooling.cost,this.data.cooling.cryogenic[P].cost);this.choices.cooling.mass=this.sumValues(this.choices.cooling.mass,this.data.cooling.cryogenic[P].mass);this.choices.cooling.cryogenic=this.data.cooling.cryogenic[P].mass;this.choices.cooling.risk*=this.data.cooling.cryogenic[P].risk;this.choices.temperature.value*=this.data.cooling.cryogenic[P].multiplier.temperature;if(this.data.cooling.cryogenic[P].life){this.choices.cooling.life=this.minValue(this.choices.cooling.life,this.data.cooling.cryogenic[P].life);this.choices.cooling.cyrogeniclife=this.convertValue(this.data.cooling.cryogenic[P].life,"years");this.choices.cooling.cyrogeniclife=this.choices.cooling.cyrogeniclife.value}if(this.choices.orbit){this.choices.cooling.life.value*=this.data.orbit[this.choices.orbit].multiplier.cryo.time;var Q=this.data.orbit[this.choices.orbit].multiplier.cryo.time;if(Q==0){this.errors.push({text:this.phrases.errors.hotorbitcryo,link:"#designer_orbit"})}if(Q<1&&Q>0){this.warnings.push({text:this.phrases.warnings.warmorbitcryo,link:"#designer_orbit"})}}}}}else{if(this.data.cooling.active&&this.getValue("input[name=cooling_active]:checked")=="yes"&&P=="no"){this.warnings.push({text:this.phrases.warnings.activenopassive,link:"#designer_cooling"})}if(this.data.cooling.cryogenic&&this.getValue("#cooling_cryogenic")!="none"&&P=="no"){this.warnings.push({text:this.phrases.warnings.cryonopassive,link:"#designer_cooling"})}}}}var ac=this.convertValue(this.choices.instrument.temp,"K");var ab=this.convertValue(this.choices.temperature,"K");if(ab.value>ac.value){this.errors.push({text:this.phrases.errors.temperature.replace(/%TEMPERATURE%/,"<strong>"+this.formatValue(ab)+"</strong>").replace(/%REQUIREMENT%/,"<strong>"+this.formatValue(ac)+"</strong>"),link:"#designer_cooling"})}if(this.proposalCompleteness()<1){this.warnings.push({text:this.phrases.warnings.proposal,link:"#designer_proposal"})}this.updateSummary().updateSidePanels().updateMessages("error",this.errors).updateMessages("warning",this.warnings);return this};C.prototype.updateMessages=function(G,H){this.log("updateMessages",H);if(G!="error"&&G!="warning"){return this}var D="";var E=0;if(H&&typeof H=="object"&&H.length>0){E=H.length;for(var F=0;F<H.length;F++){D+="<li>"+H[F].text+(H[F].link?' <a href="'+H[F].link+'">'+this.phrases.ui[G].link+"</a>":"")+"</li>"}}e("."+G+".value").html(E);e("#messages h3."+G).next().html(D);if(E==0){e(".toggle"+G+",."+G+"s").hide()}else{e(".toggle"+G+",."+G+"s").show()}return this};C.prototype.toggleView=function(i,D){this.log("toggleView",i);if(!e("#"+i).is(":visible")){this.showView(i,D)}else{this.showView(D)}return this};C.prototype.showView=function(i,F,D){this.log("showView",i,F);if(g(i,"object")){F=i;i=""}if(!g(i,"string")){i=""}if(i=="messages"||i=="menu"||i=="language"||i=="options"||i.indexOf("summaryext")==0){if(F&&g(F,"object")&&g(F.preventDefault,"function")){F.preventDefault()}if(i=="options"){if(F){F.preventDefault()}this.updateOptions();e("#summaryext").hide();this.showModal(e("#options"));e("body").addClass("showoptions")}return this}e(".view").hide();e("body").removeClass("showguide showintro showoptions showmessages");if(i.indexOf("designer")==0&&!this.scenario){i="intro"}if((i.indexOf("guide")==0&&i.length==5)||i.indexOf("guide_")==0){e("#summaryext").hide();this.showGuide(i);e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide")}else{if((i.indexOf("designer")==0&&i.length==8)||i.indexOf("designer_")==0){e("#summaryext").hide();if(i.indexOf("designer_")==0){var E=i.substr(i.indexOf("designer_")+9);e("#menubar li").removeClass("on");e("#menubar a.toggle"+E).parent().addClass("on");e(".designer .designer_content").hide();e("#"+i+" .designer_content").show();e("#designer").show();if(e("#"+i).find("a").is(":visible")){e("#"+i).find("a:visible").eq(0).focus()}else{if(e("#"+i).find("input")){e("#"+i).find("input").eq(0).focus()}else{e("#menubar a.toggle"+E).focus()}}if(E=="orbit"){this.makeSpace("orbits").displayOrbits()}else{this.removeOrbits()}if(E=="proposal"){this.updateProposal()}}else{e("#designer").show().find("a").eq(0).focus()}this.updateBodyClass("showdesigner");this.setScroll("#"+i);this.stage="designer"}else{if(i=="intro"){e("#summaryext").hide();e("#intro").show();this.updateBodyClass("showintro");this.stage="intro";this.startup()}else{if(i=="scenarios"){e("#summaryext").hide();e("#scenarios").show();this.updateBodyClass("showscenarios");this.stage="scenarios"}else{if(i=="launch"){e("#summaryext").hide();this.updateMessages("error",{}).updateMessages("warning",{});this.updateBodyClass("showlaunch");this.goForLaunch();this.stage="launch"}else{e("#"+this.stage).show();this.updateBodyClass("show"+this.stage)}}}}}if(this.pushstate&&!F){history.pushState({},"Guide","#"+i)}if(g(D,"function")){D.call(this)}return this};C.prototype.setScroll=function(E){this.log("setScroll",E);var i=e("#bar");var F=(i.is(":visible"))?i.outerHeight():0;var D=0;if(E&&e(E).length==1){D=Math.floor(e(E).offset().top-F);if(D<0){D=0}}e(window).scrollTop(D);return this};C.prototype.toggleGuide=function(i,D){this.log("toggleGuide",i);if(g(i,"object")){D=i;i=""}if(!e("#guide").is(":visible")){if(!i){i="guide"}this.showView(i)}else{this.showView()}return this};C.prototype.closeGuide=function(){this.log("closeGuide");e("body").removeClass("showguide");e("#guide").hide();e("#intro").show();return this};C.prototype.showGuide=function(M){this.log("showGuide",M);var E=M;if(g(M,"string")){var L=M.split("_");if(L.length>1&&this.phrases.guide[L[1]]){M=L[1]}}var H="";var I=this.phrases.guide;var N,J,O,G,D;if(M){e("body").addClass("showguide");e("#guide").show();if(e("#guide").length==0){e("#page").append('<div id="guide" class="view"></div>')}if(M=="guide"){H+="<h2>"+this.phrases.guide.title+"</h2><p>"+this.phrases.guide.about+'</p><ul class="index">';for(k in this.phrases.guide){if(k!="title"&&k!="about"&&g(this.phrases.guide[k].title,"string")){H+='<li><a href="#guide_'+k+'" class="guidelink">'+this.phrases.guide[k].title+"</a><br />"+(g(this.phrases.guide[k].summary,"string")?this.phrases.guide[k].summary:"")+"</li>"}}H+="</ul>"}else{if(I[M]){H+='<div class="guidetop"><span class="breadcrumb"><a href="#guide" class="guidelink">'+I.title+"</a> &raquo; "+I[M].title+"</span></div>";G=I[M].about;if(M=="mirror"){O="";for(x in this.data.mirror){O+="<tr>";O+="<td>"+this.formatValue(this.data.mirror[x].diameter)+"</td>";O+="<td>"+this.formatValue(this.data.mirror[x].mass)+"</td>";O+="<td>"+this.formatValue(this.data.mirror[x].cost)+"</td>";if(this.settings.mode=="advanced"){O+="<td>"+this.formatValue(this.data.mirror[x].devtime)+"</td>"}O+="</tr>"}G=G.replace(/\%MIRRORTABLE\%/,O)}else{if(M=="structure"){O="";for(x in this.data.mirror){O+="<tr>";O+="<td>"+this.formatValue(this.data.mirror[x].diameter)+"</td>";O+="<td>"+this.formatValue(this.data.mirror[x].bus.diameter)+"</td>";O+="<td>"+this.formatValue(this.data.mirror[x].bus.cost)+"</td>";O+="<td>"+this.formatValue(this.data.mirror[x].bus.mass)+"</td>";O+="</tr>"}G=G.replace(/\%STRUCTURETABLE\%/,O)}else{if(M=="cooling"){O="";if(this.settings.mode=="advanced"){for(x in this.data.cooling.cryogenic){if(x!="none"){O+="<tr>";O+="<td>"+this.formatValue(this.data.cooling.cryogenic[x].life)+"</td>";O+="<td>"+this.formatValue(this.data.cooling.cryogenic[x].cost)+"</td>";O+="<td>"+this.formatValue(this.data.cooling.cryogenic[x].mass)+"</td>";O+="</tr>"}}G=G.replace(/\%ACTIVELIFE\%/,this.formatValue(this.data.cooling.active.yes.life));G=G.replace(/\%ACTIVEMASS\%/,this.formatValue(this.data.cooling.active.yes.mass));G=G.replace(/\%ACTIVECOST\%/,this.formatValue(this.data.cooling.active.yes.cost))}else{for(x in this.data.cooling.temperature){O+="<tr>";O+="<td>"+this.formatValue(this.data.cooling.temperature[x].temperature)+"</td>";O+="<td>"+this.formatValue(this.data.cooling.temperature[x].cost)+"</td>";O+="<td>"+this.formatValue(this.data.cooling.temperature[x].mass)+"</td>";O+="</tr>"}}G=G.replace(/\%COOLINGTABLE\%/,O)}else{if(M=="instruments"){O="";for(x in this.data.wavelengths){if(x!="none"){O+="<tr>";O+="<td>"+this.phrases.wavelengths[x].label+"</td>";O+="<td>"+this.formatValue(this.data.wavelengths[x].temperature)+"</td>";O+="</tr>"}}G=G.replace(/\%WAVELENGTHTABLE\%/,O);if(this.settings.mode=="advanced"){O="";for(x in this.data.instrument.options){if(x!="none"){O+="<tr>";O+="<td>"+this.phrases.designer.instruments.options.instrument[x].label+"</td>";O+="<td>"+this.formatValue(this.data.instrument.options[x].multiplier.mass)+"</td>";O+="<td>"+this.formatValue(this.data.instrument.options[x].multiplier.cost)+"</td>";O+="<td>"+this.formatValue(this.data.instrument.options[x].devtime)+"</td>";O+="</tr>"}}G=G.replace(/\%INSTRUMENTTABLE\%/,O)}}else{if(M=="orbit"){O="";for(x in this.data.orbit){O+="<tr>";O+="<td>"+this.phrases.designer.orbit.options[x].label+"</td>";O+="<td>"+(this.phrases.designer.orbit.options[x].altitude?this.phrases.designer.orbit.options[x].altitude:"")+this.formatValue(this.data.orbit[x].altitude,0)+"</td>";O+="<td>"+this.formatValue(this.data.orbit[x].period)+"</td>";O+="<td>"+(this.data.orbit[x].obsfrac*100)+"%</td>";O+="<td>"+this.formatValue(this.data.orbit[x].temperature)+"</td>";O+="</tr>"}G=G.replace("%ORBITTABLE%",O);for(x in this.data.orbit){G=G.replace("%"+x+"ANCHOR%","guide_orbit_"+x);G=G.replace("%"+x+"LABEL%",this.phrases.designer.orbit.options[x].label);G=G.replace("%"+x+"GROUNDCOST%",this.formatValue(this.data.orbit[x].groundcost));G=G.replace("%"+x+"FUELLIFE%",this.formatValue(this.data.orbit[x].fuellife));G=G.replace("%"+x+"ALTITUDE%",this.formatValue(this.data.orbit[x].altitude));G=G.replace("%"+x+"PERIOD%",this.formatValue(this.data.orbit[x].period));G=G.replace("%"+x+"CRYOREDUCTION%",(100*(1-this.data.orbit[x].multiplier.cryo)).toFixed(0)+"%")}}else{if(M=="vehicle"){O="";for(x in this.data.vehicle){O+="<tr>";O+="<td>"+this.phrases.designer.vehicle.options[x].label+"</td>";O+="<td>"+this.formatValue(this.data.vehicle[x].diameter,0)+"</td>";O+="<td>"+this.formatValue(this.data.vehicle[x].mass.LEO,0)+"</td>";O+="<td>"+this.formatValue(this.data.vehicle[x].mass.GTO,0)+"</td>";O+="<td>"+this.formatValue(this.data.vehicle[x].cost,0)+"</td>";O+="<td>"+this.phrases.operator[this.data.vehicle[x].operator].label+"</td>";if(this.settings.mode=="advanced"){O+="<td>"+(this.data.vehicle[x].risk*100)+"%</td>"}O+="</tr>"}G=G.replace(/\%ROCKETTABLE\%/,O)}else{if(M=="site"){O="";for(x in this.data.site){O+="<tr>";O+="<td>"+this.phrases.designer.site.options[x].label+"</td>";O+="<td>"+this.phrases.designer.site.options[x].trajectories+"</td>";O+="<td>";var F="";for(var i in this.data.vehicle){for(var P=0;P<this.data.vehicle[i].sites.length;P++){if(this.data.vehicle[i].sites[P]==x){if(F.length>0){F+=", "}F+=""+this.phrases.designer.vehicle.options[i].label+""}}}O+=F;O+="</td>";O+="</tr>"}G=G.replace(/\%SITETABLE\%/,O)}}}}}}}if(G.indexOf("<p>")<0){G="<p>"+G+"</p>"}H+='<h2 id="guide_'+M+'">'+I[M].title+"</h2>"+G+'<div class="clearall" /></div>';if(M=="roles"){for(k in I[M]){if(k!="title"&&k!="about"&&g(I[M][k].title,"string")){H+="<h3>"+I[M][k].title+"</h3><p>"+I[M][k].about+"</p>"}}}else{if(M=="previous"){for(k in I[M]["missions"]){if(g(I[M]["missions"][k].title,"string")){J="<ul>";for(x in I[M]["missions"][k]){if(x!="title"&&x!="image"){N=this.formatValue(I[M]["missions"][k][x]);J+='<li><span class="key">'+I[M][x]+'</span> <span class="value">'+N+"</span></li>"}}J+="</ul>";H+='<h3 id="guide_'+M+"_"+k+'">'+I[M]["missions"][k].title+"</h3>";if(I[M]["missions"][k]["image"]){H+='<figure class="right"><img src="'+I[M]["missions"][k]["image"].src+'" alt="'+I[M]["missions"][k]["title"]+'" /><figcaption>'+I[M]["missions"][k]["title"]+"</figcaption></figure>"}H+="";H+=J}}}}}}if(I[M]&&I[M].questions){D='<h3 id="guide_'+M+'_questions">Questions</h3><ol>';for(x=0;x<I[M].questions.length;x++){D+="<li>"+I[M].questions[x].label.replace("%EARTHRADIUS%",this.formatValue({value:6500,units:"km",dimension:"length"})).replace("%EARTHMASS%",this.formatValue({value:6e+24,units:"kg",dimension:"mass"}))+"</li>"}D+="</ol>";H+=D}e("#guide").html(H);if(H.indexOf("script")>=0&&g(MathJax,"object")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"guide"])}this.addCloser(e("#guide"),{me:this},function(Q){Q.preventDefault();Q.data.me.toggleGuide()});var K=this;e("#guide").show(function(){K.setScroll("#"+E)});e("#intro").hide()}else{this.closeGuide()}e("#guide").show().find("a").eq(0).focus();this.updateBodyClass("showguide");return this};C.prototype.updateBodyClass=function(i){e("body").removeClass("showguide showintro showoptions showmessages showlaunch").addClass(i);return this};C.prototype.addCloser=function(E,F,D){var i=location.href.split("#")[1];if(E.find(".close").length==0){E.prepend('<a href="#" class="close" title="Close"><img src="images/cleardot.gif" class="icon close" /></a>')}if(E.attr("id")!="guide"&&E.attr("id").indexOf(i)!=0){E.find("a.close").attr("href","#"+i)}E.find("a img.close").parent().on("click",F,D);return this};C.prototype.showModal=function(F){var D=e(window).width();var G=e(window).height();var i=0;var E=0;F.show().find("a").eq(0).focus();this.positionModal(F);this.modal=F;return this};C.prototype.closeModal=function(i){i.hide();e("#modalbg").hide();e("body").css("overflow-y","auto");this.modal=undefined;return this};C.prototype.positionModal=function(i){u(i);e("#modalbg").hide().css({left:0,top:0,height:e(document).height(),width:e(document).width()}).show().off("click").on("click",{me:this},function(D){D.data.me.closeModal(i)});return this};C.prototype.log=function(){var i=Array.prototype.slice.call(arguments,0);if(console&&g(console.log,"function")){console.log("LOG",i)}return this};function A(E){if(!E){E={}}if(E.spacetel){this.s=E.spacetel}else{return this}this.heightscale="";this.prop={mirror:0,bus:0,slots:0};this.id=(g(E.id,"string"))?E.id:"sidebar_satellite";if(!this.el){this.el=e("#"+this.id)}if(this.el.find("#"+this.id+"_schematic").length==0){this.el.html('<div class="schematic" id="'+this.id+'_schematic"></div>')}if(g(E.height,"string")&&E.height.indexOf("%")>0){this.heightscale=parseFloat(E.height)/100}this.state={cooling:{passive:true,active:true,cryogenic:true},mirror:true,bus:true};if(g(E.state,"object")){for(var D in E.state){this.state[D]=E.state[D]}}this.colourize={cooling:{passive:false,active:false,cryogenic:true},mirror:false,bus:true};if(g(E.colourize,"object")){for(var D in E.colourize){this.colourize[D]=E.colourize[D]}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}A.prototype.getScales=function(M,K){var H=Math.floor(M/32);var D=H*(this.prop.bus/this.prop.mirror);var I=8;var E=2;var G=10*D;var N=(this.s.choices.cooling.cryogenic?this.s.choices.cooling.cyrogeniclife:0);if(N==0&&this.s.choices.cool.temperature){var O=this.s.convertValue(this.s.choices.temperature,"K");if(O.value<50){N=Math.log(50/O.value)}}var L=4;var F=((I+L+N)*H);var i=13*H;var J=(this.s.choices.cooling.passive?2*H:0);if(this.s.choices.cool.temperature){var O=this.s.convertValue(this.s.choices.temperature,"K");if(O.value<300){J=2*H}}h=(this.s.choices.mirror)?G+F+i+J+(2*K):0;return{body:F,vgroove:J,bus:G,mirror:i,h:h,fb:D,f:H,top:L,bodyh:I,tank:N,instrument:E}};A.prototype.build=function(){var ac=160;var P=this.el.parent().innerWidth();var ag;var aj=Math.cos(Math.PI*30/180);if(this.s.choices.mirror){for(var X in this.s.data.mirror){ag=this.s.convertValue(this.s.data.mirror[X].diameter,"m");if(X==this.s.choices.mirror){this.prop.mirror=ag.value}}for(var X in this.s.data.mirror){ag=this.s.convertValue(this.s.data.mirror[X].bus.diameter,"m");if(X==this.s.choices.mirror){this.prop.bus=ag.value;if(this.s.choices.deployablemirror&&this.s.data.deployablemirror.multiplier.bus.diameter){this.prop.bus*=this.s.data.deployablemirror.multiplier.bus.diameter}this.prop.slots=this.s.data.mirror[X].bus.instrumentslots}}}var I=16;var ak;if(this.heightscale){ak=this.getScales(200,I);P=(P*this.heightscale)*200/ak.h}ak=this.getScales(P,I);var U=ak.fb;var ae=ak.f;var J=ak.bodyh;var F=ak.tank;var D=ak.top;var E=ak.instrument;ac=(this.s.choices.mirror)?ak.bus+ak.body+ak.mirror+ak.vgroove+(2*I):0;if(this.heightscale){this.create(P,P*this.heightscale)}else{this.create("auto",ac)}if(this.bus){this.bus.remove();delete this.bus}if(this.body){this.body.remove();delete this.body}if(this.vgroove){this.vgroove.remove();delete this.vgroove}if(this.mirror){this.mirror.remove();delete this.mirror}var af={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};var al={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};var K={stroke:"white","stroke-width":1};var Q,ab;var S=this.paper;if(this.s.choices.mirror){this.bus=S.set();this.bus.push(S.ellipse(0,3.5*U,10*U,6*U).attr(af));this.bus.push(S.path("m "+(-8.5*U)+", "+(-2*U)+" l0,"+(4*U)+" l"+(5*U)+","+(3*U)+" l"+(7*U)+",0 l"+(5*U)+","+(-3*U)+" l0,"+(-4*U)+" l"+(-5*U)+","+(-3*U)+" l"+(-7*U)+",0 z").attr(af));this.bus.push(S.path("m "+(-8.5*U)+", "+(2*U)+" l0,"+(3.5*U)+" l"+(5*U)+","+(3*U)+" l0,"+(-3.5*U)+" z").attr(af));this.bus.push(S.path("m "+(-3.5*U)+", "+(5*U)+" l"+(7*U)+",0 l0,"+(3.5*U)+" l"+(-7*U)+",0 z").attr(af));this.bus.push(S.path("m "+(8.5*U)+", "+(2*U)+" l0,"+(3.5*U)+" l"+(-5*U)+","+(3*U)+" l0,"+(-3.5*U)+" z").attr(af))}if(ak.vgroove>0){ab={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.15};if(this.colourize.cooling.passive){ab.fill=(this.state.cooling.passive)?e(".mass").css("color"):"black";ab["fill-opacity"]=0.5}this.vgroove=S.set();this.vgroove.push(S.ellipse(0,-0.6*U,8.5*U,5*U).attr(ab));this.vgroove.push(S.ellipse(0,-1.2*U,8.25*U,4.75*U).attr(ab));this.vgroove.push(S.ellipse(0,-1.8*U,8*U,4.5*U).attr(ab));this.vgroove.push(S.path("m 0,"+(-0.6*U)+" l"+(-5.5*U)+","+(2.5*U)+" m"+(5.5*U)+","+(-2.5*U)+" l"+(1.5*U)+","+(3.5*U)+" m"+(-1.5*U)+","+(-3.5*U)+" l"+(8*U)+","+(-U)+" m"+(-8*U)+","+(U)+" l"+(5*U)+","+(-5*U)+" m"+(-5*U)+","+(5*U)+" l"+(-2*U)+","+(-5.5*U)+" m"+(2*U)+","+(5.5*U)+" l"+(-7*U)+","+(-3*U)).attr({stroke:"white","stroke-width":1,"stroke-opacity":0.4}))}if(this.s.choices.mirror){this.body=S.set();var ad=Math.min(7,8.5*(this.prop.bus/this.prop.mirror));var ai=ad*0.4;var G=(ad-ai);this.body.push(S.ellipse(0,0,ad*ae,G*ae).attr(K));this.body.push(S.path("m "+(-ad*ae)+",0 a "+(ad*ae)+","+(G*ae)+" 0 0,0 "+(2*ad*ae)+",0 l 0,"+(-(J+F-1)*ae)+" q 0,"+(-2*ae)+" "+(-G*ae)+","+(-D*ae)+" l0,"+(-1*ae)+" a"+(ai*ae)+","+(ai*0.5*ae)+" 0 0,0 "+(-2*ai*ae)+",0 l0,"+(1*ae)+" q"+(-G*ae)+","+(1*ae)+" "+(-G*ae)+","+(G*ae)+" z").attr(af));if(F>0){ab={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.cooling.cryogenic){ab.fill=(this.state.cooling.cryogenic)?e(".mass").css("color"):"black";ab["fill-opacity"]=0.8}this.body.push(S.path("m "+(-ad*ae)+",0 a "+(ad*ae)+","+(G*ae)+" 0 0,0 "+(2*ad*ae)+",0 l 0,"+(-F*ae)+" a "+(ad*ae)+","+(G*ae)+" 0 0,0 "+(-2*ad*ae)+",0 z").attr(ab));this.body.push(S.ellipse(0,(-F*ae),ad*ae,G*ae).attr(K))}this.body.push(S.ellipse(0,(-(J+F+D)*ae),ai*ae,ai*0.5*ae).attr(K));var O=Math.ceil(this.prop.slots/2);var M,L,R,ah;var Z=2.2;Z=ad*2/(O+2);var W=Z/2;var T=Z/4;var V=0;var H=(this.s.choices.instruments)?this.s.choices.instruments.length:0;e("#"+this.id+"_schematic .label").remove();var N="";P=this.el.innerWidth();ac=this.el.innerHeight();for(var aa=0;aa<O;aa++){M=(aa-(O-1)/2)*(Z*ae*1.25);for(var Y=0;Y<2;Y++){L=F+1.5+(Y==0?0:E*2);R=0.5+(M+(Y==0?T*ae:0))/P;ah=(I+(ak.bus+ak.vgroove+(L+(Y==0?-E:+E*1.5))*ae))/ac;if(V<H){ab={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.3};if(this.colourize.bus){ab["fill-opacity"]=1;if(this.state.bus){ab.fill=e(".science").css("color")}if(!this.s.choices.instruments[V].ok){ab.fill="black"}}}else{ab={stroke:"white","stroke-width":1,"stroke-dasharray":"- ",fill:"white","fill-opacity":0.2}}this.body.push(S.path("m"+(M-W*ae)+","+(-L*ae)+" l"+(W*ae)+","+(T*ae)+" l"+(W*ae)+","+(-T*ae)+" l0,"+(-E*ae)+" l"+(-W*ae)+","+(-T*ae)+" l"+(-W*ae)+","+(T*ae)+" z m"+(W*ae)+","+(T*ae)+" l0,"+(-E*ae)+" l"+(-W*ae)+","+(-T*ae)+"m"+(W*ae)+","+(T*ae)+"l"+(W*ae)+","+(-T*ae)).attr(ab));if(V<H&&this.s.choices.instruments[V]&&this.s.hastransform){N+='<div class="label '+(Y==0?"bottom":"top")+'" style="bottom:'+(100*ah)+"%; left:"+(100*R)+'%">'+this.s.choices.instruments[V].name+"</div>"}V++}}if(N){e("#"+this.id+"_schematic").prepend(N)}}if(this.s.choices.mirror){ab={stroke:"white","stroke-width":1,fill:"white","fill-opacity":0.5};if(this.colourize.mirror){ab.fill=e(".time").css("color");if(!this.state.mirror){ab.fill="black";ab.stroke="#ff0000"}}this.mirror=S.set();this.mirror.push(S.ellipse(0,-2.5*ae,10*ae,6*ae).attr(ab));this.mirror.push(S.ellipse(0,0,1*ae,0.6*ae).attr(af));this.mirror.push(S.path("m "+(-2*ae)+","+(-11*ae)+" l"+(-3*ae)+","+(6*ae)+" l "+(5*ae)+","+(-7*ae)+" l"+(5*ae)+","+(7*ae)+" l"+(-3*ae)+","+(-6*ae)).attr(K));this.mirror.push(S.path("m "+(-2*ae)+","+(-11*ae)+" l"+(2*ae)+","+(-1*ae)+" l 0,"+(-1*ae)+" l"+(-2*ae)+","+(1*ae)+" z").attr(af));this.mirror.push(S.path("m "+(2*ae)+","+(-11*ae)+" l"+(-2*ae)+","+(-1*ae)+" l 0,"+(-1*ae)+" l"+(2*ae)+","+(1*ae)+" z").attr(af));this.mirror.push(S.path("m "+(-2*ae)+","+(-11*ae)+" l"+(-4*ae)+","+(12*ae)+" l "+(6*ae)+","+(-11*ae)+" l"+(6*ae)+","+(11*ae)+" l"+(-4*ae)+","+(-12*ae)).attr(K));this.mirror.push(S.ellipse(0,(-11*ae),2*ae,1*ae).attr(ab));this.mirror.push(S.path("m "+(-2*ae)+","+(-12*ae)+" l"+(2*ae)+","+(1*ae)+" l 0,"+(1*ae)+" l"+(-2*ae)+","+(-1*ae)+" z").attr(af));this.mirror.push(S.path("m "+(2*ae)+","+(-12*ae)+" l"+(-2*ae)+","+(1*ae)+" l 0,"+(1*ae)+" l"+(2*ae)+","+(-1*ae)+" z").attr(af))}if(this.bus){for(var aa=0;aa<this.bus.length;aa++){w(this.bus[aa],["t",this.width/2,ac-I-ak.bus])}}if(this.vgroove){for(var aa=0;aa<this.vgroove.length;aa++){w(this.vgroove[aa],["t",this.width/2,ac-I-ak.bus])}}if(this.body){for(var aa=0;aa<this.body.length;aa++){w(this.body[aa],["t",this.width/2,ac-I-ak.bus-ak.vgroove])}}if(this.mirror){for(var aa=0;aa<this.mirror.length;aa++){w(this.mirror[aa],["t",this.width/2,ac-I-ak.bus-ak.vgroove-ak.body])}}return this};A.prototype.resize=function(i,D){this.build();return this};A.prototype.create=function(i,E){e("#"+this.id+"_schematic").hide();this.el.css({width:"auto",display:"block"});if(!i||i=="auto"){i=this.el.innerWidth()}var D=this.el.parent();if(i<D.width()/2){i=D.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}if(!E){E=i/2}if(this.heightscale){E=i*this.heightscale}if(i!=this.width||E!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=D.width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=E;if(!this.paper){this.paper=Raphael(this.id+"_schematic",this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}}e("#"+this.id+"_schematic").show();return this};function B(E){this.width=0;this.height=300;this.heightscale="";this.zoom=0;this.scale=[1,0.022];this.anim={};this.orbits={};this.labels={};this.svg={orbits:{}};this.phrases={};this.data={};this.callback;this.spacetel={};this.id="orbits";this.interactive=true;if(!E){E={}}if(g(E.id,"string")){this.id=E.id}if(g(E.zoom,"number")){this.zoom=E.zoom}this.el=e("#"+this.id);if(g(E.phrases,"object")){this.phrases=E.phrases}if(g(E.data,"object")){this.data=E.data}if(g(E.callback,"function")){this.callback=E.callback}if(g(E.interactive,"boolean")){this.interactive=E.interactive}if(g(E.height,"string")&&E.height.indexOf("%")>0){this.heightscale=E.height/100}if(g(E.height,"number")){this.height=E.height}if(E.context){this.spacetel=E.context}this.orbits={GEO:{inclination:0,color:"#048b9f",ellipticity:0.3,zoom:0,z:false,ok:false},SNS:{inclination:-90,color:"#7ac36a",ellipticity:0.4,zoom:0,z:true,ok:false},HEO:{inclination:30,color:"#de1f2a",ellipticity:0.4,zoom:0,z:false,ok:false},LEO:{inclination:-30,color:"#cccccc",ellipticity:0.4,zoom:0,z:true,ok:false},EM2:{inclination:0,color:"#cccccc",ellipticity:1,zoom:1,z:false,ok:false},ES2:{inclination:0,color:"#9467bd",ellipticity:1,zoom:1,z:false,ok:false},ETR:{inclination:0,color:"#fac900",ellipticity:1,zoom:1,z:false,ok:false}};if(!E.orbits){E.orbits=["GEO","SNS","HEO","LEO","EM2","ES2","ETR"]}for(var D=0;D<E.orbits.length;D++){if(this.orbits[E.orbits[D]]){this.orbits[E.orbits[D]].ok=true}}if(E.orbits.length==1){this.zoom=this.orbits[E.orbits[0]].zoom}if(!this.spacetel.convertValue||!g(this.spacetel.convertValue,"function")){this.spacetel.convertValue=function(i){return i}}e(window).on("resize",{me:this},function(i){i.data.me.resize()});return this}B.prototype.resize=function(){if(this.el.length>0){this.el.children().hide()}this.el.css({width:"auto",display:"block"});var i=this.el.innerWidth();if(i<this.el.parent().width()/2){i=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}var D=i/2;if(i!=this.width||D!=this.height||this.width==0){this.width=i;if(this.width==0){this.width=this.el.parent().width()-(parseInt(this.el.css("margin-left"),10)+parseInt(this.el.css("margin-right"),10))}this.height=(this.heightscale)?this.width*this.heightscale:D;if(!this.paper){this.paper=Raphael(this.id,this.width,this.height)}else{this.paper.setSize(this.width,this.height);this.rebuild=true}this.E={x:this.width/2,y:this.height/2,r:this.height/6,radius:6378};this.M={r:5,o:this.E.r*58}}this.displayOrbits();this.el.children().show();return this};B.prototype.removeOrbits=function(){for(var G in this.orbits){if(this.svg.orbits[G]){if(this.svg.orbits[G].dotted){this.svg.orbits[G].dotted.stop().remove()}if(this.svg.orbits[G].solid){this.svg.orbits[G].solid.stop().remove()}if(this.svg.orbits[G].satellite){this.svg.orbits[G].satellite.stop().remove()}delete this.svg.orbits[G]}}var E=["Moon","Moonorbit","Moonlagrangian","Earthorbit"];for(var F=0;F<E.length;F++){if(this[E[F]]){this[E[F]].remove();delete this[E[F]]}}for(var D in this.labels){for(var F in this.labels[D]){if(g(this.labels[D][F].remove,"function")){this.labels[D][F].remove();delete this.labels[D][F]}}delete this.labels[D]}return this};B.prototype.displayOrbits=function(V,E){if(!this.paper){return this}if(this.orbits.HEO){this.orbits.HEO.r=this.E.r*3.3}if(V){this.zoom=this.orbits[V].zoom}if(g(E,"number")){this.zoom=E}function R(Y,Z,W){if(!W||!g(W,"number")){W=0}var i=Y*Math.sin(W*Math.PI/180);var X=Y*Math.cos(W*Math.PI/180);if(Math.abs(W)>80){i+=Y;X+=Y*Z}return" m "+(0-X)+" "+(0-i)+" a "+(Y)+","+(Z*Y)+" "+W+" 1,1 0,0.01"}function H(i){if(i){i.hide()}}function T(i){if(i){i.show()}}if(this.rebuild){this.removeOrbits();this.rebuild=false}if(this.interactive){if(e("#"+this.id+" .zoomer").length==0){e("#"+this.id).prepend('<a href="#" class="zoomer button">-</a>');e("#"+this.id+" .zoomer").on("click",{me:this},function(i){i.preventDefault();i.data.me.displayOrbits("",(i.data.me.zoom==0?1:0));e(this).html(i.data.me.zoom==0?"&minus;":"&plus;").attr("title",(i.data.me.zoom==0?i.data.me.phrases.zoomout:i.data.me.phrases.zoomin))})}}if(this.Earth){this.Earth.remove()}if(this.zoom==0){this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m -6.927379,42.861897 c -10.79338,-1.89118 -21.17473,-8.25868 -27.52258,-16.87977 -15.02038,-20.3975403 -9.63593,-48.89125 11.79388,-62.41291 16.94554,-10.68989 39.20392,-8.16663 53.44137,6.06404 5.87268,5.86844 9.54913,12.35889 11.55616,20.4047297 1.16835,4.68267 1.47335,12.35457 0.67442,16.96248 -3.048,17.5816003 -15.4426,30.9321203 -32.72769,35.2509203 -4.33566,1.08222 -12.80575,1.3828 -17.21554,0.61124 z m 11.33951,-4.82289 c 6.979,-0.79891 13.53188,-3.42643 19.13933,-7.67694 1.15933,-0.87801 1.54372,-1.39287 1.55148,-2.07816 0.0111,-1.02039 1.44195,-5.01704 2.21985,-6.20209 0.27849,-0.42427 1.14761,-1.04771 1.93147,-1.3828 1.16726,-0.50337 1.55149,-0.90389 2.12308,-2.23204 0.96595,-2.24427 1.24242,-3.45664 0.78812,-3.45664 -0.20378,0 -0.37027,-0.35953 -0.37027,-0.78883 0,-0.79173 1.79473,-2.69441 4.39774,-4.66182 0.67305,-0.50337 1.30726,-1.14263 1.40925,-1.40725 0.839,-2.1845903 0.99945,-12.8320603 0.19322,-12.8320603 -0.51768,0 -0.70521,2.11843004 -0.37077,4.19083 0.41376,2.56281 0.0979,4.2843 -0.80975,4.4166 -1.268,0.18698 -2.13725,-1.28571 -2.84295,-4.81066 -1.04641,-5.22558 -1.1243,-5.32626 -4.56601,-5.9267 -1.02684,-0.17978 -1.08581,-0.13664 -1.08581,0.81689 0,2.22772 -2.80355,5.66709 -5.01389,6.15248 -1.66562,0.36674 -2.62557,-0.58246 -4.17367,-4.1182 -0.735,-1.67907 -1.59947,-3.31138 -1.92103,-3.62778 -0.55377,-0.5465 -0.58461,-0.53932 -0.58461,0.12942 0,1.72221 2.25458,7.61438 3.13524,8.1954 0.20501,0.13663 1.09432,0.2445 1.97628,0.25168 2.19326,0.006 3.57706,0.7572 3.56758,1.9329 -0.013,1.61147 -1.23802,3.68026 -3.44872,5.8238503 -2.98531,2.89432 -3.55713,3.9449 -3.55867,6.5372 -0.001,2.03428 0.0252,2.10116 0.75047,1.87393 0.41348,-0.12941 1.04826,-0.43864 1.4107,-0.68312 0.98159,-0.67594 2.09973,-0.56808 2.35382,0.2373 0.2447,0.77084 -1.60253,3.96287 -3.39818,5.87203 -0.87967,0.93553 -1.18294,1.07144 -1.83751,0.82552 -0.6725,-0.25169 -0.7809,-0.51776 -0.76252,-1.84374 0.013,-0.95351 -0.11516,-1.50505 -0.33409,-1.43314 -0.34616,0.10794 -0.65537,0.55369 -2.65289,3.74859 -1.17673,1.884 -3.79425,3.67597 -6.07803,4.16206 -1.86971,0.3955 -3.48492,0 -3.48492,-0.7953 0,-0.26607 -0.43326,-1.29723 -0.96281,-2.30323 -1.69574,-3.22007 -1.84288,-3.99595 -1.37585,-7.24909 0.47848,-3.33582 0.19975,-4.72582 -1.21076997,-6.04247 -1.23809,-1.15484 -1.87063003,-2.53763 -1.64033003,-3.58606 0.18366003,-0.8355803 0.0857,-0.9340903 -1.34377,-1.3540303 -1.63056,-0.4818 -5.15549,-0.33078 -7.61198,0.33796 -1.09992,0.30202 -1.50461,0.23729 -2.83756,-0.42426 -2.86801,-1.42451 -4.32003,-4.81858 -3.89918,-9.11581996 0.39299,-4.01250004 0.54491,-4.51441004 1.80953,-5.97273004 0.68343,-0.78955 1.4365,-1.90268 1.67352,-2.47365 0.39117,-0.94344 1.89274,-1.9479897 3.70135,-2.4779597 0.29382,-0.0863 0.93542,-0.95925 0.19912,-1.19654 -2.63115,0.61121 -3.4916,-1.84374 -1.69974,-3.63426 0.98587,-0.98515 1.35751,-1.14982 2.33866,-1.03549 1.08194,0.12941 1.16649,0.0791 1.16649,-0.77733 0,-0.49616 0.15034,-1.00814 0.33409,-1.12032 0.18367,-0.11497 1.44636,-0.95208 1.44636,-1.06713 0,-0.36673 -4.64238,1.86027 -2.8525,-0.67594 -0.26146,0.41707 -0.65956,0.19416 -1.1224,-0.26605 -0.87213,-0.87083 0.29445,-1.80204 1.00761,-1.97534 0.45202,-0.006 0.96756,1.28718 1.31068,0.58247 -0.82013,-1.1455 -0.62158,-2.63904 -0.28282,-2.70519 1.2859,-0.53932 1.49537,0.78523 1.49537,1.81137 0,0.39548 0.2255,0.91683 0.50112,1.14478 0.27563,0.2373 0.50113,0.79099 0.50113,1.25048 0,0.76151 0.0941,0.81689 1.06974,0.62562 1.49278,-0.30203 2.53575,-1.36699 2.47682,-2.53838 2.67534003,-1.78908 -0.15886,-1.06713 -0.29398,-1.20302 -0.63709,-0.63281 -0.13885,-1.83798 1.40482003,-3.38761 2.14169997,-2.15005 3.38975997,-2.7095 6.99786997,-3.13593 2.72694,-0.32359 3.09543,-0.29482 4.55125,0.35235 1.4815,0.64719 1.57109,0.76511 1.3838,1.70136 l -0.20026,0.99953 1.80809,-0.9643 c 0.99444,-0.53212 2.56916,-1.15844 3.49938,-1.39646 0.93019,-0.2373 1.69128,-0.56808 1.69128,-0.72556 0,-0.3811 -4.20122,-2.31041 -6.97024,-3.21358 -5.23627,-1.70998 -13.51182,-2.25217 -18.83832,-1.23323 -4.60384,0.87944 -12.69228,4.14912 -13.13855,5.31187 -0.0896,0.2373 0.0676,0.97293 0.34883,1.64671 0.63899,1.52734 0.65767,3.66589 0.0424,4.84878 -0.61531,1.18145 -5.09802,5.49956 -6.37985,6.14601 -0.55124,0.27325 -2.28017,0.92043 -3.84205,1.42882 -4.30776,1.40509 -4.48483,1.5338 -5.46145,3.96935 -1.64357,4.1023697 -2.26852,7.1311597 -2.45187,11.88357974 l -0.17385,4.50720996 2.56104,2.13282 c 1.40855,1.17211 3.47725,3.15461 4.59709,4.4043803 1.51998,1.6956 2.48972,2.45639 3.82568,2.99714 1.96471,0.79675 3.45111,2.28165 3.45111,3.4473 0,0.40987 -0.24263,1.46045 -0.53917,2.3291 -0.49906,1.46407 -0.49746,1.69129 0.0209,3.04604 0.6264,1.6388 0.35646,2.62899 -0.81789,3.00146 -0.81891,0.26607 -0.85988,1.23396 -0.10053,2.39168 0.31237,0.4746 0.65063,1.48204 0.7517,2.23635 0.17385,1.29723 0.34977,1.48131 3.26152,3.42284 7.40928,4.93795 16.4231,7.13547 25.16577,6.13379 z m 8.48287,-49.9181103 c 0.68449,-0.6759197 0.66479,-1.1239097 -0.0596,-1.3360497 -0.3215,-0.10072 -2.2514,-1.55826 -2.92906,-1.89694 -1.01081,-0.49617 6.7196,-1.01966 1.45075,-3.16972 -5.26885,-2.15079 -2.56176,4.83655 -3.32655,3.88017 -0.65552,-0.8327 -2.0022,-1.01104 -2.5835,-0.48178 -1.15634,-1.28069 -2.98745,-3.84351 -3.70189,-3.89241 -1.03907997,-0.0718 1.16978,2.32983 -0.27577,2.81665 -1.44553997,0.48898 -2.20706997,-2.826 -4.09265,-2.61817 -2.10817,0.2373 -4.38327,-0.72484 -5.18683,3.39191 -0.004,0.52493 3.06135,0.16533 4.50771,0 2.32603003,-0.3092 3.10989003,0 5.24841,1.91132 l 1.88004,1.7013597 3.25884,-0.2373 c 2.19723,-0.1583 3.33099,-0.11497 3.48033,0.1222 0.3297,0.53212 1.72994,0.42425 2.32983,-0.16534 z M 4.909541,-24.277303 c 0.94202,-0.43865 1.16153,-0.7191 1.01819,-1.2505 -0.10053,-0.38112 -0.18477,-0.86794 -0.18732,-1.09733 0.15107,-1.64957 -0.72375,-1.29793 -1.57539,-0.0718 -0.77094,1.13326 -4.82187997,5.26872 -0.61209,2.96477 0.0752,-0.0718 0.69614,-0.25886 1.35664,-0.56807 z m 20.69451,-1.74667 c 0.2363,-0.38111 -1.04497,-1.12824 -1.47795,-0.86075 -0.16792,0.10072 -0.95404,-0.15107 -1.74709,-0.56808 -1.95859,-1.02828 -6.42112,-0.95134 -5.77085,0.10072 0.10572,0.17256 1.42366,0.3164 2.92877,0.3164 2.03716,8.3e-4 3.03539,0.16533 3.90586,0.6328 1.36846,0.73274 1.8913,0.82694 2.16126,0.3883 z")}else{this.Earth=this.paper.path("M "+(this.E.x)+" "+(this.E.y)+" m 0 -43.6 c,-19.195,-0.359,-37.44,13.34,-41.865,32.015 c,-4.561096,17.1667748,2.72917,37.246587,17.656538,46.977656 c,13.373687,9.285707,32.0526208,9.996435,45.992018,1.508414 c,5.957424,-3.319826,11.075156,-8.039317,14.543607,-13.935126 c,10.546018,-15.6499112,8.720274,-38.18332,-4.018314,-52.068038 c,-8.07768,-9.096389,-20.115729,-14.609639,-32.30837958,-14.498209 z m,0.09375,5.375 c,12.57022058,-0.128555,24.94591858,6.5994,31.74999958,17.15625 c,-0.94917,5.002919,-6.086293,1.530374,-3.041063,-1.619594 c,-1.457671,-0.526126,-4.932858,2.878261,-6.847657,-0.603915 c,-3.184453,-1.308637,-6.3599,1.691261,-5.15979,4.188482 c,-3.782846,2.664376,-6.163477,-4.184848,-10.1526402,-1.250482 c,0.930713,-0.712397,6.3522672,-6.132291,1.9485113,-5.743768 c,-2.1471153,3.268504,-5.9001547,5.6116,-9.7549386,6.742359 c,-3.0333281,1.666497,3.4871809,3.919715,5.0848899,3.874212 c,4.4525294,2.286084,8.5800896,7.1007845,6.1927696,12.1877615 c,1.90772,3.21337796,3.996962,6.758283,2.957496,10.7455353 c,-1.088944,1.5975017,-1.993627,6.6457482,-3.8098779,5.9629142 c,0.09411,-5.5523502,-5.8551147,1.424572,-5.9032977,3.921686 c,-0.233555,1.607328,-2.089538,4.666463,0.316221,3.452139 c,1.5791784,3.031545,4.0433554,1.23024,2.5706854,-1.432668 c,-0.755832,-2.214988,1.071785,-4.450478,1.431817,-0.910521 c,3.4227102,1.986574,-2.079278,8.026424,-3.441317,4.221977 c,-0.05038,3.190668,-5.9116094,4.835384,-6.2547064,5.746188 c,2.90918203,2.904457,-1.551746,2.079951,-3.228894,2.254064 c,-1.300676,5.220523,5.49423002,3.315504,6.569102,-0.06951 c,2.572843,-3.120142,7.9417807,2.476723,8.2176023,0.158591 c,-5.1570029,-2.906592,4.3679773,1.498193,3.7328613,-0.172704 c,0.355589,-3.393695,5.711734,0.663429,6.832822,-2.635732 c,2.782198,1.056601,-3.254675,4.26505,-4.941003,4.473991 c,-2.714088,0.573027,-2.35272,4.236763,-5.7564619,2.583428 c,-3.9108453,-2.119881,-7.9960437,-0.807618,-12.0653907,-0.15703 c,-4.931145,2.236895,-10.2173174,1.74978,-14.8366384,-1.385684 c,-10.813803,-5.566552,-18.524599,-16.654538,-20.004852,-28.7192222 c,2.732778,2.989211,6.598056,4.7293091,8.998081,8.3559682 c,1.599527,0.730324,3.945675,3.523961,4.82994,3.171984 c,1.833841,-2.480098,4.151057,-5.772095,2.790203,-8.5464922 c,3.363681,-2.474446,-0.289772,-5.5676083,-3.153322,-3.525176 c,-4.391341,0.818177,-0.191169,-4.9463963,1.391046,-6.2324653 c,2.857681,-0.460706,3.513174,2.41500097,3.980956,3.732494 c,3.316523,-0.0353,0.834669,-3.882306,4.374542,-4.092336 c,0.130908,-1.411563,-3.481833,-2.709873,-0.211945,-1.771103 c,4.26026,-1.249006,1.634257,-4.365219,-0.493731,-3.1780419 c,2.763194,-2.1547021,4.181646,-7.6700956,8.5041634,-6.4331296 c,2.24906,-0.416067,2.612667,-2.860803,1.014942,-3.538046 c,2.719085,-1.835258,-1.409228,-1.787455,-0.10076,-4.29649 c,-1.830306,-0.309672,-4.304873,-0.973664,-2.132519,-3.101562 c,-3.3845944,2.57314,-3.5487544,7.860395,-8.9615664,7.398945 c,-4.539774,1.777416,-8.333796,-1.761858,-12.015717,-2.70409 c,-1.477835,0.696073,-6.487149,4.76626,-4.024621,0.665479 c,6.584664,-11.488859,19.533888,-19.038283,32.80405842,-18.874686 z m,-33.65625042,21.59375 c,-0.631472,0.607654,-1.285523,0.774007,0,0 z m,25.0312504,13.8749985 c,-1.378264,1.634778,-4.7210584,3.734578,-0.438841,3.849626 c,2.052676,0.491366,5.022044,2.343429,3.253406,-0.95631404 c,-0.419504,-1.86979296,-2.20923,-1.09186896,-2.814565,-2.89331196 z m,-4.0625014,1.78125 c,-4.153103,-0.46570203,-2.208863,6.0465023,-6.129842,6.4757613 c,-0.605185,2.103009,2.300217,1.325155,3.030352,1.204245 c,1.416321,-2.463228,3.738442,-4.4874303,3.09949,-7.6800063 z m,3.5312514,3.03125 c,0.05302,4.2453083,-2.3776964,7.126859,-5.9261904,8.5371375 c,-2.819523,3.208873,0.326358,5.688926,2.91859,2.404436 c,3.6624634,0.820099,7.4597394,0.468648,8.5987314,-3.8347225 c,3.98761402,-4.1394317,-1.837631,-7.108603,-5.591131,-7.106851 z m,2.65625,13.8750015 c,-4.0821284,2.583778,5.79884807,0.948002,0,0 z m,29.9999996,1 c,-0.310613,2.698258,7.000211,1.533177,2.616976,4.524626 c,-1.843124,0.0678,-6.305665,-2.59259,-2.616976,-4.524626 z m,-25.0937496,4.625 c,-2.608331,0.710104,1.04075402,4.160157,-0.444775,4.552104 c,-1.433649,1.942609,4.729631,-0.163724,1.34758302,-1.892931 c,-0.672,-1.046,-1.062,-1.697,-0.903,-2.659 z m,32.4999996,0.34375 c,-0.01479,2.705677,-5.791353,2.714607,-1.548038,0.956689 l,0.803335,-0.425532 z m,-12.78125,0.375 c,0.523617,1.617196,4.358842,0.626771,1.387,2.500788 c,-1.249506,2.929193,-6.666484,3.760447,-3.932662,-0.407517 c,1.533416,0.532153,2.258563,-0.753125,2.545662,-2.093271 z m,-21.9374996,1.15625 c,-3.15159,1.823608,0.365256,3.975785,0.815462,0.936364 c,-0.0466,-0.434703,-0.359015,-0.867276,-0.815462,-0.936364 z m,26.4374996,6.90625 c,-1.920358,1.510414,-1.942756,0.166742,0,0 z")}this.Earth.attr({stroke:0,fill:"#69DFFF",opacity:0.8});var I,G,K,S,P,Q;var M=this;function D(W){if(!W){return null}if(!W.cx){W.cx=0}if(!W.cy){W.cy=0}if(!W.e){W.e=1}if(!W.i){W.i=0}if(!W.r){W.r=1}if(!W.z){W.z=false}if(!W.color){W.color="#999999"}if(!W.stroke){W.stroke={}}if(!W.stroke.on){W.stroke.on=2.5}if(!W.stroke.off){W.stroke.off=1.5}if(!W.stroke.selected){W.stroke.selected=2.5}var Y={inp:W};if(W.key=="ES2"){Y.dotted=M.paper.path("M "+(W.cx-W.r)+",0 q "+(W.r*2)+","+(M.height/2)+" 0,"+(M.height));Y.solid=M.paper.path("M "+(W.cx-W.r)+",0 q "+(W.r*2)+","+(M.height/2)+" 0,"+(M.height))}else{if(W.e==1){Y.dotted=M.paper.circle(W.cx,W.cy,W.r);Y.solid=M.paper.circle(W.cx,W.cy,W.r)}else{var X="m "+W.cx+","+W.cy+" "+R(W.r,W.e,W.i);Y.dotted=M.paper.path(X);Y.solid=M.paper.path(X)}}if(W.period){Y.satellite=M.paper.circle(W.cx,W.cy,4).attr({fill:W.color,stroke:0});if(W.key!="ES2"){Y.anim=Y.satellite.animateAlong((W.orbit?W.orbit:Y.dotted),W.period,Infinity,W.orbitdir,W.z)}}Y.dotted.attr({stroke:W.color,"stroke-dasharray":"-","stroke-width":W.stroke.off});Y.solid.attr({stroke:W.color,opacity:0.1,"stroke-width":8});if(g(M.callback,"function")){var i=function(){e("#"+this.id).css("cursor","pointer");this.dotted.attr({"stroke-width":(this.selected?W.stroke.selected:W.stroke.on)})};var Z=function(){e("#"+this.id).css("cursor","default");this.dotted.attr({"stroke-width":(this.selected?W.stroke.selected:W.stroke.off)})};Y.solid.hover(i,Z,Y,Y);Y.satellite.hover(i,Z,Y,Y);Y.solid.click(function(){M.callback.call((M.spacetel?M.spacetel:this),W.key)},Y,Y);Y.satellite.click(function(){M.callback.call((M.spacetel?M.spacetel:this),W.key)},Y,Y)}Y.zoom=M.zoom+0;Y.hide=function(){H(Y.dotted);H(Y.solid);H(Y.satellite)};Y.show=function(){T(Y.dotted);T(Y.solid);T(Y.satellite)};return Y}if(!this.E||!this.M||!this.scale){return this}if(this.zoom==0){for(var L in this.data){if(this.orbits[L]&&this.orbits[L].ok&&this.orbits[L].zoom==this.zoom&&!this.svg.orbits[L]){if(L=="HEO"){I=-this.E.r*1.2;G=-this.E.r*0.35}else{I=0;G=0}if(!this.orbits[L].r){this.orbits[L].r=this.E.r*(1+this.data[L].altitude.value/this.E.radius)}Q=this.spacetel.convertValue(this.data[L].period,"hours");this.svg.orbits[L]=D({key:L,period:Q.value*3*1000,r:this.orbits[L].r,cx:(this.E.x+I),cy:(this.E.y+G),color:this.orbits[L].color,e:this.orbits[L].ellipticity,i:this.orbits[L].inclination,z:this.orbits[L].z})}}}else{if(this.zoom==1){if(!this.Moonorbit){this.Moonorbit=this.paper.path("M "+this.E.x+","+this.E.y+" "+R(this.M.o*this.scale[1],1)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.Moon=this.paper.circle(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6),this.E.y-this.M.o*this.scale[1]*Math.sin(Math.PI/6),this.M.r).attr({fill:"#606060",stroke:0});var K=9;if(!this.svg.orbits.ETR&&this.data.ETR&&this.orbits.ETR.ok){Q=this.spacetel.convertValue(this.data.ETR.period,"days");this.Earthorbit=this.paper.path("M "+(this.E.x-K)+",0 q "+(K*2)+","+(this.height/2)+" 0,"+(this.height)).attr({stroke:"#606060","stroke-dasharray":"-","stroke-width":1.5});this.svg.orbits.ETR=D({key:"ETR",period:Q.value*1000,r:1,cx:(this.E.x-K*0.78),cy:(this.E.y+2.1*this.M.o*this.scale[1]),color:this.orbits.ETR.color})}if(!this.svg.orbits.EM2&&this.data.EM2&&this.orbits.EM2.ok){this.Moonlagrangian=this.paper.path("M "+this.E.x+","+this.E.y+" "+R(this.M.o*this.scale[1]*440000/380000,1)).attr({stroke:"#000000","stroke-dasharray":"-","stroke-width":0.5,opacity:0.01});Q=this.spacetel.convertValue(this.data.EM2.period,"days");this.Moon.animateAlong(this.Moonorbit,Q.value*1000,Infinity,-1);this.svg.orbits.EM2=D({key:"EM2",period:Q.value*1000,orbit:this.Moonlagrangian,orbitdir:-1,r:this.M.o*((440000/380000)-1)*this.scale[1],cx:(this.E.x-this.M.o*this.scale[1]*Math.cos(Math.PI/6)),cy:(this.M.o*this.scale[1]*Math.sin(Math.PI/6)),color:this.orbits.EM2.color,e:1,i:0});this.svg.orbits.EM2.dotted.animateAlong(this.Moonorbit,Q.value*1000,Infinity,-1);this.svg.orbits.EM2.solid.animateAlong(this.Moonorbit,Q.value*1000,Infinity,-1)}if(!this.svg.orbits.ES2&&this.data.ES2&&this.orbits.ES2.ok){Q=this.spacetel.convertValue(this.data.ES2.period,"days");this.svg.orbits.ES2=D({key:"ES2",period:Q.value*1000,r:9,cx:(this.E.x+4*this.M.o*this.scale[1]),cy:this.E.y,color:this.orbits.ES2.color})}var N=this.M.o*this.scale[1];var J=0.3;var F=parseInt(this.el.css("font-size"));if(!this.labels){this.labels={}}if(!this.labels.sun){this.labels.sun={zoom:1,arrow:this.paper.path("M "+(this.E.x-4*N)+","+this.E.y+" l "+(J*N)+",-"+(J*0.3*N)+" q "+(-J*0.3*N)+","+(J*0.3*N)+" 0,"+(J*0.6*N)+" z M "+(this.E.x-4*N+J*0.85*N)+","+(this.E.y-J*0.05*N)+" l "+(J*N*1.5)+","+(-J*0.05*N)+" l 0,"+(J*0.2*N)+" l "+(-J*N*1.5)+","+(-J*0.05*N)+" z").attr({fill:"#fac900",stroke:0}),label:this.paper.text((this.E.x-4*N+2.5*J*N),(this.E.y),this.phrases.diagram.sun).attr({fill:"#fac900",stroke:0,"text-anchor":"start","font-size":F})}}if(!this.labels.earthorbit&&this.data.ETR&&this.orbits.ETR.ok){this.labels.earthorbit={zoom:1,arrow:this.paper.path("M "+(this.E.x)+","+(this.E.y-2.1*N)+" l -"+(J*0.3*N)+","+(J*N)+" q "+(J*0.3*N)+","+(-J*0.3*N)+" "+(J*0.6*N)+",0 z M "+(this.E.x-J*0.05*N)+","+(this.E.y-2.1*N+J*0.85*N)+" l "+(-J*0.05*N)+","+(J*N*1.5)+" l "+(J*0.2*N)+",0 l "+(-J*0.05*N)+","+(-J*N*1.5)+" z").attr({fill:"#999999",stroke:0}),label:this.paper.text((this.E.x+J*0.3*N),(this.E.y-2*N+J*N),this.phrases.diagram.earthorbit).attr({fill:"#999999",stroke:0,"text-anchor":"start","font-size":F})}}}}}for(var L in this.svg.orbits){if(this.svg.orbits[L].zoom!=this.zoom){H(this.svg.orbits[L])}else{T(this.svg.orbits[L])}if(this.zoom==0){H(this.Moonorbit);H(this.Moon)}else{T(this.Moonorbit);T(this.Moon)}if(this.svg.orbits.EM2){if(this.zoom==0){H(this.Moonlagrangian);H(this.Earthorbit)}else{T(this.Moonlagrangian);T(this.Earthorbit)}}}for(var O in this.labels){if(this.labels[O].zoom!=this.zoom){H(this.labels[O].arrow);H(this.labels[O].label)}else{T(this.labels[O].arrow);T(this.labels[O].label)}}var U=this.E.r/48;if(this.scale[this.zoom]<1){U*=this.scale[this.zoom]*10}if(this.Earth){w(this.Earth,["S",U,U,this.E.x,this.E.y])}return this};B.prototype.highlight=function(i){if(!i){return this}this.displayOrbits(i);for(var D in this.svg.orbits){if(D==i){this.svg.orbits[D].selected=true}else{this.svg.orbits[D].selected=false}this.svg.orbits[D].dotted.attr({"stroke-width":(this.svg.orbits[D].selected?this.svg.orbits[D].inp.stroke.selected:this.svg.orbits[D].inp.stroke.off)});this.svg.orbits[D].satellite.attr({r:(this.svg.orbits[D].selected?8:4),"stroke-width":(this.svg.orbits[D].selected?8:0),stroke:"white","stroke-opacity":0.5})}return this};function z(){var J=e("#launchrocket img");var F=e("#launchpadbg img");if(e("#launchexhaust").length==0){J.before('<canvas id="launchexhaust"></canvas>')}var D=document.getElementById("launchexhaust");var P=D.getContext("2d");this.active=true;var N=F.innerWidth(),H=F.innerHeight();D.width=N;D.height=H;var O=[];var K={};var E=80;for(var G=0;G<E;G++){O.push(new I())}function I(){this.speed={x:-0.5+Math.random()*1,y:-5+Math.random()*3};this.loc={x:J.offset().left+(J.width()/2)-F.offset().left,y:J.offset().top+J.height()-F.offset().top};this.radius=5+Math.random()*2;this.life=20+Math.random()*10;this.remaining_life=this.life;this.r=Math.round(Math.random()*55+200);this.g=this.r;this.b=this.r}var L=this;function M(){P.globalCompositeOperation="source-over";P.fillStyle="transparent";P.fillRect(0,0,N,H);for(var Q=0;Q<O.length;Q++){var R=O[Q];P.beginPath();R.opacity=Math.round(R.remaining_life/R.life*100)/100;var S=P.createRadialGradient(R.loc.x,R.loc.y,0,R.loc.x,R.loc.y,R.radius);S.addColorStop(0,"rgba("+R.r+", "+R.g+", "+R.b+", "+R.opacity+")");S.addColorStop(0.5,"rgba("+R.r+", "+R.g+", "+R.b+", "+R.opacity+")");S.addColorStop(1,"rgba("+Math.round(R.r*0.9)+", "+Math.round(R.g*0.9)+", "+Math.round(R.b*0.9)+", 0)");P.fillStyle=S;P.arc(R.loc.x,R.loc.y,R.radius,Math.PI*2,false);P.fill();R.remaining_life-=0.5;R.radius+=0.5;R.loc.x+=R.speed.x;R.loc.y-=R.speed.y;if(R.remaining_life<0||R.radius<0){O[Q]=new I()}}if(L.active){requestAnimationFrame(M)}}M();return this}z.prototype.stop=function(){this.active=false};function f(G){G+="";var i=G.split(".");var F=i[0];var D=i.length>1?"."+i[1]:"";var E=/(\d+)(\d{3})/;while(E.test(F)){F=F.replace(E,"$1,$2")}return F+D}function g(i,D){return(typeof i===D)}function b(D,E){var F=Math.floor(q.log10(D));var i=Math.round(D/Math.pow(10,F));return""+i+"&times;10<sup>"+F+"</sup>"+E}function n(i){return e("<div />").html(i).text()}function u(F){var D=e(window).width();var G=e(window).height();var i=0;var E=0;i=((D-F.outerWidth())/2);F.css({left:((D-F.outerWidth())/2)+"px"});if(e(window).height()>F.height()){E=((G-F.outerHeight())/2+e(window).scrollTop());e("body").css("overflow-y","hidden")}F.css({left:i+"px",top:E+"px",position:"absolute"})}function w(D,i){t=D.data("transform");if(g(t,"undefined")){t=D.attr("transform")}if(!g(t,"object")){t=[]}m=false;for(x=0;x<t.length;x++){for(j=0;j<i.length;j++){if(t[x][0]==i[j][0]){t[x]=i[j][0];m=true}}}if(!m){t.push(i)}D.transform(t).data("transform",t)}function s(E,F,G){if(G){var D=new Date();D.setTime(D.getTime()+(G*24*60*60*1000));var i="; expires="+D.toGMTString()}else{var i=""}document.cookie=E+"="+F+i+"; path=/"}function y(E){var G=E+"=";var D=document.cookie.split(";");for(var F=0;F<D.length;F++){var H=D[F];while(H.charAt(0)==" "){H=H.substring(1,H.length)}if(H.indexOf(G)==0){return H.substring(G.length,H.length)}}return null}function d(i){s(i,"",-1)}e.spacetelescope=function(D,i){if(typeof i=="object"){i.container=D}else{if(D){if(typeof D=="string"){i={container:D}}else{i=D}}else{i={}}}i.plugins=e.spacetelescope.plugins;return new C(i)};e.spacetelescope.plugins=[]})($);